var ba=Object.defineProperty;var ya=(i,t,s)=>t in i?ba(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s;var ce=(i,t,s)=>ya(i,typeof t!="symbol"?t+"":t,s);import{j as e,A as fe,m as P,c as va,P as Ir,u as wa,a as lr,S as ja}from"./ui-c8f28049.js";import{a as Bi,r as m,b as ka,c as Na,d as Te,R as ue}from"./vendor-d7cd1423.js";import{s as Wi,c as rt,f as Sa}from"./utils-aa2f15f0.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=s(n);fetch(n.href,a)}})();var cr={},ti=Bi;cr.createRoot=ti.createRoot,cr.hydrateRoot=ti.hydrateRoot;function _a(i,t){if(i instanceof RegExp)return{keys:!1,pattern:i};var s,r,n,a,o=[],l="",c=i.split("/");for(c[0]||c.shift();n=c.shift();)s=n[0],s==="*"?(o.push(s),l+=n[1]==="?"?"(?:/(.*))?":"/(.*)"):s===":"?(r=n.indexOf("?",1),a=n.indexOf(".",1),o.push(n.substring(1,~r?r:~a?a:n.length)),l+=~r&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(l+=(~r?"?":"")+"\\"+n.substring(a))):l+="/"+n;return{keys:o,pattern:new RegExp("^"+l+(t?"(?=$|/)":"/?$"),"i")}}const Ca=ka.useInsertionEffect,Pa=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Ea=Pa?m.useLayoutEffect:m.useEffect,Ta=Ca||Ea,Hi=i=>{const t=m.useRef([i,(...s)=>t[0](...s)]).current;return Ta(()=>{t[0]=i}),t[1]},Aa="popstate",Or="pushState",Lr="replaceState",$a="hashchange",si=[Aa,Or,Lr,$a],Ra=i=>{for(const t of si)addEventListener(t,i);return()=>{for(const t of si)removeEventListener(t,i)}},Vi=(i,t)=>Wi.useSyncExternalStore(Ra,i,t),Ia=()=>location.search,Oa=({ssrSearch:i=""}={})=>Vi(Ia,()=>i),ri=()=>location.pathname,La=({ssrPath:i}={})=>Vi(ri,i?()=>i:ri),Da=(i,{replace:t=!1,state:s=null}={})=>history[t?Lr:Or](s,"",i),za=(i={})=>[La(i),Da],ii=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[ii]>"u"){for(const i of[Or,Lr]){const t=history[i];history[i]=function(){const s=t.apply(this,arguments),r=new Event(i);return r.arguments=arguments,dispatchEvent(r),s}}Object.defineProperty(window,ii,{value:!0})}const Ua=(i,t)=>t.toLowerCase().indexOf(i.toLowerCase())?"~"+t:t.slice(i.length)||"/",qi=(i="")=>i==="/"?"":i,Ma=(i,t)=>i[0]==="~"?i.slice(1):qi(t)+i,Fa=(i="",t)=>Ua(ni(qi(i)),ni(t)),ni=i=>{try{return decodeURI(i)}catch{return i}},Gi={hook:za,searchHook:Oa,parser:_a,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:i=>i},Ji=m.createContext(Gi),ns=()=>m.useContext(Ji),Ki={},Yi=m.createContext(Ki),Ba=()=>m.useContext(Yi),As=i=>{const[t,s]=i.hook(i);return[Fa(i.base,t),Hi((r,n)=>s(Ma(r,i.base),n))]},xe=()=>As(ns()),Zi=(i,t,s,r)=>{const{pattern:n,keys:a}=t instanceof RegExp?{keys:!1,pattern:t}:i(t||"*",r),o=n.exec(s)||[],[l,...c]=o;return l!==void 0?[!0,(()=>{const d=a!==!1?Object.fromEntries(a.map((h,p)=>[h,c[p]])):o.groups;let u={...c};return d&&Object.assign(u,d),u})(),...r?[l]:[]]:[!1,null]},Qi=({children:i,...t})=>{const s=ns(),r=t.hook?Gi:s;let n=r;const[a,o]=t.ssrPath?.split("?")??[];o&&(t.ssrSearch=o,t.ssrPath=a),t.hrefs=t.hrefs??t.hook?.hrefs;let l=m.useRef({}),c=l.current,d=c;for(let u in r){const h=u==="base"?r[u]+(t[u]||""):t[u]||r[u];c===d&&h!==d[u]&&(l.current=d={...d}),d[u]=h,(h!==r[u]||h!==n[u])&&(n=d)}return m.createElement(Ji.Provider,{value:n,children:i})},ai=({children:i,component:t},s)=>t?m.createElement(t,{params:s}):typeof i=="function"?i(s):i,Wa=i=>{let t=m.useRef(Ki);const s=t.current;return t.current=Object.keys(i).length!==Object.keys(s).length||Object.entries(i).some(([r,n])=>n!==s[r])?i:s},Ce=({path:i,nest:t,match:s,...r})=>{const n=ns(),[a]=As(n),[o,l,c]=s??Zi(n.parser,i,a,t),d=Wa({...Ba(),...l});if(!o)return null;const u=c?m.createElement(Qi,{base:c},ai(r,d)):ai(r,d);return m.createElement(Yi.Provider,{value:d,children:u})};m.forwardRef((i,t)=>{const s=ns(),[r,n]=As(s),{to:a="",href:o=a,onClick:l,asChild:c,children:d,className:u,replace:h,state:p,...f}=i,g=Hi(y=>{y.ctrlKey||y.metaKey||y.altKey||y.shiftKey||y.button!==0||(l?.(y),y.defaultPrevented||(y.preventDefault(),n(o,i)))}),x=s.hrefs(o[0]==="~"?o.slice(1):s.base+o,s);return c&&m.isValidElement(d)?m.cloneElement(d,{onClick:g,href:x}):m.createElement("a",{...f,onClick:g,href:x,className:u?.call?u(r===o):u,children:d,ref:t})});const Xi=i=>Array.isArray(i)?i.flatMap(t=>Xi(t&&t.type===m.Fragment?t.props.children:t)):[i],oi=({children:i,location:t})=>{const s=ns(),[r]=As(s);for(const n of Xi(i)){let a=0;if(m.isValidElement(n)&&(a=Zi(s.parser,n.props.path,t||r,n.props.nest))[0])return m.cloneElement(n,{match:a})}return null},Ha="modulepreload",Va=function(i){return"/"+i},li={},Nt=function(t,s,r){if(!s||s.length===0)return t();const n=document.getElementsByTagName("link");return Promise.all(s.map(a=>{if(a=Va(a),a in li)return;li[a]=!0;const o=a.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const h=n[u];if(h.href===a&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":Ha,o||(d.as="script",d.crossOrigin=""),d.href=a,document.head.appendChild(d),o)return new Promise((u,h)=>{d.addEventListener("load",u),d.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>t()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},qa=i=>{let t;return i?t=i:typeof fetch>"u"?t=(...s)=>Nt(()=>Promise.resolve().then(()=>Mt),void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)};class Dr extends Error{constructor(t,s="FunctionsError",r){super(t),this.name=s,this.context=r}}class Ga extends Dr{constructor(t){super("Failed to send a request to the Edge Function","FunctionsFetchError",t)}}class ci extends Dr{constructor(t){super("Relay Error invoking the Edge Function","FunctionsRelayError",t)}}class di extends Dr{constructor(t){super("Edge Function returned a non-2xx status code","FunctionsHttpError",t)}}var dr;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(dr||(dr={}));var Ja=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};class Ka{constructor(t,{headers:s={},customFetch:r,region:n=dr.Any}={}){this.url=t,this.headers=s,this.region=n,this.fetch=qa(r)}setAuth(t){this.headers.Authorization=`Bearer ${t}`}invoke(t,s={}){var r;return Ja(this,void 0,void 0,function*(){try{const{headers:n,method:a,body:o}=s;let l={},{region:c}=s;c||(c=this.region);const d=new URL(`${this.url}/${t}`);c&&c!=="any"&&(l["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let u;o&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=o):typeof o=="string"?(l["Content-Type"]="text/plain",u=o):typeof FormData<"u"&&o instanceof FormData?u=o:(l["Content-Type"]="application/json",u=JSON.stringify(o)));const h=yield this.fetch(d.toString(),{method:a||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:u}).catch(x=>{throw new Ga(x)}),p=h.headers.get("x-relay-error");if(p&&p==="true")throw new ci(h);if(!h.ok)throw new di(h);let f=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield h.json():f==="application/octet-stream"?g=yield h.blob():f==="text/event-stream"?g=h:f==="multipart/form-data"?g=yield h.formData():g=yield h.text(),{data:g,error:null,response:h}}catch(n){return{data:null,error:n,response:n instanceof di||n instanceof ci?n.context:void 0}}})}}var je={},zr={},$s={},as={},Rs={},Is={},Ya=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Dt=Ya();const Za=Dt.fetch,en=Dt.fetch.bind(Dt),tn=Dt.Headers,Qa=Dt.Request,Xa=Dt.Response,Mt=Object.freeze(Object.defineProperty({__proto__:null,Headers:tn,Request:Qa,Response:Xa,default:en,fetch:Za},Symbol.toStringTag,{value:"Module"})),eo=Na(Mt);var Os={};Object.defineProperty(Os,"__esModule",{value:!0});let to=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}};Os.default=to;var sn=Te&&Te.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Is,"__esModule",{value:!0});const so=sn(eo),ro=sn(Os);let io=class{constructor(t){this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=t.headers,this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=t.shouldThrowOnError,this.signal=t.signal,this.isMaybeSingle=t.isMaybeSingle,t.fetch?this.fetch=t.fetch:typeof fetch>"u"?this.fetch=so.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,s){return this.headers=Object.assign({},this.headers),this.headers[t]=s,this}then(t,s){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var o,l,c;let d=null,u=null,h=null,p=a.status,f=a.statusText;if(a.ok){if(this.method!=="HEAD"){const b=await a.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=b:u=JSON.parse(b))}const x=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),y=(l=a.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");x&&y&&y.length>1&&(h=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,p=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const x=await a.text();try{d=JSON.parse(x),Array.isArray(d)&&a.status===404&&(u=[],d=null,p=200,f="OK")}catch{a.status===404&&x===""?(p=204,f="No Content"):d={message:x}}if(d&&this.isMaybeSingle&&(!((c=d?.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,p=200,f="OK"),d&&this.shouldThrowOnError)throw new ro.default(d)}return{error:d,data:u,count:h,status:p,statusText:f}});return this.shouldThrowOnError||(n=n.catch(a=>{var o,l,c;return{error:{message:`${(o=a?.name)!==null&&o!==void 0?o:"FetchError"}: ${a?.message}`,details:`${(l=a?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=a?.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),n.then(t,s)}returns(){return this}overrideTypes(){return this}};Is.default=io;var no=Te&&Te.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Rs,"__esModule",{value:!0});const ao=no(Is);let oo=class extends ao.default{select(t){let s=!1;const r=(t??"*").split("").map(n=>/\s/.test(n)&&!s?"":(n==='"'&&(s=!s),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(t,{ascending:s=!0,nullsFirst:r,foreignTable:n,referencedTable:a=n}={}){const o=a?`${a}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${t}.${s?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:s,referencedTable:r=s}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${t}`),this}range(t,s,{foreignTable:r,referencedTable:n=r}={}){const a=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(a,`${t}`),this.url.searchParams.set(o,`${s-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:t=!1,verbose:s=!1,settings:r=!1,buffers:n=!1,wal:a=!1,format:o="text"}={}){var l;const c=[t?"analyze":null,s?"verbose":null,r?"settings":null,n?"buffers":null,a?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${d}"; options=${c};`,o==="json"?this:this}rollback(){var t;return((t=this.headers.Prefer)!==null&&t!==void 0?t:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Rs.default=oo;var lo=Te&&Te.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(as,"__esModule",{value:!0});const co=lo(Rs);let uo=class extends co.default{eq(t,s){return this.url.searchParams.append(t,`eq.${s}`),this}neq(t,s){return this.url.searchParams.append(t,`neq.${s}`),this}gt(t,s){return this.url.searchParams.append(t,`gt.${s}`),this}gte(t,s){return this.url.searchParams.append(t,`gte.${s}`),this}lt(t,s){return this.url.searchParams.append(t,`lt.${s}`),this}lte(t,s){return this.url.searchParams.append(t,`lte.${s}`),this}like(t,s){return this.url.searchParams.append(t,`like.${s}`),this}likeAllOf(t,s){return this.url.searchParams.append(t,`like(all).{${s.join(",")}}`),this}likeAnyOf(t,s){return this.url.searchParams.append(t,`like(any).{${s.join(",")}}`),this}ilike(t,s){return this.url.searchParams.append(t,`ilike.${s}`),this}ilikeAllOf(t,s){return this.url.searchParams.append(t,`ilike(all).{${s.join(",")}}`),this}ilikeAnyOf(t,s){return this.url.searchParams.append(t,`ilike(any).{${s.join(",")}}`),this}is(t,s){return this.url.searchParams.append(t,`is.${s}`),this}in(t,s){const r=Array.from(new Set(s)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(t,`in.(${r})`),this}contains(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cs.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cs.{${s.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(s)}`),this}containedBy(t,s){return typeof s=="string"?this.url.searchParams.append(t,`cd.${s}`):Array.isArray(s)?this.url.searchParams.append(t,`cd.{${s.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(s)}`),this}rangeGt(t,s){return this.url.searchParams.append(t,`sr.${s}`),this}rangeGte(t,s){return this.url.searchParams.append(t,`nxl.${s}`),this}rangeLt(t,s){return this.url.searchParams.append(t,`sl.${s}`),this}rangeLte(t,s){return this.url.searchParams.append(t,`nxr.${s}`),this}rangeAdjacent(t,s){return this.url.searchParams.append(t,`adj.${s}`),this}overlaps(t,s){return typeof s=="string"?this.url.searchParams.append(t,`ov.${s}`):this.url.searchParams.append(t,`ov.{${s.join(",")}}`),this}textSearch(t,s,{config:r,type:n}={}){let a="";n==="plain"?a="pl":n==="phrase"?a="ph":n==="websearch"&&(a="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(t,`${a}fts${o}.${s}`),this}match(t){return Object.entries(t).forEach(([s,r])=>{this.url.searchParams.append(s,`eq.${r}`)}),this}not(t,s,r){return this.url.searchParams.append(t,`not.${s}.${r}`),this}or(t,{foreignTable:s,referencedTable:r=s}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${t})`),this}filter(t,s,r){return this.url.searchParams.append(t,`${s}.${r}`),this}};as.default=uo;var ho=Te&&Te.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($s,"__esModule",{value:!0});const qt=ho(as);let mo=class{constructor(t,{headers:s={},schema:r,fetch:n}){this.url=t,this.headers=s,this.schema=r,this.fetch=n}select(t,{head:s=!1,count:r}={}){const n=s?"HEAD":"GET";let a=!1;const o=(t??"*").split("").map(l=>/\s/.test(l)&&!a?"":(l==='"'&&(a=!a),l)).join("");return this.url.searchParams.set("select",o),r&&(this.headers.Prefer=`count=${r}`),new qt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(t,{count:s,defaultToNull:r=!0}={}){const n="POST",a=[];if(this.headers.Prefer&&a.push(this.headers.Prefer),s&&a.push(`count=${s}`),r||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(t)){const o=t.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new qt.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}upsert(t,{onConflict:s,ignoreDuplicates:r=!1,count:n,defaultToNull:a=!0}={}){const o="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(s!==void 0&&this.url.searchParams.set("on_conflict",s),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),a||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(t)){const c=t.reduce((d,u)=>d.concat(Object.keys(u)),[]);if(c.length>0){const d=[...new Set(c)].map(u=>`"${u}"`);this.url.searchParams.set("columns",d.join(","))}}return new qt.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}update(t,{count:s}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),s&&n.push(`count=${s}`),this.headers.Prefer=n.join(","),new qt.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:this.fetch,allowEmpty:!1})}delete({count:t}={}){const s="DELETE",r=[];return t&&r.push(`count=${t}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new qt.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};$s.default=mo;var Ls={},Ds={};Object.defineProperty(Ds,"__esModule",{value:!0});Ds.version=void 0;Ds.version="0.0.0-automated";Object.defineProperty(Ls,"__esModule",{value:!0});Ls.DEFAULT_HEADERS=void 0;const po=Ds;Ls.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${po.version}`};var rn=Te&&Te.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(zr,"__esModule",{value:!0});const fo=rn($s),go=rn(as),xo=Ls;let bo=class nn{constructor(t,{headers:s={},schema:r,fetch:n}={}){this.url=t,this.headers=Object.assign(Object.assign({},xo.DEFAULT_HEADERS),s),this.schemaName=r,this.fetch=n}from(t){const s=new URL(`${this.url}/${t}`);return new fo.default(s,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new nn(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(t,s={},{head:r=!1,get:n=!1,count:a}={}){let o;const l=new URL(`${this.url}/rpc/${t}`);let c;r||n?(o=r?"HEAD":"GET",Object.entries(s).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{l.searchParams.append(u,h)})):(o="POST",c=s);const d=Object.assign({},this.headers);return a&&(d.Prefer=`count=${a}`),new go.default({method:o,url:l,headers:d,schema:this.schemaName,body:c,fetch:this.fetch,allowEmpty:!1})}};zr.default=bo;var Ft=Te&&Te.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(je,"__esModule",{value:!0});je.PostgrestError=je.PostgrestBuilder=je.PostgrestTransformBuilder=je.PostgrestFilterBuilder=je.PostgrestQueryBuilder=je.PostgrestClient=void 0;const an=Ft(zr);je.PostgrestClient=an.default;const on=Ft($s);je.PostgrestQueryBuilder=on.default;const ln=Ft(as);je.PostgrestFilterBuilder=ln.default;const cn=Ft(Rs);je.PostgrestTransformBuilder=cn.default;const dn=Ft(Is);je.PostgrestBuilder=dn.default;const un=Ft(Os);je.PostgrestError=un.default;var yo=je.default={PostgrestClient:an.default,PostgrestQueryBuilder:on.default,PostgrestFilterBuilder:ln.default,PostgrestTransformBuilder:cn.default,PostgrestBuilder:dn.default,PostgrestError:un.default};const{PostgrestClient:vo,PostgrestQueryBuilder:im,PostgrestFilterBuilder:nm,PostgrestTransformBuilder:am,PostgrestBuilder:om,PostgrestError:lm}=yo;class wo{static detectEnvironment(){var t;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((t=navigator.userAgent)===null||t===void 0)&&t.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const s=parseInt(process.versions.node.split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const t=this.detectEnvironment();if(t.constructor)return t.constructor;let s=t.error||"WebSocket not supported in this environment.";throw t.workaround&&(s+=`

Suggested solution: ${t.workaround}`),new Error(s)}static createWebSocket(t,s){const r=this.getWebSocketConstructor();return new r(t,s)}static isWebSocketSupported(){try{const t=this.detectEnvironment();return t.type==="native"||t.type==="ws"}catch{return!1}}}const jo="2.15.1",ko=`realtime-js/${jo}`,No="1.0.0",ur=1e4,So=1e3,_o=100;var Zt;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Zt||(Zt={}));var me;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(me||(me={}));var Ie;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(Ie||(Ie={}));var hr;(function(i){i.websocket="websocket"})(hr||(hr={}));var mt;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(mt||(mt={}));class Co{constructor(){this.HEADER_LENGTH=1}decode(t,s){return t.constructor===ArrayBuffer?s(this._binaryDecode(t)):s(typeof t=="string"?JSON.parse(t):{})}_binaryDecode(t){const s=new DataView(t),r=new TextDecoder;return this._decodeBroadcast(t,s,r)}_decodeBroadcast(t,s,r){const n=s.getUint8(1),a=s.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(t.slice(o,o+n));o=o+n;const c=r.decode(t.slice(o,o+a));o=o+a;const d=JSON.parse(r.decode(t.slice(o,t.byteLength)));return{ref:null,topic:l,event:c,payload:d}}}class hn{constructor(t,s){this.callback=t,this.timerCalc=s,this.timer=void 0,this.tries=0,this.callback=t,this.timerCalc=s}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var ne;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(ne||(ne={}));const ui=(i,t,s={})=>{var r;const n=(r=s.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(t).reduce((a,o)=>(a[o]=Po(o,i,t,n),a),{})},Po=(i,t,s,r)=>{const n=t.find(l=>l.name===i),a=n?.type,o=s[i];return a&&!r.includes(a)?mn(a,o):mr(o)},mn=(i,t)=>{if(i.charAt(0)==="_"){const s=i.slice(1,i.length);return $o(t,s)}switch(i){case ne.bool:return Eo(t);case ne.float4:case ne.float8:case ne.int2:case ne.int4:case ne.int8:case ne.numeric:case ne.oid:return To(t);case ne.json:case ne.jsonb:return Ao(t);case ne.timestamp:return Ro(t);case ne.abstime:case ne.date:case ne.daterange:case ne.int4range:case ne.int8range:case ne.money:case ne.reltime:case ne.text:case ne.time:case ne.timestamptz:case ne.timetz:case ne.tsrange:case ne.tstzrange:return mr(t);default:return mr(t)}},mr=i=>i,Eo=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},To=i=>{if(typeof i=="string"){const t=parseFloat(i);if(!Number.isNaN(t))return t}return i},Ao=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(t){return console.log(`JSON parse error: ${t}`),i}return i},$o=(i,t)=>{if(typeof i!="string")return i;const s=i.length-1,r=i[s];if(i[0]==="{"&&r==="}"){let a;const o=i.slice(1,s);try{a=JSON.parse("["+o+"]")}catch{a=o?o.split(","):[]}return a.map(l=>mn(t,l))}return i},Ro=i=>typeof i=="string"?i.replace(" ","T"):i,pn=i=>{let t=i;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class Js{constructor(t,s,r={},n=ur){this.channel=t,this.event=s,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(t){this.timeout=t,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(t){this.payload=Object.assign(Object.assign({},this.payload),t)}receive(t,s){var r;return this._hasReceived(t)&&s((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:t,callback:s}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const t=s=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=s,this._matchReceive(s)};this.channel._on(this.refEvent,{},t),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(t,s){this.refEvent&&this.channel._trigger(this.refEvent,{status:t,response:s})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:t,response:s}){this.recHooks.filter(r=>r.status===t).forEach(r=>r.callback(s))}_hasReceived(t){return this.receivedResp&&this.receivedResp.status===t}}var hi;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(hi||(hi={}));class Qt{constructor(t,s){this.channel=t,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=s?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Qt.syncState(this.state,n,a,o),this.pendingDiffs.forEach(c=>{this.state=Qt.syncDiff(this.state,c,a,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},n=>{const{onJoin:a,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Qt.syncDiff(this.state,n,a,o),l())}),this.onJoin((n,a,o)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:a,newPresences:o})}),this.onLeave((n,a,o)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:a,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(t,s,r,n){const a=this.cloneDeep(t),o=this.transformState(s),l={},c={};return this.map(a,(d,u)=>{o[d]||(c[d]=u)}),this.map(o,(d,u)=>{const h=a[d];if(h){const p=u.map(y=>y.presence_ref),f=h.map(y=>y.presence_ref),g=u.filter(y=>f.indexOf(y.presence_ref)<0),x=h.filter(y=>p.indexOf(y.presence_ref)<0);g.length>0&&(l[d]=g),x.length>0&&(c[d]=x)}else l[d]=u}),this.syncDiff(a,{joins:l,leaves:c},r,n)}static syncDiff(t,s,r,n){const{joins:a,leaves:o}={joins:this.transformState(s.joins),leaves:this.transformState(s.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(a,(l,c)=>{var d;const u=(d=t[l])!==null&&d!==void 0?d:[];if(t[l]=this.cloneDeep(c),u.length>0){const h=t[l].map(f=>f.presence_ref),p=u.filter(f=>h.indexOf(f.presence_ref)<0);t[l].unshift(...p)}r(l,u,c)}),this.map(o,(l,c)=>{let d=t[l];if(!d)return;const u=c.map(h=>h.presence_ref);d=d.filter(h=>u.indexOf(h.presence_ref)<0),t[l]=d,n(l,d,c),d.length===0&&delete t[l]}),t}static map(t,s){return Object.getOwnPropertyNames(t).map(r=>s(r,t[r]))}static transformState(t){return t=this.cloneDeep(t),Object.getOwnPropertyNames(t).reduce((s,r)=>{const n=t[r];return"metas"in n?s[r]=n.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):s[r]=n,s},{})}static cloneDeep(t){return JSON.parse(JSON.stringify(t))}onJoin(t){this.caller.onJoin=t}onLeave(t){this.caller.onLeave=t}onSync(t){this.caller.onSync=t}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var mi;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(mi||(mi={}));var Xt;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Xt||(Xt={}));var Ve;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Ve||(Ve={}));class Ur{constructor(t,s={config:{}},r){this.topic=t,this.params=s,this.socket=r,this.bindings={},this.state=me.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=t.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},s.config),this.timeout=this.socket.timeout,this.joinPush=new Js(this,Ie.join,this.params,this.timeout),this.rejoinTimer=new hn(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=me.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=me.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=me.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Ie.reply,{},(n,a)=>{this._trigger(this._replyEventName(a),n)}),this.presence=new Qt(this),this.broadcastEndpointURL=pn(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(t,s=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==me.closed){const{config:{broadcast:a,presence:o,private:l}}=this.params,c=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(p=>p.filter))!==null&&n!==void 0?n:[],d=!!this.bindings[Xt.PRESENCE]&&this.bindings[Xt.PRESENCE].length>0,u={},h={broadcast:a,presence:Object.assign(Object.assign({},o),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(p=>t?.(Ve.CHANNEL_ERROR,p)),this._onClose(()=>t?.(Ve.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(s),this.joinPush.receive("ok",async({postgres_changes:p})=>{var f;if(this.socket.setAuth(),p===void 0){t?.(Ve.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,x=(f=g?.length)!==null&&f!==void 0?f:0,y=[];for(let b=0;b<x;b++){const v=g[b],{filter:{event:j,schema:k,table:L,filter:C}}=v,$=p&&p[b];if($&&$.event===j&&$.schema===k&&$.table===L&&$.filter===C)y.push(Object.assign(Object.assign({},v),{id:$.id}));else{this.unsubscribe(),this.state=me.errored,t?.(Ve.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,t&&t(Ve.SUBSCRIBED);return}}).receive("error",p=>{this.state=me.errored,t?.(Ve.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{t?.(Ve.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(t,s={}){return await this.send({type:"presence",event:"track",payload:t},s.timeout||this.timeout)}async untrack(t={}){return await this.send({type:"presence",event:"untrack"},t)}on(t,s,r){return this.state===me.joined&&t===Xt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(t,s,r)}async send(t,s={}){var r,n;if(!this._canPush()&&t.type==="broadcast"){const{event:a,payload:o}=t,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:a,payload:o,private:this.private}]})};try{const d=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=s.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=d.body)===null||n===void 0?void 0:n.cancel()),d.ok?"ok":"error"}catch(d){return d.name==="AbortError"?"timed out":"error"}}else return new Promise(a=>{var o,l,c;const d=this._push(t.type,t,s.timeout||this.timeout);t.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&a("ok"),d.receive("ok",()=>a("ok")),d.receive("error",()=>a("error")),d.receive("timeout",()=>a("timed out"))})}updateJoinPayload(t){this.joinPush.updatePayload(t)}unsubscribe(t=this.timeout){this.state=me.leaving;const s=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Ie.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Js(this,Ie.leave,{},t),r.receive("ok",()=>{s(),n("ok")}).receive("timeout",()=>{s(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(t=>t.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=me.closed,this.bindings={}}async _fetchWithTimeout(t,s,r){const n=new AbortController,a=setTimeout(()=>n.abort(),r),o=await this.socket.fetch(t,Object.assign(Object.assign({},s),{signal:n.signal}));return clearTimeout(a),o}_push(t,s,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${t}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Js(this,t,s,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(t){if(t.startTimeout(),this.pushBuffer.push(t),this.pushBuffer.length>_o){const s=this.pushBuffer.shift();s&&(s.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${s.event}`,s.payload))}}_onMessage(t,s,r){return s}_isMember(t){return this.topic===t}_joinRef(){return this.joinPush.ref}_trigger(t,s,r){var n,a;const o=t.toLocaleLowerCase(),{close:l,error:c,leave:d,join:u}=Ie;if(r&&[l,c,d,u].indexOf(o)>=0&&r!==this._joinRef())return;let p=this._onMessage(o,s,r);if(s&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(f=>{var g,x,y;return((g=f.filter)===null||g===void 0?void 0:g.event)==="*"||((y=(x=f.filter)===null||x===void 0?void 0:x.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===o}).map(f=>f.callback(p,r)):(a=this.bindings[o])===null||a===void 0||a.filter(f=>{var g,x,y,b,v,j;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const k=f.id,L=(g=f.filter)===null||g===void 0?void 0:g.event;return k&&((x=s.ids)===null||x===void 0?void 0:x.includes(k))&&(L==="*"||L?.toLocaleLowerCase()===((y=s.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const k=(v=(b=f?.filter)===null||b===void 0?void 0:b.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return k==="*"||k===((j=s?.event)===null||j===void 0?void 0:j.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof p=="object"&&"ids"in p){const g=p.data,{schema:x,table:y,commit_timestamp:b,type:v,errors:j}=g;p=Object.assign(Object.assign({},{schema:x,table:y,commit_timestamp:b,eventType:v,new:{},old:{},errors:j}),this._getPayloadRecords(g))}f.callback(p,r)})}_isClosed(){return this.state===me.closed}_isJoined(){return this.state===me.joined}_isJoining(){return this.state===me.joining}_isLeaving(){return this.state===me.leaving}_replyEventName(t){return`chan_reply_${t}`}_on(t,s,r){const n=t.toLocaleLowerCase(),a={type:n,filter:s,callback:r};return this.bindings[n]?this.bindings[n].push(a):this.bindings[n]=[a],this}_off(t,s){const r=t.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var a;return!(((a=n.type)===null||a===void 0?void 0:a.toLocaleLowerCase())===r&&Ur.isEqual(n.filter,s))})),this}static isEqual(t,s){if(Object.keys(t).length!==Object.keys(s).length)return!1;for(const r in t)if(t[r]!==s[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(t){this._on(Ie.close,{},t)}_onError(t){this._on(Ie.error,{},s=>t(s))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(t=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=me.joining,this.joinPush.resend(t))}_getPayloadRecords(t){const s={new:{},old:{}};return(t.type==="INSERT"||t.type==="UPDATE")&&(s.new=ui(t.columns,t.record)),(t.type==="UPDATE"||t.type==="DELETE")&&(s.old=ui(t.columns,t.old_record)),s}}const pi=()=>{},ps={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},Io=[1e3,2e3,5e3,1e4],Oo=1e4,Lo=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Do{constructor(t,s){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=ur,this.transport=null,this.heartbeatIntervalMs=ps.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=pi,this.ref=0,this.reconnectTimer=null,this.logger=pi,this.conn=null,this.sendBuffer=[],this.serializer=new Co,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>Nt(()=>Promise.resolve().then(()=>Mt),void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):a=fetch,(...o)=>a(...o)},!(!((r=s?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=s.params.apikey,this.endPoint=`${t}/${hr.websocket}`,this.httpEndpoint=pn(t),this._initializeOptions(s),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(s?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=wo.createWebSocket(this.endpointURL())}catch(t){this._setConnectionState("disconnected");const s=t.message;throw s.includes("Node.js")?new Error(`${s}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${s}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:No}))}disconnect(t,s){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},t?this.conn.close(t,s??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(t){const s=await t.unsubscribe();return this.channels.length===0&&this.disconnect(),s}async removeAllChannels(){const t=await Promise.all(this.channels.map(s=>s.unsubscribe()));return this.channels=[],this.disconnect(),t}log(t,s,r){this.logger(t,s,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Zt.connecting:return mt.Connecting;case Zt.open:return mt.Open;case Zt.closing:return mt.Closing;default:return mt.Closed}}isConnected(){return this.connectionState()===mt.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(t,s={config:{}}){const r=`realtime:${t}`,n=this.getChannels().find(a=>a.topic===r);if(n)return n;{const a=new Ur(`realtime:${t}`,s,this);return this.channels.push(a),a}}push(t){const{topic:s,event:r,payload:n,ref:a}=t,o=()=>{this.encode(t,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${s} ${r} (${a})`,n),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(t=null){this._authPromise=this._performAuth(t);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var t;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(t=this.conn)===null||t===void 0||t.close(So,"heartbeat timeout"),setTimeout(()=>{var s;this.isConnected()||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout()},ps.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(t){this.heartbeatCallback=t}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(t=>t()),this.sendBuffer=[])}_makeRef(){let t=this.ref+1;return t===this.ref?this.ref=0:this.ref=t,this.ref.toString()}_leaveOpenTopic(t){let s=this.channels.find(r=>r.topic===t&&(r._isJoined()||r._isJoining()));s&&(this.log("transport",`leaving duplicate topic "${t}"`),s.unsubscribe())}_remove(t){this.channels=this.channels.filter(s=>s.topic!==t.topic)}_onConnMessage(t){this.decode(t.data,s=>{s.topic==="phoenix"&&s.event==="phx_reply"&&this.heartbeatCallback(s.payload.status==="ok"?"ok":"error"),s.ref&&s.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:a,ref:o}=s,l=o?`(${o})`:"",c=a.status||"";this.log("receive",`${c} ${r} ${n} ${l}`.trim(),a),this.channels.filter(d=>d._isMember(r)).forEach(d=>d._trigger(n,a,o)),this._triggerStateCallbacks("message",s)})}_clearTimer(t){var s;t==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):t==="reconnect"&&((s=this.reconnectTimer)===null||s===void 0||s.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=t=>this._onConnError(t),this.conn.onmessage=t=>this._onConnMessage(t),this.conn.onclose=t=>this._onConnClose(t))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(t=>t.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const t=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(t),this.workerRef.onerror=s=>{this.log("worker","worker error",s.message),this.workerRef.terminate()},this.workerRef.onmessage=s=>{s.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(t){var s;this._setConnectionState("disconnected"),this.log("transport","close",t),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(s=this.reconnectTimer)===null||s===void 0||s.scheduleTimeout(),this._triggerStateCallbacks("close",t)}_onConnError(t){this._setConnectionState("disconnected"),this.log("transport",`${t}`),this._triggerChanError(),this._triggerStateCallbacks("error",t)}_triggerChanError(){this.channels.forEach(t=>t._trigger(Ie.error))}_appendParams(t,s){if(Object.keys(s).length===0)return t;const r=t.match(/\?/)?"&":"?",n=new URLSearchParams(s);return`${t}${r}${n}`}_workerObjectUrl(t){let s;if(t)s=t;else{const r=new Blob([Lo],{type:"application/javascript"});s=URL.createObjectURL(r)}return s}_setConnectionState(t,s=!1){this._connectionState=t,t==="connecting"?this._wasManualDisconnect=!1:t==="disconnecting"&&(this._wasManualDisconnect=s)}async _performAuth(t=null){let s;t?s=t:this.accessToken?s=await this.accessToken():s=this.accessTokenValue,this.accessTokenValue!=s&&(this.accessTokenValue=s,this.channels.forEach(r=>{const n={access_token:s,version:ko};s&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(Ie.access_token,{access_token:s})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(t="general"){this.setAuth().catch(s=>{this.log("error",`error setting auth in ${t}`,s)})}_triggerStateCallbacks(t,s){try{this.stateChangeCallbacks[t].forEach(r=>{try{r(s)}catch(n){this.log("error",`error in ${t} callback`,n)}})}catch(r){this.log("error",`error triggering ${t} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new hn(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ps.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(t){var s,r,n,a,o,l,c,d;if(this.transport=(s=t?.transport)!==null&&s!==void 0?s:null,this.timeout=(r=t?.timeout)!==null&&r!==void 0?r:ur,this.heartbeatIntervalMs=(n=t?.heartbeatIntervalMs)!==null&&n!==void 0?n:ps.HEARTBEAT_INTERVAL,this.worker=(a=t?.worker)!==null&&a!==void 0?a:!1,this.accessToken=(o=t?.accessToken)!==null&&o!==void 0?o:null,t?.params&&(this.params=t.params),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=t?.reconnectAfterMs)!==null&&l!==void 0?l:u=>Io[u-1]||Oo,this.encode=(c=t?.encode)!==null&&c!==void 0?c:(u,h)=>h(JSON.stringify(u)),this.decode=(d=t?.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=t?.workerUrl}}}class Mr extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}}function pe(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class zo extends Mr{constructor(t,s,r){super(t),this.name="StorageApiError",this.status=s,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class pr extends Mr{constructor(t,s){super(t),this.name="StorageUnknownError",this.originalError=s}}var Uo=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};const fn=i=>{let t;return i?t=i:typeof fetch>"u"?t=(...s)=>Nt(()=>Promise.resolve().then(()=>Mt),void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},Mo=()=>Uo(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Nt(()=>Promise.resolve().then(()=>Mt),void 0)).Response:Response}),fr=i=>{if(Array.isArray(i))return i.map(s=>fr(s));if(typeof i=="function"||i!==Object(i))return i;const t={};return Object.entries(i).forEach(([s,r])=>{const n=s.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""));t[n]=fr(r)}),t},Fo=i=>{if(typeof i!="object"||i===null)return!1;const t=Object.getPrototypeOf(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var St=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};const Ks=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Bo=(i,t,s)=>St(void 0,void 0,void 0,function*(){const r=yield Mo();i instanceof r&&!s?.noResolveJson?i.json().then(n=>{const a=i.status||500,o=n?.statusCode||a+"";t(new zo(Ks(n),a,o))}).catch(n=>{t(new pr(Ks(n),n))}):t(new pr(Ks(i),i))}),Wo=(i,t,s,r)=>{const n={method:i,headers:t?.headers||{}};return i==="GET"||!r?n:(Fo(r)?(n.headers=Object.assign({"Content-Type":"application/json"},t?.headers),n.body=JSON.stringify(r)):n.body=r,t?.duplex&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),s))};function os(i,t,s,r,n,a){return St(this,void 0,void 0,function*(){return new Promise((o,l)=>{i(s,Wo(t,r,n,a)).then(c=>{if(!c.ok)throw c;return r?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Bo(c,l,r))})})}function _s(i,t,s,r){return St(this,void 0,void 0,function*(){return os(i,"GET",t,s,r)})}function Ue(i,t,s,r,n){return St(this,void 0,void 0,function*(){return os(i,"POST",t,r,n,s)})}function gr(i,t,s,r,n){return St(this,void 0,void 0,function*(){return os(i,"PUT",t,r,n,s)})}function Ho(i,t,s,r){return St(this,void 0,void 0,function*(){return os(i,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}function gn(i,t,s,r,n){return St(this,void 0,void 0,function*(){return os(i,"DELETE",t,r,n,s)})}var ve=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};const Vo={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fi={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class qo{constructor(t,s={},r,n){this.url=t,this.headers=s,this.bucketId=r,this.fetch=fn(n)}uploadOrUpdate(t,s,r,n){return ve(this,void 0,void 0,function*(){try{let a;const o=Object.assign(Object.assign({},fi),n);let l=Object.assign(Object.assign({},this.headers),t==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(a=new FormData,a.append("cacheControl",o.cacheControl),c&&a.append("metadata",this.encodeMetadata(c)),a.append("",r)):typeof FormData<"u"&&r instanceof FormData?(a=r,a.append("cacheControl",o.cacheControl),c&&a.append("metadata",this.encodeMetadata(c))):(a=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),n?.headers&&(l=Object.assign(Object.assign({},l),n.headers));const d=this._removeEmptyFolders(s),u=this._getFinalPath(d),h=yield(t=="PUT"?gr:Ue)(this.fetch,`${this.url}/object/${u}`,a,Object.assign({headers:l},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:d,id:h.Id,fullPath:h.Key},error:null}}catch(a){if(pe(a))return{data:null,error:a};throw a}})}upload(t,s,r){return ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",t,s,r)})}uploadToSignedUrl(t,s,r,n){return ve(this,void 0,void 0,function*(){const a=this._removeEmptyFolders(t),o=this._getFinalPath(a),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",s);try{let c;const d=Object.assign({upsert:fi.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",d.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",d.cacheControl)):(c=r,u["cache-control"]=`max-age=${d.cacheControl}`,u["content-type"]=d.contentType);const h=yield gr(this.fetch,l.toString(),c,{headers:u});return{data:{path:a,fullPath:h.Key},error:null}}catch(c){if(pe(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(t,s){return ve(this,void 0,void 0,function*(){try{let r=this._getFinalPath(t);const n=Object.assign({},this.headers);s?.upsert&&(n["x-upsert"]="true");const a=yield Ue(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),o=new URL(this.url+a.url),l=o.searchParams.get("token");if(!l)throw new Mr("No token returned by API");return{data:{signedUrl:o.toString(),path:t,token:l},error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}})}update(t,s,r){return ve(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",t,s,r)})}move(t,s,r){return ve(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}copy(t,s,r){return ve(this,void 0,void 0,function*(){try{return{data:{path:(yield Ue(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:t,destinationKey:s,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}createSignedUrl(t,s,r){return ve(this,void 0,void 0,function*(){try{let n=this._getFinalPath(t),a=yield Ue(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:s},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return a={signedUrl:encodeURI(`${this.url}${a.signedURL}${o}`)},{data:a,error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}createSignedUrls(t,s,r){return ve(this,void 0,void 0,function*(){try{const n=yield Ue(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:s,paths:t},{headers:this.headers}),a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${a}`):null})),error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}download(t,s){return ve(this,void 0,void 0,function*(){const n=typeof s?.transform<"u"?"render/image/authenticated":"object",a=this.transformOptsToQueryString(s?.transform||{}),o=a?`?${a}`:"";try{const l=this._getFinalPath(t);return{data:yield(yield _s(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(pe(l))return{data:null,error:l};throw l}})}info(t){return ve(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{const r=yield _s(this.fetch,`${this.url}/object/info/${s}`,{headers:this.headers});return{data:fr(r),error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}})}exists(t){return ve(this,void 0,void 0,function*(){const s=this._getFinalPath(t);try{return yield Ho(this.fetch,`${this.url}/object/${s}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(pe(r)&&r instanceof pr){const n=r.originalError;if([400,404].includes(n?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(t,s){const r=this._getFinalPath(t),n=[],a=s?.download?`download=${s.download===!0?"":s.download}`:"";a!==""&&n.push(a);const l=typeof s?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(s?.transform||{});c!==""&&n.push(c);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${d}`)}}}remove(t){return ve(this,void 0,void 0,function*(){try{return{data:yield gn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:t},{headers:this.headers}),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}list(t,s,r){return ve(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Vo),s),{prefix:t||""});return{data:yield Ue(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(pe(n))return{data:null,error:n};throw n}})}listV2(t,s){return ve(this,void 0,void 0,function*(){try{const r=Object.assign({},t);return{data:yield Ue(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}})}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const s=[];return t.width&&s.push(`width=${t.width}`),t.height&&s.push(`height=${t.height}`),t.resize&&s.push(`resize=${t.resize}`),t.format&&s.push(`format=${t.format}`),t.quality&&s.push(`quality=${t.quality}`),s.join("&")}}const Go="2.11.0",Jo={"X-Client-Info":`storage-js/${Go}`};var Pt=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};class Ko{constructor(t,s={},r,n){const a=new URL(t);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href,this.headers=Object.assign(Object.assign({},Jo),s),this.fetch=fn(r)}listBuckets(){return Pt(this,void 0,void 0,function*(){try{return{data:yield _s(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(t){if(pe(t))return{data:null,error:t};throw t}})}getBucket(t){return Pt(this,void 0,void 0,function*(){try{return{data:yield _s(this.fetch,`${this.url}/bucket/${t}`,{headers:this.headers}),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}createBucket(t,s={public:!1}){return Pt(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/bucket`,{id:t,name:t,type:s.type,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}})}updateBucket(t,s){return Pt(this,void 0,void 0,function*(){try{return{data:yield gr(this.fetch,`${this.url}/bucket/${t}`,{id:t,name:t,public:s.public,file_size_limit:s.fileSizeLimit,allowed_mime_types:s.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(pe(r))return{data:null,error:r};throw r}})}emptyBucket(t){return Pt(this,void 0,void 0,function*(){try{return{data:yield Ue(this.fetch,`${this.url}/bucket/${t}/empty`,{},{headers:this.headers}),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}deleteBucket(t){return Pt(this,void 0,void 0,function*(){try{return{data:yield gn(this.fetch,`${this.url}/bucket/${t}`,{},{headers:this.headers}),error:null}}catch(s){if(pe(s))return{data:null,error:s};throw s}})}}class Yo extends Ko{constructor(t,s={},r,n){super(t,s,r,n)}from(t){return new qo(this.url,this.headers,t,this.fetch)}}const Zo="2.55.0";let Yt="";typeof Deno<"u"?Yt="deno":typeof document<"u"?Yt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Yt="react-native":Yt="node";const Qo={"X-Client-Info":`supabase-js-${Yt}/${Zo}`},Xo={headers:Qo},el={schema:"public"},tl={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},sl={};var rl=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};const il=i=>{let t;return i?t=i:typeof fetch>"u"?t=en:t=fetch,(...s)=>t(...s)},nl=()=>typeof Headers>"u"?tn:Headers,al=(i,t,s)=>{const r=il(s),n=nl();return(a,o)=>rl(void 0,void 0,void 0,function*(){var l;const c=(l=yield t())!==null&&l!==void 0?l:i;let d=new n(o?.headers);return d.has("apikey")||d.set("apikey",i),d.has("Authorization")||d.set("Authorization",`Bearer ${c}`),r(a,Object.assign(Object.assign({},o),{headers:d}))})};var ol=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};function ll(i){return i.endsWith("/")?i:i+"/"}function cl(i,t){var s,r;const{db:n,auth:a,realtime:o,global:l}=i,{db:c,auth:d,realtime:u,global:h}=t,p={db:Object.assign(Object.assign({},c),n),auth:Object.assign(Object.assign({},d),a),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(s=h?.headers)!==null&&s!==void 0?s:{}),(r=l?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>ol(this,void 0,void 0,function*(){return""})};return i.accessToken?p.accessToken=i.accessToken:delete p.accessToken,p}const xn="2.71.1",Rt=30*1e3,xr=3,Ys=xr*Rt,dl="http://localhost:9999",ul="supabase.auth.token",hl={"X-Client-Info":`gotrue-js/${xn}`},br="X-Supabase-Api-Version",bn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},ml=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,pl=10*60*1e3;class Fr extends Error{constructor(t,s,r){super(t),this.__isAuthError=!0,this.name="AuthError",this.status=s,this.code=r}}function Z(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class fl extends Fr{constructor(t,s,r){super(t,s,r),this.name="AuthApiError",this.status=s,this.code=r}}function gl(i){return Z(i)&&i.name==="AuthApiError"}class yn extends Fr{constructor(t,s){super(t),this.name="AuthUnknownError",this.originalError=s}}class it extends Fr{constructor(t,s,r,n){super(t,r,n),this.name=s,this.status=r}}class Ze extends it{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function xl(i){return Z(i)&&i.name==="AuthSessionMissingError"}class fs extends it{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class gs extends it{constructor(t){super(t,"AuthInvalidCredentialsError",400,void 0)}}class xs extends it{constructor(t,s=null){super(t,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function bl(i){return Z(i)&&i.name==="AuthImplicitGrantRedirectError"}class gi extends it{constructor(t,s=null){super(t,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=s}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yr extends it{constructor(t,s){super(t,"AuthRetryableFetchError",s,void 0)}}function Zs(i){return Z(i)&&i.name==="AuthRetryableFetchError"}class xi extends it{constructor(t,s,r){super(t,"AuthWeakPasswordError",s,"weak_password"),this.reasons=r}}class vr extends it{constructor(t){super(t,"AuthInvalidJwtError",400,"invalid_jwt")}}const Cs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),bi=` 	
\r=`.split(""),yl=(()=>{const i=new Array(128);for(let t=0;t<i.length;t+=1)i[t]=-1;for(let t=0;t<bi.length;t+=1)i[bi[t].charCodeAt(0)]=-2;for(let t=0;t<Cs.length;t+=1)i[Cs[t].charCodeAt(0)]=t;return i})();function yi(i,t,s){if(i!==null)for(t.queue=t.queue<<8|i,t.queuedBits+=8;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;s(Cs[r]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const r=t.queue>>t.queuedBits-6&63;s(Cs[r]),t.queuedBits-=6}}function vn(i,t,s){const r=yl[i];if(r>-1)for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function vi(i){const t=[],s=o=>{t.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},a=o=>{jl(o,r,s)};for(let o=0;o<i.length;o+=1)vn(i.charCodeAt(o),n,a);return t.join("")}function vl(i,t){if(i<=127){t(i);return}else if(i<=2047){t(192|i>>6),t(128|i&63);return}else if(i<=65535){t(224|i>>12),t(128|i>>6&63),t(128|i&63);return}else if(i<=1114111){t(240|i>>18),t(128|i>>12&63),t(128|i>>6&63),t(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function wl(i,t){for(let s=0;s<i.length;s+=1){let r=i.charCodeAt(s);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(i.charCodeAt(s+1)-56320&65535|n)+65536,s+=1}vl(r,t)}}function jl(i,t,s){if(t.utf8seq===0){if(i<=127){s(i);return}for(let r=1;r<6;r+=1)if(!(i>>7-r&1)){t.utf8seq=r;break}if(t.utf8seq===2)t.codepoint=i&31;else if(t.utf8seq===3)t.codepoint=i&15;else if(t.utf8seq===4)t.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");t.utf8seq-=1}else if(t.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|i&63,t.utf8seq-=1,t.utf8seq===0&&s(t.codepoint)}}function kl(i){const t=[],s={queue:0,queuedBits:0},r=n=>{t.push(n)};for(let n=0;n<i.length;n+=1)vn(i.charCodeAt(n),s,r);return new Uint8Array(t)}function Nl(i){const t=[];return wl(i,s=>t.push(s)),new Uint8Array(t)}function Sl(i){const t=[],s={queue:0,queuedBits:0},r=n=>{t.push(n)};return i.forEach(n=>yi(n,s,r)),yi(null,s,r),t.join("")}function _l(i){return Math.round(Date.now()/1e3)+i}function Cl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const t=Math.random()*16|0;return(i=="x"?t:t&3|8).toString(16)})}const Re=()=>typeof window<"u"&&typeof document<"u",ot={tested:!1,writable:!1},wn=()=>{if(!Re())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ot.tested)return ot.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),ot.tested=!0,ot.writable=!0}catch{ot.tested=!0,ot.writable=!1}return ot.writable};function Pl(i){const t={},s=new URL(i);if(s.hash&&s.hash[0]==="#")try{new URLSearchParams(s.hash.substring(1)).forEach((n,a)=>{t[a]=n})}catch{}return s.searchParams.forEach((r,n)=>{t[n]=r}),t}const jn=i=>{let t;return i?t=i:typeof fetch>"u"?t=(...s)=>Nt(()=>Promise.resolve().then(()=>Mt),void 0).then(({default:r})=>r(...s)):t=fetch,(...s)=>t(...s)},El=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",It=async(i,t,s)=>{await i.setItem(t,JSON.stringify(s))},lt=async(i,t)=>{const s=await i.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch{return s}},Je=async(i,t)=>{await i.removeItem(t)};class zs{constructor(){this.promise=new zs.promiseConstructor((t,s)=>{this.resolve=t,this.reject=s})}}zs.promiseConstructor=Promise;function Qs(i){const t=i.split(".");if(t.length!==3)throw new vr("Invalid JWT structure");for(let r=0;r<t.length;r++)if(!ml.test(t[r]))throw new vr("JWT not in base64url format");return{header:JSON.parse(vi(t[0])),payload:JSON.parse(vi(t[1])),signature:kl(t[2]),raw:{header:t[0],payload:t[1]}}}async function Tl(i){return await new Promise(t=>{setTimeout(()=>t(null),i)})}function Al(i,t){return new Promise((r,n)=>{(async()=>{for(let a=0;a<1/0;a++)try{const o=await i(a);if(!t(a,null,o)){r(o);return}}catch(o){if(!t(a,o)){n(o);return}}})()})}function $l(i){return("0"+i.toString(16)).substr(-2)}function Rl(){const t=new Uint32Array(56);if(typeof crypto>"u"){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=s.length;let n="";for(let a=0;a<56;a++)n+=s.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(t),Array.from(t,$l).join("")}async function Il(i){const s=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",s),n=new Uint8Array(r);return Array.from(n).map(a=>String.fromCharCode(a)).join("")}async function Ol(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const s=await Il(i);return btoa(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Et(i,t,s=!1){const r=Rl();let n=r;s&&(n+="/PASSWORD_RECOVERY"),await It(i,`${t}-code-verifier`,n);const a=await Ol(r);return[a,r===a?"plain":"s256"]}const Ll=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Dl(i){const t=i.headers.get(br);if(!t||!t.match(Ll))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch{return null}}function zl(i){if(!i)throw new Error("Missing exp claim");const t=Math.floor(Date.now()/1e3);if(i<=t)throw new Error("JWT has expired")}function Ul(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ml=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Tt(i){if(!Ml.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Xs(){const i={};return new Proxy(i,{get:(t,s)=>{if(s==="__isUserNotAvailableProxy")return!0;if(typeof s=="symbol"){const r=s.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${s}" property of the session object is not supported. Please use getUser() instead.`)},set:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(t,s)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${s}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function wi(i){return JSON.parse(JSON.stringify(i))}var Fl=globalThis&&globalThis.__rest||function(i,t){var s={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&t.indexOf(r)<0&&(s[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(s[r[n]]=i[r[n]]);return s};const ut=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Bl=[502,503,504];async function ji(i){var t;if(!El(i))throw new yr(ut(i),0);if(Bl.includes(i.status))throw new yr(ut(i),i.status);let s;try{s=await i.json()}catch(a){throw new yn(ut(a),a)}let r;const n=Dl(i);if(n&&n.getTime()>=bn["2024-01-01"].timestamp&&typeof s=="object"&&s&&typeof s.code=="string"?r=s.code:typeof s=="object"&&s&&typeof s.error_code=="string"&&(r=s.error_code),r){if(r==="weak_password")throw new xi(ut(s),i.status,((t=s.weak_password)===null||t===void 0?void 0:t.reasons)||[]);if(r==="session_not_found")throw new Ze}else if(typeof s=="object"&&s&&typeof s.weak_password=="object"&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((a,o)=>a&&typeof o=="string",!0))throw new xi(ut(s),i.status,s.weak_password.reasons);throw new fl(ut(s),i.status||500,r)}const Wl=(i,t,s,r)=>{const n={method:i,headers:t?.headers||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},t?.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))};async function X(i,t,s,r){var n;const a=Object.assign({},r?.headers);a[br]||(a[br]=bn["2024-01-01"].name),r?.jwt&&(a.Authorization=`Bearer ${r.jwt}`);const o=(n=r?.query)!==null&&n!==void 0?n:{};r?.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Hl(i,t,s+l,{headers:a,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(c):{data:Object.assign({},c),error:null}}async function Hl(i,t,s,r,n,a){const o=Wl(t,r,n,a);let l;try{l=await i(s,Object.assign({},o))}catch(c){throw console.error(c),new yr(ut(c),0)}if(l.ok||await ji(l),r?.noResolveJson)return l;try{return await l.json()}catch(c){await ji(c)}}function He(i){var t;let s=null;Jl(i)&&(s=Object.assign({},i),i.expires_at||(s.expires_at=_l(i.expires_in)));const r=(t=i.user)!==null&&t!==void 0?t:i;return{data:{session:s,user:r},error:null}}function ki(i){const t=He(i);return!t.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((s,r)=>s&&typeof r=="string",!0)&&(t.data.weak_password=i.weak_password),t}function Qe(i){var t;return{data:{user:(t=i.user)!==null&&t!==void 0?t:i},error:null}}function Vl(i){return{data:i,error:null}}function ql(i){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:a}=i,o=Fl(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:a},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function Gl(i){return i}function Jl(i){return i.access_token&&i.refresh_token&&i.expires_in}const er=["global","local","others"];var Kl=globalThis&&globalThis.__rest||function(i,t){var s={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&t.indexOf(r)<0&&(s[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(s[r[n]]=i[r[n]]);return s};class Yl{constructor({url:t="",headers:s={},fetch:r}){this.url=t,this.headers=s,this.fetch=jn(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(t,s=er[0]){if(er.indexOf(s)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${er.join(", ")}`);try{return await X(this.fetch,"POST",`${this.url}/logout?scope=${s}`,{headers:this.headers,jwt:t,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}async inviteUserByEmail(t,s={}){try{return await X(this.fetch,"POST",`${this.url}/invite`,{body:{email:t,data:s.data},headers:this.headers,redirectTo:s.redirectTo,xform:Qe})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async generateLink(t){try{const{options:s}=t,r=Kl(t,["options"]),n=Object.assign(Object.assign({},r),s);return"newEmail"in r&&(n.new_email=r?.newEmail,delete n.newEmail),await X(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:ql,redirectTo:s?.redirectTo})}catch(s){if(Z(s))return{data:{properties:null,user:null},error:s};throw s}}async createUser(t){try{return await X(this.fetch,"POST",`${this.url}/admin/users`,{body:t,headers:this.headers,xform:Qe})}catch(s){if(Z(s))return{data:{user:null},error:s};throw s}}async listUsers(t){var s,r,n,a,o,l,c;try{const d={nextPage:null,lastPage:0,total:0},u=await X(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(s=t?.page)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:"",per_page:(a=(n=t?.perPage)===null||n===void 0?void 0:n.toString())!==null&&a!==void 0?a:""},xform:Gl});if(u.error)throw u.error;const h=await u.json(),p=(o=u.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(c=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(g=>{const x=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(g.split(";")[1].split("=")[1]);d[`${y}Page`]=x}),d.total=parseInt(p)),{data:Object.assign(Object.assign({},h),d),error:null}}catch(d){if(Z(d))return{data:{users:[]},error:d};throw d}}async getUserById(t){Tt(t);try{return await X(this.fetch,"GET",`${this.url}/admin/users/${t}`,{headers:this.headers,xform:Qe})}catch(s){if(Z(s))return{data:{user:null},error:s};throw s}}async updateUserById(t,s){Tt(t);try{return await X(this.fetch,"PUT",`${this.url}/admin/users/${t}`,{body:s,headers:this.headers,xform:Qe})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async deleteUser(t,s=!1){Tt(t);try{return await X(this.fetch,"DELETE",`${this.url}/admin/users/${t}`,{headers:this.headers,body:{should_soft_delete:s},xform:Qe})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async _listFactors(t){Tt(t.userId);try{const{data:s,error:r}=await X(this.fetch,"GET",`${this.url}/admin/users/${t.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:s,error:r}}catch(s){if(Z(s))return{data:null,error:s};throw s}}async _deleteFactor(t){Tt(t.userId),Tt(t.id);try{return{data:await X(this.fetch,"DELETE",`${this.url}/admin/users/${t.userId}/factors/${t.id}`,{headers:this.headers}),error:null}}catch(s){if(Z(s))return{data:null,error:s};throw s}}}function Ni(i={}){return{getItem:t=>i[t]||null,setItem:(t,s)=>{i[t]=s},removeItem:t=>{delete i[t]}}}function Zl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const At={debug:!!(globalThis&&wn()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class kn extends Error{constructor(t){super(t),this.isAcquireTimeout=!0}}class Ql extends kn{}async function Xl(i,t,s){At.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),At.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,t===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){At.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,n.name);try{return await s()}finally{At.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,n.name)}}else{if(t===0)throw At.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Ql(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(At.debug)try{const a=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(a,null,"  "))}catch(a){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",a)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}}))}Zl();const ec={url:dl,storageKey:ul,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:hl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Si(i,t,s){return await s()}const $t={};class es{constructor(t){var s,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=es.nextInstanceID,es.nextInstanceID+=1,this.instanceID>0&&Re()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},ec),t);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Yl({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=jn(n.fetch),this.lock=n.lock||Si,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:Re()&&(!((s=globalThis?.navigator)===null||s===void 0)&&s.locks)?this.lock=Xl:this.lock=Si,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:wn()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Ni(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=Ni(this.memoryStorage)),Re()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(a){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",a)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async a=>{this._debug("received broadcast notification from other tab or client",a),await this._notifyAllSubscribers(a.data.event,a.data.session,!1)})}this.initialize()}get jwks(){var t,s;return(s=(t=$t[this.storageKey])===null||t===void 0?void 0:t.jwks)!==null&&s!==void 0?s:{keys:[]}}set jwks(t){$t[this.storageKey]=Object.assign(Object.assign({},$t[this.storageKey]),{jwks:t})}get jwks_cached_at(){var t,s;return(s=(t=$t[this.storageKey])===null||t===void 0?void 0:t.cachedAt)!==null&&s!==void 0?s:Number.MIN_SAFE_INTEGER}set jwks_cached_at(t){$t[this.storageKey]=Object.assign(Object.assign({},$t[this.storageKey]),{cachedAt:t})}_debug(...t){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${xn}) ${new Date().toISOString()}`,...t),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var t;try{const s=Pl(window.location.href);let r="none";if(this._isImplicitGrantCallback(s)?r="implicit":await this._isPKCECallback(s)&&(r="pkce"),Re()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:a}=await this._getSessionFromURL(s,r);if(a){if(this._debug("#_initialize()","error detecting session from URL",a),bl(a)){const c=(t=a.details)===null||t===void 0?void 0:t.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:a}}return await this._removeSession(),{error:a}}const{session:o,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(s){return Z(s)?{error:s}:{error:new yn("Unexpected error during initialization",s)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(t){var s,r,n;try{const a=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(s=t?.options)===null||s===void 0?void 0:s.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=t?.options)===null||n===void 0?void 0:n.captchaToken}},xform:He}),{data:o,error:l}=a;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(Z(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(t){var s,r,n;try{let a;if("email"in t){const{email:u,password:h,options:p}=t;let f=null,g=null;this.flowType==="pkce"&&([f,g]=await Et(this.storage,this.storageKey)),a=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p?.emailRedirectTo,body:{email:u,password:h,data:(s=p?.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:f,code_challenge_method:g},xform:He})}else if("phone"in t){const{phone:u,password:h,options:p}=t;a=await X(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=p?.data)!==null&&r!==void 0?r:{},channel:(n=p?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:He})}else throw new gs("You must provide either an email or phone number and a password");const{data:o,error:l}=a;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,d=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(a){if(Z(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(t){try{let s;if("email"in t){const{email:a,password:o,options:l}=t;s=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:a,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:ki})}else if("phone"in t){const{phone:a,password:o,options:l}=t;s=await X(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:a,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:ki})}else throw new gs("You must provide either an email or phone number and a password");const{data:r,error:n}=s;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new fs}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOAuth(t){var s,r,n,a;return await this._handleProviderSignIn(t.provider,{redirectTo:(s=t.options)===null||s===void 0?void 0:s.redirectTo,scopes:(r=t.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=t.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(a=t.options)===null||a===void 0?void 0:a.skipBrowserRedirect})}async exchangeCodeForSession(t){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(t))}async signInWithWeb3(t){const{chain:s}=t;if(s==="solana")return await this.signInWithSolana(t);throw new Error(`@supabase/auth-js: Unsupported chain "${s}"`)}async signInWithSolana(t){var s,r,n,a,o,l,c,d,u,h,p,f;let g,x;if("message"in t)g=t.message,x=t.signature;else{const{chain:y,wallet:b,statement:v,options:j}=t;let k;if(Re())if(typeof b=="object")k=b;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))k=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!j?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=b}const L=new URL((s=j?.url)!==null&&s!==void 0?s:window.location.href);if("signIn"in k&&k.signIn){const C=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},j?.signInWithSolana),{version:"1",domain:L.host,uri:L.href}),v?{statement:v}:null));let $;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")$=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)$=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in $&&"signature"in $&&(typeof $.signedMessage=="string"||$.signedMessage instanceof Uint8Array)&&$.signature instanceof Uint8Array)g=typeof $.signedMessage=="string"?$.signedMessage:new TextDecoder().decode($.signedMessage),x=$.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${L.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${L.href}`,`Issued At: ${(n=(r=j?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((a=j?.signInWithSolana)===null||a===void 0)&&a.notBefore?[`Not Before: ${j.signInWithSolana.notBefore}`]:[],...!((o=j?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${j.signInWithSolana.expirationTime}`]:[],...!((l=j?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${j.signInWithSolana.chainId}`]:[],...!((c=j?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${j.signInWithSolana.nonce}`]:[],...!((d=j?.signInWithSolana)===null||d===void 0)&&d.requestId?[`Request ID: ${j.signInWithSolana.requestId}`]:[],...!((h=(u=j?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...j.signInWithSolana.resources.map($=>`- ${$}`)]:[]].join(`
`);const C=await k.signMessage(new TextEncoder().encode(g),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=C}}try{const{data:y,error:b}=await X(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:Sl(x)},!((p=t.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(f=t.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:He});if(b)throw b;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new fs}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:b})}catch(y){if(Z(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(t){const s=await lt(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(s??"").split("/");try{const{data:a,error:o}=await X(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:t,code_verifier:r},xform:He});if(await Je(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!a||!a.session||!a.user?{data:{user:null,session:null,redirectType:null},error:new fs}:(a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:Object.assign(Object.assign({},a),{redirectType:n??null}),error:o})}catch(a){if(Z(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(t){try{const{options:s,provider:r,token:n,access_token:a,nonce:o}=t,l=await X(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:a,nonce:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},xform:He}),{data:c,error:d}=l;return d?{data:{user:null,session:null},error:d}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new fs}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:d})}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithOtp(t){var s,r,n,a,o;try{if("email"in t){const{email:l,options:c}=t;let d=null,u=null;this.flowType==="pkce"&&([d,u]=await Et(this.storage,this.storageKey));const{error:h}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(s=c?.data)!==null&&s!==void 0?s:{},create_user:(r=c?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:d,code_challenge_method:u},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in t){const{phone:l,options:c}=t,{data:d,error:u}=await X(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=c?.data)!==null&&n!==void 0?n:{},create_user:(a=c?.shouldCreateUser)!==null&&a!==void 0?a:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:d?.message_id},error:u}}throw new gs("You must provide either an email or phone number.")}catch(l){if(Z(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(t){var s,r;try{let n,a;"options"in t&&(n=(s=t.options)===null||s===void 0?void 0:s.redirectTo,a=(r=t.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await X(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},t),{gotrue_meta_security:{captcha_token:a}}),redirectTo:n,xform:He});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,d=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(t.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:d,session:c},error:null}}catch(n){if(Z(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(t){var s,r,n;try{let a=null,o=null;return this.flowType==="pkce"&&([a,o]=await Et(this.storage,this.storageKey)),await X(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in t?{provider_id:t.providerId}:null),"domain"in t?{domain:t.domain}:null),{redirect_to:(r=(s=t.options)===null||s===void 0?void 0:s.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=t?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:t.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:a,code_challenge_method:o}),headers:this.headers,xform:Vl})}catch(a){if(Z(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async t=>{const{data:{session:s},error:r}=t;if(r)throw r;if(!s)throw new Ze;const{error:n}=await X(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:s.access_token});return{data:{user:null,session:null},error:n}})}catch(t){if(Z(t))return{data:{user:null,session:null},error:t};throw t}}async resend(t){try{const s=`${this.url}/resend`;if("email"in t){const{email:r,type:n,options:a}=t,{error:o}=await X(this.fetch,"POST",s,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:a?.captchaToken}},redirectTo:a?.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in t){const{phone:r,type:n,options:a}=t,{data:o,error:l}=await X(this.fetch,"POST",s,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:a?.captchaToken}}});return{data:{user:null,session:null,messageId:o?.message_id},error:l}}throw new gs("You must provide either an email or phone number and a type")}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async s=>s))}async _acquireLock(t,s){this._debug("#_acquireLock","begin",t);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await s()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,t,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=s();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(t){this._debug("#_useSession","begin");try{const s=await this.__loadSession();return await t(s)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let t=null;const s=await lt(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",s),s!==null&&(this._isValidSession(s)?t=s:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!t)return{data:{session:null},error:null};const r=t.expires_at?t.expires_at*1e3-Date.now()<Ys:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",t.expires_at),!r){if(this.userStorage){const o=await lt(this.userStorage,this.storageKey+"-user");o?.user?t.user=o.user:t.user=Xs()}if(this.storage.isServer&&t.user){let o=this.suppressGetSessionWarning;t=new Proxy(t,{get:(c,d,u)=>(!o&&d==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,d,u))})}return{data:{session:t},error:null}}const{session:n,error:a}=await this._callRefreshToken(t.refresh_token);return a?{data:{session:null},error:a}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(t){return t?await this._getUser(t):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(t){try{return t?await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:t,xform:Qe}):await this._useSession(async s=>{var r,n,a;const{data:o,error:l}=s;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ze}:await X(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(a=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&a!==void 0?a:void 0,xform:Qe})})}catch(s){if(Z(s))return xl(s)&&(await this._removeSession(),await Je(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:s};throw s}}async updateUser(t,s={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(t,s))}async _updateUser(t,s={}){try{return await this._useSession(async r=>{const{data:n,error:a}=r;if(a)throw a;if(!n.session)throw new Ze;const o=n.session;let l=null,c=null;this.flowType==="pkce"&&t.email!=null&&([l,c]=await Et(this.storage,this.storageKey));const{data:d,error:u}=await X(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:s?.emailRedirectTo,body:Object.assign(Object.assign({},t),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Qe});if(u)throw u;return o.user=d.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(Z(r))return{data:{user:null},error:r};throw r}}async setSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(t))}async _setSession(t){try{if(!t.access_token||!t.refresh_token)throw new Ze;const s=Date.now()/1e3;let r=s,n=!0,a=null;const{payload:o}=Qs(t.access_token);if(o.exp&&(r=o.exp,n=r<=s),n){const{session:l,error:c}=await this._callRefreshToken(t.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};a=l}else{const{data:l,error:c}=await this._getUser(t.access_token);if(c)throw c;a={access_token:t.access_token,refresh_token:t.refresh_token,user:l.user,token_type:"bearer",expires_in:r-s,expires_at:r},await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)}return{data:{user:a.user,session:a},error:null}}catch(s){if(Z(s))return{data:{session:null,user:null},error:s};throw s}}async refreshSession(t){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(t))}async _refreshSession(t){try{return await this._useSession(async s=>{var r;if(!t){const{data:o,error:l}=s;if(l)throw l;t=(r=o.session)!==null&&r!==void 0?r:void 0}if(!t?.refresh_token)throw new Ze;const{session:n,error:a}=await this._callRefreshToken(t.refresh_token);return a?{data:{user:null,session:null},error:a}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(s){if(Z(s))return{data:{user:null,session:null},error:s};throw s}}async _getSessionFromURL(t,s){try{if(!Re())throw new xs("No browser detected.");if(t.error||t.error_description||t.error_code)throw new xs(t.error_description||"Error in URL with unspecified error_description",{error:t.error||"unspecified_error",code:t.error_code||"unspecified_code"});switch(s){case"implicit":if(this.flowType==="pkce")throw new gi("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new xs("Not a valid implicit grant flow url.");break;default:}if(s==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!t.code)throw new gi("No code detected.");const{data:v,error:j}=await this._exchangeCodeForSession(t.code);if(j)throw j;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:a,refresh_token:o,expires_in:l,expires_at:c,token_type:d}=t;if(!a||!l||!o||!d)throw new xs("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let p=u+h;c&&(p=parseInt(c));const f=p-u;f*1e3<=Rt&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const g=p-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,p,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,p,u);const{data:x,error:y}=await this._getUser(a);if(y)throw y;const b={provider_token:r,provider_refresh_token:n,access_token:a,expires_in:h,expires_at:p,refresh_token:o,token_type:d,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:t.type},error:null}}catch(r){if(Z(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(t){return!!(t.access_token||t.error_description)}async _isPKCECallback(t){const s=await lt(this.storage,`${this.storageKey}-code-verifier`);return!!(t.code&&s)}async signOut(t={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(t))}async _signOut({scope:t}={scope:"global"}){return await this._useSession(async s=>{var r;const{data:n,error:a}=s;if(a)return{error:a};const o=(r=n.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,t);if(l&&!(gl(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return t!=="others"&&(await this._removeSession(),await Je(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(t){const s=Cl(),r={id:s,callback:t,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",s),this.stateChangeEmitters.delete(s)}};return this._debug("#onAuthStateChange()","registered callback with id",s),this.stateChangeEmitters.set(s,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(s)})))(),{data:{subscription:r}}}async _emitInitialSession(t){return await this._useSession(async s=>{var r,n;try{const{data:{session:a},error:o}=s;if(o)throw o;await((r=this.stateChangeEmitters.get(t))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",a)),this._debug("INITIAL_SESSION","callback id",t,"session",a)}catch(a){await((n=this.stateChangeEmitters.get(t))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",t,"error",a),console.error(a)}})}async resetPasswordForEmail(t,s={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await Et(this.storage,this.storageKey,!0));try{return await X(this.fetch,"POST",`${this.url}/recover`,{body:{email:t,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:s.captchaToken}},headers:this.headers,redirectTo:s.redirectTo})}catch(a){if(Z(a))return{data:null,error:a};throw a}}async getUserIdentities(){var t;try{const{data:s,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(t=s.user.identities)!==null&&t!==void 0?t:[]},error:null}}catch(s){if(Z(s))return{data:null,error:s};throw s}}async linkIdentity(t){var s;try{const{data:r,error:n}=await this._useSession(async a=>{var o,l,c,d,u;const{data:h,error:p}=a;if(p)throw p;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,t.provider,{redirectTo:(o=t.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=t.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=t.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await X(this.fetch,"GET",f,{headers:this.headers,jwt:(u=(d=h.session)===null||d===void 0?void 0:d.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return Re()&&!(!((s=t.options)===null||s===void 0)&&s.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:t.provider,url:r?.url},error:null}}catch(r){if(Z(r))return{data:{provider:t.provider,url:null},error:r};throw r}}async unlinkIdentity(t){try{return await this._useSession(async s=>{var r,n;const{data:a,error:o}=s;if(o)throw o;return await X(this.fetch,"DELETE",`${this.url}/user/identities/${t.identity_id}`,{headers:this.headers,jwt:(n=(r=a.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async _refreshAccessToken(t){const s=`#_refreshAccessToken(${t.substring(0,5)}...)`;this._debug(s,"begin");try{const r=Date.now();return await Al(async n=>(n>0&&await Tl(200*Math.pow(2,n-1)),this._debug(s,"refreshing attempt",n),await X(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:t},headers:this.headers,xform:He})),(n,a)=>{const o=200*Math.pow(2,n);return a&&Zs(a)&&Date.now()+o-r<Rt})}catch(r){if(this._debug(s,"error",r),Z(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(s,"end")}}_isValidSession(t){return typeof t=="object"&&t!==null&&"access_token"in t&&"refresh_token"in t&&"expires_at"in t}async _handleProviderSignIn(t,s){const r=await this._getUrlForProvider(`${this.url}/authorize`,t,{redirectTo:s.redirectTo,scopes:s.scopes,queryParams:s.queryParams});return this._debug("#_handleProviderSignIn()","provider",t,"options",s,"url",r),Re()&&!s.skipBrowserRedirect&&window.location.assign(r),{data:{provider:t,url:r},error:null}}async _recoverAndRefresh(){var t,s;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await lt(this.storage,this.storageKey);if(n&&this.userStorage){let o=await lt(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:n.user},await It(this.userStorage,this.storageKey+"-user",o)),n.user=(t=o?.user)!==null&&t!==void 0?t:Xs()}else if(n&&!n.user&&!n.user){const o=await lt(this.storage,this.storageKey+"-user");o&&o?.user?(n.user=o.user,await Je(this.storage,this.storageKey+"-user"),await It(this.storage,this.storageKey,n)):n.user=Xs()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const a=((s=n.expires_at)!==null&&s!==void 0?s:1/0)*1e3-Date.now()<Ys;if(this._debug(r,`session has${a?"":" not"} expired with margin of ${Ys}s`),a){if(this.autoRefreshToken&&n.refresh_token){const{error:o}=await this._callRefreshToken(n.refresh_token);o&&(console.error(o),Zs(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(n.access_token);!l&&o?.user?(n.user=o.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(t){var s,r;if(!t)throw new Ze;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${t.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new zs;const{data:a,error:o}=await this._refreshAccessToken(t);if(o)throw o;if(!a.session)throw new Ze;await this._saveSession(a.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",a.session);const l={session:a.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(a){if(this._debug(n,"error",a),Z(a)){const o={session:null,error:a};return Zs(a)||await this._removeSession(),(s=this.refreshingDeferred)===null||s===void 0||s.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(a),a}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(t,s,r=!0){const n=`#_notifyAllSubscribers(${t})`;this._debug(n,"begin",s,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:t,session:s});const a=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(t,s)}catch(c){a.push(c)}});if(await Promise.all(o),a.length>0){for(let l=0;l<a.length;l+=1)console.error(a[l]);throw a[0]}}finally{this._debug(n,"end")}}async _saveSession(t){this._debug("#_saveSession()",t),this.suppressGetSessionWarning=!0;const s=Object.assign({},t),r=s.user&&s.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&s.user&&await It(this.userStorage,this.storageKey+"-user",{user:s.user});const n=Object.assign({},s);delete n.user;const a=wi(n);await It(this.storage,this.storageKey,a)}else{const n=wi(s);await It(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await Je(this.storage,this.storageKey),await Je(this.storage,this.storageKey+"-code-verifier"),await Je(this.storage,this.storageKey+"-user"),this.userStorage&&await Je(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const t=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{t&&Re()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",t)}catch(s){console.error("removing visibilitychange callback failed",s)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const t=setInterval(()=>this._autoRefreshTokenTick(),Rt);this.autoRefreshTicker=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const t=this.autoRefreshTicker;this.autoRefreshTicker=null,t&&clearInterval(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const t=Date.now();try{return await this._useSession(async s=>{const{data:{session:r}}=s;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-t)/Rt);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${Rt}ms, refresh threshold is ${xr} ticks`),n<=xr&&await this._callRefreshToken(r.refresh_token)})}catch(s){console.error("Auto refresh tick failed with error. This is likely a transient error.",s)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(t){if(t.isAcquireTimeout||t instanceof kn)this._debug("auto refresh token tick lock not available");else throw t}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Re()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(t){console.error("_handleVisibilityChange",t)}}async _onVisibilityChanged(t){const s=`#_onVisibilityChanged(${t})`;this._debug(s,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),t||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(s,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(t,s,r){const n=[`provider=${encodeURIComponent(s)}`];if(r?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[a,o]=await Et(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(o)}`});n.push(l.toString())}if(r?.queryParams){const a=new URLSearchParams(r.queryParams);n.push(a.toString())}return r?.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${t}?${n.join("&")}`}async _unenroll(t){try{return await this._useSession(async s=>{var r;const{data:n,error:a}=s;return a?{data:null,error:a}:await X(this.fetch,"DELETE",`${this.url}/factors/${t.factorId}`,{headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async _enroll(t){try{return await this._useSession(async s=>{var r,n;const{data:a,error:o}=s;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:t.friendlyName,factor_type:t.factorType},t.factorType==="phone"?{phone:t.phone}:{issuer:t.issuer}),{data:c,error:d}=await X(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return d?{data:null,error:d}:(t.factorType==="totp"&&(!((n=c?.totp)===null||n===void 0)&&n.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(s){if(Z(s))return{data:null,error:s};throw s}}async _verify(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:n,error:a}=s;if(a)return{data:null,error:a};const{data:o,error:l}=await X(this.fetch,"POST",`${this.url}/factors/${t.factorId}/verify`,{body:{code:t.code,challenge_id:t.challengeId},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(s){if(Z(s))return{data:null,error:s};throw s}})}async _challenge(t){return this._acquireLock(-1,async()=>{try{return await this._useSession(async s=>{var r;const{data:n,error:a}=s;return a?{data:null,error:a}:await X(this.fetch,"POST",`${this.url}/factors/${t.factorId}/challenge`,{body:{channel:t.channel},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(s){if(Z(s))return{data:null,error:s};throw s}})}async _challengeAndVerify(t){const{data:s,error:r}=await this._challenge({factorId:t.factorId});return r?{data:null,error:r}:await this._verify({factorId:t.factorId,challengeId:s.id,code:t.code})}async _listFactors(){const{data:{user:t},error:s}=await this.getUser();if(s)return{data:null,error:s};const r=t?.factors||[],n=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),a=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:n,phone:a},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async t=>{var s,r;const{data:{session:n},error:a}=t;if(a)return{data:null,error:a};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Qs(n.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((r=(s=n.user.factors)===null||s===void 0?void 0:s.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const u=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(t,s={keys:[]}){let r=s.keys.find(l=>l.kid===t);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(l=>l.kid===t),r&&this.jwks_cached_at+pl>n)return r;const{data:a,error:o}=await X(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!a.keys||a.keys.length===0||(this.jwks=a,this.jwks_cached_at=n,r=a.keys.find(l=>l.kid===t),!r)?null:r}async getClaims(t,s={}){try{let r=t;if(!r){const{data:f,error:g}=await this.getSession();if(g||!f.session)return{data:null,error:g};r=f.session.access_token}const{header:n,payload:a,signature:o,raw:{header:l,payload:c}}=Qs(r);s?.allowExpired||zl(a.exp);const d=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,s?.keys?{keys:s.keys}:s?.jwks);if(!d){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:a,header:n,signature:o},error:null}}const u=Ul(n.alg),h=await crypto.subtle.importKey("jwk",d,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,o,Nl(`${l}.${c}`)))throw new vr("Invalid JWT signature");return{data:{claims:a,header:n,signature:o},error:null}}catch(r){if(Z(r))return{data:null,error:r};throw r}}}es.nextInstanceID=0;const tc=es;class sc extends tc{constructor(t){super(t)}}var rc=globalThis&&globalThis.__awaiter||function(i,t,s,r){function n(a){return a instanceof s?a:new s(function(o){o(a)})}return new(s||(s=Promise))(function(a,o){function l(u){try{d(r.next(u))}catch(h){o(h)}}function c(u){try{d(r.throw(u))}catch(h){o(h)}}function d(u){u.done?a(u.value):n(u.value).then(l,c)}d((r=r.apply(i,t||[])).next())})};class ic{constructor(t,s,r){var n,a,o;if(this.supabaseUrl=t,this.supabaseKey=s,!t)throw new Error("supabaseUrl is required.");if(!s)throw new Error("supabaseKey is required.");const l=ll(t),c=new URL(l);this.realtimeUrl=new URL("realtime/v1",c),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",c),this.storageUrl=new URL("storage/v1",c),this.functionsUrl=new URL("functions/v1",c);const d=`sb-${c.hostname.split(".")[0]}-auth-token`,u={db:el,realtime:sl,auth:Object.assign(Object.assign({},tl),{storageKey:d}),global:Xo},h=cl(r??{},u);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(a=h.global.headers)!==null&&a!==void 0?a:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(p,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=al(s,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new vo(new URL("rest/v1",c).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new Yo(this.storageUrl.href,this.headers,this.fetch,r?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Ka(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,s={},r={}){return this.rest.rpc(t,s,r)}channel(t,s={config:{}}){return this.realtime.channel(t,s)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var t,s;return rc(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(s=(t=r.session)===null||t===void 0?void 0:t.access_token)!==null&&s!==void 0?s:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:n,storageKey:a,flowType:o,lock:l,debug:c},d,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new sc({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),d),storageKey:a,autoRefreshToken:t,persistSession:s,detectSessionInUrl:r,storage:n,flowType:o,lock:l,debug:c,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(t){return new Do(this.realtimeUrl.href,Object.assign(Object.assign({},t),{params:Object.assign({apikey:this.supabaseKey},t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((s,r)=>{this._handleTokenChanged(s,"CLIENT",r?.access_token)})}_handleTokenChanged(t,s,r){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:t==="SIGNED_OUT"&&(this.realtime.setAuth(),s=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const nc=(i,t,s)=>new ic(i,t,s);function ac(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const t=i.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}ac()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const oc="https://ihtnsyhknvltgrksffun.supabase.co",lc="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlodG5zeWhrbnZsdGdya3NmZnVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2NzA2MzYsImV4cCI6MjA2OTI0NjYzNn0.ZmoZ5cGVHfhDwTvkmaw9LSVHm_awoyMOTyQKewr7rYo";console.log("🔧 Supabase Config Check:");console.log("URL:","✅ Present");console.log("Anon Key:","✅ Present");const W=nc(oc,lc,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},db:{schema:"public"},global:{headers:{"X-Client-Info":"fanclubz-web@1.0.0"}}}),tr={signUp:async(i,t,s={})=>{try{const{data:r,error:n}=await W.auth.signUp({email:i,password:t,options:{data:s,emailRedirectTo:"https://app.fanclubz.app/auth/callback"}});return n&&console.error("Auth signUp error:",n),{data:r,error:n}}catch(r){return console.error("Auth signUp exception:",r),{data:null,error:{message:r.message||"An unexpected error occurred"}}}},signIn:async(i,t)=>{try{const{data:s,error:r}=await W.auth.signInWithPassword({email:i,password:t});return r&&console.error("Auth signIn error:",r),{data:s,error:r}}catch(s){return console.error("Auth signIn exception:",s),{data:null,error:{message:s.message||"An unexpected error occurred"}}}},signOut:async()=>{try{const{error:i}=await W.auth.signOut();return i&&console.error("Auth signOut error:",i),{error:i}}catch(i){return console.error("Auth signOut exception:",i),{error:{message:i.message||"An unexpected error occurred"}}}},getCurrentUser:async()=>{try{const{data:{user:i},error:t}=await W.auth.getUser();return t&&console.error("Auth getCurrentUser error:",t),{user:i,error:t}}catch(i){return console.error("Auth getCurrentUser exception:",i),{user:null,error:{message:i.message||"An unexpected error occurred"}}}},onAuthStateChange:i=>W.auth.onAuthStateChange(i)},ls=rt()((i,t)=>({balances:[],transactions:[],isLoading:!1,error:null,get balance(){return t().balances.find(n=>n.currency==="USD")?.available||0},get totalBalance(){return t().balances.find(n=>n.currency==="USD")?.total||0},get reservedBalance(){return t().balances.find(n=>n.currency==="USD")?.reserved||0},initializeWallet:async()=>{console.log("🔄 Initializing wallet..."),i({isLoading:!0,error:null});try{const{data:{user:s}}=await W.auth.getUser();if(!s){console.log("⚠️ No authenticated user found"),i({balances:[],isLoading:!1,error:"User not authenticated"});return}console.log("👤 Fetching wallet for user:",s.id);const{data:r,error:n}=await W.from("wallets").select("*").eq("user_id",s.id);if(n&&n.code!=="PGRST116"){console.error("❌ Error fetching wallet data:",n),i({balances:[],isLoading:!1,error:"Failed to fetch wallet data"});return}const a=r?.map(d=>({currency:d.currency,available:Number(d.available_balance)||0,reserved:Number(d.reserved_balance)||0,total:Number(d.available_balance||0)+Number(d.reserved_balance||0)}))||[];if(a.length===0){console.log("🏦 Creating initial wallet in database");try{await W.from("wallets").insert({user_id:s.id,currency:"USD",available_balance:0,reserved_balance:0,total_deposited:0,total_withdrawn:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),a.push({currency:"USD",available:0,reserved:0,total:0}),console.log("✅ Initial wallet created in database")}catch(d){console.error("❌ Failed to create initial wallet:",d),i({balances:[],isLoading:!1,error:"Failed to create wallet"});return}}else console.log("✅ Using real wallet data from database:",a[0]);const{data:o,error:l}=await W.from("wallet_transactions").select("*").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(50);l&&console.error("❌ Error fetching transaction history:",l);const c=(o||[]).map(d=>({id:d.id,type:d.type,amount:Number(d.amount),description:d.description,date:new Date(d.created_at),status:d.status,reference:d.reference,currency:d.currency,fee:d.fee?Number(d.fee):void 0,fromUser:d.from_user,toUser:d.to_user,predictionId:d.prediction_id}));i({balances:a,transactions:c,isLoading:!1,error:null}),console.log("✅ Wallet initialized successfully"),console.log("💰 Balance:",a[0]?.available||0),console.log("📊 Transactions:",c.length)}catch(s){console.error("❌ Error initializing wallet:",s),i({balances:[{currency:"USD",available:0,reserved:0,total:0}],isLoading:!1,error:"Failed to initialize wallet"})}},refreshWalletData:async()=>{await t().initializeWallet()},lockFunds:async(s,r="USD")=>{try{if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");const a=t().balances.find(d=>d.currency===r);if(!a||a.available<s)throw new Error("Insufficient funds");const o=a.available-s,l=a.reserved+s,c={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"bet_lock",amount:s,description:"Funds locked for prediction",date:new Date,status:"completed",reference:`LOCK_${Date.now()}`,currency:r,fee:0};i(d=>({balances:d.balances.map(u=>u.currency===r?{...u,available:o,reserved:l,total:o+l}:u),transactions:[c,...d.transactions],error:null})),console.log("✅ Funds locked successfully with transaction record:",s,r);try{const{data:{user:d}}=await W.auth.getUser();d&&(await W.from("wallets").upsert({user_id:d.id,currency:r,available_balance:o,reserved_balance:l,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:d.id,type:c.type,currency:c.currency,amount:c.amount,status:c.status,reference:c.reference,description:c.description,created_at:new Date().toISOString()}))}catch{console.log("⚠️ Could not update database, using local state only")}}catch(n){const a=n instanceof Error?n.message:"Failed to lock funds";throw i({error:a}),n}},addFunds:async(s,r="USD",n="Bank Transfer")=>{i({isLoading:!0,error:null});try{if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");const o=t().balances.find(u=>u.currency===r),l=(o?.available||0)+s,c=l+(o?.reserved||0),d={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"deposit",amount:s,description:`${n} Deposit`,date:new Date,status:"completed",reference:`DEP_${Date.now()}`,currency:r,fee:0};i(u=>({balances:u.balances.map(h=>h.currency===r?{...h,available:l,total:c}:h),transactions:[d,...u.transactions],isLoading:!1,error:null}));try{const{data:{user:u}}=await W.auth.getUser();u&&(await W.from("wallets").upsert({user_id:u.id,currency:r,available_balance:l,reserved_balance:o?.reserved||0,total_deposited:(o?.available||0)+s,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:u.id,type:d.type,currency:d.currency,amount:d.amount,status:d.status,reference:d.reference,description:d.description,created_at:new Date().toISOString()}),console.log("✅ Funds added and saved to database:",s,r))}catch(u){console.error("❌ Failed to save to database:",u)}return d}catch(a){const o=a instanceof Error?a.message:"Failed to add funds";throw i({isLoading:!1,error:o}),a}},withdraw:async(s,r="USD",n="Bank Account")=>{i({isLoading:!0,error:null});try{if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");const o=t().balances.find(u=>u.currency===r);if(!o||o.available<s)throw new Error("Insufficient funds");const l=o.available-s,c=l+o.reserved,d={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"withdraw",amount:s,description:`Withdrawal to ${n}`,date:new Date,status:"completed",reference:`WTH_${Date.now()}`,currency:r,fee:0};i(u=>({balances:u.balances.map(h=>h.currency===r?{...h,available:l,total:c}:h),transactions:[d,...u.transactions],isLoading:!1,error:null}));try{const{data:{user:u}}=await W.auth.getUser();u&&(await W.from("wallets").upsert({user_id:u.id,currency:r,available_balance:l,reserved_balance:o.reserved,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:u.id,type:d.type,currency:d.currency,amount:d.amount,status:d.status,reference:d.reference,description:d.description,created_at:new Date().toISOString()}))}catch(u){console.error("❌ Failed to persist withdrawal:",u)}return console.log("✅ Withdrawal successful:",s,r),d}catch(a){const o=a instanceof Error?a.message:"Failed to withdraw funds";throw i({isLoading:!1,error:o}),a}},makePrediction:async(s,r,n,a="USD")=>{i({isLoading:!0,error:null});try{if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");const l=t().balances.find(p=>p.currency===a);if(!l||l.available<s)throw new Error("Insufficient funds");const c=l.available-s,d=l.reserved+s,u=c+d,h={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"bet_lock",amount:s,description:r,date:new Date,status:"completed",reference:`PRED_${Date.now()}`,currency:a,fee:0,predictionId:n};i(p=>({balances:p.balances.map(f=>f.currency===a?{...f,available:c,reserved:d,total:u}:f),transactions:[h,...p.transactions],isLoading:!1,error:null}));try{const{data:{user:p}}=await W.auth.getUser();p&&(await W.from("wallets").upsert({user_id:p.id,currency:a,available_balance:c,reserved_balance:d,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:p.id,type:h.type,currency:h.currency,amount:h.amount,status:h.status,reference:h.reference,description:h.description,created_at:new Date().toISOString()}))}catch(p){console.error("❌ Failed to persist prediction lock:",p)}return console.log("✅ Prediction made successfully:",s,a),h}catch(o){const l=o instanceof Error?o.message:"Failed to make prediction";throw i({isLoading:!1,error:l}),o}},recordWin:async(s,r,n,a="USD")=>{i({isLoading:!0,error:null});try{const l=t().balances.find(p=>p.currency===a),c=(l?.available||0)+s,d=Math.max(0,(l?.reserved||0)-s),u=c+d,h={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"win",amount:s,description:r,date:new Date,status:"completed",reference:`WIN_${Date.now()}`,currency:a,fee:0,predictionId:n};i(p=>({balances:p.balances.map(f=>f.currency===a?{...f,available:c,reserved:d,total:u}:f),transactions:[h,...p.transactions],isLoading:!1,error:null}));try{const{data:{user:p}}=await W.auth.getUser();p&&(await W.from("wallets").upsert({user_id:p.id,currency:a,available_balance:c,reserved_balance:d,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:p.id,type:"bet_release",currency:h.currency,amount:h.amount,status:h.status,reference:h.reference,description:h.description,prediction_id:n,created_at:new Date().toISOString()}))}catch(p){console.error("❌ Failed to persist win:",p)}return console.log("✅ Win recorded successfully:",s,a),h}catch(o){const l=o instanceof Error?o.message:"Failed to record win";throw i({isLoading:!1,error:l}),o}},recordLoss:async(s,r,n,a="USD")=>{i({isLoading:!0,error:null});try{const l=t().balances.find(h=>h.currency===a),c=Math.max(0,(l?.reserved||0)-s),d=(l?.available||0)+c,u={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"loss",amount:s,description:r,date:new Date,status:"completed",reference:`LOSS_${Date.now()}`,currency:a,fee:0,predictionId:n};i(h=>({balances:h.balances.map(p=>p.currency===a?{...p,reserved:c,total:d}:p),transactions:[u,...h.transactions],isLoading:!1,error:null}));try{const{data:{user:h}}=await W.auth.getUser();h&&(await W.from("wallets").upsert({user_id:h.id,currency:a,available_balance:l?.available||0,reserved_balance:c,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:h.id,type:"loss",currency:u.currency,amount:u.amount,status:u.status,reference:u.reference,description:u.description,prediction_id:n,created_at:new Date().toISOString()}))}catch(h){console.error("❌ Failed to persist loss:",h)}return console.log("✅ Loss recorded successfully:",s,a),u}catch(o){const l=o instanceof Error?o.message:"Failed to record loss";throw i({isLoading:!1,error:l}),o}},transferFunds:async(s,r,n,a="USD")=>{i({isLoading:!0,error:null});try{if(isNaN(s)||s<=0)throw new Error("Please enter a valid amount");const l=t().balances.find(h=>h.currency===a);if(!l||l.available<s)throw new Error("Insufficient funds");const c=l.available-s,d=c+l.reserved,u={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"transfer_out",amount:s,description:n||`Transfer to ${r}`,date:new Date,status:"completed",reference:`TRF_${Date.now()}`,currency:a,fee:0,toUser:r};i(h=>({balances:h.balances.map(p=>p.currency===a?{...p,available:c,total:d}:p),transactions:[u,...h.transactions],isLoading:!1,error:null}));try{const{data:{user:h}}=await W.auth.getUser();h&&(await W.from("wallets").upsert({user_id:h.id,currency:a,available_balance:c,reserved_balance:l.reserved,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await W.from("wallet_transactions").insert({user_id:h.id,type:u.type,currency:u.currency,amount:u.amount,status:u.status,reference:u.reference,description:u.description,to_user:r,created_at:new Date().toISOString()}))}catch(h){console.error("❌ Failed to persist transfer:",h)}return console.log("✅ Transfer successful:",s,a),u}catch(o){const l=o instanceof Error?o.message:"Failed to transfer funds";throw i({isLoading:!1,error:l}),o}},getBalance:(s="USD")=>t().balances.find(a=>a.currency===s)?.available||0,getTransactionHistory:s=>{let n=[...t().transactions];return s?.type&&(n=n.filter(a=>a.type===s.type)),s?.currency&&(n=n.filter(a=>a.currency===s.currency)),s?.limit&&(n=n.slice(0,s.limit)),n},clearError:()=>{i({error:null})}})),cc=Object.freeze(Object.defineProperty({__proto__:null,useWalletStore:ls},Symbol.toStringTag,{value:"Module"})),wr=new Map,bs=i=>{const t=wr.get(i);return t?Object.fromEntries(Object.entries(t.stores).map(([s,r])=>[s,r.getState()])):{}},dc=(i,t,s)=>{if(i===void 0)return{type:"untracked",connection:t.connect(s)};const r=wr.get(s.name);if(r)return{type:"tracked",store:i,...r};const n={connection:t.connect(s),stores:{}};return wr.set(s.name,n),{type:"tracked",store:i,...n}},uc=(i,t={})=>(s,r,n)=>{const{enabled:a,anonymousActionType:o,store:l,...c}=t;let d;try{d=(a??!1)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!d)return i(s,r,n);const{connection:u,...h}=dc(l,d,c);let p=!0;n.setState=(x,y,b)=>{const v=s(x,y);if(!p)return v;const j=b===void 0?{type:o||"anonymous"}:typeof b=="string"?{type:b}:b;return l===void 0?(u?.send(j,r()),v):(u?.send({...j,type:`${l}/${j.type}`},{...bs(c.name),[l]:n.getState()}),v)};const f=(...x)=>{const y=p;p=!1,s(...x),p=y},g=i(n.setState,r,n);if(h.type==="untracked"?u?.init(g):(h.stores[h.store]=n,u?.init(Object.fromEntries(Object.entries(h.stores).map(([x,y])=>[x,x===h.store?g:y.getState()])))),n.dispatchFromDevtools&&typeof n.dispatch=="function"){let x=!1;const y=n.dispatch;n.dispatch=(...b)=>{y(...b)}}return u.subscribe(x=>{var y;switch(x.type){case"ACTION":if(typeof x.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return sr(x.payload,b=>{if(b.type==="__setState"){if(l===void 0){f(b.state);return}Object.keys(b.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const v=b.state[l];if(v==null)return;JSON.stringify(n.getState())!==JSON.stringify(v)&&f(v);return}n.dispatchFromDevtools&&typeof n.dispatch=="function"&&n.dispatch(b)});case"DISPATCH":switch(x.payload.type){case"RESET":return f(g),l===void 0?u?.init(n.getState()):u?.init(bs(c.name));case"COMMIT":if(l===void 0){u?.init(n.getState());return}return u?.init(bs(c.name));case"ROLLBACK":return sr(x.state,b=>{if(l===void 0){f(b),u?.init(n.getState());return}f(b[l]),u?.init(bs(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return sr(x.state,b=>{if(l===void 0){f(b);return}JSON.stringify(n.getState())!==JSON.stringify(b[l])&&f(b[l])});case"IMPORT_STATE":{const{nextLiftedState:b}=x.payload,v=(y=b.computedStates.slice(-1)[0])==null?void 0:y.state;if(!v)return;f(l===void 0?v:v[l]),u?.send(null,b);return}case"PAUSE_RECORDING":return p=!p}return}}),g},hc=uc,sr=(i,t)=>{let s;try{s=JSON.parse(i)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}s!==void 0&&t(s)};function Nn(i,t){let s;try{s=i()}catch{return}return{getItem:n=>{var a;const o=c=>c===null?null:JSON.parse(c,t?.reviver),l=(a=s.getItem(n))!=null?a:null;return l instanceof Promise?l.then(o):o(l)},setItem:(n,a)=>s.setItem(n,JSON.stringify(a,t?.replacer)),removeItem:n=>s.removeItem(n)}}const ts=i=>t=>{try{const s=i(t);return s instanceof Promise?s:{then(r){return ts(r)(s)},catch(r){return this}}}catch(s){return{then(r){return this},catch(r){return ts(r)(s)}}}},mc=(i,t)=>(s,r,n)=>{let a={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:y=>y,version:0,merge:(y,b)=>({...b,...y}),...t},o=!1;const l=new Set,c=new Set;let d;try{d=a.getStorage()}catch{}if(!d)return i((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),s(...y)},r,n);const u=ts(a.serialize),h=()=>{const y=a.partialize({...r()});let b;const v=u({state:y,version:a.version}).then(j=>d.setItem(a.name,j)).catch(j=>{b=j});if(b)throw b;return v},p=n.setState;n.setState=(y,b)=>{p(y,b),h()};const f=i((...y)=>{s(...y),h()},r,n);let g;const x=()=>{var y;if(!d)return;o=!1,l.forEach(v=>v(r()));const b=((y=a.onRehydrateStorage)==null?void 0:y.call(a,r()))||void 0;return ts(d.getItem.bind(d))(a.name).then(v=>{if(v)return a.deserialize(v)}).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==a.version){if(a.migrate)return a.migrate(v.state,v.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return v.state}).then(v=>{var j;return g=a.merge(v,(j=r())!=null?j:f),s(g,!0),h()}).then(()=>{b?.(g,void 0),o=!0,c.forEach(v=>v(g))}).catch(v=>{b?.(void 0,v)})};return n.persist={setOptions:y=>{a={...a,...y},y.getStorage&&(d=y.getStorage())},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>x(),hasHydrated:()=>o,onHydrate:y=>(l.add(y),()=>{l.delete(y)}),onFinishHydration:y=>(c.add(y),()=>{c.delete(y)})},x(),g||f},pc=(i,t)=>(s,r,n)=>{let a={storage:Nn(()=>localStorage),partialize:x=>x,version:0,merge:(x,y)=>({...y,...x}),...t},o=!1;const l=new Set,c=new Set;let d=a.storage;if(!d)return i((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),s(...x)},r,n);const u=()=>{const x=a.partialize({...r()});return d.setItem(a.name,{state:x,version:a.version})},h=n.setState;n.setState=(x,y)=>{h(x,y),u()};const p=i((...x)=>{s(...x),u()},r,n);n.getInitialState=()=>p;let f;const g=()=>{var x,y;if(!d)return;o=!1,l.forEach(v=>{var j;return v((j=r())!=null?j:p)});const b=((y=a.onRehydrateStorage)==null?void 0:y.call(a,(x=r())!=null?x:p))||void 0;return ts(d.getItem.bind(d))(a.name).then(v=>{if(v)if(typeof v.version=="number"&&v.version!==a.version){if(a.migrate)return[!0,a.migrate(v.state,v.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,v.state];return[!1,void 0]}).then(v=>{var j;const[k,L]=v;if(f=a.merge(L,(j=r())!=null?j:p),s(f,!0),k)return u()}).then(()=>{b?.(f,void 0),f=r(),o=!0,c.forEach(v=>v(f))}).catch(v=>{b?.(void 0,v)})};return n.persist={setOptions:x=>{a={...a,...x},x.storage&&(d=x.storage)},clearStorage:()=>{d?.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>g(),hasHydrated:()=>o,onHydrate:x=>(l.add(x),()=>{l.delete(x)}),onFinishHydration:x=>(c.add(x),()=>{c.delete(x)})},a.skipHydration||g(),f||p},fc=(i,t)=>"getStorage"in t||"serialize"in t||"deserialize"in t?mc(i,t):pc(i,t),Sn=fc,Us=rt()(Sn((i,t)=>({notifications:[],unreadCount:0,toasts:[],settings:{predictionOutcomes:!0,comments:!0,marketClosing:!0,payouts:!0,pushNotifications:!0,emailNotifications:!1,frequency:"immediate"},addNotification:s=>{const r={...s,id:crypto.randomUUID(),createdAt:new Date().toISOString(),read:!1};i(n=>({notifications:[r,...n.notifications],unreadCount:n.unreadCount+1})),["prediction_outcome","payout"].includes(r.type)&&t().addToast({type:"success",title:r.title,message:r.message,duration:5e3}),t().settings.pushNotifications&&t().sendPushNotification(r)},markAsRead:s=>{i(r=>({notifications:r.notifications.map(n=>n.id===s?{...n,read:!0}:n),unreadCount:Math.max(0,r.unreadCount-1)}))},markAllAsRead:()=>{i(s=>({notifications:s.notifications.map(r=>({...r,read:!0})),unreadCount:0}))},deleteNotification:s=>{i(r=>{const n=r.notifications.find(o=>o.id===s),a=n&&!n.read;return{notifications:r.notifications.filter(o=>o.id!==s),unreadCount:a?Math.max(0,r.unreadCount-1):r.unreadCount}})},clearAllNotifications:()=>{i({notifications:[],unreadCount:0})},updateSettings:s=>{i(r=>({settings:{...r.settings,...s}}))},addToast:s=>{const r={...s,id:crypto.randomUUID()};i(n=>({toasts:[...n.toasts,r]}))},removeToast:s=>{i(r=>({toasts:r.toasts.filter(n=>n.id!==s)}))},clearToasts:()=>{i({toasts:[]})},requestPermission:async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.warn("This browser does not support notifications"),!1),subscribeToPush:async()=>{if(!await t().requestPermission())throw new Error("Notification permission denied");console.log("Push notifications subscribed"),i(r=>({settings:{...r.settings,pushNotifications:!0}}))},unsubscribeFromPush:async()=>{console.log("Push notifications unsubscribed"),i(s=>({settings:{...s.settings,pushNotifications:!1}}))},sendPushNotification:s=>{if(!("Notification"in window)||Notification.permission!=="granted")return;const r=new Notification(s.title,{body:s.message,icon:"/icon-192x192.png",badge:"/icon-badge.png",tag:s.id,renotify:!1});r.onclick=()=>{window.focus(),r.close(),s.data?.predictionId&&(window.location.href=`/predictions/${s.data.predictionId}`)},setTimeout(()=>{r.close()},5e3)},notifySettlementReady:(s,r)=>{const{addNotification:n,addToast:a}=t();n({type:"settlement_ready",title:"Settlement Required",message:`"${r}" needs your validation. Tap to review the outcome.`,data:{predictionId:s,action:"validate_settlement"}}),a({type:"info",title:"⚖️ Settlement Ready",message:`Tap to validate the outcome of "${r}"`,duration:8e3})},notifySettlementCompleted:(s,r,n,a)=>{const{addNotification:o,addToast:l}=t(),c=n==="won"?`You won ${a?`$${a}`:""} on "${r}"!`:`Settlement completed for "${r}". Better luck next time!`;o({type:"settlement_completed",title:n==="won"?"You Won!":"Settlement Complete",message:c,data:{predictionId:s,outcome:n,payout:a}}),l({type:n==="won"?"success":"info",title:n==="won"?"🎉 You Won!":"📋 Settlement Complete",message:c,duration:n==="won"?1e4:6e3})},showSuccess:(s,r)=>{t().addToast({type:"success",title:r||"Success",message:s,duration:3e3})},showError:(s,r)=>{t().addToast({type:"error",title:r||"Error",message:s,duration:5e3})}}),{name:"fanclubz-notifications",partialize:i=>({notifications:i.notifications,settings:i.settings})})),ct=(i,t)=>{Us.getState().addToast({type:"success",title:t||"Success",message:i,duration:3e3})},dt=(i,t)=>{Us.getState().addToast({type:"error",title:t||"Error",message:i,duration:5e3})},ht=i=>{if(!i)return null;const t=i.user_metadata||{},s=i.app_metadata||{};let r="",n="",a="";if(t.full_name){const o=t.full_name.split(" ");r=o[0]||"",n=o.slice(1).join(" ")||""}else r=t.firstName||t.first_name||t.given_name||"User",n=t.lastName||t.last_name||t.family_name||"";return t.avatar_url?a=t.avatar_url:t.picture?a=t.picture:t.photo&&(a=t.photo),{id:i.id,email:i.email||"",firstName:r,lastName:n,phone:i.phone,avatar:a,provider:s.provider||"email",bio:t.bio,totalEarnings:t.totalEarnings||0,totalInvested:t.totalInvested||0,winRate:t.winRate||0,activePredictions:t.activePredictions||0,totalPredictions:t.totalPredictions||0,rank:t.rank||0,level:t.level||"New Predictor",createdAt:i.created_at||new Date().toISOString()}};let _i=!1,rr=!1,Ci="",Pi=0;const oe=rt()(Sn((i,t)=>({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!1,lastAuthCheck:0,initializeAuth:async()=>{const s=t(),r=Date.now();if(rr){console.log("🔄 Auth initialization already in progress, waiting...");return}if(s.initialized&&r-s.lastAuthCheck<3e4){console.log("🔄 Auth recently checked, skipping initialization");return}if(s.isAuthenticated&&s.user&&s.token&&r-s.lastAuthCheck<3e5){s.initialized||console.log("✅ Using cached auth state for:",s.user.firstName),i({loading:!1,initialized:!0,lastAuthCheck:r});return}if(s.loading){console.log("🔄 Auth check already in progress...");return}rr=!0,i({loading:!0,lastAuthCheck:r});try{console.log("🔐 Initializing authentication...");const{data:{session:n},error:a}=await W.auth.getSession();if(a){console.log("⚠️ Session check error:",a.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:r});return}if(n?.user){const o=ht(n.user);s.initialized||console.log("✅ Found active session for:",o?.firstName),i({isAuthenticated:!0,user:o,token:n.access_token,loading:!1,initialized:!0,lastAuthCheck:r})}else s.initialized||console.log("ℹ️ No active session found"),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:r})}catch(n){console.error("❌ Auth initialization error:",n.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:r})}finally{rr=!1}},login:async(s,r)=>{i({loading:!0});try{console.log("🔑 Logging in user:",s);const{data:n,error:a}=await tr.signIn(s,r);if(a){console.error("❌ Login error:",a.message);let o="Login failed. Please check your credentials.";throw a.message.includes("Invalid login credentials")?o="Invalid email or password. Please try again.":a.message.includes("Email not confirmed")&&(o="Please check your email and click the confirmation link."),i({loading:!1}),dt(o),new Error(o)}if(n.user&&n.session){const o=ht(n.user);console.log("✅ Login successful for:",o?.firstName),i({isAuthenticated:!0,user:o,token:n.session.access_token,loading:!1,initialized:!0,lastAuthCheck:Date.now()}),ct(`Welcome back, ${o?.firstName}!`)}}catch(n){throw console.error("❌ Login exception:",n.message),i({loading:!1}),n}},register:async(s,r,n,a)=>{i({loading:!0});try{if(console.log("📝 Registering user:",s),r.length<6)throw new Error("Password must be at least 6 characters long");const o={data:{firstName:n,lastName:a,first_name:n,last_name:a,full_name:`${n} ${a}`}},{data:l,error:c}=await tr.signUp(s,r,o);if(c){console.error("❌ Registration error:",c.message);let d="Registration failed. Please try again.";throw c.message.includes("User already registered")?d="An account with this email already exists. Please sign in instead.":c.message.includes("Password should be at least")&&(d="Password must be at least 6 characters long."),i({loading:!1}),dt(d),new Error(d)}if(l.user){const d=ht(l.user);console.log("✅ Registration successful for:",d?.firstName),l.session?(i({isAuthenticated:!0,user:d,token:l.session.access_token,loading:!1,initialized:!0,lastAuthCheck:Date.now()}),ct(`Welcome to Fan Club Z, ${d?.firstName}!`)):(i({isAuthenticated:!0,user:d,token:null,loading:!1,initialized:!0,lastAuthCheck:Date.now()}),ct(`Welcome to Fan Club Z, ${d?.firstName}! Please check your email to verify your account.`))}}catch(o){throw console.error("❌ Registration exception:",o.message),i({loading:!1}),o}},loginWithOAuth:async s=>{i({loading:!0});try{console.log(`🔑 Starting ${s} OAuth login...`);const r=window.location.origin,n=`${r}/auth/callback`;console.log("🔗 Current origin:",r),console.log("🔗 OAuth redirect URL:",n);const{data:a,error:o}=await W.auth.signInWithOAuth({provider:s,options:{redirectTo:n,queryParams:{access_type:"offline",prompt:"consent"}}});if(o)throw console.error(`❌ ${s} OAuth error:`,o.message),i({loading:!1}),dt(`${s} sign-in failed. Please try again.`),new Error(o.message);console.log(`✅ ${s} OAuth initiated, redirecting...`)}catch(r){throw console.error(`❌ ${s} OAuth exception:`,r.message),i({loading:!1}),r}},handleOAuthCallback:async()=>{try{console.log("🔄 Handling OAuth callback...");const{data:s,error:r}=await W.auth.getSession();if(r)throw console.error("❌ OAuth callback error:",r.message),dt("Authentication failed. Please try again."),new Error(r.message);if(s.session?.user){const n=ht(s.session.user);console.log("✅ OAuth authentication successful for:",n?.firstName),i({isAuthenticated:!0,user:n,token:s.session.access_token,loading:!1,initialized:!0,lastAuthCheck:Date.now()});const a=n?.provider?.charAt(0).toUpperCase()+n?.provider?.slice(1);return ct(`Welcome ${n?.firstName}! Signed in with ${a}.`),n}else throw new Error("No user session found after OAuth callback")}catch(s){throw console.error("❌ OAuth callback exception:",s.message),i({loading:!1}),s}},logout:async()=>{i({loading:!0});try{console.log("🚪 Logging out...");const{error:s}=await tr.signOut();s&&console.error("❌ Logout error:",s.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:0}),ct("Signed out successfully")}catch(s){console.error("❌ Logout exception:",s.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:0})}},updateProfile:async s=>{i({loading:!0});try{const r=t().user;if(!r)throw new Error("No user logged in");console.log("📝 Updating profile...");const{data:n,error:a}=await W.auth.updateUser({data:{firstName:s.firstName||r.firstName,lastName:s.lastName||r.lastName,bio:s.bio!==void 0?s.bio:r.bio}});if(a)throw new Error(a.message);if(n.user){const o=ht(n.user);i({user:o,loading:!1,lastAuthCheck:Date.now()}),ct("Profile updated successfully!")}}catch(r){throw console.error("❌ Profile update error:",r.message),i({loading:!1}),dt(r.message||"Failed to update profile"),r}},uploadAvatar:async s=>{const r=t();if(!r.user)throw new Error("No user logged in");const n=r.user.id,a=s.name.split(".").pop()?.toLowerCase()||"jpg",o=`${n}/${Date.now()}.${a}`,{data:l,error:c}=await W.storage.from("avatars").upload(o,s,{cacheControl:"3600",upsert:!0,contentType:s.type});if(c)throw dt("Failed to upload image."),c;const{data:d}=W.storage.from("avatars").getPublicUrl(l.path),u=d.publicUrl,{data:h,error:p}=await W.auth.updateUser({data:{avatar_url:u}});if(p)throw dt("Failed to save avatar to profile."),p;await clientDb.users.updateProfile(n,{avatar_url:u});const f=ht(h.user);return i({user:f,lastAuthCheck:Date.now()}),ct("Profile photo updated."),u}}),{name:"fanclubz-auth-storage",storage:Nn(()=>localStorage),partialize:i=>({isAuthenticated:i.isAuthenticated,user:i.user,token:i.token,initialized:i.initialized,lastAuthCheck:i.lastAuthCheck}),version:5}));typeof window<"u"&&!_i&&(_i=!0,console.log("🔧 Setting up auth state listener..."),W.auth.onAuthStateChange((i,t)=>{const s=Date.now();if(!(Ci===i&&s-Pi<1e3)){if(Ci=i,Pi=s,console.log("🔄 Auth state change:",i),i==="SIGNED_OUT")console.log("🔓 User signed out"),oe.setState({isAuthenticated:!1,user:null,token:null,lastAuthCheck:0});else if(i==="TOKEN_REFRESHED"&&t?.user){console.log("🔄 Token refreshed");const r=ht(t.user);oe.setState({user:r,token:t.access_token,lastAuthCheck:s})}}}));const Br=rt((i,t)=>({likedPredictions:new Set,likeCounts:{},loading:!1,error:null,initializeLikes:async()=>{try{const{data:{user:s}}=await W.auth.getUser();if(!s){console.log("❌ No authenticated user, skipping like initialization");return}console.log("🔄 Initializing like store for user:",s.id);const{data:r,error:n}=await W.from("prediction_likes").select("prediction_id").eq("user_id",s.id);n&&console.error("❌ Error fetching user likes:",n);const{data:a,error:o}=await W.from("predictions").select("id, likes_count");o&&console.error("❌ Error fetching like counts:",o);const l=new Set(r?.map(d=>d.prediction_id)||[]),c=Object.fromEntries(a?.map(d=>[d.id,d.likes_count||0])||[]);i({likedPredictions:l,likeCounts:c,error:null}),console.log("✅ Like store initialized successfully:",{likedCount:l.size,totalPredictions:Object.keys(c).length,userLikes:Array.from(l)})}catch(s){console.error("❌ Error initializing likes:",s),i({error:"Failed to load likes"})}},refreshLikeCounts:async()=>{try{const{data:s,error:r}=await W.from("predictions").select("id, likes_count");if(r){console.error("Error refreshing like counts:",r);return}const n=Object.fromEntries(s?.map(a=>[a.id,a.likes_count||0])||[]);i({likeCounts:n}),console.log("✅ Like counts refreshed:",Object.keys(n).length,"predictions")}catch(s){console.error("Error refreshing like counts:",s)}},toggleLike:async s=>{const{likedPredictions:r,likeCounts:n}=t(),a=r.has(s),o=n[s]||0,l=new Set(r),c={...n};a?(l.delete(s),c[s]=Math.max(0,o-1)):(l.add(s),c[s]=o+1),i({likedPredictions:l,likeCounts:c,loading:!0});try{const{data:{user:d}}=await W.auth.getUser();if(!d)throw new Error("User not authenticated");if(a){const{error:u}=await W.from("prediction_likes").delete().eq("prediction_id",s).eq("user_id",d.id);if(u)throw u;const{error:h}=await W.from("predictions").update({likes_count:Math.max(0,o-1),updated_at:new Date().toISOString()}).eq("id",s);h&&console.error("Error updating prediction likes count:",h)}else{const{error:u}=await W.from("prediction_likes").insert({prediction_id:s,user_id:d.id,created_at:new Date().toISOString()});if(u&&!u.message.includes("duplicate"))throw u;const{error:h}=await W.from("predictions").update({likes_count:o+1,updated_at:new Date().toISOString()}).eq("id",s);h&&console.error("Error updating prediction likes count:",h)}i({loading:!1,error:null}),console.log("✅ Like toggled successfully:",{predictionId:s,wasLiked:!a})}catch(d){throw console.error("Error toggling like:",d),i({likedPredictions:r,likeCounts:n,loading:!1,error:"Failed to update like"}),d}},checkIfLiked:s=>t().likedPredictions.has(s),getLikeCount:s=>{const n=t().likeCounts[s];return n!==void 0?n:0},clearError:()=>{i({error:null})},debugLikeState:s=>{const r=t();console.log(`🔍 Debug like state for prediction ${s}:`,{isLiked:r.likedPredictions.has(s),likeCount:r.likeCounts[s]||0,allLikedPredictions:Array.from(r.likedPredictions),allLikeCounts:r.likeCounts,loading:r.loading,error:r.error})}}));function _t(){const i=window.location.hostname,t=window.location.protocol;if(console.log("🌍 Environment Detection:"),console.log("  - Hostname:",i),console.log("  - Protocol:",t),console.log("  - VITE_API_URL:","https://fan-club-z.onrender.com"),console.log("  - MODE:","production"),i==="app.fanclubz.app"||i==="fanclubz.app"||i==="www.fanclubz.app"){const s={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"production",isDevelopment:!1,isProduction:!0};return console.log("🚀 Production environment detected (single service):",s),s}if(i==="dev.fanclubz.app"){const s={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"staging",isDevelopment:!1,isProduction:!1};return console.log("🧪 Development environment detected (single service):",s),s}if(i.includes("vercel.app")){const s={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"production",isDevelopment:!1,isProduction:!0};return console.log("🚀 Vercel deployment detected, using single service:",s),s}{const s={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"production",isDevelopment:!1,isProduction:!0};return console.log("🔧 Using VITE_API_URL:",s),s}}function gc(){return _t().apiUrl}function xc(){const i=_t();return console.log("🔧 Socket URL configuration:",{hostname:window.location.hostname,configuredUrl:i.socketUrl,environment:i.environment,isDevelopment:i.isDevelopment,isProduction:i.isProduction}),i.socketUrl}function bc(){return _t().isDevelopment}function yc(){return _t().isProduction}const vc=Object.freeze(Object.defineProperty({__proto__:null,getApiUrl:gc,getEnvironmentConfig:_t,getSocketUrl:xc,isDevelopment:bc,isProduction:yc},Symbol.toStringTag,{value:"Module"})),Gt=_t().apiUrl,Wr=rt()(hc((i,t)=>({commentsByPrediction:{},commentCounts:{},loading:{},errors:{},submitting:{},fetchedPredictions:new Set,lastFetched:{},initialized:!1,initialize:()=>{t().initialized||(console.log("🔧 Initializing unified comment store"),i({initialized:!0}))},initializeCommentCounts:s=>{console.log("🔧 Initializing comment counts:",s),i(r=>({commentCounts:{...r.commentCounts,...s}}))},updateCommentCount:(s,r)=>{if(!s?.trim()){console.warn("⚠️ Cannot update comment count: invalid predictionId");return}console.log(`📊 Updating comment count for ${s}: ${r}`),i(n=>({commentCounts:{...n.commentCounts,[s]:r}}))},getCommentCount:s=>{if(!s?.trim())return 0;const r=t(),n=r.commentsByPrediction[s];return n&&Array.isArray(n)?n.length:r.commentCounts[s]!==void 0?r.commentCounts[s]:0},getComments:s=>s?.trim()?t().commentsByPrediction[s]||[]:[],clearError:s=>{s?.trim()&&i(r=>({errors:{...r.errors,[s]:null}}))},fetchComments:async s=>{if(!s?.trim()){console.warn("⚠️ Cannot fetch comments: invalid predictionId");return}const r=t(),n=r.lastFetched[s],a=Date.now()-60*1e3,o=r.commentsByPrediction[s],l=Array.isArray(o)?o.length:0;if(n&&n>a&&l>0){console.log(`⚡ Using cached comments for prediction ${s} (${l} comments)`);return}if(r.loading[s]){console.log(`⏳ Already loading comments for prediction ${s}`);return}console.log(`🔍 Fetching comments for prediction ${s}`),i(c=>({loading:{...c.loading,[s]:!0},errors:{...c.errors,[s]:null}}));try{const c=await fetch(`${Gt}/api/v2/social/predictions/${s}/comments`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!c.ok)throw new Error(`API responded with ${c.status}`);const u=(await c.json()).comments||[];console.log(`✅ Loaded ${u.length} comments for prediction ${s}`),i(h=>{const p=new Set(h.fetchedPredictions);return p.add(s),{commentsByPrediction:{...h.commentsByPrediction,[s]:u},commentCounts:{...h.commentCounts,[s]:u.length},fetchedPredictions:p,lastFetched:{...h.lastFetched,[s]:Date.now()},loading:{...h.loading,[s]:!1}}})}catch(c){console.error("❌ Failed to fetch comments:",c),i(d=>({commentsByPrediction:{...d.commentsByPrediction,[s]:[]},commentCounts:{...d.commentCounts,[s]:0},loading:{...d.loading,[s]:!1},errors:{...d.errors,[s]:"Failed to load comments. Please try again later."}}))}},addComment:async(s,r,n,a)=>{if(!s?.trim())throw new Error("Cannot add comment: invalid predictionId");if(!r?.trim())throw new Error("Comment content cannot be empty");console.log(`💬 Adding comment to prediction ${s}`),i(o=>({submitting:{...o.submitting,[s]:!0},errors:{...o.errors,[s]:null}}));try{const o=await fetch(`${Gt}/api/v2/social/predictions/${s}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:r.trim(),parent_comment_id:n||null,user:a||null})});if(!o.ok)throw new Error(`API responded with ${o.status}`);const l=await o.json();i(c=>{const d=c.commentsByPrediction[s]||[];let u,h;return n?(u=d.map(p=>p.id===n?{...p,replies:[l,...p.replies||[]],replies_count:(p.replies_count||0)+1}:p),h=c.commentCounts[s]||0):(u=[l,...d],h=(c.commentCounts[s]||0)+1),{commentsByPrediction:{...c.commentsByPrediction,[s]:u},commentCounts:{...c.commentCounts,[s]:h},submitting:{...c.submitting,[s]:!1}}}),console.log(`✅ Added comment to prediction ${s}`)}catch(o){throw console.error("❌ Failed to add comment:",o),i(l=>({submitting:{...l.submitting,[s]:!1},errors:{...l.errors,[s]:"Failed to post comment. Please try again."}})),o}},toggleCommentLike:async(s,r)=>{if(!s?.trim()||!r?.trim()){console.warn("⚠️ Cannot toggle comment like: invalid parameters");return}try{i(a=>{const o=a.commentsByPrediction[r]||[],l=c=>c.id===s?{...c,is_liked:!c.is_liked,likes_count:c.is_liked?Math.max(0,c.likes_count-1):c.likes_count+1}:c.replies?{...c,replies:c.replies.map(l)}:c;return{commentsByPrediction:{...a.commentsByPrediction,[r]:o.map(l)}}}),(await fetch(`${Gt}/api/v2/social/comments/${s}/like`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok?console.log("✅ Like synced with server"):console.warn("❌ Failed to sync like with server, but UI updated optimistically")}catch(n){console.error("❌ Failed to toggle like:",n)}},editComment:async(s,r,n)=>{if(!s?.trim()||!r?.trim()){console.warn("⚠️ Cannot edit comment: invalid parameters");return}if(!n?.trim()){console.warn("⚠️ Cannot edit comment: empty content");return}try{const a=await fetch(`${Gt}/api/v2/social/comments/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n.trim()})});if(!a.ok)throw new Error(`API responded with ${a.status}`);i(o=>{const l=c=>c.id===r?{...c,content:n.trim(),is_edited:!0,updated_at:new Date().toISOString()}:c.replies?{...c,replies:c.replies.map(l)}:c;return{commentsByPrediction:{...o.commentsByPrediction,[s]:(o.commentsByPrediction[s]||[]).map(l)}}})}catch(a){throw console.error("❌ Failed to edit comment:",a),a}},deleteComment:async(s,r)=>{if(!s?.trim()||!r?.trim()){console.warn("⚠️ Cannot delete comment: invalid parameters");return}try{const n=await fetch(`${Gt}/api/v2/social/comments/${r}`,{method:"DELETE"});if(!n.ok)throw new Error(`API responded with ${n.status}`);i(a=>{let o=!1;const l=u=>{const h=[];for(const p of u){if(p.id===r){o=!0;continue}if(p.replies&&p.replies.length>0){const f=p.replies.length,g=l(p.replies),x=g.length;if(x!==f){h.push({...p,replies:g,replies_count:Math.max(0,(p.replies_count||f)-(f-x))});continue}}h.push(p)}return h},c=a.commentsByPrediction[s]||[],d=l(c);return{commentsByPrediction:{...a.commentsByPrediction,[s]:d},commentCounts:{...a.commentCounts,[s]:Math.max(0,(a.commentCounts[s]||d.length)-(o?1:0))}}})}catch(n){throw console.error("❌ Failed to delete comment:",n),n}}}),{name:"unified-comment-store",partialize:i=>({commentCounts:i.commentCounts,initialized:i.initialized})})),Hr=i=>{const t=Wr(),s=m.useMemo(()=>i?.trim()||"",[i]),r=m.useCallback(()=>s?t.fetchComments(s):(console.warn("⚠️ Cannot fetch comments: no prediction ID provided"),Promise.resolve()),[t.fetchComments,s]),n=m.useCallback((l,c,d)=>s?t.addComment(s,l,c,d):(console.warn("⚠️ Cannot add comment: no prediction ID provided"),Promise.resolve()),[t.addComment,s]),a=m.useCallback(l=>s?t.toggleCommentLike(l,s):(console.warn("⚠️ Cannot toggle like: no prediction ID provided"),Promise.resolve()),[t.toggleCommentLike,s]),o=m.useCallback(()=>{s&&t.clearError(s)},[t.clearError,s]);return m.useMemo(()=>s?{comments:t.getComments(s),commentCount:t.getCommentCount(s),isLoading:t.loading[s]||!1,error:t.errors[s]||null,isSubmitting:t.submitting[s]||!1,fetchComments:r,addComment:n,toggleCommentLike:a,clearError:o}:{comments:[],commentCount:0,isLoading:!1,error:null,isSubmitting:!1,fetchComments:r,addComment:n,toggleCommentLike:a,clearError:o},[s,t.commentsByPrediction[s],t.commentCounts[s],t.loading[s],t.errors[s],t.submitting[s],r,n,a,o])};let wc={data:""},jc=i=>typeof window=="object"?((i?i.querySelector("#_goober"):window._goober)||Object.assign((i||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:i||wc,kc=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Nc=/\/\*[^]*?\*\/|  +/g,Ei=/\n+/g,Xe=(i,t)=>{let s="",r="",n="";for(let a in i){let o=i[a];a[0]=="@"?a[1]=="i"?s=a+" "+o+";":r+=a[1]=="f"?Xe(o,a):a+"{"+Xe(o,a[1]=="k"?"":t)+"}":typeof o=="object"?r+=Xe(o,t?t.replace(/([^,])+/g,l=>a.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,l):l?l+" "+c:c)):a):o!=null&&(a=/^--/.test(a)?a:a.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=Xe.p?Xe.p(a,o):a+":"+o+";")}return s+(t&&n?t+"{"+n+"}":n)+r},Be={},_n=i=>{if(typeof i=="object"){let t="";for(let s in i)t+=s+_n(i[s]);return t}return i},Sc=(i,t,s,r,n)=>{let a=_n(i),o=Be[a]||(Be[a]=(c=>{let d=0,u=11;for(;d<c.length;)u=101*u+c.charCodeAt(d++)>>>0;return"go"+u})(a));if(!Be[o]){let c=a!==i?i:(d=>{let u,h,p=[{}];for(;u=kc.exec(d.replace(Nc,""));)u[4]?p.shift():u[3]?(h=u[3].replace(Ei," ").trim(),p.unshift(p[0][h]=p[0][h]||{})):p[0][u[1]]=u[2].replace(Ei," ").trim();return p[0]})(i);Be[o]=Xe(n?{["@keyframes "+o]:c}:c,s?"":"."+o)}let l=s&&Be.g?Be.g:null;return s&&(Be.g=Be[o]),((c,d,u,h)=>{h?d.data=d.data.replace(h,c):d.data.indexOf(c)===-1&&(d.data=u?c+d.data:d.data+c)})(Be[o],t,r,l),o},_c=(i,t,s)=>i.reduce((r,n,a)=>{let o=t[a];if(o&&o.call){let l=o(s),c=l&&l.props&&l.props.className||/^go/.test(l)&&l;o=c?"."+c:l&&typeof l=="object"?l.props?"":Xe(l,""):l===!1?"":l}return r+n+(o??"")},"");function Ms(i){let t=this||{},s=i.call?i(t.p):i;return Sc(s.unshift?s.raw?_c(s,[].slice.call(arguments,1),t.p):s.reduce((r,n)=>Object.assign(r,n&&n.call?n(t.p):n),{}):s,jc(t.target),t.g,t.o,t.k)}let Cn,jr,kr;Ms.bind({g:1});let qe=Ms.bind({k:1});function Cc(i,t,s,r){Xe.p=t,Cn=i,jr=s,kr=r}function nt(i,t){let s=this||{};return function(){let r=arguments;function n(a,o){let l=Object.assign({},a),c=l.className||n.className;s.p=Object.assign({theme:jr&&jr()},l),s.o=/ *go\d+/.test(c),l.className=Ms.apply(s,r)+(c?" "+c:""),t&&(l.ref=o);let d=i;return i[0]&&(d=l.as||i,delete l.as),kr&&d[0]&&kr(l),Cn(d,l)}return t?t(n):n}}var Pc=i=>typeof i=="function",Ps=(i,t)=>Pc(i)?i(t):i,Ec=(()=>{let i=0;return()=>(++i).toString()})(),Pn=(()=>{let i;return()=>{if(i===void 0&&typeof window<"u"){let t=matchMedia("(prefers-reduced-motion: reduce)");i=!t||t.matches}return i}})(),Tc=20,Vr="default",En=(i,t)=>{let{toastLimit:s}=i.settings;switch(t.type){case 0:return{...i,toasts:[t.toast,...i.toasts].slice(0,s)};case 1:return{...i,toasts:i.toasts.map(o=>o.id===t.toast.id?{...o,...t.toast}:o)};case 2:let{toast:r}=t;return En(i,{type:i.toasts.find(o=>o.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=t;return{...i,toasts:i.toasts.map(o=>o.id===n||n===void 0?{...o,dismissed:!0,visible:!1}:o)};case 4:return t.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(o=>o.id!==t.toastId)};case 5:return{...i,pausedAt:t.time};case 6:let a=t.time-(i.pausedAt||0);return{...i,pausedAt:void 0,toasts:i.toasts.map(o=>({...o,pauseDuration:o.pauseDuration+a}))}}},ks=[],Tn={toasts:[],pausedAt:void 0,settings:{toastLimit:Tc}},Me={},An=(i,t=Vr)=>{Me[t]=En(Me[t]||Tn,i),ks.forEach(([s,r])=>{s===t&&r(Me[t])})},$n=i=>Object.keys(Me).forEach(t=>An(i,t)),Ac=i=>Object.keys(Me).find(t=>Me[t].toasts.some(s=>s.id===i)),Fs=(i=Vr)=>t=>{An(t,i)},$c={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Rc=(i={},t=Vr)=>{let[s,r]=m.useState(Me[t]||Tn),n=m.useRef(Me[t]);m.useEffect(()=>(n.current!==Me[t]&&r(Me[t]),ks.push([t,r]),()=>{let o=ks.findIndex(([l])=>l===t);o>-1&&ks.splice(o,1)}),[t]);let a=s.toasts.map(o=>{var l,c,d;return{...i,...i[o.type],...o,removeDelay:o.removeDelay||((l=i[o.type])==null?void 0:l.removeDelay)||i?.removeDelay,duration:o.duration||((c=i[o.type])==null?void 0:c.duration)||i?.duration||$c[o.type],style:{...i.style,...(d=i[o.type])==null?void 0:d.style,...o.style}}});return{...s,toasts:a}},Ic=(i,t="blank",s)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:t,ariaProps:{role:"status","aria-live":"polite"},message:i,pauseDuration:0,...s,id:s?.id||Ec()}),cs=i=>(t,s)=>{let r=Ic(t,i,s);return Fs(r.toasterId||Ac(r.id))({type:2,toast:r}),r.id},Y=(i,t)=>cs("blank")(i,t);Y.error=cs("error");Y.success=cs("success");Y.loading=cs("loading");Y.custom=cs("custom");Y.dismiss=(i,t)=>{let s={type:3,toastId:i};t?Fs(t)(s):$n(s)};Y.dismissAll=i=>Y.dismiss(void 0,i);Y.remove=(i,t)=>{let s={type:4,toastId:i};t?Fs(t)(s):$n(s)};Y.removeAll=i=>Y.remove(void 0,i);Y.promise=(i,t,s)=>{let r=Y.loading(t.loading,{...s,...s?.loading});return typeof i=="function"&&(i=i()),i.then(n=>{let a=t.success?Ps(t.success,n):void 0;return a?Y.success(a,{id:r,...s,...s?.success}):Y.dismiss(r),n}).catch(n=>{let a=t.error?Ps(t.error,n):void 0;a?Y.error(a,{id:r,...s,...s?.error}):Y.dismiss(r)}),i};var Oc=1e3,Lc=(i,t="default")=>{let{toasts:s,pausedAt:r}=Rc(i,t),n=m.useRef(new Map).current,a=m.useCallback((h,p=Oc)=>{if(n.has(h))return;let f=setTimeout(()=>{n.delete(h),o({type:4,toastId:h})},p);n.set(h,f)},[]);m.useEffect(()=>{if(r)return;let h=Date.now(),p=s.map(f=>{if(f.duration===1/0)return;let g=(f.duration||0)+f.pauseDuration-(h-f.createdAt);if(g<0){f.visible&&Y.dismiss(f.id);return}return setTimeout(()=>Y.dismiss(f.id,t),g)});return()=>{p.forEach(f=>f&&clearTimeout(f))}},[s,r,t]);let o=m.useCallback(Fs(t),[t]),l=m.useCallback(()=>{o({type:5,time:Date.now()})},[o]),c=m.useCallback((h,p)=>{o({type:1,toast:{id:h,height:p}})},[o]),d=m.useCallback(()=>{r&&o({type:6,time:Date.now()})},[r,o]),u=m.useCallback((h,p)=>{let{reverseOrder:f=!1,gutter:g=8,defaultPosition:x}=p||{},y=s.filter(j=>(j.position||x)===(h.position||x)&&j.height),b=y.findIndex(j=>j.id===h.id),v=y.filter((j,k)=>k<b&&j.visible).length;return y.filter(j=>j.visible).slice(...f?[v+1]:[0,v]).reduce((j,k)=>j+(k.height||0)+g,0)},[s]);return m.useEffect(()=>{s.forEach(h=>{if(h.dismissed)a(h.id,h.removeDelay);else{let p=n.get(h.id);p&&(clearTimeout(p),n.delete(h.id))}})},[s,a]),{toasts:s,handlers:{updateHeight:c,startPause:l,endPause:d,calculateOffset:u}}},Dc=qe`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,zc=qe`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Uc=qe`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Mc=nt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Dc} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${zc} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${i=>i.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Uc} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Fc=qe`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Bc=nt("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${i=>i.secondary||"#e0e0e0"};
  border-right-color: ${i=>i.primary||"#616161"};
  animation: ${Fc} 1s linear infinite;
`,Wc=qe`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Hc=qe`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Vc=nt("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Wc} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Hc} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${i=>i.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,qc=nt("div")`
  position: absolute;
`,Gc=nt("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Jc=qe`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Kc=nt("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Jc} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Yc=({toast:i})=>{let{icon:t,type:s,iconTheme:r}=i;return t!==void 0?typeof t=="string"?m.createElement(Kc,null,t):t:s==="blank"?null:m.createElement(Gc,null,m.createElement(Bc,{...r}),s!=="loading"&&m.createElement(qc,null,s==="error"?m.createElement(Mc,{...r}):m.createElement(Vc,{...r})))},Zc=i=>`
0% {transform: translate3d(0,${i*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Qc=i=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${i*-150}%,-1px) scale(.6); opacity:0;}
`,Xc="0%{opacity:0;} 100%{opacity:1;}",ed="0%{opacity:1;} 100%{opacity:0;}",td=nt("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,sd=nt("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,rd=(i,t)=>{let s=i.includes("top")?1:-1,[r,n]=Pn()?[Xc,ed]:[Zc(s),Qc(s)];return{animation:t?`${qe(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${qe(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},id=m.memo(({toast:i,position:t,style:s,children:r})=>{let n=i.height?rd(i.position||t||"top-center",i.visible):{opacity:0},a=m.createElement(Yc,{toast:i}),o=m.createElement(sd,{...i.ariaProps},Ps(i.message,i));return m.createElement(td,{className:i.className,style:{...n,...s,...i.style}},typeof r=="function"?r({icon:a,message:o}):m.createElement(m.Fragment,null,a,o))});Cc(m.createElement);var nd=({id:i,className:t,style:s,onHeightUpdate:r,children:n})=>{let a=m.useCallback(o=>{if(o){let l=()=>{let c=o.getBoundingClientRect().height;r(i,c)};l(),new MutationObserver(l).observe(o,{subtree:!0,childList:!0,characterData:!0})}},[i,r]);return m.createElement("div",{ref:a,className:t,style:s},n)},ad=(i,t)=>{let s=i.includes("top"),r=s?{top:0}:{bottom:0},n=i.includes("center")?{justifyContent:"center"}:i.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Pn()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${t*(s?1:-1)}px)`,...r,...n}},od=Ms`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,ys=16,ld=({reverseOrder:i,position:t="top-center",toastOptions:s,gutter:r,children:n,toasterId:a,containerStyle:o,containerClassName:l})=>{let{toasts:c,handlers:d}=Lc(s,a);return m.createElement("div",{"data-rht-toaster":a||"",style:{position:"fixed",zIndex:9999,top:ys,left:ys,right:ys,bottom:ys,pointerEvents:"none",...o},className:l,onMouseEnter:d.startPause,onMouseLeave:d.endPause},c.map(u=>{let h=u.position||t,p=d.calculateOffset(u,{reverseOrder:i,gutter:r,defaultPosition:t}),f=ad(h,p);return m.createElement(nd,{id:u.id,key:u.id,onHeightUpdate:d.updateHeight,className:u.visible?od:"",style:f},u.type==="custom"?Ps(u.message,u):n?n(u):m.createElement(id,{toast:u,position:h}))}))},G=Y;const ft=class ft{constructor(){ce(this,"scrollPositions",new Map);ce(this,"currentRoute","");ce(this,"scrollTimeout",null);ce(this,"isNavigating",!1);ce(this,"restoreTimeout",null);typeof window<"u"&&(this.currentRoute=window.location.pathname,this.setupNavigationListeners())}static getInstance(){return ft.instance||(ft.instance=new ft),ft.instance}setupNavigationListeners(){let t=window.location.pathname;new MutationObserver(()=>{const r=window.location.pathname;r!==t&&(console.log(`🔄 Route change detected: ${t} → ${r}`),this.handleRouteChange(t,r),t=r)}).observe(document.documentElement,{subtree:!0,childList:!0}),window.addEventListener("popstate",()=>{console.log("⬅️ Browser navigation detected"),this.isNavigating=!0,setTimeout(()=>{this.restoreScrollPosition(window.location.pathname),this.isNavigating=!1},100)}),window.addEventListener("beforeunload",()=>{this.saveCurrentScrollPosition()})}handleRouteChange(t,s){t!==s&&(this.saveScrollPosition(t),this.currentRoute=s,this.scheduleScrollRestore(s))}scheduleScrollRestore(t){this.restoreTimeout&&clearTimeout(this.restoreTimeout),this.restoreTimeout=window.setTimeout(()=>{this.isNavigating||this.restoreScrollPosition(t)},150)}saveScrollPosition(t){const s=t||this.currentRoute,r=this.getCurrentScrollPosition();r>50&&(this.scrollPositions.set(s,{scrollY:r,timestamp:Date.now(),route:s}),console.log(`💾 Saved scroll position for ${s}: ${r}px`))}saveCurrentScrollPosition(){this.saveScrollPosition(this.currentRoute)}restoreScrollPosition(t){const s=this.scrollPositions.get(t);return s?Date.now()-s.timestamp<10*60*1e3?(console.log(`🔄 Restoring scroll position for ${t}: ${s.scrollY}px`),this.scrollToPosition(s.scrollY,"smooth"),!0):(console.log(`⏰ Scroll position for ${t} is too old, ignoring`),this.scrollPositions.delete(t),!1):(console.log(`📍 No saved scroll position for ${t}`),!1)}getCurrentScrollPosition(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}scrollToPosition(t,s="smooth"){try{requestAnimationFrame(()=>{window.scrollTo({top:t,left:0,behavior:s}),s==="smooth"&&setTimeout(()=>{const r=this.getCurrentScrollPosition();Math.abs(r-t)>100&&window.scrollTo(0,t)},300)})}catch(r){console.warn("Scroll API failed, using fallback:",r),window.scrollTo(0,t),document.documentElement.scrollTop=t,document.body.scrollTop=t}}scrollToTop(t={}){const{behavior:s="smooth",delay:r=0}=t;this.scrollTimeout&&window.clearTimeout(this.scrollTimeout),this.scrollTimeout=window.setTimeout(()=>{this.scrollToPosition(0,s),this.scrollTimeout=null},r)}scrollToElement(t,s={}){const{behavior:r="smooth",offset:n=0}=s;this.scrollTimeout&&window.clearTimeout(this.scrollTimeout),this.scrollTimeout=window.setTimeout(()=>{const a=document.getElementById(t);if(a){const o=a.offsetTop-n;this.scrollToPosition(o,r)}this.scrollTimeout=null},50)}clearOldPositions(){const t=Date.now(),s=10*60*1e3;for(const[r,n]of this.scrollPositions.entries())t-n.timestamp>s&&(this.scrollPositions.delete(r),console.log(`🗑️ Cleared old scroll position for ${r}`))}markNavigationAsIntentional(){this.isNavigating=!0,setTimeout(()=>{this.isNavigating=!1},500)}getDebugInfo(){return{currentRoute:this.currentRoute,savedPositions:Array.from(this.scrollPositions.entries()).map(([t,s])=>({route:t,scrollY:s.scrollY,age:Date.now()-s.timestamp})),isNavigating:this.isNavigating}}destroy(){this.scrollTimeout&&window.clearTimeout(this.scrollTimeout),this.restoreTimeout&&window.clearTimeout(this.restoreTimeout),this.scrollPositions.clear()}};ce(ft,"instance");let Nr=ft;const Bs=Nr.getInstance(),Ot=i=>{Bs.scrollToTop(i)},jt=i=>{Bs.saveScrollPosition(i)},zt=()=>{Bs.markNavigationAsIntentional()};setInterval(()=>{Bs.clearOldPositions()},5*60*1e3);const cd=({type:i,message:t,duration:s=5e3,onClose:r,show:n=!0})=>{const[a,o]=m.useState(n);if(m.useEffect(()=>{o(n)},[n]),m.useEffect(()=>{if(a&&s>0){const d=setTimeout(()=>{o(!1),r?.()},s);return()=>clearTimeout(d)}},[a,s,r]),!a)return null;const l=()=>{switch(i){case"success":return e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})});case"error":return e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})});case"warning":return e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},c=()=>{const d={position:"fixed",top:"20px",right:"20px",zIndex:9999,padding:"16px 20px",borderRadius:"16px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"12px",maxWidth:"400px",minWidth:"300px",animation:"slideIn 0.3s ease-out",border:"1px solid",backdropFilter:"blur(10px)",fontSize:"14px",fontWeight:"600",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'};switch(i){case"success":return{...d,backgroundColor:"rgba(16, 185, 129, 0.95)",color:"white",borderColor:"rgba(16, 185, 129, 0.3)"};case"error":return{...d,backgroundColor:"rgba(239, 68, 68, 0.95)",color:"white",borderColor:"rgba(239, 68, 68, 0.3)"};case"warning":return{...d,backgroundColor:"rgba(245, 158, 11, 0.95)",color:"white",borderColor:"rgba(245, 158, 11, 0.3)"};case"info":return{...d,backgroundColor:"rgba(59, 130, 246, 0.95)",color:"white",borderColor:"rgba(59, 130, 246, 0.3)"}}};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
          
          @keyframes slideOut {
            from {
              transform: translateX(0);
              opacity: 1;
            }
            to {
              transform: translateX(100%);
              opacity: 0;
            }
          }
        `}),e.jsxs("div",{style:c(),children:[e.jsx("div",{style:{flexShrink:0},children:l()}),e.jsx("div",{style:{flex:1},children:t})]})]})},Rn=()=>{const{notifications:i,removeNotification:t}=Us();return e.jsx(e.Fragment,{children:i.map((s,r)=>e.jsx(cd,{type:s.type,message:s.message,duration:s.duration,onClose:()=>t(s.id),show:!0},s.id))})};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var dd={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),H=(i,t)=>{const s=m.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:a=2,absoluteStrokeWidth:o,className:l="",children:c,...d},u)=>m.createElement("svg",{ref:u,...dd,width:n,height:n,stroke:r,strokeWidth:o?Number(a)*24/Number(n):a,className:["lucide",`lucide-${ud(i)}`,l].join(" "),...d},[...t.map(([h,p])=>m.createElement(h,p)),...Array.isArray(c)?c:[c]]));return s.displayName=`${i}`,s};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sr=H("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=H("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=H("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=H("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const In=H("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=H("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const et=H("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _r=H("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=H("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ct=H("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=H("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=H("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=H("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qr=H("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=H("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=H("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const On=H("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fd=H("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gd=H("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ln=H("Gavel",[["path",{d:"m14.5 12.5-8 8a2.119 2.119 0 1 1-3-3l8-8",key:"15492f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vt=H("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dn=H("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zn=H("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=H("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=H("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=H("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=H("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=H("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vd=H("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wd=H("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gr=H("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=H("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kd=H("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=H("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=H("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nd=H("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sd=H("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Un=H("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _d=H("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ut=H("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=H("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cr=H("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jr=H("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fn=H("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ws=H("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cd=H("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=H("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bn=H("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pd=H("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=H("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pr=H("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ed=H("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kr=H("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wt=H("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=H("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=H("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wn=H("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),gt=class gt{constructor(){ce(this,"deferredPrompt",null);ce(this,"isInstalled",!1);this.init()}static getInstance(){return gt.instance||(gt.instance=new gt),gt.instance}init(){this.registerServiceWorker(),this.checkInstallStatus(),this.setupInstallPrompt()}async registerServiceWorker(){if("serviceWorker"in navigator)try{const t=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered successfully:",t),t.addEventListener("updatefound",()=>{const s=t.installing;s&&s.addEventListener("statechange",()=>{s.state==="installed"&&navigator.serviceWorker.controller&&this.showUpdateAvailable()})})}catch(t){console.error("Service Worker registration failed:",t)}}checkInstallStatus(){this.isInstalled=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),this.deferredPrompt=t,window.dispatchEvent(new CustomEvent("pwa-installable",{detail:{canInstall:!0}}))}),window.addEventListener("appinstalled",()=>{this.isInstalled=!0,this.deferredPrompt=null,this.trackInstallation(),window.dispatchEvent(new CustomEvent("pwa-installed"))})}async promptInstall(){if(!this.deferredPrompt)return!1;try{await this.deferredPrompt.prompt();const t=await this.deferredPrompt.userChoice;return this.deferredPrompt=null,t.outcome==="accepted"}catch(t){return console.error("Install prompt failed:",t),!1}}canInstall(){return!!this.deferredPrompt&&!this.isInstalled}isAppInstalled(){return this.isInstalled}isIOSDevice(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}isAndroidDevice(){return/Android/.test(navigator.userAgent)}showUpdateAvailable(){const t=new CustomEvent("pwa-update-available",{detail:{message:"A new version of Fan Club Z is available. Refresh to update.",action:()=>window.location.reload()}});window.dispatchEvent(t)}trackInstallation(){typeof gtag<"u"&&gtag("event","pwa_install",{event_category:"engagement",event_label:"app_install"})}async requestNotificationPermission(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission==="denied"?!1:await Notification.requestPermission()==="granted":!1}async subscribeToPushNotifications(){try{const t=await navigator.serviceWorker.ready,s=await t.pushManager.getSubscription();if(s)return s;const r=await t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array({}.VITE_VAPID_PUBLIC_KEY||"")});return await this.sendSubscriptionToServer(r),r}catch(t){return console.error("Push subscription failed:",t),null}}urlBase64ToUint8Array(t){const s="=".repeat((4-t.length%4)%4),r=(t+s).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(r),a=new Uint8Array(n.length);for(let o=0;o<n.length;++o)a[o]=n.charCodeAt(o);return a}async sendSubscriptionToServer(t){try{await fetch("/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(s){console.error("Failed to send subscription to server:",s)}}};ce(gt,"instance");let Er=gt;const Pe=Er.getInstance(),Td=()=>{const[i,t]=m.useState(!1),[s,r]=m.useState(!1);m.useEffect(()=>{const l=()=>{if(Pe.isAppInstalled()){t(!1);return}const u=Pe.isIOSDevice(),h=localStorage.getItem(u?"ios-install-dismissed":"pwa-banner-dismissed"),p=h?parseInt(h):0,f=(Date.now()-p)/(24*60*60*1e3),x=!h||f>(u?3:1),y=sessionStorage.getItem("pwa-banner-session-dismissed");x&&!y&&(u?setTimeout(()=>t(!0),5e3):r(Pe.canInstall()))},c=()=>{r(!0),localStorage.getItem("pwa-banner-dismissed")||t(!0)},d=()=>{t(!1),r(!1)};return window.addEventListener("pwa-installable",c),window.addEventListener("pwa-installed",d),l(),()=>{window.removeEventListener("pwa-installable",c),window.removeEventListener("pwa-installed",d)}},[]);const n=async()=>{Pe.isIOSDevice()?(window.dispatchEvent(new CustomEvent("show-ios-install")),t(!1)):(await Pe.promptInstall()||localStorage.setItem("pwa-banner-dismissed",Date.now().toString()),t(!1))},a=()=>{t(!1);const l=Pe.isIOSDevice()?"ios-install-dismissed":"pwa-banner-dismissed";localStorage.setItem(l,Date.now().toString()),sessionStorage.setItem("pwa-banner-session-dismissed","true")};if(!i)return null;const o=Pe.isIOSDevice();return e.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-purple-500 to-teal-600 text-white shadow-lg animate-in slide-in-from-top duration-300",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:e.jsx(Fn,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-semibold text-sm",children:o?"Add to Home Screen":"Install Fan Club Z"}),e.jsx("p",{className:"text-xs text-green-100",children:o?"Get quick access and offline features":"Faster loading • Offline access • Notifications"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:n,className:"bg-white text-teal-600 px-3 py-1.5 rounded-md text-sm font-medium hover:bg-teal-50 active:bg-teal-100 transition-colors flex items-center space-x-1 shadow-sm",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsx("span",{children:o?"How To":"Install"})]}),e.jsx("button",{onClick:a,className:"text-green-100 hover:text-white transition-colors p-1 rounded","aria-label":"Dismiss install banner",children:e.jsx(ge,{className:"w-5 h-5"})})]})]})})},Ad=({isOpen:i,onClose:t})=>i?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex flex-col ios-install-modal",onClick:t,style:{zIndex:1e4},children:e.jsx("div",{className:"flex-1 flex items-center justify-center p-4 pb-24",children:e.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200 flex flex-col max-h-[calc(100vh-8rem)]",onClick:s=>s.stopPropagation(),style:{zIndex:10001},children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-emerald-600 p-4 text-center text-white relative rounded-t-2xl flex-shrink-0",children:[e.jsx("button",{onClick:t,className:"absolute top-3 right-3 text-white/80 hover:text-white transition-colors p-1 rounded-full hover:bg-white/20","aria-label":"Close modal",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-white/20 rounded-full mb-3",children:e.jsx(Fn,{className:"w-6 h-6"})}),e.jsx("h2",{className:"text-lg font-bold mb-1",children:"Install Fan Club Z"}),e.jsx("p",{className:"text-green-100 text-sm",children:"Get the full app experience with offline access and notifications"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"1"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 text-base",children:"Tap the Share button"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(Cr,{className:"w-4 h-4"}),e.jsx("span",{children:"Usually found at the bottom of Safari"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"2"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 text-base",children:'Select "Add to Home Screen"'}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Scroll down in the share menu to find this option"})]})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"3"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900 mb-2 text-base",children:'Tap "Add" to confirm'}),e.jsx("p",{className:"text-sm text-gray-600",children:"Fan Club Z will appear on your home screen like a native app"})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3 text-base",children:"Why install?"}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-2",children:[e.jsx("li",{children:"• Faster loading and smoother experience"}),e.jsx("li",{children:"• Works offline for viewing your predictions"}),e.jsx("li",{children:"• Push notifications for important updates"}),e.jsx("li",{children:"• Easy access from your home screen"})]})]}),e.jsx("div",{className:"h-4"})]})}),e.jsx("div",{className:"border-t border-gray-100 p-4 flex-shrink-0 rounded-b-2xl",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-lg font-medium hover:bg-gray-200 transition-colors text-base",children:"Maybe Later"}),e.jsx("button",{onClick:()=>{t(),localStorage.setItem("ios-install-dismissed",Date.now().toString())},className:"flex-1 px-4 py-3 bg-emerald-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors text-base",children:"Got It!"})]})})]})})}):null,$d=({onInstall:i,onDismiss:t})=>{const[s,r]=m.useState(!1);m.useEffect(()=>{const o=setTimeout(()=>r(!0),100);return()=>clearTimeout(o)},[]);const n=()=>{r(!1),setTimeout(i,300)},a=()=>{r(!1),setTimeout(t,300)};return e.jsx("div",{className:`
      fixed inset-x-4 top-20 max-w-sm mx-auto transition-all duration-300 ease-out pwa-install-prompt
      ${s?"opacity-100 transform translate-y-0":"opacity-0 transform -translate-y-4"}
    `,style:{zIndex:1e4},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-teal-600 p-4 text-white",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:e.jsx(Es,{className:"w-4 h-4"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Install Fan Club Z"}),e.jsx("p",{className:"text-xs text-green-100",children:"Get the full app experience"})]})]}),e.jsx("button",{onClick:a,className:"text-green-100 hover:text-white transition-colors p-1 rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-400 to-teal-500 rounded-lg flex items-center justify-center",children:e.jsx(Wn,{className:"w-4 h-4 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Faster Performance"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Lightning-fast loading and smooth animations"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(In,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Push Notifications"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Get notified about prediction results and updates"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(Ws,{className:"w-4 h-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Offline Access"}),e.jsx("p",{className:"text-xs text-gray-600",children:"View your predictions even without internet"})]})]})]}),e.jsxs("div",{className:"p-4 pt-0 flex space-x-2",children:[e.jsx("button",{onClick:a,className:"flex-1 py-2.5 px-4 text-gray-700 bg-gray-100 rounded-lg font-medium text-sm hover:bg-gray-200 transition-colors",children:"Maybe Later"}),e.jsxs("button",{onClick:n,className:"flex-1 py-2.5 px-4 bg-teal-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors flex items-center justify-center space-x-1",children:[e.jsx(Es,{className:"w-4 h-4"}),e.jsx("span",{children:"Install"})]})]})]})})},Rd=()=>{const[i,t]=m.useState(!1),[s,r]=m.useState(0);m.useEffect(()=>{let l=0;const c=["click","scroll","touchstart","keydown"],d=()=>{l++,r(l),l>=5&&!localStorage.getItem("install-prompt-shown")&&n()};return c.forEach(u=>{document.addEventListener(u,d,{passive:!0})}),()=>{c.forEach(u=>{document.removeEventListener(u,d)})}},[]);const n=()=>{if(Pe.isAppInstalled())return;const l=localStorage.getItem("install-prompt-dismissed"),c=l?parseInt(l):0,d=24*60*60*1e3;if(!l||Date.now()-c>d){const u=Date.now()-parseInt(localStorage.getItem("session-start")||"0"),h=localStorage.getItem("has-created-prediction"),p=localStorage.getItem("has-placed-prediction");u>3e4&&(h||p)&&(t(!0),localStorage.setItem("install-prompt-shown","true"))}},a=async()=>{Pe.isIOSDevice()?window.dispatchEvent(new CustomEvent("show-ios-install")):await Pe.promptInstall()||localStorage.setItem("install-prompt-dismissed",Date.now().toString()),t(!1)},o=()=>{t(!1),localStorage.setItem("install-prompt-dismissed",Date.now().toString())};return i?e.jsx($d,{onInstall:a,onDismiss:o}):null},Id=({isVisible:i,onUpdate:t,onDismiss:s})=>{const[r,n]=m.useState(!1),a=()=>{n(!0),setTimeout(s,300)},o=()=>{n(!0),setTimeout(t,200)};return!i&&!r?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`
        fixed inset-0 bg-black/10 backdrop-blur-sm transition-opacity duration-300 update-notification
        ${i&&!r?"opacity-100":"opacity-0"}
      `,style:{zIndex:1e4}}),e.jsx("div",{className:`
        fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 update-notification
        w-[calc(100vw-32px)] max-w-sm max-h-[90vh] overflow-y-auto
        transition-all duration-300 ease-out
        ${i&&!r?"opacity-100 scale-100":"opacity-0 scale-95"}
      `,style:{zIndex:10001},children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-teal-600 p-4 text-white relative",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx(ss,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-bold text-base flex items-center space-x-2",children:[e.jsx("span",{children:"Update Available!"}),e.jsx(Ws,{className:"w-4 h-4"})]}),e.jsx("p",{className:"text-sm text-green-100",children:"New features and improvements ready"})]})]}),e.jsx("button",{onClick:a,className:"absolute top-3 right-3 text-green-100 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10","aria-label":"Dismiss update notification",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["🚀 ",e.jsx("strong",{children:"What's New:"})]}),e.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-2",children:[e.jsx("li",{children:"• Improved performance and stability"}),e.jsx("li",{children:"• Enhanced user interface"}),e.jsx("li",{children:"• Bug fixes and optimizations"})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:o,className:"flex-[2] bg-teal-600 text-white py-3 px-4 rounded-xl font-semibold text-sm hover:bg-green-700 active:bg-green-800 transition-colors flex items-center justify-center space-x-2 shadow-lg",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{children:"Update Now"})]}),e.jsx("button",{onClick:a,className:"flex-1 py-3 px-4 text-gray-600 hover:text-gray-800 transition-colors text-sm font-medium hover:bg-gray-50 rounded-xl border border-gray-200",children:"Later"})]})]})]})})]})},Od=()=>{const[i,t]=m.useState(!1),[s,r]=m.useState(!1);m.useEffect(()=>{localStorage.getItem("session-start")||localStorage.setItem("session-start",Date.now().toString());const o=()=>{t(!0)},l=p=>{r(!0)},c=()=>{setTimeout(async()=>{const p=localStorage.getItem("user-has-interacted"),f=localStorage.getItem("notification-permission-requested");if(p&&!f){const g=await Pe.requestNotificationPermission();localStorage.setItem("notification-permission-requested","true"),g&&await Pe.subscribeToPushNotifications()}},15e3)};window.addEventListener("show-ios-install",o),window.addEventListener("pwa-update-available",l);const d=()=>{localStorage.setItem("user-has-interacted","true"),c()},u=["click","scroll","touchstart"];return u.forEach(p=>{document.addEventListener(p,d,{once:!0,passive:!0})}),(()=>{const p=parseInt(localStorage.getItem("visit-count")||"0")+1;localStorage.setItem("visit-count",p.toString()),localStorage.setItem("last-visit",Date.now().toString()),p>1&&localStorage.setItem("is-returning-user","true")})(),()=>{window.removeEventListener("show-ios-install",o),window.removeEventListener("pwa-update-available",l),u.forEach(p=>{document.removeEventListener(p,d)})}},[]);const n=()=>{typeof gtag<"u"&&gtag("event","pwa_update_accepted",{event_category:"engagement",event_label:"app_update"}),window.location.reload()},a=()=>{r(!1),typeof gtag<"u"&&gtag("event","pwa_update_dismissed",{event_category:"engagement",event_label:"app_update"})};return e.jsxs(e.Fragment,{children:[e.jsx(Td,{}),e.jsx(Rd,{}),e.jsx(Ad,{isOpen:i,onClose:()=>t(!1)}),e.jsx(Id,{isVisible:s,onUpdate:n,onDismiss:a})]})};let Ld=class extends m.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("PageWrapper Error Boundary caught an error:",t,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 mb-4",children:this.state.error?.message||"An unexpected error occurred while loading this page."}),e.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:void 0}),this.props.onRetry()},className:"bg-teal-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Try Again"})]})}):this.props.children}};const Dd=({title:i="Loading..."})=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:i})]})}),Ge=({children:i,title:t="Loading...",fallback:s})=>{const[r,n]=ue.useState(0),a=()=>{n(o=>o+1)};return e.jsx(Ld,{onRetry:a,children:e.jsx(m.Suspense,{fallback:s||e.jsx(Dd,{title:t}),children:e.jsx("div",{children:i},r)})})},zd=()=>{const[i,t]=m.useState(()=>{try{const u=localStorage.getItem("fcz_onboarding_state_v3");return u?JSON.parse(u):{isActive:!1,currentStep:0,completed:!1,skipped:!1,userPreferences:{hasSeenOnboarding:!1,preferredTourStyle:"full",completedSteps:[]}}}catch{return{isActive:!1,currentStep:0,completed:!1,skipped:!1,userPreferences:{hasSeenOnboarding:!1,preferredTourStyle:"full",completedSteps:[]}}}}),[s,r]=m.useState(null),n=m.useCallback(u=>{t(h=>{const p=typeof u=="function"?u(h):u,f={...h,...p};try{localStorage.setItem("fcz_onboarding_state_v3",JSON.stringify(f))}catch(g){console.warn("Failed to save onboarding state:",g)}return f})},[]),a=m.useCallback(u=>{r(u),n({isActive:!0,currentStep:0,completed:!1,skipped:!1})},[n]),o=m.useCallback(async()=>{if(!s)return;const u=s.steps[i.currentStep];if(u?.onNext)try{await u.onNext()}catch(h){console.warn("Step onNext handler failed:",h)}n(h=>{const p=h.currentStep>=(s?.steps.length||0)-1,f=u?.id?[...h.userPreferences.completedSteps,u.id]:h.userPreferences.completedSteps;return p?{isActive:!1,completed:!0,userPreferences:{...h.userPreferences,hasSeenOnboarding:!0,completedSteps:f}}:{currentStep:h.currentStep+1,userPreferences:{...h.userPreferences,completedSteps:f}}})},[s,i.currentStep,n]),l=m.useCallback(async()=>{const u=s?.steps[i.currentStep];if(u?.onPrev)try{await u.onPrev()}catch(h){console.warn("Step onPrev handler failed:",h)}i.currentStep>0&&n(h=>({currentStep:Math.max(0,h.currentStep-1)}))},[s,i.currentStep,n]),c=m.useCallback(()=>{n(u=>({isActive:!1,skipped:!0,userPreferences:{...u.userPreferences,hasSeenOnboarding:!0,preferredTourStyle:"minimal"}}))},[n]),d=m.useCallback(()=>{try{localStorage.removeItem("fcz_onboarding_state_v3"),t({isActive:!1,currentStep:0,completed:!1,skipped:!1,userPreferences:{hasSeenOnboarding:!1,preferredTourStyle:"full",completedSteps:[]}})}catch(u){console.warn("Failed to reset onboarding state:",u)}},[]);return{state:i,config:s,startOnboarding:a,nextStep:o,prevStep:l,skipOnboarding:c,resetOnboarding:d}},Ud=(i,t,s="auto")=>{const r={width:window.innerWidth,height:window.innerHeight},n={top:44,bottom:100,left:16,right:16},a=16,o={top:{x:Math.max(n.left,Math.min(i.left+(i.width-t.width)/2,r.width-t.width-n.right)),y:Math.max(n.top,i.top-t.height-a)},bottom:{x:Math.max(n.left,Math.min(i.left+(i.width-t.width)/2,r.width-t.width-n.right)),y:Math.min(r.height-t.height-n.bottom,i.bottom+a)},left:{x:Math.max(n.left,i.left-t.width-a),y:Math.max(n.top,Math.min(i.top+(i.height-t.height)/2,r.height-t.height-n.bottom))},right:{x:Math.min(r.width-t.width-n.right,i.right+a),y:Math.max(n.top,Math.min(i.top+(i.height-t.height)/2,r.height-t.height-n.bottom))},center:{x:(r.width-t.width)/2,y:(r.height-t.height)/2}};if(s!=="auto")return o[s]||o.center;const l={top:i.top-n.top,bottom:r.height-i.bottom-n.bottom,left:i.left-n.left,right:r.width-i.right-n.right},c={top:l.top>=t.height+a,bottom:l.bottom>=t.height+a,left:l.left>=t.width+a,right:l.right>=t.width+a};return c.bottom?o.bottom:c.top?o.top:c.right&&t.width<300?o.right:c.left&&t.width<300?o.left:o.center},Md=({step:i,position:t,onNext:s,onPrev:r,onSkip:n,isFirst:a,isLast:o,stepNumber:l,totalSteps:c,canSkip:d})=>{const u=m.useCallback(()=>{console.log("Next button clicked, calling onNext"),s()},[s]),h=m.useCallback(()=>{console.log("Previous button clicked, calling onPrev"),r()},[r]),p=m.useCallback(()=>{console.log("Skip button clicked, calling onSkip"),n()},[n]);return e.jsxs(P.div,{className:"fixed bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden max-w-sm z-[25000]",style:{left:t.x,top:t.y,width:"min(calc(100vw - 32px), 380px)"},initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:10},transition:{duration:.2,ease:"easeOut"},children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-teal-600 p-4 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[i.icon&&e.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:i.icon}),e.jsx("h3",{className:"font-semibold text-lg",children:i.title})]}),d&&e.jsx("button",{onClick:p,className:"p-1 rounded-lg hover:bg-white/10 transition-colors","aria-label":"Skip tour",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-white/20 rounded-full h-2",children:e.jsx("div",{className:"bg-white rounded-full h-2 transition-all duration-300",style:{width:`${(l+1)/c*100}%`}})}),e.jsxs("span",{className:"text-xs font-medium",children:[l+1," of ",c]})]})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"text-gray-700 text-sm leading-relaxed mb-4",children:i.description}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("button",{onClick:h,disabled:a,className:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-100 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200 transition-colors text-sm font-medium min-w-[80px] justify-center",children:[e.jsx(Ct,{className:"w-4 h-4"}),"Previous"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:c},(f,g)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${g===l?"bg-teal-500":"bg-gray-200"}`},g))}),e.jsx("button",{onClick:u,className:"flex items-center gap-1 px-4 py-2 rounded-xl bg-teal-500 text-white hover:bg-teal-600 transition-colors text-sm font-medium min-w-[80px] justify-center",children:o?e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4"}),"Finish"]}):e.jsxs(e.Fragment,{children:["Next",e.jsx(Ee,{className:"w-4 h-4"})]})})]})]})]})},Fd=({targetRect:i})=>{const t=m.useMemo(()=>`spotlight-${Math.random().toString(36).substr(2,9)}`,[]);if(!i)return null;const s=Math.max(i.width,i.height)/2+20,r=i.left+i.width/2,n=i.top+i.height/2;return e.jsx("div",{className:"fixed inset-0 z-[24000] pointer-events-none",children:e.jsxs("svg",{width:"100%",height:"100%",className:"absolute inset-0",children:[e.jsx("defs",{children:e.jsxs("mask",{id:t,children:[e.jsx("rect",{width:"100%",height:"100%",fill:"white"}),e.jsx("circle",{cx:r,cy:n,r:s,fill:"black"})]})}),e.jsx("rect",{width:"100%",height:"100%",fill:"rgba(0,0,0,0.7)",mask:`url(#${t})`})]})})},Bd=({isActive:i,config:t,currentStep:s,onNext:r,onPrev:n,onSkip:a})=>{const[o,l]=m.useState(null),[c,d]=m.useState(null),[u,h]=m.useState({x:0,y:0}),p=m.useRef(null),f=m.useRef(null),g=m.useRef(null),x=t?.steps[s];if(m.useEffect(()=>{if(!i||!x?.target){l(null),d(null);return}const b=()=>{try{const k=document.querySelector(`[data-tour-id="${x.target}"]`);if(k){const L=k.getBoundingClientRect();l(k),d(L),k.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}else console.warn(`Onboarding target not found: ${x.target}`),l(null),d(null)}catch(k){console.warn("Error updating target position:",k)}};g.current&&clearTimeout(g.current),g.current=setTimeout(b,x.delay||100);const v=()=>b(),j=()=>b();return window.addEventListener("resize",v),window.addEventListener("scroll",j,!0),window.addEventListener("orientationchange",v),f.current&&f.current.disconnect(),f.current=new ResizeObserver(b),()=>{g.current&&clearTimeout(g.current),window.removeEventListener("resize",v),window.removeEventListener("scroll",j,!0),window.removeEventListener("orientationchange",v),f.current&&f.current.disconnect()}},[i,x,s]),m.useEffect(()=>{if(c&&p.current){let v=Ud(c,{width:380,height:200},x?.placement||"auto");x?.offset&&(v={x:v.x+(x.offset.x??0),y:v.y+(x.offset.y??0)}),h(v)}},[c,x?.placement]),m.useEffect(()=>{if(i){const b=setTimeout(()=>{const v=document.querySelector("[data-onboarding-tooltip]");v&&v.focus()},100);return()=>clearTimeout(b)}},[i,s]),!i||!t||!x)return null;const y=e.jsx(fe,{mode:"wait",children:e.jsxs(P.div,{className:"fixed inset-0 z-[23000]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[x.action==="spotlight"&&c?e.jsx(Fd,{targetRect:c}):e.jsx("div",{className:"absolute inset-0 bg-black/40"}),c&&x.target&&e.jsx(P.div,{className:"absolute border-4 border-teal-400 rounded-xl pointer-events-none shadow-lg",style:{left:Math.max(0,c.left-4),top:Math.max(0,c.top-4),width:Math.min(window.innerWidth,c.width+8),height:c.height+8},initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.1}}),e.jsx("div",{ref:p,"data-onboarding-tooltip":!0,tabIndex:-1,children:e.jsx(Md,{step:x,position:u,onNext:r,onPrev:n,onSkip:a,isFirst:s===0,isLast:s===t.steps.length-1,stepNumber:s,totalSteps:t.steps.length,canSkip:t.allowSkip!==!1})})]},`onboarding-${s}`)});return Bi.createPortal(y,document.body)},Wd=({isOpen:i,onStartTour:t,onSkip:s,onMinimalTour:r})=>{const n=m.useCallback(()=>{console.log("Welcome modal: Start Tour clicked"),t()},[t]),a=m.useCallback(()=>{console.log("Welcome modal: Quick Overview clicked"),r()},[r]),o=m.useCallback(()=>{console.log("Welcome modal: Skip clicked"),s()},[s]);return e.jsx(fe,{children:i&&e.jsxs("div",{className:"fixed inset-0 z-[26000] flex items-center justify-center p-4",children:[e.jsx(P.div,{className:"absolute inset-0 bg-black/50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}),e.jsxs(P.div,{className:"relative bg-white rounded-3xl shadow-2xl overflow-hidden w-full max-w-md",initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{duration:.3,ease:"easeOut"},children:[e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 via-teal-600 to-teal-600 p-6 text-white text-center relative overflow-hidden",children:[e.jsx(P.div,{className:"absolute inset-0 bg-white/10",animate:{background:["radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 50%)","radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%)","radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 50%)"]},transition:{duration:4,repeat:1/0,ease:"linear"}}),e.jsxs("div",{className:"relative z-10",children:[e.jsx(P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.3},className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(Ws,{className:"w-8 h-8"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome to Fan Club Z!"}),e.jsx("p",{className:"text-teal-100 text-sm",children:"Ready to discover the future of social predictions?"})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-teal-500 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(qr,{className:"w-5 h-5 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Discover Predictions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Explore trending markets and join the community"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(Ss,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Make Your Predictions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Put your knowledge to the test and earn rewards"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center flex-shrink-0",children:e.jsx(rs,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Manage Everything"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Track your performance and manage your wallet"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:n,className:"w-full bg-teal-500 hover:bg-teal-600 text-white py-3 px-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2",children:[e.jsx(kd,{className:"w-4 h-4"}),"Take the Tour"]}),e.jsx("button",{onClick:a,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-medium transition-colors",children:"Quick Overview"}),e.jsxs("button",{onClick:o,className:"w-full text-gray-500 hover:text-gray-700 py-2 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-1",children:[e.jsx(pd,{className:"w-4 h-4"}),"Skip for now"]})]})]})]})]})})},Hd=m.createContext(void 0),Ti=[{id:"welcome-discover",title:"Welcome to Discover",description:"This is where you'll find trending predictions and explore new markets. Scroll through the list to see all available predictions.",target:"discover-list",placement:"bottom",offset:{y:24},icon:e.jsx(qr,{className:"w-5 h-5"}),delay:500},{id:"search-feature",title:"Search Predictions",description:"Use the search bar to find specific topics, events, or types of predictions that interest you.",target:"search-bar",placement:"bottom",icon:e.jsx(Un,{className:"w-5 h-5"})},{id:"category-filters",title:"Browse by Category",description:"Filter predictions by category - Sports, Pop Culture, Tech, Finance, and more. Find what you're passionate about.",target:"category-filters",placement:"bottom",icon:e.jsx(fd,{className:"w-5 h-5"})},{id:"create-prediction",title:"Create Your Own",description:"Ready to share your insights? Tap the plus button to create your own prediction and invite others to participate.",target:"create-fab",placement:"left",offset:{y:-100},icon:e.jsx(kt,{className:"w-5 h-5"})},{id:"my-bets-tab",title:"Track Your Predictions",description:"View all your active predictions, ones you've created, and your completed predictions with results.",target:"tab-bets",placement:"top",offset:{y:-60},icon:e.jsx(Oe,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/predictions"),await new Promise(t=>setTimeout(t,300)))}},{id:"bets-management",title:"Organize Your Activity",description:"Switch between Active (ongoing), Created (your predictions), and Completed (finished) to stay organized.",target:"bets-tabs",placement:"bottom",icon:e.jsx(Ns,{className:"w-5 h-5"})},{id:"wallet-tab",title:"Manage Your Wallet",description:"Keep track of your balance, view transaction history, and manage your funds securely.",target:"tab-wallet",placement:"top",offset:{y:-40},icon:e.jsx(rs,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/wallet"),await new Promise(t=>setTimeout(t,300)))}},{id:"wallet-balance",title:"Your Balance",description:"Your current balance is displayed here. In demo mode, you can add test funds to try out predictions.",target:"wallet-balance-card",placement:"bottom",offset:{y:40},icon:e.jsx(rs,{className:"w-5 h-5"})},{id:"profile-tab",title:"Your Profile",description:"Access your settings, view achievements, manage notifications, and track your performance stats.",target:"tab-profile",placement:"top",offset:{y:-40},icon:e.jsx(Kr,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/profile"),await new Promise(t=>setTimeout(t,300)))}},{id:"profile-completion",title:"Complete Your Profile",description:"Take a moment to complete your profile information and adjust your preferences for the best experience.",target:"profile-card",placement:"bottom",icon:e.jsx(Ut,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/"),await new Promise(t=>setTimeout(t,200)))}}],Vd=[{id:"quick-discover",title:"Discover Predictions",description:"Browse and participate in predictions from the community.",target:"tab-discover",placement:"top",icon:e.jsx(qr,{className:"w-5 h-5"})},{id:"quick-create",title:"Create Predictions",description:"Share your insights by creating your own predictions.",target:"create-fab",placement:"left",icon:e.jsx(kt,{className:"w-5 h-5"})},{id:"quick-track",title:"Track Progress",description:"Monitor your active and completed predictions.",target:"tab-bets",placement:"top",icon:e.jsx(Oe,{className:"w-5 h-5"})},{id:"quick-wallet",title:"Manage Funds",description:"View your balance and transaction history.",target:"tab-wallet",placement:"top",icon:e.jsx(rs,{className:"w-5 h-5"})}],qd=()=>{try{const i=localStorage.getItem("fcz_onboarding_state_v3");return i?!JSON.parse(i).userPreferences?.hasSeenOnboarding:!0}catch{return!0}},Gd=()=>new URLSearchParams(window.location.search).get("welcome")==="1"||qd(),Jd=({children:i})=>{const[t,s]=xe(),{state:r,config:n,startOnboarding:a,nextStep:o,prevStep:l,skipOnboarding:c,resetOnboarding:d}=zd(),[u,h]=m.useState(!1);m.useEffect(()=>(window.__router_navigate=s,()=>{delete window.__router_navigate}),[s]),m.useEffect(()=>{const b=setTimeout(()=>{Gd()&&h(!0)},1e3);return()=>clearTimeout(b)},[]),m.useEffect(()=>{const v=new URLSearchParams(window.location.search).get("tour");v==="full"?p():v==="quick"&&f()},[t]);const p=m.useCallback(()=>{h(!1),t!=="/"&&t!=="/discover"?(s("/"),setTimeout(()=>{a({steps:Ti,allowSkip:!0,showProgress:!0,persistent:!0})},500)):a({steps:Ti,allowSkip:!0,showProgress:!0,persistent:!0})},[t,s,a]),f=m.useCallback(()=>{h(!1),a({steps:Vd,allowSkip:!0,showProgress:!0,persistent:!1})},[a]),g=m.useCallback(()=>{h(!1),c()},[c]),x=m.useCallback(()=>{d(),h(!0)},[d]),y={isActive:r.isActive,showWelcome:u,startFullTour:p,startQuickTour:f,skipOnboarding:g,resetOnboarding:x,hasSeenOnboarding:r.userPreferences.hasSeenOnboarding,currentStep:r.currentStep,totalSteps:n?.steps.length||0};return e.jsxs(Hd.Provider,{value:y,children:[i,e.jsx(Wd,{isOpen:u,onStartTour:p,onMinimalTour:f,onSkip:g}),e.jsx(Bd,{isActive:r.isActive,config:n,currentStep:r.currentStep,onNext:o,onPrev:l,onSkip:c})]})},Kd="@fanclubz/client",Yd="2.0.77",Zd="Fan Club Z React Client Application",Qd="module",Xd={dev:"vite",build:"vite build","vercel-build":"vite build",preview:"vite preview",lint:"eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0","lint:fix":"eslint . --ext ts,tsx --fix","type-check":"tsc --noEmit","generate-icons":"bash ../generate-pwa-icons.sh","pwa-audit":"lighthouse --view --chrome-flags='--headless' --only-categories=pwa http://localhost:5173","check-manifest":`node -e "console.log('Checking manifest...'); fetch('http://localhost:5173/manifest.json').then(r=>r.json()).then(console.log).catch(console.error)"`},eu={"@fanclubz/shared":"file:../shared",react:"^18.2.0","react-dom":"^18.2.0","@supabase/supabase-js":"^2.39.1",zustand:"^4.4.7","@tanstack/react-query":"^5.14.2",wouter:"^3.0.0","framer-motion":"^10.16.16",tailwindcss:"^3.4.0","@tailwindcss/forms":"^0.5.7","@tailwindcss/typography":"^0.5.10","lucide-react":"^0.303.0","react-hot-toast":"^2.4.1","react-hook-form":"^7.48.2","@hookform/resolvers":"^3.3.2",zod:"^3.22.4","date-fns":"^3.0.6",clsx:"^2.0.0","tailwind-merge":"^2.2.0","class-variance-authority":"^0.7.0","@radix-ui/react-slot":"^1.0.2","@radix-ui/react-dialog":"^1.0.5","@radix-ui/react-dropdown-menu":"^2.0.6","@radix-ui/react-tabs":"^1.0.4","@radix-ui/react-avatar":"^1.0.4","@radix-ui/react-select":"^2.0.0","@radix-ui/react-switch":"^1.0.3","@radix-ui/react-toast":"^1.1.5","react-intersection-observer":"^9.5.3","socket.io-client":"^4.7.4"},tu={"@typescript-eslint/eslint-plugin":"^6.16.0","@typescript-eslint/parser":"^6.16.0","@types/react":"^18.2.45","@types/react-dom":"^18.2.18","@vitejs/plugin-react":"^4.1.1",autoprefixer:"^10.4.16",eslint:"^8.56.0","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-react-refresh":"^0.4.5",postcss:"^8.4.32",typescript:"^5.3.3",vite:"^4.4.9","vite-plugin-pwa":"^0.17.4"},su={node:">=18.0.0",npm:">=9.0.0"},Hn={name:Kd,version:Yd,description:Zd,type:Qd,scripts:Xd,dependencies:eu,devDependencies:tu,engines:su},ru=Hn.version,iu={version:ru,name:"Fan Club Z",description:"Social Prediction Platform",api:{url:_t().apiUrl,timeout:15e3,retries:3},frontend:{url:{}.VITE_FRONTEND_URL||"https://app.fanclubz.app"},features:{realTimeUpdates:!0,socialEngagement:!0,walletIntegration:!0,settlementSystem:!0,clubSystem:!0},limits:{maxStakeAmount:1e4,minStakeAmount:1,maxDescriptionLength:500,maxCommentLength:280},ui:{theme:{primaryColor:"#22c55e",brandColors:{green:{50:"#f0fdf4",500:"#22c55e",600:"#16a34a",700:"#15803d"}}},animations:{duration:{fast:200,normal:300,slow:500}}}},de=()=>iu.api.url,Ai={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffFactor:2},nu=i=>new Promise(t=>setTimeout(t,i)),au=(i,t,s)=>t>=s?!1:!!(i.name==="TypeError"&&i.message.includes("Failed to fetch")||i.name==="HTTPError"&&i.status>=500||i.name==="AbortError"||i.name==="TimeoutError"),ou=(i,t)=>{const s=t.initialDelay*Math.pow(t.backoffFactor,i-1);return Math.min(s,t.maxDelay)},vs=async(i,t={})=>{const{timeout:s=15e3,retryOptions:r=Ai,...n}=t,a={...Ai,...r};let o;for(let l=1;l<=a.maxRetries+1;l++)try{console.log(`🌐 API Request (attempt ${l}/${a.maxRetries+1}): ${i}`);const c=new AbortController,d=setTimeout(()=>c.abort(),s),u=await fetch(i,{...n,signal:c.signal,headers:{"Content-Type":"application/json",Accept:"application/json",...n.headers}});if(clearTimeout(d),!u.ok){const h=new Error(`HTTP error! status: ${u.status} ${u.statusText}`);throw h.name="HTTPError",h.status=u.status,h.response=u,h}return console.log(`✅ API Success (attempt ${l}): ${u.status} ${u.statusText}`),u}catch(c){if(o=c,console.warn(`⚠️ API Error (attempt ${l}):`,c.message),au(c,l,a.maxRetries)){const d=ou(l,a);console.log(`🔄 Retrying in ${d}ms...`),await nu(d);continue}break}throw console.error(`❌ API Failed after ${a.maxRetries+1} attempts:`,o),o},ws={get:async(i,t={})=>{const s=`${de()}${i}`;return(await vs(s,{method:"GET",...t})).json()},post:async(i,t,s={})=>{const r=`${de()}${i}`;return(await vs(r,{method:"POST",body:t?JSON.stringify(t):void 0,...s})).json()},put:async(i,t,s={})=>{const r=`${de()}${i}`;return(await vs(r,{method:"PUT",body:t?JSON.stringify(t):void 0,...s})).json()},delete:async(i,t={})=>{const s=`${de()}${i}`;return(await vs(s,{method:"DELETE",...t})).json()}},js={predictions:[],trendingPredictions:[],userPredictions:[],createdPredictions:[],completedPredictions:[],userPredictionEntries:[],userCreatedPredictions:[],loading:!1,loadingMore:!1,error:null,initialized:!1,lastFetchTime:0,platformStats:null,statsLoading:!1,pagination:{page:1,limit:20,total:0,hasNext:!1,hasPrev:!1},filters:{category:"all",search:""}},at=rt((i,t)=>({...js,fetchPredictions:async(s={})=>{const{page:r=1,category:n=t().filters.category,search:a=t().filters.search,append:o=!1}=s,l=Date.now(),{lastFetchTime:c,predictions:d}=t();if(!o&&r===1&&l-c<3e4&&d.length>0){console.log("📋 Using cached predictions");return}const u=o&&r>1;i({[u?"loadingMore":"loading"]:!0,error:null});try{console.log(`📡 Fetching predictions: page=${r}, category=${n}, search=${a}, append=${o}`);const h=new URLSearchParams({page:r.toString(),limit:"20",...n!=="all"&&{category:n},...a.trim()&&{search:a.trim()}}),p=await ws.get(`/api/v2/predictions?${h}`,{timeout:1e4,retryOptions:{maxRetries:3}}),f=p.data||[],g=p.pagination||{};console.log(`✅ Predictions fetched successfully: ${f.length} items (${g.total} total)`),i(x=>({predictions:o?[...x.predictions,...f]:f,loading:!1,loadingMore:!1,error:null,initialized:!0,lastFetchTime:l,pagination:{page:g.page||r,limit:g.limit||20,total:g.total||0,hasNext:g.hasNext||!1,hasPrev:g.hasPrev||!1},filters:{category:n,search:a}}))}catch(h){console.error("❌ Error fetching predictions:",h),i({loading:!1,loadingMore:!1,error:h instanceof Error?h.message:"Failed to fetch predictions"})}},loadMorePredictions:async()=>{const{pagination:s,loadingMore:r}=t();if(r||!s.hasNext){console.log("📋 Load more skipped:",{loadingMore:r,hasNext:s.hasNext});return}console.log(`📋 Loading more predictions: page ${s.page+1}`),await t().fetchPredictions({page:s.page+1,append:!0})},setFilters:s=>{const n={...t().filters,...s};console.log("🔍 Setting filters:",n),i(a=>({filters:n,pagination:{...a.pagination,page:1},predictions:[]})),t().fetchPredictions({category:n.category,search:n.search})},resetPagination:()=>{console.log("🔄 Resetting pagination"),i(s=>({pagination:{...js.pagination},filters:{...js.filters},predictions:[]}))},refreshPredictions:async(s=!1)=>{const{lastFetchTime:r}=t(),n=Date.now();if(!s&&n-r<1e4){console.log("📋 Using cached predictions (refresh)");return}i(a=>({lastFetchTime:0,pagination:{...a.pagination,page:1},predictions:[]}));try{await t().fetchPredictions(),console.log("🔄 Predictions refreshed successfully")}catch(a){throw console.error("❌ Error refreshing predictions:",a),a}},fetchTrendingPredictions:async()=>{i({loading:!0});try{const s=await fetch(`${de()}/api/v2/predictions/trending`);if(!s.ok)throw new Error(`Failed to fetch trending predictions: ${s.statusText}`);const n=(await s.json()).data||[];i({trendingPredictions:n,loading:!1,error:null}),console.log("✅ Trending predictions fetched:",n.length)}catch(s){console.error("❌ Error fetching trending predictions:",s),i({loading:!1,error:s instanceof Error?s.message:"Failed to fetch trending predictions"})}},fetchUserPredictions:async s=>{i({loading:!0});try{const r=await fetch(`${de()}/api/v2/predictions/user/${s}`);if(!r.ok)throw new Error(`Failed to fetch user predictions: ${r.statusText}`);const a=(await r.json()).data||[];i({userPredictions:a,loading:!1,error:null})}catch(r){console.error("❌ Error fetching user predictions:",r),i({loading:!1,error:r instanceof Error?r.message:"Failed to fetch user predictions"})}},fetchCreatedPredictions:async s=>{i({loading:!0});try{const r=await fetch(`${de()}/api/v2/predictions/created/${s}`);if(!r.ok)throw new Error(`Failed to fetch created predictions: ${r.statusText}`);const a=(await r.json()).data||[];i({createdPredictions:a,loading:!1,error:null})}catch(r){console.error("❌ Error fetching created predictions:",r),i({loading:!1,error:r instanceof Error?r.message:"Failed to fetch created predictions"})}},fetchPredictionById:async s=>{try{console.log(`🔍 Fetching prediction by ID: ${s}`);const{predictions:r}=t(),n=r.find(c=>c.id===s);if(n&&n.options&&n.options.length>0)return console.log("✅ Found prediction in store with options:",n.title,n.options.length),n;console.log("🌐 Fetching prediction directly from API:",s);const a=await fetch(`${de()}/api/v2/predictions/${s}`);if(!a.ok)return console.error(`❌ Failed to fetch prediction ${s}:`,a.status),null;const l=(await a.json()).data;return l?(console.log("✅ Fetched prediction from API:",l.title),console.log("🔍 Prediction options:",l.options?.length||0),i(c=>({predictions:c.predictions.some(d=>d.id===s)?c.predictions.map(d=>d.id===s?l:d):[...c.predictions,l]})),l):n?(console.log("⚠️ Using existing prediction without options:",n.title),n):(console.log("❌ Prediction not found:",s),null)}catch(r){return console.error("❌ Error fetching prediction by ID:",r),null}},createPrediction:async s=>{i({loading:!0,error:null});try{const r=await fetch(`${de()}/api/v2/predictions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw new Error(`Failed to create prediction: ${r.statusText}`);const n=await r.json();if(!n.data)throw new Error("Invalid response: no prediction data returned");const a=n.data;if(!a||!a.id)throw new Error("Invalid prediction data: missing required fields");i(o=>({predictions:[a,...o.predictions],loading:!1,error:null})),setTimeout(()=>{t().fetchPredictions()},100),i(o=>({userCreatedPredictions:[a,...o.userCreatedPredictions]}));try{const{user:o}=oe.getState();o?.id&&setTimeout(()=>{t().fetchUserCreatedPredictions(o.id)},1e3)}catch(o){console.warn("⚠️ Failed to refresh user created predictions:",o)}return console.log("✅ Prediction created successfully:",a.id),a}catch(r){throw console.error("❌ Error creating prediction:",r),i({loading:!1,error:r instanceof Error?r.message:"Failed to create prediction"}),r}},placePrediction:async(s,r,n,a)=>{i({loading:!0,error:null});try{const{useWalletStore:o}=await Nt(()=>Promise.resolve().then(()=>cc),void 0),l=o.getState(),c=t().predictions.find(f=>f.id===s),u=`Bet on "${c?.options.find(f=>f.id===r)?.label||"Unknown"}" in "${c?.title||"Unknown Prediction"}"`;console.log("🔄 Locking wallet funds before prediction placement..."),await l.makePrediction(n,u,s),console.log("✅ Wallet funds locked successfully");const h=await fetch(`${de()}/api/v2/predictions/${s}/entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_id:r,amount:n,user_id:a})});if(!h.ok)throw new Error(`Failed to place prediction: ${h.statusText}`);const p=await h.json();p.prediction?(console.log("📊 Updating prediction with server data:",{id:p.prediction.id,pool_total:p.prediction.pool_total,participant_count:p.prediction.participant_count,options:p.prediction.options?.length||0}),i(f=>({predictions:f.predictions.map(g=>g.id===s?{...g,...p.prediction,user_entry:p.entry}:g),userPredictions:f.userPredictions.map(g=>g.id===s?{...g,...p.prediction,user_entry:p.entry}:g),createdPredictions:f.createdPredictions.map(g=>g.id===s?{...g,...p.prediction,user_entry:p.entry}:g),loading:!1,error:null}))):i(f=>({predictions:f.predictions.map(g=>g.id===s?{...g,pool_total:p.pool_total||g.pool_total,participant_count:p.participant_count||g.participant_count,user_entry:p.entry}:g),loading:!1,error:null})),console.log("✅ Prediction placed successfully with updated data"),console.log("🔄 Refreshing wallet data after prediction placement..."),await l.initializeWallet(),console.log("✅ Wallet refreshed")}catch(o){throw console.error("❌ Error placing prediction:",o),i({loading:!1,error:o instanceof Error?o.message:"Failed to place prediction"}),o}},fetchPlatformStats:async()=>{i({statsLoading:!0});try{console.log("📊 Fetching platform stats with retry logic...");const s=await ws.get("/api/v2/predictions/stats/platform",{timeout:8e3,retryOptions:{maxRetries:3}});if(s.success&&s.data)i({platformStats:s.data,statsLoading:!1}),console.log("✅ Platform stats fetched:",s.data);else throw new Error("Invalid stats response format")}catch(s){console.error("❌ Error fetching platform stats:",s);const{predictions:r}=t(),n={totalVolume:r.reduce((a,o)=>a+(o.pool_total||0),0).toFixed(2),activePredictions:r.filter(a=>a.status==="open").length,totalUsers:r.length>0?"5":"0",rawVolume:r.reduce((a,o)=>a+(o.pool_total||0),0),rawUsers:r.length>0?5:0};i({platformStats:n,statsLoading:!1}),console.log("📊 Using fallback stats:",n)}},getActivityForPrediction:s=>[],getParticipantsForPrediction:s=>[],clearError:()=>{i({error:null})},fetchUserPredictionEntries:async s=>{try{console.log("📋 Fetching user prediction entries with retry logic for:",s);const n=(await ws.get(`/api/v2/prediction-entries/user/${s}`,{timeout:1e4,retryOptions:{maxRetries:3}})).data||[];i({userPredictionEntries:n}),console.log("✅ User prediction entries fetched:",n.length)}catch(r){console.error("❌ Error fetching user prediction entries:",r)}},fetchUserCreatedPredictions:async s=>{try{console.log("📋 Fetching user created predictions with retry logic for:",s);const n=(await ws.get(`/api/v2/predictions/created/${s}`,{timeout:1e4,retryOptions:{maxRetries:3}})).data||[];i({userCreatedPredictions:n}),console.log("✅ User created predictions fetched:",n.length)}catch(r){console.error("❌ Error fetching user created predictions:",r)}},getUserPredictionEntries:s=>{const{userPredictionEntries:r}=t();return r.filter(n=>n.user_id===s)},getUserCreatedPredictions:s=>{const{userCreatedPredictions:r}=t();return r.filter(n=>n.creator_id===s)},updatePrediction:async(s,r)=>{try{console.log("🔄 Updating prediction:",s,r);const n=await fetch(`${de()}/api/v2/predictions/${s}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(`Failed to update prediction: ${n.statusText}`);const o=(await n.json()).data;i(l=>({predictions:l.predictions.map(c=>c.id===s?{...c,...o}:c),userCreatedPredictions:l.userCreatedPredictions.map(c=>c.id===s?{...c,...o}:c)})),console.log("✅ Prediction updated successfully")}catch(n){throw console.error("❌ Error updating prediction:",n),n}},deletePrediction:async s=>{try{console.log("🗑️ Deleting prediction:",s);const r=await fetch(`${de()}/api/v2/predictions/${s}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!r.ok)throw new Error(`Failed to delete prediction: ${r.statusText}`);i(n=>({predictions:n.predictions.filter(a=>a.id!==s),createdPredictions:n.createdPredictions.filter(a=>a.id!==s),userCreatedPredictions:n.userCreatedPredictions.filter(a=>a.id!==s),trendingPredictions:n.trendingPredictions.filter(a=>a.id!==s),completedPredictions:n.completedPredictions.filter(a=>a.id!==s)}));try{const{user:n}=oe.getState();await t().refreshPredictions(!0),await t().fetchTrendingPredictions(),n?.id&&(await t().fetchUserCreatedPredictions(n.id),await t().fetchUserPredictionEntries(n.id))}catch(n){console.warn("⚠️ Post-delete refresh had an issue:",n)}console.log("✅ Prediction deleted successfully")}catch(r){throw console.error("❌ Error deleting prediction:",r),r}},closePrediction:async s=>{try{console.log("🔒 Closing prediction:",s);const r=await fetch(`${de()}/api/v2/predictions/${s}/close`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!r.ok)throw new Error(`Failed to close prediction: ${r.statusText}`);const a=(await r.json()).data;i(o=>({predictions:o.predictions.map(l=>l.id===s?{...l,status:"closed",...a}:l),userCreatedPredictions:o.userCreatedPredictions.map(l=>l.id===s?{...l,status:"closed",...a}:l)})),console.log("✅ Prediction closed successfully")}catch(r){throw console.error("❌ Error closing prediction:",r),r}},fetchPredictionActivity:async s=>{try{console.log("📋 Fetching prediction activity:",s);const r=await fetch(`${de()}/api/v2/predictions/${s}/activity`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});return r.ok?(await r.json()).data||[]:(console.warn(`Activity endpoint not available: ${r.statusText}`),[])}catch(r){return console.warn("Activity endpoint not implemented yet:",r),[]}},fetchPredictionParticipants:async s=>{try{console.log("📋 Fetching prediction participants:",s);const r=await fetch(`${de()}/api/v2/predictions/${s}/participants`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});return r.ok?(await r.json()).data||[]:(console.warn(`Participants endpoint not available: ${r.statusText}`),[])}catch(r){return console.warn("Participants endpoint not implemented yet:",r),[]}},reset:()=>{i(js)}})),is=({username:i,userId:t,displayName:s,className:r="",showAt:n=!0,onClick:a})=>{const[,o]=xe(),l=d=>{if(d.stopPropagation(),console.log("👤 TappableUsername clicked:",{username:i,userId:t,displayName:s}),a){a();return}const u=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(t&&t.trim()!==""&&u.test(t.trim()))console.log("🔗 Navigating to profile with userId:",t),o(`/profile/${t.trim()}`);else if(i&&i.trim()!==""){t&&!u.test(t.trim())&&console.warn("⚠️ Invalid userId format, using username instead:",t);const h=i.replace("@","").trim();console.log("🔗 Navigating to profile with username:",h),o(`/profile/${h}`)}else{console.warn("⚠️ No valid userId or username provided for profile navigation");return}},c=s||(n?`@${i.replace("@","")}`:i.replace("@",""));return e.jsx(P.button,{className:`inline-flex items-center font-medium text-blue-600 hover:text-blue-700 hover:underline transition-all cursor-pointer rounded-md px-1 py-0.5 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 ${r}`,whileHover:{scale:1.02},whileTap:{scale:.98},onClick:l,type:"button","aria-label":`View profile for ${c}`,children:c})},$i=({children:i,onClose:t,error:s})=>s?e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9000]",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-sm mx-4",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"⚠️ Error"}),e.jsx("p",{className:"text-sm",children:s}),e.jsx("button",{onClick:t,className:"mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})]})})}):e.jsx(e.Fragment,{children:i}),ir=({prediction:i,isOpen:t,onClose:s})=>{const{user:r}=oe(),[n,a]=m.useState(""),[o,l]=m.useState(!1);m.useEffect(()=>{l(!0)},[]);const c=i&&i.id&&i.id.trim()!=="",d=t&&c&&o,{comments:u,commentCount:h,isLoading:p,error:f,isSubmitting:g,fetchComments:x,addComment:y,toggleCommentLike:b,clearError:v}=Hr(d?i.id:"");m.useEffect(()=>{d&&x()},[d,x]),m.useEffect(()=>{t||(a(""),c&&v())},[t,v,c]);const j=async()=>{if(!(!c||!n.trim()||!r))try{await y(n.trim()),a(""),G.success("Comment added successfully!")}catch(C){console.error("Failed to add comment:",C),G.error(C.message||"Failed to add comment")}},k=async C=>{if(c)try{await b(C)}catch($){console.error("Failed to toggle comment like:",$),G.error("Failed to update like")}},L=C=>{try{const $=new Date,J=new Date(C),V=Math.floor(($.getTime()-J.getTime())/1e3);return V<60?"Just now":V<3600?`${Math.floor(V/60)}m ago`:V<86400?`${Math.floor(V/3600)}h ago`:`${Math.floor(V/86400)}d ago`}catch{return"Recently"}};return o?t&&!c?e.jsx($i,{onClose:s,error:"Unable to load comments. Invalid prediction data."}):!t||!i?null:e.jsx(fe,{children:e.jsx($i,{onClose:s,children:e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center sm:items-center sm:p-4 z-[9000]",children:e.jsxs(P.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},onClick:C=>C.stopPropagation(),className:"bg-white w-full max-w-lg rounded-t-3xl sm:rounded-3xl overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[80vh]",style:{zIndex:9001},children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Comments"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[h," ",h===1?"comment":"comments"]})]})]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:e.jsx(ge,{size:18})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:i.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:i.description||"No description available"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:p&&u.length===0?e.jsx("div",{className:"p-4 text-center",children:e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((C,$)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]},$))})}):f?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Fe,{size:48,className:"text-red-300 mx-auto mb-3"}),e.jsx("p",{className:"text-red-600 font-medium",children:"Failed to load comments"}),e.jsx("p",{className:"text-sm text-red-400 mb-4",children:f}),e.jsx("button",{onClick:()=>x(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]}):u.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(Fe,{size:48,className:"text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No comments yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Be the first to share your thoughts!"})]}):e.jsx("div",{className:"p-4 space-y-4",children:u.map(C=>e.jsx(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-gray-50 rounded-2xl px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(is,{username:C.user?.username||"Anonymous",userId:C.user?.id||"anonymous",className:"font-semibold text-gray-900 text-sm hover:text-blue-600",showAt:!1}),e.jsx("span",{className:"text-xs text-gray-500",children:L(C.created_at)})]}),e.jsx("p",{className:"text-gray-800 text-sm leading-relaxed",children:C.content})]}),e.jsx("div",{className:"flex items-center gap-4 mt-2 ml-4",children:e.jsxs("button",{onClick:()=>k(C.id),className:`flex items-center gap-1 text-xs transition-colors ${C.is_liked?"text-red-500":"text-gray-500 hover:text-red-500"}`,children:[e.jsx(vt,{size:14,fill:C.is_liked?"currentColor":"none"}),C.likes_count>0&&e.jsx("span",{children:C.likes_count})]})})]})},C.id))})}),r?e.jsx("div",{className:"p-4 border-t border-gray-100 bg-white sticky bottom-0",children:e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{type:"text",value:n,onChange:C=>a(C.target.value),onKeyPress:C=>{C.key==="Enter"&&!C.shiftKey&&(C.preventDefault(),j())},placeholder:"Write a comment...",className:"flex-1 px-4 py-2 bg-gray-100 rounded-full focus:ring-2 focus:ring-green-500 focus:bg-white focus:outline-none transition-all text-sm",disabled:g}),e.jsx("button",{onClick:j,disabled:!n.trim()||g,className:"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center hover:bg-teal-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:e.jsx(_d,{size:14})})]})})}):e.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50 text-center",children:e.jsx("p",{className:"text-gray-600 text-sm",children:"Please log in to join the conversation"})})]})})})}):null};class Yr extends ue.Component{constructor(s){super(s);ce(this,"resetError",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,r){console.error("ErrorBoundary caught an error:",s,r),this.setState({error:s,errorInfo:r}),this.props.onError?.(s,r)}render(){if(this.state.hasError){if(this.props.fallback){const s=this.props.fallback;return e.jsx(s,{error:this.state.error,resetError:this.resetError})}return e.jsx(lu,{error:this.state.error,resetError:this.resetError})}return this.props.children}}const lu=({error:i,resetError:t})=>{const s=()=>{t(),window.location.href="/"},r=()=>{t(),window.location.reload()};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Se,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:"We encountered an unexpected error. This has been logged and our team will investigate."})]}),i&&!1,e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs(P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:r,className:"flex items-center justify-center gap-2 w-full bg-teal-600 text-white py-3 px-4 rounded-xl font-semibold hover:bg-green-700 transition-colors",children:[e.jsx(ss,{className:"w-4 h-4"}),"Try Again"]}),e.jsxs(P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:s,className:"flex items-center justify-center gap-2 w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-xl font-semibold hover:bg-gray-200 transition-colors",children:[e.jsx(zn,{className:"w-4 h-4"}),"Go to Home"]})]})]})})};function cu(){return Wi.useSyncExternalStore(du,()=>!0,()=>!1)}function du(){return()=>{}}var Zr="Avatar",[uu,dm]=va(Zr),[hu,Vn]=uu(Zr),qn=m.forwardRef((i,t)=>{const{__scopeAvatar:s,...r}=i,[n,a]=m.useState("idle");return e.jsx(hu,{scope:s,imageLoadingStatus:n,onImageLoadingStatusChange:a,children:e.jsx(Ir.span,{...r,ref:t})})});qn.displayName=Zr;var Gn="AvatarImage",Jn=m.forwardRef((i,t)=>{const{__scopeAvatar:s,src:r,onLoadingStatusChange:n=()=>{},...a}=i,o=Vn(Gn,s),l=mu(r,a),c=wa(d=>{n(d),o.onImageLoadingStatusChange(d)});return lr(()=>{l!=="idle"&&c(l)},[l,c]),l==="loaded"?e.jsx(Ir.img,{...a,ref:t,src:r}):null});Jn.displayName=Gn;var Kn="AvatarFallback",Yn=m.forwardRef((i,t)=>{const{__scopeAvatar:s,delayMs:r,...n}=i,a=Vn(Kn,s),[o,l]=m.useState(r===void 0);return m.useEffect(()=>{if(r!==void 0){const c=window.setTimeout(()=>l(!0),r);return()=>window.clearTimeout(c)}},[r]),o&&a.imageLoadingStatus!=="loaded"?e.jsx(Ir.span,{...n,ref:t}):null});Yn.displayName=Kn;function Ri(i,t){return i?t?(i.src!==t&&(i.src=t),i.complete&&i.naturalWidth>0?"loaded":"loading"):"error":"idle"}function mu(i,{referrerPolicy:t,crossOrigin:s}){const r=cu(),n=m.useRef(null),a=r?(n.current||(n.current=new window.Image),n.current):null,[o,l]=m.useState(()=>Ri(a,i));return lr(()=>{l(Ri(a,i))},[a,i]),lr(()=>{const c=h=>()=>{l(h)};if(!a)return;const d=c("loaded"),u=c("error");return a.addEventListener("load",d),a.addEventListener("error",u),t&&(a.referrerPolicy=t),typeof s=="string"&&(a.crossOrigin=s),()=>{a.removeEventListener("load",d),a.removeEventListener("error",u)}},[a,s,t]),o}var Zn=qn,Qn=Jn,Xn=Yn;function ea(i){var t,s,r="";if(typeof i=="string"||typeof i=="number")r+=i;else if(typeof i=="object")if(Array.isArray(i)){var n=i.length;for(t=0;t<n;t++)i[t]&&(s=ea(i[t]))&&(r&&(r+=" "),r+=s)}else for(s in i)i[s]&&(r&&(r+=" "),r+=s);return r}function ta(){for(var i,t,s=0,r="",n=arguments.length;s<n;s++)(i=arguments[s])&&(t=ea(i))&&(r&&(r+=" "),r+=t);return r}const Qr="-",pu=i=>{const t=gu(i),{conflictingClassGroups:s,conflictingClassGroupModifiers:r}=i;return{getClassGroupId:o=>{const l=o.split(Qr);return l[0]===""&&l.length!==1&&l.shift(),sa(l,t)||fu(o)},getConflictingClassGroupIds:(o,l)=>{const c=s[o]||[];return l&&r[o]?[...c,...r[o]]:c}}},sa=(i,t)=>{if(i.length===0)return t.classGroupId;const s=i[0],r=t.nextPart.get(s),n=r?sa(i.slice(1),r):void 0;if(n)return n;if(t.validators.length===0)return;const a=i.join(Qr);return t.validators.find(({validator:o})=>o(a))?.classGroupId},Ii=/^\[(.+)\]$/,fu=i=>{if(Ii.test(i)){const t=Ii.exec(i)[1],s=t?.substring(0,t.indexOf(":"));if(s)return"arbitrary.."+s}},gu=i=>{const{theme:t,prefix:s}=i,r={nextPart:new Map,validators:[]};return bu(Object.entries(i.classGroups),s).forEach(([a,o])=>{Tr(o,r,a,t)}),r},Tr=(i,t,s,r)=>{i.forEach(n=>{if(typeof n=="string"){const a=n===""?t:Oi(t,n);a.classGroupId=s;return}if(typeof n=="function"){if(xu(n)){Tr(n(r),t,s,r);return}t.validators.push({validator:n,classGroupId:s});return}Object.entries(n).forEach(([a,o])=>{Tr(o,Oi(t,a),s,r)})})},Oi=(i,t)=>{let s=i;return t.split(Qr).forEach(r=>{s.nextPart.has(r)||s.nextPart.set(r,{nextPart:new Map,validators:[]}),s=s.nextPart.get(r)}),s},xu=i=>i.isThemeGetter,bu=(i,t)=>t?i.map(([s,r])=>{const n=r.map(a=>typeof a=="string"?t+a:typeof a=="object"?Object.fromEntries(Object.entries(a).map(([o,l])=>[t+o,l])):a);return[s,n]}):i,yu=i=>{if(i<1)return{get:()=>{},set:()=>{}};let t=0,s=new Map,r=new Map;const n=(a,o)=>{s.set(a,o),t++,t>i&&(t=0,r=s,s=new Map)};return{get(a){let o=s.get(a);if(o!==void 0)return o;if((o=r.get(a))!==void 0)return n(a,o),o},set(a,o){s.has(a)?s.set(a,o):n(a,o)}}},ra="!",vu=i=>{const{separator:t,experimentalParseClassName:s}=i,r=t.length===1,n=t[0],a=t.length,o=l=>{const c=[];let d=0,u=0,h;for(let y=0;y<l.length;y++){let b=l[y];if(d===0){if(b===n&&(r||l.slice(y,y+a)===t)){c.push(l.slice(u,y)),u=y+a;continue}if(b==="/"){h=y;continue}}b==="["?d++:b==="]"&&d--}const p=c.length===0?l:l.substring(u),f=p.startsWith(ra),g=f?p.substring(1):p,x=h&&h>u?h-u:void 0;return{modifiers:c,hasImportantModifier:f,baseClassName:g,maybePostfixModifierPosition:x}};return s?l=>s({className:l,parseClassName:o}):o},wu=i=>{if(i.length<=1)return i;const t=[];let s=[];return i.forEach(r=>{r[0]==="["?(t.push(...s.sort(),r),s=[]):s.push(r)}),t.push(...s.sort()),t},ju=i=>({cache:yu(i.cacheSize),parseClassName:vu(i),...pu(i)}),ku=/\s+/,Nu=(i,t)=>{const{parseClassName:s,getClassGroupId:r,getConflictingClassGroupIds:n}=t,a=[],o=i.trim().split(ku);let l="";for(let c=o.length-1;c>=0;c-=1){const d=o[c],{modifiers:u,hasImportantModifier:h,baseClassName:p,maybePostfixModifierPosition:f}=s(d);let g=!!f,x=r(g?p.substring(0,f):p);if(!x){if(!g){l=d+(l.length>0?" "+l:l);continue}if(x=r(p),!x){l=d+(l.length>0?" "+l:l);continue}g=!1}const y=wu(u).join(":"),b=h?y+ra:y,v=b+x;if(a.includes(v))continue;a.push(v);const j=n(x,g);for(let k=0;k<j.length;++k){const L=j[k];a.push(b+L)}l=d+(l.length>0?" "+l:l)}return l};function Su(){let i=0,t,s,r="";for(;i<arguments.length;)(t=arguments[i++])&&(s=ia(t))&&(r&&(r+=" "),r+=s);return r}const ia=i=>{if(typeof i=="string")return i;let t,s="";for(let r=0;r<i.length;r++)i[r]&&(t=ia(i[r]))&&(s&&(s+=" "),s+=t);return s};function _u(i,...t){let s,r,n,a=o;function o(c){const d=t.reduce((u,h)=>h(u),i());return s=ju(d),r=s.cache.get,n=s.cache.set,a=l,l(c)}function l(c){const d=r(c);if(d)return d;const u=Nu(c,s);return n(c,u),u}return function(){return a(Su.apply(null,arguments))}}const ae=i=>{const t=s=>s[i]||[];return t.isThemeGetter=!0,t},na=/^\[(?:([a-z-]+):)?(.+)\]$/i,Cu=/^\d+\/\d+$/,Pu=new Set(["px","full","screen"]),Eu=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Tu=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Au=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,$u=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Ru=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,We=i=>Lt(i)||Pu.has(i)||Cu.test(i),Ke=i=>Bt(i,"length",Fu),Lt=i=>!!i&&!Number.isNaN(Number(i)),nr=i=>Bt(i,"number",Lt),Jt=i=>!!i&&Number.isInteger(Number(i)),Iu=i=>i.endsWith("%")&&Lt(i.slice(0,-1)),Q=i=>na.test(i),Ye=i=>Eu.test(i),Ou=new Set(["length","size","percentage"]),Lu=i=>Bt(i,Ou,aa),Du=i=>Bt(i,"position",aa),zu=new Set(["image","url"]),Uu=i=>Bt(i,zu,Wu),Mu=i=>Bt(i,"",Bu),Kt=()=>!0,Bt=(i,t,s)=>{const r=na.exec(i);return r?r[1]?typeof t=="string"?r[1]===t:t.has(r[1]):s(r[2]):!1},Fu=i=>Tu.test(i)&&!Au.test(i),aa=()=>!1,Bu=i=>$u.test(i),Wu=i=>Ru.test(i),Hu=()=>{const i=ae("colors"),t=ae("spacing"),s=ae("blur"),r=ae("brightness"),n=ae("borderColor"),a=ae("borderRadius"),o=ae("borderSpacing"),l=ae("borderWidth"),c=ae("contrast"),d=ae("grayscale"),u=ae("hueRotate"),h=ae("invert"),p=ae("gap"),f=ae("gradientColorStops"),g=ae("gradientColorStopPositions"),x=ae("inset"),y=ae("margin"),b=ae("opacity"),v=ae("padding"),j=ae("saturate"),k=ae("scale"),L=ae("sepia"),C=ae("skew"),$=ae("space"),J=ae("translate"),V=()=>["auto","contain","none"],ee=()=>["auto","hidden","clip","visible","scroll"],q=()=>["auto",Q,t],F=()=>[Q,t],O=()=>["",We,Ke],w=()=>["auto",Lt,Q],I=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],N=()=>["solid","dashed","dotted","double","none"],z=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],R=()=>["start","end","center","between","around","evenly","stretch"],S=()=>["","0",Q],E=()=>["auto","avoid","all","avoid-page","page","left","right","column"],D=()=>[Lt,Q];return{cacheSize:500,separator:":",theme:{colors:[Kt],spacing:[We,Ke],blur:["none","",Ye,Q],brightness:D(),borderColor:[i],borderRadius:["none","","full",Ye,Q],borderSpacing:F(),borderWidth:O(),contrast:D(),grayscale:S(),hueRotate:D(),invert:S(),gap:F(),gradientColorStops:[i],gradientColorStopPositions:[Iu,Ke],inset:q(),margin:q(),opacity:D(),padding:F(),saturate:D(),scale:D(),sepia:S(),skew:D(),space:F(),translate:F()},classGroups:{aspect:[{aspect:["auto","square","video",Q]}],container:["container"],columns:[{columns:[Ye]}],"break-after":[{"break-after":E()}],"break-before":[{"break-before":E()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...I(),Q]}],overflow:[{overflow:ee()}],"overflow-x":[{"overflow-x":ee()}],"overflow-y":[{"overflow-y":ee()}],overscroll:[{overscroll:V()}],"overscroll-x":[{"overscroll-x":V()}],"overscroll-y":[{"overscroll-y":V()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Jt,Q]}],basis:[{basis:q()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Q]}],grow:[{grow:S()}],shrink:[{shrink:S()}],order:[{order:["first","last","none",Jt,Q]}],"grid-cols":[{"grid-cols":[Kt]}],"col-start-end":[{col:["auto",{span:["full",Jt,Q]},Q]}],"col-start":[{"col-start":w()}],"col-end":[{"col-end":w()}],"grid-rows":[{"grid-rows":[Kt]}],"row-start-end":[{row:["auto",{span:[Jt,Q]},Q]}],"row-start":[{"row-start":w()}],"row-end":[{"row-end":w()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Q]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Q]}],gap:[{gap:[p]}],"gap-x":[{"gap-x":[p]}],"gap-y":[{"gap-y":[p]}],"justify-content":[{justify:["normal",...R()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...R(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...R(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[$]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[$]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Q,t]}],"min-w":[{"min-w":[Q,t,"min","max","fit"]}],"max-w":[{"max-w":[Q,t,"none","full","min","max","fit","prose",{screen:[Ye]},Ye]}],h:[{h:[Q,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Q,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Q,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Q,t,"auto","min","max","fit"]}],"font-size":[{text:["base",Ye,Ke]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",nr]}],"font-family":[{font:[Kt]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Q]}],"line-clamp":[{"line-clamp":["none",Lt,nr]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",We,Q]}],"list-image":[{"list-image":["none",Q]}],"list-style-type":[{list:["none","disc","decimal",Q]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[b]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[b]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...N(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",We,Ke]}],"underline-offset":[{"underline-offset":["auto",We,Q]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:F()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Q]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Q]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[b]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...I(),Du]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Lu]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Uu]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[f]}],"gradient-via":[{via:[f]}],"gradient-to":[{to:[f]}],rounded:[{rounded:[a]}],"rounded-s":[{"rounded-s":[a]}],"rounded-e":[{"rounded-e":[a]}],"rounded-t":[{"rounded-t":[a]}],"rounded-r":[{"rounded-r":[a]}],"rounded-b":[{"rounded-b":[a]}],"rounded-l":[{"rounded-l":[a]}],"rounded-ss":[{"rounded-ss":[a]}],"rounded-se":[{"rounded-se":[a]}],"rounded-ee":[{"rounded-ee":[a]}],"rounded-es":[{"rounded-es":[a]}],"rounded-tl":[{"rounded-tl":[a]}],"rounded-tr":[{"rounded-tr":[a]}],"rounded-br":[{"rounded-br":[a]}],"rounded-bl":[{"rounded-bl":[a]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[b]}],"border-style":[{border:[...N(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[b]}],"divide-style":[{divide:N()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...N()]}],"outline-offset":[{"outline-offset":[We,Q]}],"outline-w":[{outline:[We,Ke]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:O()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[b]}],"ring-offset-w":[{"ring-offset":[We,Ke]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Ye,Mu]}],"shadow-color":[{shadow:[Kt]}],opacity:[{opacity:[b]}],"mix-blend":[{"mix-blend":[...z(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":z()}],filter:[{filter:["","none"]}],blur:[{blur:[s]}],brightness:[{brightness:[r]}],contrast:[{contrast:[c]}],"drop-shadow":[{"drop-shadow":["","none",Ye,Q]}],grayscale:[{grayscale:[d]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[j]}],sepia:[{sepia:[L]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[s]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[c]}],"backdrop-grayscale":[{"backdrop-grayscale":[d]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[b]}],"backdrop-saturate":[{"backdrop-saturate":[j]}],"backdrop-sepia":[{"backdrop-sepia":[L]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Q]}],duration:[{duration:D()}],ease:[{ease:["linear","in","out","in-out",Q]}],delay:[{delay:D()}],animate:[{animate:["none","spin","ping","pulse","bounce",Q]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[Jt,Q]}],"translate-x":[{"translate-x":[J]}],"translate-y":[{"translate-y":[J]}],"skew-x":[{"skew-x":[C]}],"skew-y":[{"skew-y":[C]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Q]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Q]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":F()}],"scroll-mx":[{"scroll-mx":F()}],"scroll-my":[{"scroll-my":F()}],"scroll-ms":[{"scroll-ms":F()}],"scroll-me":[{"scroll-me":F()}],"scroll-mt":[{"scroll-mt":F()}],"scroll-mr":[{"scroll-mr":F()}],"scroll-mb":[{"scroll-mb":F()}],"scroll-ml":[{"scroll-ml":F()}],"scroll-p":[{"scroll-p":F()}],"scroll-px":[{"scroll-px":F()}],"scroll-py":[{"scroll-py":F()}],"scroll-ps":[{"scroll-ps":F()}],"scroll-pe":[{"scroll-pe":F()}],"scroll-pt":[{"scroll-pt":F()}],"scroll-pr":[{"scroll-pr":F()}],"scroll-pb":[{"scroll-pb":F()}],"scroll-pl":[{"scroll-pl":F()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Q]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[We,Ke,nr]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Vu=_u(Hu);function Ae(...i){return Vu(ta(i))}const qu=i=>{const t=new Date(i),s=new Date,r=t.getTime()-s.getTime();if(r<=0)return"Ended";const n=Math.floor(r/6e4),a=Math.floor(r/36e5),o=Math.floor(r/864e5),l=Math.floor(o/365);if(a>999)if(l>0){const c=o%365;return c>0?`${l}y ${c}d left`:`${l}y left`}else return`${o}d left`;return o>0?`${o}d ${a%24}h left`:a>0?`${a}h left`:n>0?`${n}m left`:"Ending soon"},oa=m.forwardRef(({className:i,...t},s)=>e.jsx(Zn,{ref:s,className:Ae("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full border border-border",i),...t}));oa.displayName=Zn.displayName;const la=m.forwardRef(({className:i,...t},s)=>e.jsx(Qn,{ref:s,className:Ae("aspect-square h-full w-full object-cover",i),...t}));la.displayName=Qn.displayName;const ca=m.forwardRef(({className:i,...t},s)=>e.jsx(Xn,{ref:s,className:Ae("flex h-full w-full items-center justify-center rounded-full bg-muted text-sm font-medium text-muted-foreground",i),...t}));ca.displayName=Xn.displayName;const Gu={sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-16 w-16 text-xl",xl:"h-20 w-20 text-2xl"},Ts=({email:i,username:t,avatarUrl:s,className:r,size:n="md"})=>{const a=`${Gu[n]} ${r||""}`.trim(),l=t&&t.trim()?t.trim().split(" ").map(c=>c.charAt(0)).join("").toUpperCase().slice(0,2):i&&i.trim()?i.trim().split("@")[0].slice(0,2).toUpperCase():"FC";return e.jsxs(oa,{className:a,children:[s&&s.trim()?e.jsx(la,{src:s,alt:t||i||"User avatar"}):null,e.jsx(ca,{className:"bg-gradient-to-r from-purple-400 to-purple-600 text-white font-bold",children:l})]})},Ju=({error:i})=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-red-200 p-4 m-2",children:e.jsxs("div",{className:"text-red-600 text-sm",children:["⚠️ Error loading prediction",i&&e.jsx("div",{className:"text-xs mt-1 text-gray-500",children:i})]})}),Ku=({prediction:i,entry:t,variant:s="default",onLike:r,onComment:n,onShare:a,onPredict:o,className:l=""})=>{if(!i||!i.id)return console.warn("⚠️ PredictionCard: Invalid prediction data received:",i),e.jsx(Ju,{error:"Invalid prediction data"});const[,c]=xe(),[d,u]=m.useState(!1),[h,p]=m.useState(!1),[f,g]=m.useState(!1);m.useEffect(()=>{u(!0)},[]);const x=()=>{try{const{toggleLike:T,checkIfLiked:A,getLikeCount:_}=Br();return{toggleLike:T,checkIfLiked:A,getLikeCount:_}}catch(T){return console.warn("Error accessing like store:",T),{toggleLike:async()=>{},checkIfLiked:()=>!1,getLikeCount:()=>0}}},y=()=>{try{const{getCommentCount:T}=Wr();return{getCommentCount:T}}catch(T){return console.warn("Error accessing comment store:",T),{getCommentCount:()=>0}}},{toggleLike:b,checkIfLiked:v,getLikeCount:j}=x(),{getCommentCount:k}=y();if(!d)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]});const L=v(i.id)||!1,C=j(i.id),$=C??(i.likes_count||i.likes||0),J=k(i.id),V=J??(i.comments_count||i.comments||0);console.log(`📊 PredictionCard ${i.id}: storeCount=${J}, predictionCount=${i.comments_count||i.comments||0}, finalCount=${V}`);const ee=i.entry_deadline||i.entryDeadline,q=ee?Math.max(0,new Date(ee).getTime()-Date.now()):0,F=Math.floor(q/(1e3*60*60)),O=F<24&&F>0,w=i.participant_count||i.entries?.length||0,I=i.options?.reduce((T,A)=>{const _=A.total_staked||A.totalStaked||0;return T+_},0)||i.pool_total||i.poolTotal||0,N=T=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(T),z=async()=>{if(!f){console.log("❤️ Like clicked:",i.id,"- Before:",{isLiked:L,likeCount:$});try{g(!0),await b(i.id),r&&r()}catch(T){console.error("❌ Error toggling like:",T),G.error("Failed to update like")}finally{g(!1)}}},R=()=>{p(!0),n&&n()},S=async()=>{try{const T={title:i.title,text:`Check out this prediction: ${i.title}`,url:`${window.location.origin}/prediction/${i.id}`};if(navigator.share&&navigator.canShare&&navigator.canShare(T))await navigator.share(T);else if(navigator.clipboard)await navigator.clipboard.writeText(T.url),G.success("Link copied to clipboard!");else{const A=document.createElement("textarea");A.value=T.url,document.body.appendChild(A),A.select(),document.execCommand("copy"),document.body.removeChild(A),G.success("Link copied to clipboard!")}a&&a()}catch(T){console.error("Error sharing:",T),G.error("Failed to share")}},E=T=>{const A=T.target;A.closest("button")||A.closest("a")||A.closest(".interactive")||A.closest(".options-clickable")||A.closest('[data-clickable="true"]')||A.closest(".predict-button")||T.defaultPrevented||c(`/prediction/${i.id}`)},D=()=>q<=0?"Ended":F>=24?`${Math.floor(F/24)}d left`:`${F}h left`;if(s==="compact")return e.jsxs(e.Fragment,{children:[e.jsxs(P.div,{className:`bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer ${l}`,whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:E,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ts,{email:i.creator?.email,username:i.creator?.username,avatarUrl:i.creator?.avatar_url,size:"sm"}),e.jsxs("div",{children:[e.jsx(is,{username:i.creator?.username||i.creator?.full_name||"Anonymous",userId:i.creator?.id||"anonymous",className:"font-medium text-gray-900 text-sm hover:text-blue-600",showAt:!0}),e.jsx("div",{className:"text-xs text-gray-500",children:D()})]})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${i.category==="sports"?"bg-red-100 text-red-700":i.category==="pop_culture"?"bg-purple-100 text-purple-700":i.category==="esports"?"bg-yellow-100 text-yellow-700":i.category==="politics"?"bg-blue-100 text-blue-700":i.category==="celebrity_gossip"?"bg-pink-100 text-pink-700":"bg-emerald-100 text-emerald-700"}`,children:i.category?.replace("_"," ")||"General"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2 cursor-pointer options-clickable",onClick:T=>{T.stopPropagation(),o&&o()},children:i.title}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-600 cursor-pointer options-clickable",onClick:T=>{T.stopPropagation(),o&&o()},children:[e.jsx("span",{className:"font-medium",children:N(I)}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[Array.isArray(i.options)?i.options.length:0," options"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:T=>{T.stopPropagation(),z()},className:`flex items-center gap-1 ${L?"text-red-500":"text-gray-400"} hover:text-red-500 transition-colors`,children:[e.jsx(vt,{className:`w-4 h-4 ${L?"fill-current":""}`}),e.jsx("span",{className:"text-gray-600",children:$})]}),e.jsxs("button",{onClick:T=>{T.stopPropagation(),R()},className:"flex items-center gap-1 text-gray-400 hover:text-blue-500 transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-gray-600",children:V})]})]})]})]}),e.jsx(ir,{prediction:i,isOpen:h,onClose:()=>p(!1)})]});if(s==="user-entry"){const T=!!t,A=t?.option_id,_=t?.potential_payout||0,K=t?.actual_payout||0,se=t?.status||i.status;return e.jsxs(e.Fragment,{children:[e.jsxs(P.div,{className:`bg-white rounded-xl shadow-sm border-l-4 ${se==="won"?"border-emerald-500":se==="lost"?"border-red-500":se==="settled"?"border-gray-500":"border-blue-500"} p-4 cursor-pointer ${l}`,whileHover:{scale:1.01,y:-2},onClick:E,children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base line-clamp-1",children:i.title}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${se==="won"?"bg-emerald-100 text-emerald-700":se==="lost"?"bg-red-100 text-red-700":se==="settled"?"bg-gray-100 text-gray-700":"bg-blue-100 text-blue-700"}`,children:se?.toUpperCase()}),e.jsx(tt,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-xs text-gray-500",children:D()})]})]})}),T&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Your Position"}),e.jsx("div",{className:"font-semibold text-gray-900",children:i.options?.find(re=>re.id===A)?.label||"Option selected"}),e.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Stake: ",N(t?.amount||0)," •",se==="won"?` Won: ${N(K)}`:se==="lost"?" Lost":` Potential: ${N(_)}`]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:z,disabled:f,className:`flex items-center gap-1 ${L?"text-red-500":"text-gray-500"} hover:text-red-500 transition-colors`,children:[e.jsx(vt,{className:`w-4 h-4 ${L?"fill-current":""}`}),e.jsx("span",{className:"text-sm",children:$})]}),e.jsxs("button",{onClick:R,className:"flex items-center gap-1 text-gray-500 hover:text-blue-500 transition-colors",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:V})]}),e.jsxs("button",{onClick:S,className:"flex items-center gap-1 text-gray-500 hover:text-emerald-500 transition-colors",children:[e.jsx(Cr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:"Share"})]})]}),e.jsx("button",{onClick:o,className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 text-sm font-medium transition-colors",children:"View Details"})]})]}),e.jsx(ir,{prediction:i,isOpen:h,onClose:()=>p(!1)})]})}return e.jsxs(e.Fragment,{children:[e.jsxs(P.div,{className:`bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer ${l}`,whileHover:{scale:1.01,y:-2},initial:{opacity:0,y:20},animate:{opacity:1,y:0},onClick:E,transition:{duration:.3},children:[e.jsxs("div",{className:"p-4 pb-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-400 to-purple-600 flex items-center justify-center text-white font-bold",children:i.creator?.username?.slice(0,2).toUpperCase()||"FC"}),e.jsxs("div",{children:[e.jsx(is,{username:i.creator?.username||i.creator?.full_name||"Anonymous",userId:i.creator?.id||"anonymous",className:"font-medium text-gray-900 hover:text-blue-600",showAt:!0}),e.jsx("div",{className:"text-sm text-gray-500",children:i.created_at?new Date(i.created_at).toLocaleDateString():"Recently"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${i.category==="sports"?"bg-red-100 text-red-700":i.category==="pop_culture"?"bg-purple-100 text-purple-700":i.category==="esports"?"bg-yellow-100 text-yellow-700":i.category==="politics"?"bg-blue-100 text-blue-700":i.category==="celebrity_gossip"?"bg-pink-100 text-pink-700":"bg-emerald-100 text-emerald-700"}`,children:i.category?.replace("_"," ")||"General"}),O&&e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-700",children:"Closing Soon"})]})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2 leading-tight",children:i.title}),i.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:i.description})]}),e.jsx("div",{className:"px-4 mb-4",children:e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Options"}),e.jsxs("span",{className:"text-xs text-gray-500",children:[Array.isArray(i.options)?i.options.length:0," choices"]})]}),e.jsxs("div",{className:"space-y-2",children:[(i.options||[]).slice(0,3).map((T,A)=>{const _=T.total_staked||T.totalStaked||0,K=Array.isArray(i.options)?i.options.length:0,se=I>0?_/I*100:K>0?100/K:0,re=T.current_odds||(_>0?Math.max(I/_,1.01):K||2);return e.jsx(P.button,{className:"w-full p-3 rounded-lg border-2 border-gray-200 bg-white hover:border-emerald-300 hover:bg-emerald-50 transition-all group",whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>o&&o(),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 group-hover:text-emerald-700",children:T.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[se.toFixed(0),"% • ",N(_)]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-emerald-600",children:[re.toFixed(1),"x"]})})]})},T.id)}),(i.options?.length||0)>3&&e.jsxs("div",{className:"text-center text-sm text-gray-500",children:["+",(i.options?.length||0)-3," more options available"]})]})]})}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:N(I)}),e.jsx("span",{className:"text-gray-500",children:"pool"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{children:w})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(tt,{className:"w-4 h-4"}),e.jsx("span",{className:O?"text-amber-600 font-medium":"",children:D()})]})]}),w>5&&e.jsxs("div",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Trending"})]})]})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(P.button,{onClick:z,disabled:f,className:`flex items-center gap-2 ${L?"text-red-500":"text-gray-600"} hover:text-red-500 transition-colors`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(vt,{className:`w-5 h-5 ${L?"fill-current":""}`}),e.jsx("span",{className:"text-sm font-medium",children:$})]}),e.jsxs(P.button,{onClick:R,className:"flex items-center gap-2 text-gray-600 hover:text-blue-500 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:V})]}),e.jsxs(P.button,{onClick:S,className:"flex items-center gap-2 text-gray-600 hover:text-emerald-500 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(Cr,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Share"})]})]}),e.jsx(P.button,{onClick:o,className:"bg-gradient-to-r from-purple-600 to-emerald-600 text-white px-6 py-2 rounded-lg font-medium shadow-sm",whileHover:{scale:1.02,boxShadow:"0 8px 25px rgba(123, 47, 247, 0.25)"},whileTap:{scale:.98},children:"Predict Now"})]})})]}),e.jsx(ir,{prediction:i,isOpen:h,onClose:()=>p(!1)})]})},Yu=i=>e.jsx(Yr,{children:e.jsx(Ku,{...i})}),Zu=()=>e.jsxs("div",{className:"bg-white rounded-2xl p-4 mx-4 mb-3 shadow-sm border border-gray-100 animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}),e.jsx("div",{className:"ml-3 flex-shrink-0",children:e.jsx("div",{className:"w-16 h-6 bg-gray-200 rounded-full"})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"p-3 border-2 border-gray-200 rounded-xl",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-8"})]}),e.jsxs("div",{className:"p-3 border-2 border-gray-200 rounded-xl",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-8"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-10"})]}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-6"})]}),e.jsx("div",{className:"w-20 h-8 bg-gray-200 rounded-lg"})]})]}),Li=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,Di=ta,Qu=(i,t)=>s=>{var r;if(t?.variants==null)return Di(i,s?.class,s?.className);const{variants:n,defaultVariants:a}=t,o=Object.keys(n).map(d=>{const u=s?.[d],h=a?.[d];if(u===null)return null;const p=Li(u)||Li(h);return n[d][p]}),l=s&&Object.entries(s).reduce((d,u)=>{let[h,p]=u;return p===void 0||(d[h]=p),d},{}),c=t==null||(r=t.compoundVariants)===null||r===void 0?void 0:r.reduce((d,u)=>{let{class:h,className:p,...f}=u;return Object.entries(f).every(g=>{let[x,y]=g;return Array.isArray(y)?y.includes({...a,...l}[x]):{...a,...l}[x]===y})?[...d,h,p]:d},[]);return Di(i,o,c,s?.class,s?.className)},Xu=Qu("inline-flex items-center justify-center rounded-lg text-sm font-semibold ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-[0.98]",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-12 px-6 py-3",sm:"h-9 px-4 py-2 text-xs",lg:"h-14 px-8 py-4",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),bt=m.forwardRef(({className:i,variant:t,size:s,asChild:r=!1,...n},a)=>{const o=r?ja:"button";return e.jsx(o,{className:Ae(Xu({variant:t,size:s,className:i})),ref:a,...n})});bt.displayName="Button";const Xr=m.forwardRef(({className:i,type:t,...s},r)=>e.jsx("input",{type:t,className:Ae("flex h-12 w-full rounded-lg border border-input bg-background px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:r,...s}));Xr.displayName="Input";const Ar=m.forwardRef(({className:i,...t},s)=>e.jsx("div",{ref:s,className:Ae("rounded-xl border bg-card text-card-foreground shadow-sm",i),...t}));Ar.displayName="Card";const eh=m.forwardRef(({className:i,...t},s)=>e.jsx("div",{ref:s,className:Ae("flex flex-col space-y-1.5 p-6",i),...t}));eh.displayName="CardHeader";const th=m.forwardRef(({className:i,...t},s)=>e.jsx("h3",{ref:s,className:Ae("font-semibold leading-none tracking-tight",i),...t}));th.displayName="CardTitle";const sh=m.forwardRef(({className:i,...t},s)=>e.jsx("p",{ref:s,className:Ae("text-sm text-muted-foreground",i),...t}));sh.displayName="CardDescription";const $r=m.forwardRef(({className:i,...t},s)=>e.jsx("div",{ref:s,className:Ae("p-6 pt-0",i),...t}));$r.displayName="CardContent";const rh=m.forwardRef(({className:i,...t},s)=>e.jsx("div",{ref:s,className:Ae("flex items-center p-6 pt-0",i),...t}));rh.displayName="CardFooter";const ze=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),ih=(i,t)=>i*t,zi=(...i)=>i.filter(Boolean).join(" "),nh=i=>{const t=i.entry_deadline||i.entryDeadline;if(!t)return"Time remaining unknown";const s=Math.max(0,new Date(t).getTime()-Date.now()),r=Math.floor(s/(1e3*60*60));return s<=0?"Ended":r>=24?`${Math.floor(r/24)}d left`:`${r}h left`},ah=({prediction:i,isOpen:t,onClose:s})=>{if(!i||!t)return null;const[r,n]=m.useState(""),[a,o]=m.useState(""),[l,c]=m.useState(!1),{user:d}=oe(),{getBalance:u,lockFunds:h}=ls(),{placePrediction:p}=at(),f=u("USD")||0,g=parseFloat(a)||0,x=i?.options?.find(k=>k.id===r),y=x?.current_odds||(x?.total_staked?i?.pool_total/x.total_staked:2),b=x?ih(g,y):0,v=[5,10,25,50,100,250],j=async()=>{if(!r){G.error("Please select a prediction option (Yes or No)");return}if(!g){G.error("Please enter an amount to stake");return}if(g<i.stake_min){G.error(`Minimum stake is ${ze(i.stake_min)}. Please increase your amount.`);return}if(i.stake_max&&g>i.stake_max){G.error(`Maximum stake is ${ze(i.stake_max)}. Please reduce your amount.`);return}if(g>f){G.error(`Insufficient balance. You have ${ze(f)} available, but tried to stake ${ze(g)}.`);return}if(!d?.id){G.error("You must be logged in to place predictions");return}c(!0);try{await h(g,"USD"),await p(i.id,r,g,d.id),G.success(`Prediction placed successfully! You staked ${ze(g)} on ${x?.label}.`),s(),o(""),n("")}catch(k){const L=k?.message||"Unknown error occurred";G.error(`Failed to place prediction: ${L}. Please try again.`)}finally{c(!1)}};return e.jsx(fe,{mode:"wait",initial:!1,children:t&&e.jsxs(e.Fragment,{children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:s,style:{zIndex:8e3}},"prediction-modal-backdrop"),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center p-4 pb-20",style:{zIndex:8500,pointerEvents:"none"},children:e.jsxs(P.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:"w-full max-w-md bg-white rounded-t-2xl shadow-2xl flex flex-col max-h-[75vh]",style:{pointerEvents:"auto"},onClick:k=>k.stopPropagation(),children:[e.jsx("div",{className:"flex-shrink-0 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Place Prediction"}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close modal",children:e.jsx(ge,{size:20})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base",children:i.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:[ze(i.pool_total||0)," Pool"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[i.participant_count||0," Players"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:nh(i)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Select your prediction:"}),e.jsx("div",{className:"space-y-2",children:(i.options||[]).map(k=>{const L=k.total_staked||0,C=i.pool_total||1,$=C>0?Math.min(L/C*100,100):50,J=k.current_odds||(L>0?C/L:2);return e.jsx(Ar,{className:zi("cursor-pointer transition-all border-2",r===k.id?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-gray-300"),onClick:()=>n(k.id),children:e.jsx($r,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:k.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[$.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[J.toFixed(2),"x"]})})]})})},k.id||Math.random())})})]}),e.jsx(fe,{mode:"wait",children:r&&e.jsxs(P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stake amount"}),e.jsxs("div",{className:"relative",children:[e.jsx(Xr,{type:"number",placeholder:"0.00",value:a,onChange:k=>o(k.target.value),className:"pl-8 pr-4 h-12 text-lg font-medium",min:i.stake_min,max:i.stake_max||f}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"$"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:["Balance: ",ze(f)]}),e.jsx("button",{onClick:()=>o(f.toString()),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Max"})]})]}),e.jsx("div",{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:v.map(k=>e.jsxs(bt,{variant:"outline",size:"sm",onClick:()=>o(k.toString()),disabled:k>f,className:"text-sm h-10",children:["$",k]},k))})}),g>0&&e.jsx(Ar,{className:"bg-teal-50 border-teal-200",children:e.jsx($r,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Potential return"}),e.jsx("div",{className:"text-lg font-bold text-teal-600",children:ze(b)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Profit"}),e.jsx("div",{className:zi("font-semibold",b>g?"text-teal-600":"text-red-600"),children:ze(b-g)})]})]})})})]},`amount-input-${r}`)})]}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-gray-200 bg-white",children:e.jsx(bt,{onClick:j,disabled:!r||!g||l||g>f,className:"w-full h-12 bg-teal-500 hover:bg-teal-600 disabled:bg-gray-400 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg flex items-center justify-center",children:l?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Placing..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Wn,{size:16}),e.jsxs("span",{children:["Place Prediction (",ze(g),")"]})]})})})]},"prediction-modal-content")})]})})},oh=({hasNext:i,loading:t,onLoadMore:s,threshold:r=200,disabled:n=!1,container:a=null})=>{const o=m.useRef(!1),l=m.useCallback(()=>{if(n||t||!i||o.current)return;let d,u,h;a?(d=a.scrollTop,u=a.scrollHeight,h=a.clientHeight):(d=window.pageYOffset||document.documentElement.scrollTop,u=document.documentElement.scrollHeight,h=window.innerHeight||document.documentElement.clientHeight);const p=u-(d+h);p<=r&&(console.log("🔄 Infinite scroll triggered:",{distanceFromBottom:p,threshold:r,hasNext:i,loading:t,container:a?"container":"window"}),o.current=!0,s(),setTimeout(()=>{o.current=!1},1e3))},[n,t,i,r,s,a]);return m.useEffect(()=>{if(n)return;let d;const u=()=>{clearTimeout(d),d=setTimeout(l,100)},h=a||window,p="scroll",f="touchmove";return h.addEventListener(p,u,{passive:!0}),a||window.addEventListener(f,u,{passive:!0}),()=>{h.removeEventListener(p,u),a||window.removeEventListener(f,u),clearTimeout(d)}},[l,n,a]),{triggerLoadMore:m.useCallback(()=>{!n&&!t&&i&&!o.current&&(console.log("🔄 Manual infinite scroll trigger"),o.current=!0,s(),setTimeout(()=>{o.current=!1},1e3))},[n,t,i,s])}},da=({size:i="md",variant:t="full",className:s="",onClick:r})=>{const a={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"}[i];return e.jsxs("div",{className:`${a} ${s} ${r?"cursor-pointer":""} flex items-center justify-center`,onClick:r,role:r?"button":void 0,tabIndex:r?0:void 0,children:[e.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("circle",{cx:"50",cy:"50",r:"48",fill:"#00F5D4",stroke:"#00F5D4",strokeWidth:"2"}),e.jsx("path",{d:"M 15 15 Q 15 15 35 15 Q 50 15 50 30 Q 50 50 35 50 L 15 50 Q 15 50 15 85 Q 15 85 35 85 Q 85 85 85 50 Q 85 15 50 15 L 35 15 Z",fill:"#7B2FF7"}),e.jsxs("g",{fill:"white",children:[e.jsx("rect",{x:"22",y:"25",width:"6",height:"28"}),e.jsx("rect",{x:"22",y:"25",width:"18",height:"5"}),e.jsx("rect",{x:"22",y:"36",width:"14",height:"4"})]}),e.jsx("g",{fill:"white",transform:"translate(45, 15)",children:e.jsx("path",{d:"M 15 10 Q 5 10 5 20 L 5 30 Q 5 40 15 40 L 25 40 L 25 35 L 15 35 Q 10 35 10 30 L 10 20 Q 10 15 15 15 L 25 15 L 25 10 Z"})})]}),t==="full"&&i!=="sm"&&e.jsx("span",{className:"ml-2 font-bold text-gray-900 text-lg",children:"Fan Club Z"})]})},lh=rt((i,t)=>({positions:{},saveScrollPosition:(s,r)=>{i(n=>({positions:{...n.positions,[s]:{path:s,scrollY:r,timestamp:Date.now()}}}))},getScrollPosition:s=>{const r=t().positions[s];return r&&Date.now()-r.timestamp<10*60*1e3?r.scrollY:null},clearOldPositions:()=>{const s=Date.now(),r=10*60*1e3;i(n=>({positions:Object.fromEntries(Object.entries(n.positions).filter(([,a])=>s-a.timestamp<r))}))}})),ch=(i,t={})=>{const[s]=xe(),{saveScrollPosition:r,getScrollPosition:n}=lh(),a=m.useRef(""),{saveOnUnmount:o=!0,restoreOnMount:l=!0,preserveFor:c=10,threshold:d=50}=t,u=m.useCallback(()=>i?.current?i.current:document.querySelector("[data-scroll-container]")||document.documentElement,[i]),h=m.useCallback(()=>{const g=u(),x=g===document.documentElement?window.pageYOffset||document.documentElement.scrollTop:g.scrollTop;x>d&&(console.log(`💾 Saving scroll position for ${s}: ${x}px`),r(s,x))},[s,d,r,u]),p=m.useCallback(()=>{const g=u(),x=n(s);return x!==null&&x>0?(console.log(`🔄 Restoring scroll position for ${s}: ${x}px`),setTimeout(()=>{g===document.documentElement?window.scrollTo({top:x,behavior:"smooth"}):g.scrollTo({top:x,behavior:"smooth"})},100),!0):!1},[s,n,u]),f=m.useCallback(g=>{const x=u(),y=x===document.documentElement?window.pageYOffset||document.documentElement.scrollTop:x.scrollTop,b=g||s;y>d&&(console.log(`💾 Manually saving scroll for ${b}: ${y}px`),r(b,y))},[s,d,r,u]);return m.useEffect(()=>{let g;return l&&(g=setTimeout(()=>{p()},50)),()=>{g&&clearTimeout(g),o&&h()}},[l,o,p,h]),m.useEffect(()=>{a.current&&a.current!==s&&console.log(`🔄 Location changed from ${a.current} to ${s}`),a.current=s},[s]),{saveScroll:f,restoreScroll:p,saveCurrentScroll:h}},ua=ue.memo(function({selectedCategory:t,onSelect:s}){const r=[{id:"all",label:"All",icon:"🌟"},{id:"sports",label:"Sports",icon:"⚽"},{id:"pop_culture",label:"Pop Culture",icon:"🎬"},{id:"custom",label:"Custom",icon:"✨"},{id:"politics",label:"Politics",icon:"🗳️"},{id:"crypto",label:"Crypto",icon:"₿"},{id:"tech",label:"Tech",icon:"💻"},{id:"finance",label:"Finance",icon:"📈"}];return e.jsx("div",{className:"category-filters bg-white border-b border-gray-100 px-4 py-3","data-tour-id":"category-filters",children:e.jsx("div",{className:"category-filters-container overflow-x-auto -mx-2 px-2",children:e.jsx("div",{className:"category-filters-flex flex gap-2 pb-1",children:r.map(n=>e.jsx(P.button,{onClick:()=>s(n.id),className:`
                category-pill flex-shrink-0 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium
                transition-all duration-200 whitespace-nowrap
                ${t===n.id?"active bg-purple-500 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
              `,whileTap:{scale:.96},children:e.jsx("span",{children:n.label})},n.id))})})})});ua.displayName="CategoryFilters";const ha=ue.memo(function({user:t,stats:s,searchQuery:r,onSearchChange:n,onNavigateToProfile:a}){return e.jsxs("div",{className:"bg-white border-b border-gray-100 sticky top-0 z-50",children:[e.jsx("div",{className:"h-11"}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(da,{size:"md",variant:"icon"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Discover"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Find your next winning prediction"})]})]}),e.jsx("button",{onClick:a,className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-400 to-purple-500 flex items-center justify-center text-white font-semibold shadow-lg",children:t?.email?.[0]?.toUpperCase()||"U"})]}),e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-purple-50 to-emerald-50 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"LIVE MARKETS"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["$",s?.totalVolume||"0"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Volume"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:s?.activePredictions||"0"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Live"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:s?.totalUsers||"0"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Players"})]})]})]}),e.jsxs("div",{className:"relative","data-tour-id":"search-bar",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Un,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search predictions...",value:r,onChange:o=>n(o.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:bg-white focus:ring-2 focus:ring-purple-500 focus:outline-none transition-all"})]})]})]})});ha.displayName="MobileHeader";const ma=ue.memo(function({onNavigateToProfile:t,onNavigateToPrediction:s}){const{user:r}=oe(),{predictions:n,loading:a,loadingMore:o,pagination:l,filters:c,refreshPredictions:d,loadMorePredictions:u,setFilters:h}=at(),[p,f]=m.useState(null),[g,x]=m.useState(!1),y=m.useRef(null),{saveScroll:b}=ch(y,{saveOnUnmount:!0,restoreOnMount:!0,preserveFor:15,threshold:100}),[v,j]=m.useState({totalVolume:"0",activePredictions:0,totalUsers:"0",rawVolume:0,rawUsers:0}),k=m.useCallback(async()=>{try{const{getApiUrl:I}=await Nt(()=>Promise.resolve().then(()=>vc),void 0),N=await fetch(`${I()}/api/v2/predictions/stats/platform`);if(N.ok){const z=await N.json();z.success&&(j(z.data),console.log("✅ Platform stats fetched:",z.data))}else console.error("Failed to fetch platform stats:",N.status)}catch(I){console.error("Error fetching platform stats:",I)}},[]);oh({hasNext:l.hasNext,loading:o,onLoadMore:()=>{console.log("🔄 Infinite scroll triggered in DiscoverPage:",{hasNext:l.hasNext,loading:o,currentPage:l.page,total:l.total}),u()},threshold:300,container:y.current}),m.useEffect(()=>{d(),k()},[d,k]);const L=m.useMemo(()=>({totalVolume:v.totalVolume,activePredictions:v.activePredictions,totalUsers:v.totalUsers}),[v]),C=m.useMemo(()=>!n||!Array.isArray(n)?(console.log("🔍 DiscoverPage Debug - No valid predictions array:",n),[]):(console.log(`🔍 DiscoverPage Debug - Displaying ${n.length} predictions`),n.filter(I=>!I||!I.id||!I.title?(console.warn("⚠️ DiscoverPage: Invalid prediction object:",I),!1):!0)),[n]),$=m.useCallback(I=>{f(I),x(!0)},[]),J=m.useCallback(I=>{b("/discover"),s?s(I):window.location.href=`/prediction/${I}`},[s,b]),V=m.useCallback(I=>{Y.success("Prediction liked!")},[]),ee=m.useCallback(I=>{b("/discover"),J(I)},[J,b]),q=m.useCallback(I=>{const N=`Check out this prediction: ${I.title}`,z=`${window.location.origin}/prediction/${I.id}`;navigator.share?navigator.share({title:I.title,text:N,url:z}).catch(console.error):navigator.clipboard.writeText(`${N}
${z}`).then(()=>Y.success("Link copied to clipboard!")).catch(()=>Y.error("Failed to copy link"))},[]),F=m.useCallback(I=>{console.log("🔍 Search query changed:",I),h({search:I})},[h]),O=m.useCallback(I=>{console.log("📂 Category changed:",I),h({category:I})},[h]),w=m.useCallback(()=>{x(!1),f(null)},[]);return a&&(!n||n.length===0)?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-100",children:[e.jsx("div",{className:"h-11"}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24 mb-2 loading-skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 loading-skeleton"})]}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full loading-skeleton"})]}),e.jsxs("div",{className:"bg-gray-200 rounded-2xl p-4 mb-4 loading-skeleton",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-20 mb-3 loading-skeleton"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-16 mx-auto loading-skeleton"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-12 mx-auto loading-skeleton"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-14 mx-auto loading-skeleton"})]})]})]}),e.jsx("div",{className:"h-12 bg-gray-200 rounded-xl loading-skeleton"})]})]}),e.jsx("div",{className:"px-4 py-3 bg-white border-b border-gray-100",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:[1,2,3,4,5,6].map(I=>e.jsx("div",{className:"h-8 bg-gray-200 rounded-full w-20 flex-shrink-0 loading-skeleton"},I))})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"px-4 mb-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mb-2 loading-skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 loading-skeleton"})]}),e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(I=>e.jsx(Zu,{},I))})]})]}):e.jsxs("div",{ref:y,className:"discover-page content-with-bottom-nav","data-scroll-container":!0,style:{position:"relative",zIndex:1,overflowY:"auto",height:"100vh"},children:[e.jsx("div",{className:"discover-header",children:e.jsx("div",{className:"header-content",children:e.jsx(ha,{user:r,stats:L,searchQuery:c.search,onSearchChange:F,onNavigateToProfile:t||(()=>{})})})}),e.jsx("div",{className:"category-filters-wrapper",style:{position:"relative",zIndex:45},children:e.jsx(ua,{selectedCategory:c.category,onSelect:O})}),e.jsxs("div",{className:"prediction-cards-container",children:[e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"px-4 mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-1","data-tour-id":"discover-list",children:[c.category==="all"?"All Predictions":`${c.category} Predictions`,c.search&&` - "${c.search}"`]}),l.total>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",C.length," of ",l.total," predictions",l.hasNext&&" • Scroll for more"]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(fe,{mode:"wait",children:C.length>0?e.jsxs(e.Fragment,{children:[C.map((I,N)=>!I||!I.id?(console.warn("⚠️ DiscoverPage: Skipping invalid prediction at index",N),null):e.jsx(Yu,{prediction:I,variant:"compact",onPredict:()=>$(I),onLike:()=>V(I.id),onComment:()=>ee(I.id),onShare:()=>q(I)},`${I.id}-${N}`)),o&&e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:[e.jsx(pt,{className:"w-6 h-6 animate-spin text-purple-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading more predictions..."})]}),l.hasNext&&!o&&e.jsxs(P.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-6",children:[e.jsxs("button",{onClick:()=>{console.log("🔄 Manual load more triggered"),u()},className:"bg-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors",children:["Load More (",l.total-C.length," remaining)"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Page ",l.page," • ",C.length,"/",l.total]})]}),!l.hasNext&&!o&&C.length>10&&e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"🎉 You've seen all predictions!"})})]}):e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center py-12 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Oe,{size:24,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No predictions found"}),e.jsx("p",{className:"text-gray-600",children:c.search?`No predictions match "${c.search}"`:a?"Loading predictions...":"Try adjusting your filters or check back later"}),!a&&!c.search&&e.jsx("button",{onClick:()=>d(!0),className:"mt-4 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:"Refresh Predictions"})]})})})]}),e.jsx(ah,{prediction:p,isOpen:g,onClose:w})]})});ma.displayName="DiscoverPage";const Wt=rt((i,t)=>({approvedSources:[],settlementConfigs:{},settlements:{},playerAcceptances:{},disputes:{},auditTimeline:{},loading:!1,error:null,selectedSource:null,settlementModalOpen:!1,disputeModalOpen:!1,fetchApprovedSources:async s=>{i({loading:!0,error:null});try{let r=W.from("approved_sources").select("*").eq("status","approved").order("name");s&&(r=r.eq("category",s));const{data:n,error:a}=await r;if(a)throw a;i({approvedSources:n||[]})}catch(r){console.error("Error fetching approved sources:",r),i({error:"Failed to fetch approved sources"})}finally{i({loading:!1})}},createSettlementConfig:async(s,r)=>{i({loading:!0,error:null});try{const{data:n,error:a}=await W.from("settlement_configs").insert({prediction_id:s,method:r.method||"manual",primary_source_id:r.primary_source_id,backup_source_id:r.backup_source_id,rule_text:r.rule_text||"",timezone:r.timezone||"Africa/Lagos",contingencies:r.contingencies||{},risk_flags:r.risk_flags||[],badges:r.badges||[]}).select().single();if(a)throw a;i(o=>({settlementConfigs:{...o.settlementConfigs,[s]:n}}))}catch(n){console.error("Error creating settlement config:",n),i({error:"Failed to create settlement configuration"})}finally{i({loading:!1})}},fetchSettlement:async s=>{i({loading:!0,error:null});try{const{data:r,error:n}=await W.from("settlements").select("*").eq("prediction_id",s).single();if(n&&n.code!=="PGRST116")throw n;r&&i(a=>({settlements:{...a.settlements,[s]:r}}))}catch(r){console.error("Error fetching settlement:",r),i({error:"Failed to fetch settlement data"})}finally{i({loading:!1})}},updateSettlementState:async(s,r,n,a)=>{i({loading:!0,error:null});try{const{data:o,error:l}=await W.rpc("update_settlement_state",{prediction_uuid:s,new_state:r,outcome_val:n,proof_data:a||{}});if(l)throw l;await t().fetchSettlement(s)}catch(o){console.error("Error updating settlement state:",o),i({error:"Failed to update settlement state"})}finally{i({loading:!1})}},acceptOutcome:async s=>{i({loading:!0,error:null});try{const{data:{user:r}}=await W.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:n}=await W.rpc("record_player_acceptance",{prediction_uuid:s,user_uuid:r.id,action_val:"accepted"});if(n)throw n;await t().fetchPlayerAcceptances(s)}catch(r){console.error("Error accepting outcome:",r),i({error:"Failed to accept outcome"})}finally{i({loading:!1})}},createDispute:async(s,r,n)=>{i({loading:!0,error:null});try{const{data:{user:a}}=await W.auth.getUser();if(!a)throw new Error("User not authenticated");const{error:o}=await W.rpc("create_dispute",{prediction_uuid:s,user_uuid:a.id,reason_val:r,evidence_data:n||[]});if(o)throw o;await t().fetchDisputes(s)}catch(a){console.error("Error creating dispute:",a),i({error:"Failed to create dispute"})}finally{i({loading:!1})}},fetchPlayerAcceptances:async s=>{try{const{data:r,error:n}=await W.from("player_acceptances").select("*").eq("prediction_id",s).order("timestamp",{ascending:!1});if(n)throw n;i(a=>({playerAcceptances:{...a.playerAcceptances,[s]:r||[]}}))}catch(r){console.error("Error fetching player acceptances:",r)}},fetchDisputes:async s=>{try{const{data:r,error:n}=await W.from("disputes").select("*").eq("prediction_id",s).order("opened_at",{ascending:!1});if(n)throw n;i(a=>({disputes:{...a.disputes,[s]:r||[]}}))}catch(r){console.error("Error fetching disputes:",r)}},fetchAuditTimeline:async s=>{try{const{data:r,error:n}=await W.from("audit_timeline").select("*").eq("prediction_id",s).order("timestamp",{ascending:!1});if(n)throw n;i(a=>({auditTimeline:{...a.auditTimeline,[s]:r||[]}}))}catch(r){console.error("Error fetching audit timeline:",r)}},setSelectedSource:s=>i({selectedSource:s}),setSettlementModalOpen:s=>i({settlementModalOpen:s}),setDisputeModalOpen:s=>i({disputeModalOpen:s}),clearError:()=>i({error:null})})),dh=({onNavigateBack:i})=>{const[t,s]=m.useState(1),[r,n]=m.useState(!1),[a,o]=m.useState(!1),{createPrediction:l}=at(),{user:c,isAuthenticated:d}=oe(),[,u]=xe();m.useEffect(()=>{Ot({delay:200})},[]);const[h,p]=m.useState(""),[f,g]=m.useState(""),[x,y]=m.useState(""),[b,v]=m.useState("binary"),[j,k]=m.useState([{id:"1",label:"Yes"},{id:"2",label:"No"}]),[L,C]=m.useState(""),[$,J]=m.useState("1"),[V,ee]=m.useState("1000"),[q,F]=m.useState("manual"),[O,w]=m.useState(!1),[I,N]=m.useState(null),[z,R]=m.useState(null),[S,E]=m.useState(""),[D,T]=m.useState("Africa/Lagos"),[A,_]=m.useState({postponed:"auto_void",source_down:"use_backup"}),K=[{id:"sports",label:"Sports",icon:"⚽",gradient:"from-orange-500 to-red-500"},{id:"politics",label:"Politics",icon:"🏛️",gradient:"from-blue-500 to-indigo-500"},{id:"entertainment",label:"Entertainment",icon:"🎬",gradient:"from-purple-500 to-pink-500"},{id:"crypto",label:"Crypto",icon:"₿",gradient:"from-yellow-500 to-orange-500"},{id:"tech",label:"Technology",icon:"💻",gradient:"from-purple-500 to-teal-500"},{id:"custom",label:"Custom",icon:"⚡",gradient:"from-gray-500 to-gray-600"}],se=[{id:"binary",label:"Yes/No",description:"Simple binary outcome prediction",icon:"🎯"},{id:"multiple",label:"Multiple Choice",description:"Multiple possible outcomes",icon:"🎲"}],re=m.useCallback(()=>{const U=(j.length+1).toString();k(le=>[...le,{id:U,label:""}])},[j.length]),$e=m.useCallback(U=>{k(le=>le.filter(Ne=>Ne.id!==U))},[]),ke=m.useCallback((U,le)=>{k(Ne=>Ne.map(be=>be.id===U?{...be,label:le}:be))},[]),ie=m.useCallback(U=>{switch(U){case 1:return!!(h.trim()&&x);case 2:return!!(b&&j.every(le=>le.label.trim()));case 3:return!!(L&&$);case 4:return!0;default:return!0}},[h,x,b,j,L,$]),Le=m.useCallback(()=>{ie(t)&&t<4&&(s(t+1),Ot({delay:150}))},[t,ie]),_e=m.useCallback(()=>{t>1?(s(t-1),Ot({delay:150})):i&&i()},[t,i]),we=m.useCallback(async()=>{if(!ie(4)){G.error("Please fill in all required fields");return}n(!0);try{if(!h.trim())throw new Error("Title is required");if(!x)throw new Error("Category is required");if(!L)throw new Error("Entry deadline is required");const U=new Date(L);if(U<=new Date)throw new Error("Entry deadline must be in the future");if(!d||!c?.id)throw new Error("You must be logged in to create predictions");const le={title:h.trim(),description:f.trim()||void 0,category:x,type:b,options:j.filter(be=>be.label.trim()).map(be=>({id:be.id,label:be.label.trim(),totalStaked:0,currentOdds:2})),entryDeadline:U,stakeMin:Math.max(1,parseFloat($)||100),stakeMax:V?Math.max(parseFloat($)||100,parseFloat(V)):void 0,settlementMethod:q,isPrivate:O,creatorId:c.id};if(le.options.length<2)throw new Error("At least 2 prediction options are required");console.log("Creating prediction with data:",le);const Ne=await l(le);if(console.log("Prediction created successfully!",Ne),q==="auto"&&Ne)try{const{createSettlementConfig:be}=Wt.getState();await be(Ne.id,{method:"web",primary_source_id:I?.id,backup_source_id:z?.id,rule_text:S||`Check if ${h} by ${L}`,timezone:D,contingencies:A}),console.log("Settlement configuration created successfully!")}catch(be){console.error("Failed to create settlement configuration:",be)}G.success("🎉 Prediction created successfully!"),o(!0),setTimeout(()=>{s(1),p(""),g(""),y(""),v("binary"),k([{id:"1",label:"Yes"},{id:"2",label:"No"}]),C(""),J("100"),ee("10000"),F("manual"),w(!1),o(!1),n(!1),i&&(i(),setTimeout(()=>{u("/predictions")},100))},2e3)}catch(U){console.error("Failed to create prediction:",U);const le=U instanceof Error?U.message:"Failed to create prediction. Please try again.";G.error(le),n(!1)}},[ie,h,x,L,f,b,j,$,V,q,O,l,i,u]);return a?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-teal-100 flex items-center justify-center px-6",children:e.jsxs(P.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-white rounded-3xl p-8 text-center shadow-2xl border border-teal-200",children:[e.jsx(P.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200,damping:10},className:"w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(_r,{size:32,className:"text-white"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Prediction Created!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your prediction has been successfully created and is now live."}),e.jsx("div",{className:"text-sm text-teal-600 font-medium",children:"Redirecting to My Predictions..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 pb-20 create-prediction-page",children:[e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600 via-green-700 to-teal-600"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 via-transparent to-purple-600/10"}),e.jsx("div",{className:"absolute top-0 right-1/3 w-72 h-72 bg-white/10 rounded-full blur-3xl animate-pulse"}),e.jsx("div",{className:"absolute bottom-0 left-1/3 w-72 h-72 bg-white/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),e.jsxs("div",{className:"relative z-10 px-6 pt-14 pb-8",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx(P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:_e,className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white",children:e.jsx(Ct,{size:20})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Create Prediction"}),e.jsxs("p",{className:"text-green-100",children:["Step ",t," of 4"]})]})]}),e.jsx("div",{className:"bg-white/20 rounded-full h-2 mb-6",children:e.jsx(P.div,{initial:{width:0},animate:{width:`${t/4*100}%`},transition:{duration:.5},className:"h-full bg-white rounded-full"})})]})]}),e.jsx("div",{className:"px-6 -mt-4 pb-8 relative z-20",children:e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/90 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-2xl p-6",children:[e.jsxs(fe,{mode:"wait",initial:!1,children:[t===1&&e.jsxs(P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-teal-600 rounded-2xl flex items-center justify-center",children:e.jsx(Ws,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Basic Information"}),e.jsx("p",{className:"text-gray-600",children:"Tell us about your prediction"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Prediction Title *"}),e.jsx("input",{type:"text",value:h,onChange:U=>p(U.target.value),placeholder:"Will Bitcoin reach $100,000 by end of 2024?",className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200 text-gray-900 placeholder-gray-500"})]}),e.jsxs("div",{className:"textarea-container",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description (Optional)"}),e.jsx("textarea",{value:f,onChange:U=>g(U.target.value),placeholder:"Provide additional context and rules for your prediction...",rows:4,className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200 text-gray-900 placeholder-gray-500 resize-none"})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Category *"}),e.jsx("div",{className:"flex flex-wrap gap-3",children:K.map(U=>e.jsxs(P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>y(U.id),className:`motion-button pill-category px-4 py-2.5 rounded-full text-sm font-semibold transition-all flex items-center gap-2 min-h-[40px] ${x===U.id?`bg-gradient-to-r ${U.gradient} text-white shadow-lg`:"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"}`,children:[e.jsx("span",{className:"text-base",children:U.icon}),e.jsx("span",{children:U.label})]},U.id))})]})]})]},"step1"),t===2&&e.jsxs(P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center",children:e.jsx(Ut,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Prediction Setup"}),e.jsx("p",{className:"text-gray-600",children:"Configure your prediction options"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Prediction Type *"}),e.jsx("div",{className:"space-y-3",children:se.map(U=>e.jsx(P.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>{v(U.id),U.id==="binary"?k([{id:"1",label:"Yes"},{id:"2",label:"No"}]):U.id==="multiple"&&k([{id:"1",label:""},{id:"2",label:""},{id:"3",label:""}])},className:`motion-button w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${b===U.id?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-2xl",children:U.icon}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:U.label}),e.jsx("p",{className:"text-sm text-gray-600",children:U.description})]})]})},U.id))})]}),(b==="binary"||b==="multiple")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Prediction Options *"}),e.jsxs("div",{className:"space-y-3",children:[j.map((U,le)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"input-container flex-1",children:e.jsx("input",{type:"text",value:U.label,onChange:Ne=>ke(U.id,Ne.target.value),placeholder:`Option ${le+1}`,className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all duration-200"})}),b==="multiple"&&j.length>2&&e.jsx(P.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>$e(U.id),className:"motion-button w-10 h-10 bg-red-100 text-red-600 rounded-xl flex items-center justify-center hover:bg-red-200 transition-colors",children:e.jsx(ge,{size:18})})]},U.id)),b==="multiple"&&j.length<6&&e.jsxs(P.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:re,className:"motion-button w-full p-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-all duration-200 flex items-center justify-center gap-2",children:[e.jsx(kt,{size:18}),e.jsx("span",{children:"Add Option"})]})]})]})]})]},"step2"),t===3&&e.jsxs(P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center",children:e.jsx(st,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Settings & Launch"}),e.jsx("p",{className:"text-gray-600",children:"Final configuration details"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Entry Deadline *"}),e.jsx("input",{type:"datetime-local",value:L,onChange:U=>C(U.target.value),min:new Date().toISOString().slice(0,16),className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Minimum Stake ($)"}),e.jsx("input",{type:"number",value:$,onChange:U=>J(U.target.value),placeholder:"100",min:"1",className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200"})]}),e.jsxs("div",{className:"input-container",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Maximum Stake ($)"}),e.jsx("input",{type:"number",value:V,onChange:U=>ee(U.target.value),placeholder:"100000",min:$||"1",className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Settlement Method"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(P.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>F("manual"),className:`w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${q==="manual"?"border-teal-500 bg-teal-50":"border-gray-200 bg-white hover:border-teal-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx(wt,{size:16,className:"text-teal-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Manual Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You resolve the prediction manually"})]})]})}),e.jsx(P.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>F("auto"),className:`w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${q==="auto"?"border-teal-500 bg-teal-50":"border-gray-200 bg-white hover:border-teal-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(Ut,{size:16,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Automatic Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Resolved automatically when possible"})]})]})})]})]}),e.jsx("div",{className:"bg-gray-50 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Private Prediction"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Only people with link can participate"})]}),e.jsx(P.button,{whileTap:{scale:.95},onClick:()=>w(!O),className:`relative w-12 h-6 rounded-full transition-all duration-200 ${O?"bg-teal-500":"bg-gray-300"}`,children:e.jsx(P.div,{animate:{x:O?24:2},transition:{type:"spring",stiffness:500,damping:30},className:"absolute top-1 w-4 h-4 bg-white rounded-full shadow"})})]})})]})]},"step3"),t===4&&e.jsxs(P.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center",children:e.jsx(_r,{size:24,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Preview & Confirm"}),e.jsx("p",{className:"text-gray-600",children:"Review your prediction before publishing"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Prediction Preview"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Title"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:h})]}),f&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Description"}),e.jsx("p",{className:"text-gray-700",children:f})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Category"}),e.jsx("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:K.find(U=>U.id===x)?.label||x})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Options"}),e.jsx("div",{className:"space-y-2",children:j.map((U,le)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Option ",le+1,":"]}),e.jsx("span",{className:"font-semibold text-gray-900",children:U.label})]},U.id))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Stake Limits"}),e.jsxs("p",{className:"text-gray-900",children:["$",$," - $",V]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Deadline"}),e.jsx("p",{className:"text-gray-900",children:new Date(L).toLocaleString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Settlement"}),e.jsx("p",{className:"text-gray-900 capitalize",children:q})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Privacy"}),e.jsx("p",{className:"text-gray-900",children:O?"Private":"Public"})]})]})]}),e.jsx("div",{className:"bg-teal-50 border border-teal-200 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(et,{size:20,className:"text-teal-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-teal-800",children:"Ready to Publish"}),e.jsx("p",{className:"text-sm text-teal-700",children:'Your prediction looks good! Click "Create Prediction" to publish it.'})]})]})})]})]},"step4")]}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200",children:[e.jsx(P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:_e,className:"px-6 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all duration-200",children:t===1?"Cancel":"Back"}),t<4?e.jsx(P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Le,disabled:!ie(t),className:`px-8 py-3 font-semibold rounded-xl shadow-lg transition-all duration-200 ${ie(t)?"bg-gradient-to-r from-purple-500 to-teal-600 text-white shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:t===3?"Preview":"Continue"}):e.jsx(P.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:we,disabled:!ie(4)||r,className:`px-8 py-3 font-semibold rounded-xl shadow-lg transition-all duration-200 flex items-center gap-2 ${ie(4)&&!r?"bg-gradient-to-r from-purple-500 to-teal-600 text-white shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):"Create Prediction"})]})]})})]})},uh=({isOpen:i,onClose:t,onConfirm:s,title:r,message:n,confirmText:a="Confirm",cancelText:o="Cancel",variant:l="danger",isLoading:c=!1})=>{const u=(()=>{switch(l){case"danger":return{icon:e.jsx(Se,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"};case"warning":return{icon:e.jsx(Se,{className:"w-6 h-6 text-amber-600"}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white",border:"border-amber-200"};case"info":return{icon:e.jsx(Se,{className:"w-6 h-6 text-blue-600"}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",border:"border-blue-200"};default:return{icon:e.jsx(Se,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"}}})(),h=()=>{c||s()},p=()=>{c||t()};return e.jsx(fe,{mode:"wait",children:i&&e.jsxs("div",{className:"fixed inset-0 z-[12000] flex items-center justify-center p-4",children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50",onClick:p}),e.jsxs(P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${u.border}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u.icon,e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:r})]}),e.jsx("button",{onClick:p,disabled:c,className:"p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(ge,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-600 leading-relaxed",children:n})}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:p,disabled:c,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50",children:o}),e.jsx("button",{onClick:h,disabled:c,className:`flex-1 px-4 py-3 rounded-xl font-medium transition-colors disabled:opacity-50 ${u.confirmButton}`,children:c?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):a})]})]})]})})},hh=()=>{const[i,t]=m.useState(!1),[s,r]=m.useState(null),n=m.useCallback(async o=>{t(!0),r(null);try{console.log("🔨 Starting manual settlement:",o);const l=await fetch(`${de()}/api/v2/settlement/manual`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(o)});if(console.log("📡 Settlement response status:",l.status),!l.ok){const d=await l.json();return console.error("❌ Settlement failed:",d),r(d.message||"Settlement failed"),null}const c=await l.json();return console.log("✅ Settlement successful:",c),c}catch(l){return console.error("❌ Settlement network error:",l),r("Network error during settlement"),null}finally{t(!1)}},[]),a=m.useCallback(async o=>{try{console.log("📊 Fetching settlement info for:",o);const l=await fetch(`${de()}/api/v2/settlement/prediction/${o}`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!l.ok){if(l.status===404)return null;throw new Error(`Failed to fetch settlement: ${l.status}`)}const c=await l.json();return console.log("📊 Settlement info fetched:",c),c.data}catch(l){return console.error("❌ Error fetching settlement info:",l),null}},[]);return{settleManually:n,getSettlementInfo:a,isSettling:i,settlementError:s,clearError:()=>r(null)}},pa=m.forwardRef(({className:i,...t},s)=>e.jsx("textarea",{className:Ae("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:s,...t}));pa.displayName="Textarea";const mh=({isOpen:i,onClose:t,prediction:s,onSettlementComplete:r})=>{const[n,a]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(""),[u,h]=m.useState(!1),[p,f]=m.useState(s.options||[]),{settleManually:g,isSettling:x,settlementError:y,clearError:b}=hh();Us();const v=async()=>{if(!n){G.error("Please select a winning option");return}if(!c.trim()){G.error("Please provide a reason for settlement");return}try{await g({predictionId:s.id,winningOptionId:n,proofUrl:o.trim()||void 0,reason:c.trim(),userId:s.creator_id||"325343a7-0a32-4565-8059-7c0d9d3fed1b"})&&(G.success("Prediction settled successfully!"),console.log("🔔 Settlement completed, participants will be notified individually"),h(!1),t(),r&&r())}catch(q){console.error("Settlement error:",q)}},j=()=>{a(""),l(""),d(""),h(!1),b(),t()},{fetchPredictionById:k}=at();ue.useEffect(()=>{let q=!0;return(async()=>{try{if(s.options&&s.options.length>0){if(!q)return;f(s.options),console.log("✅ SettlementModal: Using options from props:",s.options.length);return}const O=await k(String(s.id));q&&O?.options?.length?(f(O.options),console.log("✅ SettlementModal: Loaded options via fetch:",O.options.length)):q&&console.warn("⚠️ SettlementModal: No options available for prediction:",s.id)}catch(O){console.warn("⚠️ SettlementModal: Failed to ensure options:",O)}})(),()=>{q=!1}},[s.id]);const L=p.find(q=>q.id===n),C=s.pool_total||0,$=s.participant_count||0,J=C*2.5/100,V=C*1/100,ee=C-J-V;return i?e.jsx(fe,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[110] p-4",children:e.jsx(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Confirm Settlement"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:x,children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg p-4 border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Pr,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Settlement Summary"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winning Option:"}),e.jsx("span",{className:"font-medium text-gray-900",children:L?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Pool:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",C.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Platform Fee (2.5%):"}),e.jsxs("span",{className:"text-gray-900",children:["$",J.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Creator Fee (1.0%):"}),e.jsxs("span",{className:"text-gray-900",children:["$",V.toFixed(2)]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winner Payout:"}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:["$",ee.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Participants:"}),e.jsx("span",{className:"text-gray-900",children:$})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-amber-600 flex-shrink-0"}),e.jsxs("p",{className:"text-amber-800 text-sm",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone. All participants will be notified of the settlement result."]})]})}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:y})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(bt,{variant:"outline",onClick:()=>h(!1),disabled:x,children:"Back"}),e.jsx(bt,{onClick:v,disabled:x,className:"bg-emerald-600 hover:bg-emerald-700",children:x?"Settling...":"Confirm Settlement"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Settle Prediction"}),e.jsx("button",{onClick:j,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6 pb-40",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsxs("span",{children:["$",C.toFixed(2)," pool"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsxs("span",{children:[$," participants"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Winning Option *"}),e.jsx("div",{className:"space-y-2",children:p.length===0?e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"w-5 h-5 text-yellow-600"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"No Options Available"})]}),e.jsx("p",{className:"text-yellow-700 text-sm mb-3",children:"This prediction doesn't have any options to select from. This might be because:"}),e.jsxs("ul",{className:"text-yellow-700 text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"• The prediction data is still loading"}),e.jsx("li",{children:"• The prediction was created without options"}),e.jsx("li",{children:"• There was an error fetching the prediction details"})]}),e.jsx("p",{className:"text-yellow-600 text-xs mt-3",children:"Please close this modal and try opening it again. If the problem persists, contact support."})]}):p.map(q=>{const F=n===q.id,O=q.total_staked||0,w=C>0?O/C*100:0;return e.jsx(P.button,{onClick:()=>a(q.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${F?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${F?"text-emerald-700":"text-gray-900"}`,children:q.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[w.toFixed(0),"% • $",O.toFixed(2)," staked"]})]}),F&&e.jsx(_r,{className:"w-5 h-5 text-emerald-500"})]})},q.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof URL (optional)"}),e.jsx(Xr,{type:"url",placeholder:"https://example.com/proof",value:o,onChange:q=>l(q.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to evidence supporting this outcome (news article, official result, etc.)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Settlement Reason *"}),e.jsx(pa,{placeholder:"Explain why this option is the winner...",value:c,onChange:q=>d(q.target.value),className:"w-full h-20 resize-none",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/500 characters"]})]}),y&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:y})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(bt,{variant:"outline",onClick:j,disabled:x,children:"Cancel"}),e.jsx(bt,{onClick:()=>h(!0),disabled:!n||!c.trim()||x,className:"bg-emerald-600 hover:bg-emerald-700",children:"Continue"})]})]})})})}):null},ph=({isOpen:i,onClose:t,predictionId:s,predictionTitle:r,onResolutionComplete:n})=>{const[a,o]=m.useState(null),[l,c]=m.useState(!0),[d,u]=m.useState(!1),[h,p]=m.useState(null),[f,g]=m.useState(""),[x,y]=m.useState(""),{user:b}=oe();m.useEffect(()=>{i&&v()},[i,s]);const v=async()=>{try{c(!0);const k=await fetch(`${de()}/api/v2/settlement/${s}/disputes`);if(!k.ok)throw new Error("Failed to fetch disputes");const L=await k.json();o(L.data)}catch(k){console.error("Error fetching disputes:",k),Y.error("Failed to load disputes")}finally{c(!1)}},j=async()=>{if(!h||!f.trim()){Y.error("Please select an action and provide a reason");return}try{if(u(!0),!(await fetch(`${de()}/api/v2/settlement/${s}/resolve-disputes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:h,reason:f,newWinningOption:h==="revise"?x:void 0,creatorId:b?.id})})).ok)throw new Error("Failed to resolve disputes");Y.success("Disputes resolved successfully!"),t(),n&&n()}catch(k){console.error("Error resolving disputes:",k),Y.error("Failed to resolve disputes")}finally{u(!1)}};return i?e.jsx(fe,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Dispute Resolution"}),e.jsx("p",{className:"text-sm text-gray-600",children:r})]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(ge,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:l?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-red-500 border-t-transparent rounded-full animate-spin"})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(wt,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Dispute Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Total Disputes:"}),e.jsx("span",{className:"font-medium ml-2",children:a.totalDisputes})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Pending:"}),e.jsx("span",{className:"font-medium ml-2",children:a.pendingDisputes})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Individual Disputes"}),a.disputes.map(k=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:k.user.full_name||k.user.username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(k.created_at).toLocaleDateString()})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${k.status==="pending"?"bg-yellow-100 text-yellow-800":k.status==="resolved"?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"}`,children:k.status})]}),e.jsx("div",{className:"bg-gray-50 rounded p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(vd,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700",children:k.reason})]})})]},k.id))]}),a.pendingDisputes>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Resolution Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("button",{onClick:()=>p("reject"),className:`p-4 border-2 rounded-lg text-left transition-all ${h==="reject"?"border-red-500 bg-red-50":"border-gray-200 hover:border-red-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ge,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Reject Disputes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Maintain original settlement"})]})]})}),e.jsx("button",{onClick:()=>p("revise"),className:`p-4 border-2 rounded-lg text-left transition-all ${h==="revise"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ln,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Revise Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change the winning option"})]})]})}),e.jsx("button",{onClick:()=>p("accept"),className:`p-4 border-2 rounded-lg text-left transition-all ${h==="accept"?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-emerald-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(et,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Accept Disputes & Refund"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Refund all participants"})]})]})})]}),h==="revise"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Winning Option ID"}),e.jsx("input",{type:"text",value:x,onChange:k=>y(k.target.value),placeholder:"Enter the correct winning option ID",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Reason"}),e.jsx("textarea",{value:f,onChange:k=>g(k.target.value),placeholder:"Explain your resolution decision...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:t,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:j,disabled:d||!h||!f.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:d?"Resolving...":"Resolve Disputes"})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No dispute data available"})})})]})})}):null},fh=({isOpen:i,onClose:t,prediction:s,onUpdate:r})=>{const[n,a]=m.useState(s.title||""),[o,l]=m.useState(s.description||""),[c,d]=m.useState(!1),[u,h]=m.useState({}),p=m.useRef(null),f=m.useRef(null);m.useEffect(()=>{i&&(a(s.title||""),l(s.description||""),h({}),setTimeout(()=>p.current?.focus(),150))},[i,s.title,s.description]),m.useEffect(()=>{const b=f.current;b&&(b.style.height="auto",b.style.height=Math.min(b.scrollHeight,120)+"px")},[o]);const g=()=>{const b={};return n.trim()?n.trim().length<3?b.title="Title must be at least 3 characters":n.trim().length>200&&(b.title="Title must be less than 200 characters"):b.title="Title is required",o.trim().length>1e3&&(b.description="Description must be less than 1000 characters"),h(b),Object.keys(b).length===0},x=async()=>{if(!g())return;const b=n.trim(),v=o.trim();if(b===s.title&&v===(s.description||"")){Y.error("No changes detected");return}d(!0);try{const j={};b!==s.title&&(j.title=b),v!==(s.description||"")&&(j.description=v),await r(j),Y.success("Prediction updated successfully!"),t()}catch(j){console.error("Failed to update prediction:",j),Y.error(j instanceof Error?j.message:"Failed to update prediction")}finally{d(!1)}},y=b=>{b.key==="Escape"&&!c?t():b.key==="Enter"&&(b.metaKey||b.ctrlKey)&&!c&&x()};return i?e.jsx(fe,{children:e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4",children:[e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:c?void 0:t}),e.jsxs(P.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",onKeyDown:y,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Gr,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Prediction"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your prediction details"})]})]}),e.jsx("button",{onClick:t,disabled:c,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(ge,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prediction Title *"}),e.jsx("input",{ref:p,type:"text",value:n,onChange:b=>a(b.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${u.title?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Enter prediction title...",disabled:c,maxLength:200}),u.title&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Sr,{className:"w-4 h-4"}),u.title]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[n.length,"/200 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description (Optional)"}),e.jsx("textarea",{ref:f,value:o,onChange:b=>l(b.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${u.description?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Add more details about your prediction...",disabled:c,rows:3,maxLength:1e3,style:{minHeight:"80px",maxHeight:"120px"}}),u.description&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Sr,{className:"w-4 h-4"}),u.description]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[o.length,"/1000 characters"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 border-t border-gray-100",children:[e.jsx("button",{onClick:t,disabled:c,className:"px-6 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx(P.button,{onClick:x,disabled:c||!n.trim()||!!u.title||!!u.description,className:"px-6 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",whileHover:{scale:c?1:1.02},whileTap:{scale:c?1:.98},children:c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):"Update Prediction"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Press ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel or"," ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"⌘ Enter"})," to save"]})})]})]})}):null},gh=({isOpen:i,onClose:t,prediction:s})=>{const[r,n]=m.useState("overview"),[a,o]=m.useState(!0),[l,c]=m.useState(!0),[d,u]=m.useState(!0),[h,p]=m.useState([]),[f,g]=m.useState([]),[x,y]=m.useState(!1),[b,v]=m.useState(!1),[j,k]=m.useState(!1),[L,C]=m.useState(!1),[$,J]=m.useState(!1),[V,ee]=m.useState(!1),[q,F]=m.useState(!1),[O,w]=m.useState(!1),[I,N]=m.useState(!1),[z,R]=m.useState(""),[S,E]=m.useState(s);m.useEffect(()=>{E(s)},[s]);const{updatePrediction:D,deletePrediction:T,closePrediction:A,fetchPredictionActivity:_,fetchPredictionParticipants:K,fetchPredictionById:se,refreshPredictions:re,fetchUserCreatedPredictions:$e,fetchUserPredictionEntries:ke}=at(),{user:ie}=oe(),Le=B=>{if(B.status==="closed"||B.status==="ended")return!0;const M=B.entry_deadline||B.timeRemaining;if(M){if(typeof M=="string"&&M.includes("Ended"))return!0;if(B.entry_deadline){const te=new Date(B.entry_deadline)<=new Date;return B.status==="open"&&te}}return!1},_e=[{id:"overview",label:"Overview",icon:Ns},{id:"settings",label:"Settings",icon:Ut},{id:"participants",label:"Participants",icon:wt}];m.useEffect(()=>{i&&s.id&&we()},[i,s.id]);const we=m.useCallback(async()=>{y(!0);try{console.log("🔄 Loading prediction data for modal:",s.id);const B=await se(String(s.id));B?.options?.length?(console.log("🔄 ManagePredictionModal: Updated prediction with",B.options.length,"options"),Object.assign(s,B),E({...B})):(console.warn("⚠️ ManagePredictionModal: No options found for prediction:",s.id),setTimeout(async()=>{const he=await se(String(s.id));he?.options?.length&&(console.log("🔄 Retry successful: Found",he.options.length,"options"),Object.assign(s,he),E({...he}))},1e3));const[M,te]=await Promise.all([_(String(s.id)).catch(he=>(console.warn("Failed to fetch activity:",he),[])),K(String(s.id)).catch(he=>(console.warn("Failed to fetch participants:",he),[]))]);p(M),g(te),console.log("✅ Modal data loaded successfully")}catch(B){console.error("Failed to load prediction data:",B),Y.error("Failed to load prediction data. Using cached information.")}finally{y(!1)}},[s.id,_,K,se]),U=m.useCallback(async()=>{if(ie?.id)try{console.log("🔄 Refreshing all prediction data..."),await Promise.all([re(!0),$e(ie.id),ke(ie.id),we()]),console.log("✅ All prediction data refreshed")}catch(B){console.error("❌ Error refreshing prediction data:",B)}},[ie?.id,re,$e,ke,we]),le=m.useCallback(async()=>{console.log("❌ Closing modal and triggering data refresh"),await U(),setTimeout(()=>{t()},100)},[t,U]),Ne=()=>{R(s.title),F(!0)},be=async B=>{try{J(!0),console.log("🔧 Updating prediction:",s.id,B),await D(String(s.id),B),await U()}catch(M){throw console.error("Failed to update prediction:",M),M}finally{J(!1)}},Vs=async()=>{k(!0)},qs=()=>{w(!0)},Ht=async()=>{try{J(!0),console.log("🔒 Closing prediction:",s.id),await A(String(s.id)),await U(),Object.assign(s,{status:"closed"}),Y.success("Prediction closed successfully! You can now settle it."),w(!1)}catch(B){console.error("Failed to close prediction:",B),Y.error(B instanceof Error?B.message:"Failed to close prediction")}finally{J(!1)}},De=async()=>{try{const B=`${window.location.origin}/predictions/${s.id}`,M=`Check out this prediction: ${s.title}`;if(navigator.share)try{await navigator.share({title:s.title,text:M,url:B});return}catch(te){console.log("Native sharing cancelled or failed:",te)}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(`${M}
${B}`),Y.success("Link copied to clipboard!");else{const te=document.createElement("textarea");te.value=`${M}
${B}`,document.body.appendChild(te),te.select();try{document.execCommand("copy"),Y.success("Link copied to clipboard!")}catch(he){Y.error("Failed to copy link. Please copy manually."),console.error("execCommand failed:",he)}finally{document.body.removeChild(te)}}}catch(B){console.error("Error sharing prediction:",B),Y.error("Failed to share prediction")}},ds=async()=>{try{v(!0),console.log("⚙️ Saving prediction settings:",s.id),await D(String(s.id),{is_private:!l}),await U(),Y.success("Settings saved successfully!")}catch(B){console.error("Failed to save settings:",B),Y.error("Failed to save settings. Please try again.")}finally{v(!1)}},us=async()=>{try{C(!0),console.log("🗑️ Deleting prediction:",s.id),await T(String(s.id)),await U(),Y.success("Prediction deleted successfully!"),k(!1),le()}catch(B){console.error("Failed to delete prediction:",B),Y.error(B instanceof Error?B.message:"Failed to delete prediction")}finally{C(!1)}},hs=()=>{const B=s.pool_total||s.totalPool||0,M=s.participant_count||s.participants||0,te=s.creator_fee_percentage||s.yourCut||0,he=B*te/100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(st,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Pool"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",B.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(wt,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Participants"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:M})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ns,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Cut"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[te,"%"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(st,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Est. Earnings"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:["$",he.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(P.button,{onClick:Ne,disabled:$||x,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:$||x?1:1.02},whileTap:{scale:$||x?1:.98},children:[$?e.jsx(pt,{className:"w-5 h-5 animate-spin"}):e.jsx(Gr,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Edit Details"})]}),e.jsxs(P.button,{onClick:De,disabled:$||x,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:$||x?1:1.02},whileTap:{scale:$||x?1:.98},children:[e.jsx(Mn,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Share"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(P.button,{onClick:qs,disabled:$||x||s.status!=="open",className:`flex-1 flex items-center justify-center gap-3 px-6 py-4 rounded-2xl font-semibold shadow-lg transition-all duration-200 group ${s.status!=="open"?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-xl"} disabled:opacity-50 disabled:cursor-not-allowed`,whileHover:{scale:$||x||s.status!=="open"?1:1.02},whileTap:{scale:$||x||s.status!=="open"?1:.98},children:[$?e.jsx(pt,{className:"w-5 h-5 animate-spin"}):e.jsx(tt,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:s.status==="open"?"Close Early":"Already Closed"})]}),e.jsxs(P.button,{onClick:()=>ee(!0),disabled:$||x||!Le(s),className:"flex-1 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group border-2 border-emerald-400/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300/30",whileHover:{scale:$||x||!Le(s)?1:1.02},whileTap:{scale:$||x||!Le(s)?1:.98},children:[e.jsx(Ln,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Settle"})]})]})]}),s.status==="disputed"&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-900",children:"⚠️ Settlement Disputed"}),e.jsx("p",{className:"text-red-700",children:"Participants have disputed your settlement. Review and resolve."})]})]}),e.jsx(P.button,{onClick:()=>N(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:"🔍 Manage Disputes"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Recent Activity"}),x?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(pt,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading activity..."})]}):h.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:h.map((ye,Gs)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ye.description}),e.jsx("p",{className:"text-xs text-gray-500",children:ye.timeAgo})]}),ye.amount&&e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:["$",ye.amount.toLocaleString()]})]},`activity-${Gs}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ns,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No activity yet"})]})]})]})},ms=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prediction Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Public Visibility"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow anyone to find and join this prediction"})]}),e.jsx("button",{onClick:()=>c(!l),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${l?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${l?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive updates about this prediction via email"})]}),e.jsx("button",{onClick:()=>o(!a),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${a?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${a?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Auto Close"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically close when deadline is reached"})]}),e.jsx("button",{onClick:()=>u(!d),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${d?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${d?"translate-x-6":"translate-x-1"}`})})]})]})]}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end",children:e.jsxs("button",{onClick:ds,disabled:b,className:"inline-flex items-center justify-center gap-2 px-5 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[b?e.jsx(pt,{className:"w-4 h-4 animate-spin"}):e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Settings"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-4",children:"Danger Zone"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Delete Prediction"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"This action cannot be undone. This will permanently delete the prediction and all associated data."}),e.jsxs("button",{onClick:Vs,disabled:$||x,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(Bn,{className:"w-4 h-4"}),"Delete Prediction"]})]})]})]}),Vt=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Participants (",f.length,")"]}),x?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(pt,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading participants..."})]}):f.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:f.map((B,M)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-purple-600",children:B.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["@",B.username]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Chose: ",B.option," • ",B.timeAgo]})]})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",B.amount.toLocaleString()]})]},`participant-${M}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(wt,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No participants yet"})]})]})});return i?e.jsxs(e.Fragment,{children:[e.jsx(fe,{children:e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4",onClick:B=>{B.target===B.currentTarget&&le()},children:e.jsxs(P.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Manage Prediction"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-1",children:s.title})]}),e.jsx("button",{onClick:le,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ge,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"flex border-b border-gray-200",children:_e.map(B=>{const M=B.icon;return e.jsxs("button",{onClick:()=>n(B.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${r===B.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(M,{className:"w-4 h-4"}),B.label]},B.id)})}),e.jsxs("div",{className:"p-6 pb-40 max-h-[calc(90vh-200px)] overflow-y-auto",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[r==="overview"&&e.jsx(hs,{}),r==="settings"&&e.jsx(ms,{}),r==="participants"&&e.jsx(Vt,{})]})]})})}),j&&e.jsx(uh,{isOpen:j,onClose:()=>k(!1),onConfirm:us,title:"Delete Prediction",message:"Are you sure you want to delete this prediction? This action cannot be undone and all participant data will be lost.",confirmText:"Delete",variant:"danger",isLoading:L}),q&&e.jsx(fh,{isOpen:q,onClose:()=>F(!1),prediction:{id:String(s.id),title:s.title,description:s.description||""},onUpdate:be}),O&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Close Prediction Early"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to close this prediction early? No new participants will be able to join once closed."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors",disabled:$,children:"Cancel"}),e.jsx("button",{onClick:Ht,disabled:$,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-xl hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:$?"Closing...":"Close Early"})]})]})}),V&&e.jsx(mh,{isOpen:V,onClose:()=>ee(!1),prediction:{...S,id:String(S.id),creator_id:ie?.id||"",type:"multi_outcome",stake_min:1,settlement_method:"manual",is_private:!1,platform_fee_percentage:2.5,club_id:void 0,image_url:void 0,tags:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString(),creator:{id:ie?.id||"",username:ie?.username||"",full_name:ie?.full_name||"",avatar_url:ie?.avatar_url||null},options:s.options||[],pool_total:s.pool_total||s.totalPool||0,participant_count:s.participant_count||s.participants||0,entry_deadline:s.entry_deadline||new Date().toISOString()},onSettlementComplete:U}),I&&e.jsx(ph,{isOpen:I,onClose:()=>N(!1),predictionId:String(s.id),predictionTitle:s.title,onResolutionComplete:U})]}):null},xh=({onNavigateToDiscover:i})=>{const[,t]=xe(),{predictions:s,getUserCreatedPredictions:r,fetchUserCreatedPredictions:n,fetchUserPredictionEntries:a,getUserPredictionEntries:o,loading:l}=at(),{user:c,isAuthenticated:d}=oe(),[u,h]=m.useState("Active"),[p,f]=m.useState(!1),[g,x]=m.useState(null),y=(w,I)=>{if(!w)return"Unknown";const N=new Date().getTime(),z=new Date(w).getTime()-N;if(I==="closed")return"Closed";if(I==="settled")return"Settled";if(I==="awaiting_settlement")return"Awaiting Settlement";if(I==="disputed")return"Disputed";if(I==="refunded")return"Refunded";if(I==="ended"||z<=0)return"Ended";const R=Math.floor(z/(1e3*60*60*24)),S=Math.floor(z%(1e3*60*60*24)/(1e3*60*60));return R>0?`${R}d ${S}h`:`${S}h`},b=w=>{if(!w||!w.options)return 68;const I=w.options.reduce((z,R)=>z+(R.total_staked||0),0);if(I===0)return 68;const N=Math.max(...w.options.map(z=>z.total_staked||0));return Math.round(N/I*100)};m.useEffect(()=>{window.scrollTo({behavior:"instant"})},[]),m.useEffect(()=>{if(!c?.id||!d)return;let w=!0,I=!1;const N=setTimeout(()=>{!w||I||(console.log("📊 BetsTab: Fetching data for user:",c.id),n(c.id),a(c.id),I=!0)},100);return()=>{w=!1,clearTimeout(N)}},[c?.id,d]);const j=(()=>{if(!d||!c)return{active:0,created:0,completed:0};const w=r(c.id),I=o(c.id),N=I.filter(S=>{const E=S.prediction||s.find(_=>_.id===S.prediction_id);if(!E)return!1;const D=E.status==="open",T=new Date(E.entry_deadline)>new Date,A=S.status==="active";return D&&T&&A}),z=w.filter(S=>S.status==="open"||S.status==="closed"||S.status==="awaiting_settlement"),R=I.filter(S=>{const E=S.prediction||s.find(_=>_.id===S.prediction_id);if(!E)return!1;const D=S.status==="won"||S.status==="lost",T=E.status==="closed"||E.status==="settled"||E.status==="ended",A=new Date(E.entry_deadline)<=new Date;return D||T||A});return{active:N.length,created:z.length,completed:R.length}})(),k=[{id:"Active",label:"Active",icon:Oe,count:j.active},{id:"Created",label:"Created",icon:Ss,count:j.created},{id:"Completed",label:"Completed",icon:et,count:j.completed}],L=()=>{if(!d||!c)return{Active:[],Created:[],Completed:[]};const w=o(c.id),I=r(c.id),N=w.filter(S=>{const E=S.prediction||s.find(_=>_.id===S.prediction_id);if(!E)return!1;const D=E.status==="open",T=new Date(E.entry_deadline)>new Date,A=S.status==="active";return D&&T&&A}).map(S=>{const E=S.prediction||s.find(A=>A.id===S.prediction_id);if(!E)return console.warn("⚠️ No prediction found for entry:",S.id),null;const D=S.option||E.options?.find(A=>A.id===S.option_id),T=y(E.entry_deadline,E.status);return{id:S.id,title:E.title,category:E.category,position:D?.label||"Unknown",stake:S.amount,potentialReturn:S.potential_payout||0,odds:S.potential_payout?`${(S.potential_payout/S.amount).toFixed(2)}x`:"1.00x",timeRemaining:T,status:"active",participants:E.participant_count||0,confidence:b(E)}}).filter(Boolean),z=I.filter(S=>S.status==="open"||S.status==="closed"||S.status==="awaiting_settlement").map(S=>{let E=S.status;const D=new Date,T=new Date(S.entry_deadline);E==="open"&&T<=D&&(E="ended");const A=y(S.entry_deadline,E);return{id:S.id,title:S.title,category:S.category,totalPool:S.pool_total||0,participants:S.participant_count||0,timeRemaining:A,status:E,yourCut:S.creator_fee_percentage||3.5,description:S.description,pool_total:S.pool_total,participant_count:S.participant_count,creator_fee_percentage:S.creator_fee_percentage,entry_deadline:S.entry_deadline}}),R=w.filter(S=>{const E=S.prediction||s.find(_=>_.id===S.prediction_id);if(!E)return!1;const D=S.status==="won"||S.status==="lost",T=E.status==="closed"||E.status==="settled"||E.status==="ended",A=new Date(E.entry_deadline)<=new Date;return D||T||A}).map(S=>{const E=S.prediction||s.find(K=>K.id===S.prediction_id);if(!E)return console.warn("⚠️ No prediction found for completed entry:",S.id),null;const D=S.option||E.options?.find(K=>K.id===S.option_id),T=(S.actual_payout||0)-S.amount;let A=S.status,_="";return E.status==="settled"&&(S.status==="won"||S.status==="lost")?_=`Settled on ${new Date(S.updated_at).toLocaleDateString()}`:E.status==="closed"?_="Closed - Awaiting Settlement":E.status==="awaiting_settlement"?_="Awaiting Settlement":E.status==="disputed"?_="Settlement Disputed":E.status==="refunded"?_=`Refunded on ${new Date(E.updated_at||E.created_at).toLocaleDateString()}`:new Date(E.entry_deadline)<=new Date?(_=`Ended on ${new Date(E.entry_deadline).toLocaleDateString()}`,S.status==="active"&&(A="active")):_=y(E.entry_deadline,E.status),{id:S.id,title:E.title,category:E.category,position:D?.label||"Unknown",stake:S.amount,actualReturn:S.actual_payout||0,profit:T,status:A,participants:E.participant_count||0,settledAt:_}}).filter(Boolean);return{Active:N,Created:z,Completed:R}},$=m.useMemo(()=>{try{return L()}catch(w){return console.error("Error getting user predictions:",w),{Active:[],Created:[],Completed:[]}}},[c?.id,d,s,u])[u]||[],J=w=>{switch(w){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"winning":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"losing":return"bg-red-50 text-red-700 border-red-200";case"open":return"bg-blue-50 text-blue-700 border-blue-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},V=w=>({custom:"bg-orange-100 text-orange-700",sports:"bg-blue-100 text-blue-700",esports:"bg-purple-100 text-purple-700",pop_culture:"bg-pink-100 text-pink-700",politics:"bg-red-100 text-red-700",celebrity_gossip:"bg-emerald-100 text-emerald-700"})[w]||"bg-gray-100 text-gray-700";if(!d)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"My Predictions"})})}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:e.jsx(Ss,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Sign in to view your predictions"}),e.jsx("p",{className:"text-gray-600 text-center mb-8 max-w-sm",children:"Create an account or sign in to track your predictions, manage your portfolio, and engage with the community."}),e.jsxs(P.button,{className:"bg-emerald-500 hover:bg-emerald-600 text-white px-8 py-3 rounded-xl font-medium transition-all duration-200 flex items-center gap-2",onClick:()=>{i&&i()},whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(kt,{className:"w-5 h-5"}),"Explore Predictions"]})]})]});const ee=({tab:w})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-6",children:[e.jsxs("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-6",children:[w==="Active"&&e.jsx(Oe,{className:"w-10 h-10 text-gray-400"}),w==="Created"&&e.jsx(Ss,{className:"w-10 h-10 text-gray-400"}),w==="Completed"&&e.jsx(et,{className:"w-10 h-10 text-gray-400"})]}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:["No ",w.toLowerCase()," predictions"]}),e.jsxs("p",{className:"text-gray-600 text-center mb-8 max-w-sm",children:[w==="Active"&&"You haven't made any predictions yet. Start by exploring trending topics!",w==="Created"&&"You haven't created any predictions yet. Share your insights with the community!",w==="Completed"&&"Your prediction history will appear here once you complete some predictions."]}),e.jsxs(P.button,{className:"bg-emerald-500 hover:bg-emerald-600 text-white px-8 py-3 rounded-xl font-medium transition-all duration-200 flex items-center gap-2",onClick:()=>{w==="Created"?(t("/create"),window.scrollTo({behavior:"instant"})):i&&i()},whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(kt,{className:"w-5 h-5"}),w==="Created"?"Create Prediction":"Explore Predictions"]})]}),q=({prediction:w})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${V(w.category)}`,children:w.category.replace("_"," ")}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${J(w.status)}`,children:"Active"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:w.title})]})}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-800",children:"Your Position"}),e.jsx("span",{className:"text-lg font-bold text-emerald-700",children:w.position})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Staked"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",w.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Potential"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",w.potentialReturn.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Odds"}),e.jsx("p",{className:"font-semibold text-emerald-900",children:w.odds})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Market Confidence"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[w.confidence,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${w.confidence}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[w.participants," participants"]}),e.jsx("span",{className:`font-medium ${w.timeRemaining.includes("Closed")||w.timeRemaining.includes("Settled")||w.timeRemaining.includes("Disputed")||w.timeRemaining.includes("Ended")?"text-red-600":w.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-amber-600"}`,children:(w.timeRemaining.includes("h")||w.timeRemaining.includes("d"))&&!w.timeRemaining.includes("Closed")&&!w.timeRemaining.includes("Ended")&&!w.timeRemaining.includes("Settled")&&!w.timeRemaining.includes("Disputed")&&!w.timeRemaining.includes("Awaiting")?`${w.timeRemaining} left`:w.timeRemaining})]})]}),F=({prediction:w})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${V(w.category)}`,children:w.category.replace("_"," ")}),e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-blue-50 text-blue-700 border-blue-200",children:w.status==="open"?"Open":w.status})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:w.title})]})}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Total Pool"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:["$",w.totalPool.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Participants"}),e.jsx("p",{className:"font-semibold text-blue-900",children:w.participants})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Your Cut"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[w.yourCut,"%"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm ${w.timeRemaining.includes("Closed")||w.timeRemaining.includes("Settled")||w.timeRemaining.includes("Disputed")||w.timeRemaining.includes("Ended")?"text-red-600":w.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-gray-500"}`,children:(w.timeRemaining.includes("h")||w.timeRemaining.includes("d"))&&!w.timeRemaining.includes("Closed")&&!w.timeRemaining.includes("Ended")&&!w.timeRemaining.includes("Settled")&&!w.timeRemaining.includes("Disputed")&&!w.timeRemaining.includes("Awaiting")?`Closes in ${w.timeRemaining}`:w.timeRemaining}),e.jsxs("button",{onClick:()=>{x(w),f(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-1 hover:bg-blue-700 transition-colors",children:["Manage ",e.jsx(Ut,{className:"w-4 h-4"})]})]})]}),O=({prediction:w})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${V(w.category)}`,children:w.category.replace("_"," ")}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${w.status==="won"?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-red-50 text-red-700 border-red-200"}`,children:w.status==="won"?"Won":"Lost"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:w.title})]})}),e.jsxs("div",{className:`rounded-xl p-4 mb-4 ${w.status==="won"?"bg-emerald-50":"bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`text-sm font-medium ${w.status==="won"?"text-emerald-800":"text-red-800"}`,children:["Your Position: ",w.position]}),e.jsxs("span",{className:`text-lg font-bold ${w.status==="won"?"text-emerald-700":"text-red-700"}`,children:[w.profit>=0?"+":"","$",Math.abs(w.profit).toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${w.status==="won"?"text-emerald-600":"text-red-600"}`,children:"Staked"}),e.jsxs("p",{className:`font-semibold ${w.status==="won"?"text-emerald-900":"text-red-900"}`,children:["$",w.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${w.status==="won"?"text-emerald-600":"text-red-600"}`,children:"Returned"}),e.jsxs("p",{className:`font-semibold ${w.status==="won"?"text-emerald-900":"text-red-900"}`,children:["$",w.actualReturn.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${w.status==="won"?"text-emerald-600":"text-red-600"}`,children:"Profit/Loss"}),e.jsxs("p",{className:`font-semibold ${w.status==="won"?"text-emerald-900":"text-red-900"}`,children:[w.profit>=0?"+":"","$",Math.abs(w.profit).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[w.participants," participants"]}),e.jsxs("span",{children:["Settled ",w.settledAt]})]})]});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"px-6 pt-12 pb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-6",children:"My Predictions"}),e.jsx("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-xl","data-tour-id":"bets-tabs",children:k.map(w=>{const I=w.icon;return e.jsxs("button",{onClick:()=>h(w.id),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-lg font-medium transition-all duration-200 ${u===w.id?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{children:w.label}),w.count>0&&e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${u===w.id?"bg-emerald-100 text-emerald-700":"bg-gray-200 text-gray-600"}`,children:w.count})]},w.id)})})]})}),e.jsx("div",{className:"px-6 py-6",children:l?e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading predictions..."})]}):$.length>0?e.jsxs("div",{className:"space-y-4",children:[u==="Active"&&$.map((w,I)=>!w||typeof w.id>"u"?(console.warn("Invalid prediction object:",w),null):e.jsx(q,{prediction:w},`active-${w.id}-${I}`)),u==="Created"&&$.map((w,I)=>!w||typeof w.id>"u"?(console.warn("Invalid prediction object:",w),null):e.jsx(F,{prediction:w},`created-${w.id}-${I}`)),u==="Completed"&&$.map((w,I)=>!w||typeof w.id>"u"?(console.warn("Invalid prediction object:",w),null):e.jsx(O,{prediction:w},`completed-${w.id}-${I}`))]}):e.jsx(ee,{tab:u})}),g&&e.jsx(gh,{isOpen:p,onClose:()=>{f(!1),x(null)},prediction:{id:g.id,title:g.title,category:g.category,totalPool:g.totalPool||g.pool_total||0,participants:g.participants||g.participant_count||0,timeRemaining:g.timeRemaining||"0h",yourCut:g.yourCut||g.creator_fee_percentage||3.5,status:g.status||"open",description:g.description,pool_total:g.pool_total,participant_count:g.participant_count,creator_fee_percentage:g.creator_fee_percentage,entry_deadline:g.entry_deadline}})]})};class bh{constructor(t){ce(this,"options");ce(this,"element");ce(this,"startY",0);ce(this,"currentY",0);ce(this,"pullDistance",0);ce(this,"isRefreshing",!1);ce(this,"isPulling",!1);ce(this,"rafId",null);ce(this,"indicatorElement",null);ce(this,"disabled",!1);this.options={threshold:80,element:document.body,disabled:!1,...t},this.element=this.options.element,this.disabled=this.options.disabled,this.init()}init(){this.createIndicator(),this.bindEvents()}createIndicator(){this.indicatorElement=document.createElement("div"),this.indicatorElement.className="pull-to-refresh-indicator",this.indicatorElement.innerHTML=`
      <div class="pull-to-refresh-content">
        <div class="pull-to-refresh-icon">
          <svg class="pull-to-refresh-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12l7-7 7 7"/>
          </svg>
          <svg class="pull-to-refresh-spinner" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"/>
          </svg>
        </div>
        <span class="pull-to-refresh-text">Pull to refresh</span>
      </div>
    `;const t=document.createElement("style");t.textContent=`
      .pull-to-refresh-indicator {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: linear-gradient(135deg, #10b981, #059669);
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-80px);
        transition: transform 0.2s ease;
        z-index: 9999;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .pull-to-refresh-indicator.visible {
        transform: translateY(0);
      }
      
      .pull-to-refresh-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      
      .pull-to-refresh-icon {
        position: relative;
        width: 24px;
        height: 24px;
      }
      
      .pull-to-refresh-arrow,
      .pull-to-refresh-spinner {
        position: absolute;
        top: 0;
        left: 0;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }
      
      .pull-to-refresh-arrow {
        opacity: 1;
        transform: rotate(180deg);
      }
      
      .pull-to-refresh-spinner {
        opacity: 0;
        animation: spin 1s linear infinite;
      }
      
      .pull-to-refresh-indicator.refreshing .pull-to-refresh-arrow {
        opacity: 0;
      }
      
      .pull-to-refresh-indicator.refreshing .pull-to-refresh-spinner {
        opacity: 1;
      }
      
      .pull-to-refresh-indicator.ready .pull-to-refresh-arrow {
        transform: rotate(0deg);
      }
      
      .pull-to-refresh-text {
        font-size: 14px;
        font-weight: 500;
      }
      
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `,document.head.querySelector("#pull-to-refresh-styles")||(t.id="pull-to-refresh-styles",document.head.appendChild(t)),document.body.appendChild(this.indicatorElement)}bindEvents(){this.element.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.element.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.element.addEventListener("touchend",this.onTouchEnd.bind(this))}unbindEvents(){this.element.removeEventListener("touchstart",this.onTouchStart.bind(this)),this.element.removeEventListener("touchmove",this.onTouchMove.bind(this)),this.element.removeEventListener("touchend",this.onTouchEnd.bind(this))}findScrollableParent(t){let s=t.parentElement;for(;s;){const n=window.getComputedStyle(s).overflowY;if(n==="auto"||n==="scroll"||s.scrollHeight>s.clientHeight)return s;s=s.parentElement}return null}onTouchStart(t){if(this.disabled||this.isRefreshing||window.scrollY>5)return;const s=t.target,r=this.findScrollableParent(s);r&&r.scrollTop>5||(this.startY=t.touches[0].clientY,this.isPulling=!1)}onTouchMove(t){if(this.disabled||this.isRefreshing)return;this.currentY=t.touches[0].clientY,this.pullDistance=Math.max(0,this.currentY-this.startY);const s=window.scrollY<=5,r=t.target,n=this.findScrollableParent(r),a=!n||n.scrollTop<=5;this.pullDistance>50&&s&&a&&(t.preventDefault(),this.isPulling=!0,this.updateIndicator())}onTouchEnd(){this.disabled||this.isRefreshing||!this.isPulling||(this.pullDistance>=this.options.threshold?this.refresh():this.resetIndicator(),this.isPulling=!1,this.pullDistance=0)}updateIndicator(){if(!this.indicatorElement)return;const t=Math.min(1,this.pullDistance/this.options.threshold),s=Math.min(0,t*80-80);this.indicatorElement.style.transform=`translateY(${s}px)`,this.pullDistance>=this.options.threshold?(this.indicatorElement.classList.add("ready"),this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Release to refresh"):(this.indicatorElement.classList.remove("ready"),this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Pull to refresh")}async refresh(){if(this.indicatorElement){this.isRefreshing=!0,this.indicatorElement.classList.add("refreshing","visible"),this.indicatorElement.style.transform="translateY(0)",this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Refreshing...";try{await this.options.onRefresh()}catch(t){console.error("Pull to refresh error:",t)}await new Promise(t=>setTimeout(t,1e3)),this.resetIndicator()}}resetIndicator(){this.indicatorElement&&(this.isRefreshing=!1,this.indicatorElement.classList.remove("refreshing","ready","visible"),this.indicatorElement.style.transform="translateY(-80px)",this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Pull to refresh")}setDisabled(t){this.disabled=t}destroy(){this.unbindEvents(),this.indicatorElement&&this.indicatorElement.remove(),this.rafId&&cancelAnimationFrame(this.rafId)}}const yh=(i,t={})=>{const s=ue.useRef(null);return ue.useEffect(()=>(s.current=new bh({...t,onRefresh:i}),()=>{s.current?.destroy()}),[i]),{setDisabled:r=>s.current?.setDisabled(r),destroy:()=>s.current?.destroy()}},vh=Hn.version,wh=vh,xt=class xt{constructor(){ce(this,"currentVersion");this.currentVersion=wh}static getInstance(){return xt.instance||(xt.instance=new xt),xt.instance}getVersion(){return this.currentVersion}incrementPatch(){const[t,s,r]=this.currentVersion.split(".").map(Number);return this.currentVersion=`${t}.${s}.${r+1}`,this.currentVersion}incrementMinor(){const[t,s]=this.currentVersion.split(".").map(Number);return this.currentVersion=`${t}.${s+1}.0`,this.currentVersion}incrementMajor(){const[t]=this.currentVersion.split(".").map(Number);return this.currentVersion=`${t+1}.0.0`,this.currentVersion}setVersion(t){this.currentVersion=t}getVersionInfo(){return{version:this.currentVersion,buildTime:new Date().toISOString(),cacheBuster:`v${this.currentVersion}-${new Date().toISOString().split("T")[0]}-auto`,environment:"production",isProduction:!0}}};ce(xt,"instance");let Rr=xt;const jh=Rr.getInstance(),Hs=jh.getVersion(),kh=new Date().toISOString();`${Hs}${new Date().toISOString().split("T")[0]}`;const Nh=({onBack:i})=>{oe();const[t,s]=m.useState({twoFactorEnabled:!1,emailNotifications:!0,pushNotifications:!0,marketingEmails:!1,publicProfile:!0,showEarnings:!1}),[r,n]=m.useState(!1),[a,o]=m.useState(""),[l,c]=m.useState(!1);m.useState(!1),m.useState({currentPassword:"",newPassword:"",confirmPassword:""});const[d,u]=m.useState({lastPasswordChange:"3 months ago",loginSessions:1,suspiciousActivity:0}),h=async()=>{a.toLowerCase()==="delete my account"?(c(!0),setTimeout(()=>{alert("Account deletion request submitted. You will receive a confirmation email."),n(!1),o(""),c(!1)},2e3)):alert('Please type "delete my account" to confirm.')},p=async f=>{c(!0),setTimeout(()=>{s({...t,[f]:!t[f]}),c(!1);const g=document.createElement("div");g.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #059669;
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        z-index: 10000;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      `,g.textContent="Setting updated successfully!",document.body.appendChild(g),setTimeout(()=>{document.body.removeChild(g)},3e3)},500)};return e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Ct,{size:24,style:{color:"#374151"}})}),e.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Account Settings"})]})}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Profile Visibility"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Public Profile"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Allow others to see your profile"})]}),e.jsx("button",{onClick:()=>p("publicProfile"),disabled:l,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.publicProfile?"#059669":"#e5e7eb",position:"relative",cursor:l?"not-allowed":"pointer",transition:"background 0.2s",opacity:l?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.publicProfile?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Show Earnings"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Display your earnings on profile"})]}),e.jsx("button",{onClick:()=>p("showEarnings"),disabled:l,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.showEarnings?"#059669":"#e5e7eb",position:"relative",cursor:l?"not-allowed":"pointer",transition:"background 0.2s",opacity:l?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.showEarnings?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Security Status"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Last Password Change"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:d.lastPasswordChange})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Active Sessions"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:d.loginSessions})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Suspicious Activity"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:d.suspiciousActivity>0?"#dc2626":"#059669"},children:d.suspiciousActivity===0?"None detected":`${d.suspiciousActivity} incidents`})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Account Security"}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Two-Factor Authentication"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Add extra security to your account"})]}),e.jsx("button",{onClick:()=>p("twoFactorEnabled"),disabled:l,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.twoFactorEnabled?"#059669":"#e5e7eb",position:"relative",cursor:l?"not-allowed":"pointer",transition:"background 0.2s",opacity:l?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.twoFactorEnabled?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Danger Zone"}),e.jsx("div",{style:{marginBottom:"12px"},children:e.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 12px 0"},children:"Once you delete your account, there is no going back. Please be certain."})}),r?e.jsxs("div",{style:{border:"2px solid #ef4444",borderRadius:"8px",padding:"16px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#dc2626",margin:"0 0 12px 0"},children:"⚠️ Confirm Account Deletion"}),e.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 16px 0"},children:"This action cannot be undone. This will permanently delete your account and all associated data."}),e.jsxs("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 16px 0"},children:["Type ",e.jsx("strong",{children:'"delete my account"'})," to confirm:"]}),e.jsx("input",{type:"text",value:a,onChange:f=>o(f.target.value),placeholder:"Type: delete my account",style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",marginBottom:"16px",boxSizing:"border-box"}}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{onClick:()=>{n(!1),o("")},style:{flex:1,padding:"10px",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500"},children:"Cancel"}),e.jsx("button",{onClick:h,disabled:l||a.toLowerCase()!=="delete my account",style:{flex:1,padding:"10px",background:a.toLowerCase()==="delete my account"?"#dc2626":"#9ca3af",color:"white",border:"none",borderRadius:"6px",cursor:a.toLowerCase()==="delete my account"&&!l?"pointer":"not-allowed",fontWeight:"500"},children:l?"Processing...":"Delete Account"})]})]}):e.jsx("button",{style:{width:"100%",padding:"12px",background:"rgba(239, 68, 68, 0.1)",color:"#dc2626",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},onClick:()=>n(!0),children:"Delete Account"})]})]})]})},Sh=({onBack:i})=>{const[t,s]=m.useState({pushEnabled:!0,emailEnabled:!0,predictionUpdates:!0,winLossAlerts:!0,clubActivity:!0,socialInteractions:!1,marketingEmails:!1,weeklyDigest:!0}),[r,n]=m.useState(!1),[a,o]=m.useState("default");ue.useEffect(()=>{"Notification"in window&&o(Notification.permission)},[]);const l=async()=>{if("Notification"in window){const u=await Notification.requestPermission();o(u),c(u==="granted"?"Notifications enabled successfully!":"You can enable notifications in your browser settings later.")}},c=u=>{const h=document.createElement("div");h.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #059669;
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `,h.textContent=u,document.body.appendChild(h),setTimeout(()=>{document.body.contains(h)&&document.body.removeChild(h)},3e3)},d=async u=>{u==="pushEnabled"&&!t.pushEnabled&&a!=="granted"&&(await l(),a!=="granted")||(n(!0),setTimeout(()=>{s({...t,[u]:!t[u]}),n(!1),c("Notification setting updated!")},500))};return e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Ct,{size:24,style:{color:"#374151"}})}),e.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Notifications"})]})}),e.jsxs("div",{style:{padding:"24px"},children:[a!=="granted"&&e.jsx("div",{style:{background:"rgba(255, 176, 32, 0.1)",border:"1px solid rgba(255, 176, 32, 0.3)",borderRadius:"12px",padding:"16px",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"24px",height:"24px",background:"#ffb020",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold"},children:"!"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h4",{style:{fontSize:"14px",fontWeight:"600",color:"#b45309",margin:"0 0 4px 0"},children:"Enable Browser Notifications"}),e.jsx("p",{style:{fontSize:"12px",color:"#b45309",margin:0},children:a==="denied"?"Notifications are blocked. You can enable them in your browser settings.":"Click to enable push notifications for real-time updates."})]}),a==="default"&&e.jsx("button",{onClick:l,style:{padding:"6px 12px",background:"#ffb020",color:"white",border:"none",borderRadius:"6px",fontSize:"12px",fontWeight:"600",cursor:"pointer"},children:"Enable"})]})}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"General"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Push Notifications"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Receive notifications on your device"})]}),e.jsx("button",{onClick:()=>d("pushEnabled"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.pushEnabled?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.pushEnabled?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Email Notifications"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Receive notifications via email"})]}),e.jsx("button",{onClick:()=>d("emailEnabled"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.emailEnabled?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.emailEnabled?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Prediction Alerts"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Win/Loss Alerts"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Get notified when predictions resolve"})]}),e.jsx("button",{onClick:()=>d("winLossAlerts"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.winLossAlerts?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.winLossAlerts?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Club Activity"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Activity from clubs you've joined"})]}),e.jsx("button",{onClick:()=>d("clubActivity"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:t.clubActivity?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:e.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:t.clubActivity?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]})]})]})]})},_h=({onBack:i})=>{const[t,s]=m.useState(!1),[r,n]=m.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[a,o]=m.useState(!1),[l,c]=m.useState({lastPasswordChange:"3 months ago",loginSessions:1,suspiciousActivity:0}),d=async()=>{if(r.newPassword!==r.confirmPassword){alert("New passwords do not match!");return}if(r.newPassword.length<8){alert("Password must be at least 8 characters long!");return}o(!0),setTimeout(()=>{alert("Password changed successfully!"),n({currentPassword:"",newPassword:"",confirmPassword:""}),s(!1),o(!1),c({...l,lastPasswordChange:"Just now"})},2e3)};return e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Ct,{size:24,style:{color:"#374151"}})}),e.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Security & Privacy"})]})}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Password & Authentication"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>s(!t),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(xd,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Change Password"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]}),t&&e.jsxs("div",{style:{marginTop:"16px",padding:"16px",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[e.jsx("h4",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px",margin:"0 0 12px 0"},children:"Change Password"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsx("input",{type:"password",placeholder:"Current Password",value:r.currentPassword,onChange:u=>n({...r,currentPassword:u.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}}),e.jsx("input",{type:"password",placeholder:"New Password (min 8 characters)",value:r.newPassword,onChange:u=>n({...r,newPassword:u.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}}),e.jsx("input",{type:"password",placeholder:"Confirm New Password",value:r.confirmPassword,onChange:u=>n({...r,confirmPassword:u.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px"},children:[e.jsx("button",{onClick:()=>{s(!1),n({currentPassword:"",newPassword:"",confirmPassword:""})},style:{flex:1,padding:"8px",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"14px"},children:"Cancel"}),e.jsx("button",{onClick:d,disabled:a||!r.currentPassword||!r.newPassword||!r.confirmPassword,style:{flex:1,padding:"8px",background:a||!r.currentPassword||!r.newPassword||!r.confirmPassword?"#9ca3af":"#059669",color:"white",border:"none",borderRadius:"6px",cursor:a||!r.currentPassword||!r.newPassword||!r.confirmPassword?"not-allowed":"pointer",fontWeight:"500",fontSize:"14px"},children:a?"Updating...":"Update Password"})]})]})]}),e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Two-factor authentication setup will be available in the next update!"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Jr,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Two-Factor Authentication"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Privacy Controls"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Privacy settings will be available soon"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Kr,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Profile Privacy"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]}),e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Data management features coming soon"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(On,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Data & Privacy"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Login Activity"}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"12px"},children:"Recent login activity and device management"}),e.jsxs("div",{style:{padding:"12px",background:"#f9fafb",borderRadius:"8px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:"500",fontSize:"14px"},children:"Current Device"}),e.jsx("span",{style:{fontSize:"12px",color:"#059669"},children:"Active Now"})]}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"MacBook Pro • Chrome • Gainesville, GA"})]})]})]})]})},Ch=({onBack:i})=>{const[t,s]=m.useState("predictions"),[r,n]=m.useState([]),[a,o]=m.useState(!0),[l,c]=m.useState(null),d=async g=>{try{o(!0),c(null);const x=de(),y=await fetch(`${x}/api/v2/users/leaderboard?type=${g==="winrate"?"accuracy":g}&limit=50`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!y.ok)throw new Error(`Failed to fetch leaderboard: ${y.status}`);const b=await y.json();if(b.error)throw new Error(b.message||"Failed to fetch leaderboard");const v=(b.data||[]).map((j,k)=>({...j,rank:k+1,won_entries:Math.round(j.win_rate/100*j.total_entries)}));n(v)}catch(x){console.error("Error fetching leaderboard:",x),c(x instanceof Error?x.message:"Failed to load leaderboard"),n([])}finally{o(!1)}};m.useEffect(()=>{d(t)},[t]);const u=[{id:"sample-1",username:"PredictionMaster",predictions_count:15,total_profit:2450.75,total_invested:1200,win_rate:78,total_entries:23,won_entries:18,rank:1},{id:"sample-2",username:"SportsSage",predictions_count:12,total_profit:1890.25,total_invested:950,win_rate:75,total_entries:16,won_entries:12,rank:2},{id:"sample-3",username:"TrendSpotter",predictions_count:18,total_profit:1650.5,total_invested:800,win_rate:72,total_entries:25,won_entries:18,rank:3},{id:"sample-4",username:"AnalyticsAce",predictions_count:8,total_profit:1200,total_invested:600,win_rate:70,total_entries:10,won_entries:7,rank:4},{id:"sample-5",username:"DataDriven",predictions_count:6,total_profit:980.75,total_invested:500,win_rate:68,total_entries:9,won_entries:6,rank:5}],h=()=>{const g=r.length>0?r:u;return t==="winrate"?g.filter(x=>x.total_entries>=3):g},p=g=>{switch(g){case 1:return{emoji:"🏆",color:"#ffd700"};case 2:return{emoji:"🥈",color:"#c0c0c0"};case 3:return{emoji:"🥉",color:"#cd7f32"};default:return{emoji:`#${g}`,color:"#6b7280"}}},f=(g,x)=>{switch(x){case"predictions":return{primary:g.predictions_count.toString(),secondary:"predictions created",accent:g.total_entries>0?`${g.total_entries} entries`:"No entries"};case"profit":return{primary:`${g.total_profit.toLocaleString()}`,secondary:"net profit",accent:`${g.total_invested.toLocaleString()} invested`};case"winrate":return{primary:`${g.win_rate}%`,secondary:"win rate",accent:`${g.won_entries}/${g.total_entries} won`}}};return e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Ct,{size:24,style:{color:"#374151"}})}),e.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Leaderboard"})]})}),e.jsx("div",{style:{padding:"16px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:e.jsx("div",{style:{display:"flex",gap:"4px",background:"#f3f4f6",borderRadius:"12px",padding:"4px"},children:[{key:"predictions",label:"Predictions"},{key:"profit",label:"Profit"},{key:"winrate",label:"Win Rate"}].map(g=>e.jsx("button",{onClick:()=>s(g.key),style:{flex:1,padding:"12px 16px",borderRadius:"8px",border:"none",background:t===g.key?"white":"transparent",color:t===g.key?"#111827":"#6b7280",fontWeight:t===g.key?"600":"500",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",transition:"all 0.2s ease",boxShadow:t===g.key?"0 1px 3px rgba(0, 0, 0, 0.1)":"none"},children:g.label},g.key))})}),e.jsx("div",{style:{padding:"0 24px 100px 24px"},children:e.jsx("div",{style:{paddingTop:"16px"},children:a?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"40px"},children:e.jsx("div",{style:{width:"32px",height:"32px",border:"3px solid #e5e7eb",borderTop:"3px solid #059669",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):l?e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",textAlign:"center",border:"1px solid #fecaca"},children:[e.jsx("p",{style:{color:"#dc2626",margin:"0 0 12px 0"},children:"Failed to load leaderboard"}),e.jsx("p",{style:{color:"#6b7280",fontSize:"14px",margin:"0 0 16px 0"},children:l}),e.jsx("button",{onClick:()=>d(t),style:{background:"#059669",color:"white",border:"none",borderRadius:"8px",padding:"8px 16px",cursor:"pointer"},children:"Retry"})]}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:h().map((g,x)=>{const y=p(g.rank),b=f(g,t),v=g.rank<=3;return e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:x*.05},style:{background:v?"linear-gradient(135deg, rgba(5, 150, 105, 0.05), rgba(123, 47, 247, 0.05))":"white",border:v?"2px solid rgba(5, 150, 105, 0.2)":"1px solid #e5e7eb",borderRadius:"16px",padding:"20px",display:"flex",alignItems:"center",gap:"16px",boxShadow:v?"0 8px 24px rgba(5, 150, 105, 0.15)":"0 2px 8px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease",cursor:"pointer"},whileHover:{scale:1.02,y:-2},children:[e.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:v?y.color:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",fontSize:v?"20px":"16px",fontWeight:"700",color:v?"white":"#6b7280",boxShadow:v?"0 4px 12px rgba(0, 0, 0, 0.2)":"none",flexShrink:0},children:g.rank<=3?y.emoji:g.rank}),e.jsx(Ts,{email:g.username,username:g.username,avatarUrl:g.avatar_url,size:"md",className:"ring-2 ring-white"}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("h4",{style:{fontSize:"16px",fontWeight:"700",color:"#111827",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:g.full_name||g.username}),v&&e.jsx("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",color:"white",fontSize:"10px",fontWeight:"700",padding:"2px 6px",borderRadius:"4px",textTransform:"uppercase"},children:g.rank===1?"Champion":g.rank===2?"Elite":"Pro"})]}),e.jsxs("p",{style:{color:"#6b7280",fontSize:"13px",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["@",g.username," • ",b.accent]})]}),e.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[e.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:v?"#059669":"#111827",marginBottom:"2px"},children:b.primary}),e.jsx("div",{style:{fontSize:"11px",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.5px"},children:b.secondary})]})]},`${t}-${g.id}`)})})})})]})},Ph=({onBack:i})=>e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[e.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:e.jsx(Ct,{size:24,style:{color:"#374151"}})}),e.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Help & Support"})]})}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Get Help"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("https://help.fanclubz.com/faq","_blank")||alert("FAQ section will open in a new window"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Dn,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Frequently Asked Questions"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]}),e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("mailto:support@fanclubz.com"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(yd,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Contact Support"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]}),e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Live chat will be available 24/7 starting next week!"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Fe,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Live Chat"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Resources"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/terms","_blank")||alert("Terms of Service will open in a new window"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(On,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Terms of Service"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]}),e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/privacy","_blank")||alert("Privacy Policy will open in a new window"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(Jr,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Privacy Policy"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]}),e.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/community-guidelines","_blank")||alert("Community Guidelines will open in a new window"),children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx(vt,{size:20,style:{color:"#6b7280"}}),e.jsx("span",{style:{fontWeight:"500"},children:"Community Guidelines"})]}),e.jsx(Ee,{size:16,style:{color:"#9ca3af"}})]})]})]}),e.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"App Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"App Version"}),e.jsxs("span",{style:{fontSize:"14px",fontWeight:"500"},children:["v",Hs]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Build Number"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:"2024.07.30"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Last Updated"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:"July 30, 2025"})]})]})]})]})]}),fa=({onNavigateBack:i,userId:t})=>{const{user:s,updateProfile:r,logout:n}=oe(),{getUserPredictionEntries:a,getUserCreatedPredictions:o,fetchUserPredictionEntries:l,fetchUserCreatedPredictions:c}=at(),[d,u]=m.useState("overview"),[h,p]=m.useState(!1),[f,g]=m.useState(!1),[x,y]=m.useState(null),[b,v]=m.useState(!1),[j,k]=m.useState({firstName:s?.firstName||"",lastName:s?.lastName||"",email:s?.email||"",bio:s?.bio||""}),L=!t||t===s?.id,$=!L&&!(L||!!x&&!b);ue.useEffect(()=>{if(!s){console.log("⏳ Waiting for currentUser to load...");return}try{if(console.log("🔎 ProfilePage useEffect triggered with:",{userId:t,currentUserId:s?.id}),!t||typeof t!="string"||t.trim()===""){console.log("ℹ️ No valid userId provided, viewing own profile"),f||g(!1),x!==s&&y(s);return}const N=t!==s?.id;console.log("🔄 Profile viewing decision:",{userId:t,currentUserId:s?.id,isViewingOther:N}),f!==N&&g(N),N?(console.log("👥 Viewing other user profile:",t),(!x||x.id!==t)&&J(t)):(console.log("👤 Viewing own profile"),x!==s&&y(s))}catch(N){console.error("❌ Error in profile useEffect:",N),f&&g(!1),x!==s&&y(s)}},[t,s?.id]);const J=ue.useCallback(async N=>{if(b){console.log("🔄 Already loading profile, skipping request");return}v(!0);try{console.log("🔍 Fetching profile for user ID:",N),/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(N)||console.warn("⚠️ Invalid userId format, but attempting API call anyway:",N);const S=`${de()}/api/v2/users/${N}`;console.log("🌐 Making API request to:",S);const E=await fetch(S,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(console.log("📝 API Response status:",E.status,E.statusText),!E.ok){if(E.status===404){console.warn("⚠️ User not found:",N),g(!1),y(s),v(!1);return}throw new Error(`HTTP error! status: ${E.status} ${E.statusText}`)}const D=await E.json();if(console.log("📦 Raw API response:",D),D.error)throw new Error(D.message||"Failed to fetch user profile");const T=D.data;if(!T)throw new Error("No user data in API response");const A={id:T.id,firstName:T.full_name?.split(" ")[0]||T.username||"Unknown",lastName:T.full_name?.split(" ").slice(1).join(" ")||"",email:T.email||"",bio:T.bio||"No bio available",avatar:T.avatar_url||null,totalEarnings:T.stats?.totalEarnings||0,totalInvested:T.stats?.totalInvested||0,winRate:T.stats?.winRate||0,activePredictions:T.stats?.predictionsCreated||0,totalPredictions:T.stats?.predictionsParticipated||0,rank:0,level:T.reputation_score>1e3?"Advanced Predictor":T.reputation_score>500?"Intermediate Predictor":"New Predictor",createdAt:T.created_at,username:T.username||T.full_name||"unknown_user",isVerified:T.is_verified||!1};console.log("✅ User profile transformed successfully:",A),y(A)}catch(z){console.error("❌ Error fetching user profile:",z),z.name==="AbortError"?console.log("⏱️ Request timed out"):z.message.includes("ERR_BLOCKED_BY_CLIENT")&&console.log("🚫 Request blocked by client (likely ad blocker)");const R={id:N,firstName:"Unknown",lastName:"User",email:"",bio:z instanceof Error?"Profile temporarily unavailable":"Profile not available",avatar:null,totalEarnings:0,totalInvested:0,winRate:0,activePredictions:0,totalPredictions:0,rank:0,level:"Unknown",createdAt:new Date().toISOString(),username:"unknown_user",isVerified:!1};console.log("🎆 Setting fallback user:",R),y(R)}finally{v(!1)}},[b]);ue.useEffect(()=>{Ot({behavior:"instant"})},[]);const V=ue.useCallback(async()=>{console.log("Pull to refresh triggered on Profile page"),await new Promise(N=>setTimeout(N,500))},[]);yh(V,{threshold:60,disabled:!1}),ue.useEffect(()=>{const N=t||s?.id;if(!N||!s)return;let z=!0,R=!1;const S=()=>{if(!(!z||R))try{console.log("📊 ProfilePage: Fetching data for user:",N),l(N),c(N),R=!0}catch(T){console.error("Error fetching user prediction data:",T)}},{isAuthenticated:E,initialized:D}=oe.getState();if(D&&E)S();else{const T=oe.subscribe(A=>{A.initialized&&A.isAuthenticated&&!R&&(S(),T())});return()=>{z=!1,T()}}return()=>{z=!1}},[t,s?.id]);const ee=ue.useMemo(()=>{const N=x||s,z=t||s?.id;if(!N||!z)return{totalEarnings:0,totalInvested:0,winRate:0,activePredictions:0,totalPredictions:0,rank:0,joinedDate:"Recently",level:"New Predictor"};try{const R=a(z)||[],S=o(z)||[],E=R.filter(se=>se?.status==="active").length,D=R.filter(se=>se?.status==="won"||se?.status==="lost"),T=R.filter(se=>se?.status==="won"),A=R.reduce((se,re)=>se+(re?.amount||0),0),_=T.reduce((se,re)=>se+(re?.actual_payout||0),0),K=D.length>0?Math.round(T.length/D.length*100):0;return{totalEarnings:_,totalInvested:A,winRate:K,activePredictions:E,totalPredictions:R.length+S.length,rank:N.rank||0,joinedDate:N.createdAt?new Date(N.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long"}):"Recently",level:E>5?"Expert Predictor":E>0?"Active Predictor":"New Predictor"}}catch(R){return console.error("Error calculating user stats:",R),{totalEarnings:0,totalInvested:0,winRate:0,activePredictions:0,totalPredictions:0,rank:0,joinedDate:"Recently",level:"New Predictor"}}},[x?.id,t,s?.id]),q=ue.useMemo(()=>[{id:"account",label:"Account Settings",icon:Ut,description:"Manage your account preferences",action:()=>u("account")},{id:"notifications",label:"Notifications",icon:In,description:"Control your notification settings",action:()=>u("notifications")},{id:"security",label:"Security & Privacy",icon:Jr,description:"Manage security settings",action:()=>u("security")},{id:"help",label:"Help & Support",icon:Dn,description:"Get help and contact support",action:()=>u("help")}],[u]),F=ue.useMemo(()=>{const N=t||s?.id;if(!N)return[];try{const z=a(N)||[],R=o(N)||[],S=z.length,E=R.length,D=z.filter(A=>A?.status==="won").length,T=z.filter(A=>A?.status==="won").reduce((A,_)=>A+(_?.actual_payout||0),0);return[{id:1,title:"First Prediction",icon:"🎯",unlocked:S>0,description:"Make your first prediction"},{id:2,title:"Active Predictor",icon:"🔥",unlocked:S>=3,description:`Make 3 predictions (${S}/3)`},{id:3,title:"Top Predictor",icon:"👑",unlocked:D>=5,description:`Win 5 predictions (${D}/5)`},{id:4,title:"Community Leader",icon:"⭐",unlocked:E>=2,description:`Create 2 predictions (${E}/2)`}]}catch(z){return console.error("Error calculating achievements:",z),[]}},[t,s?.id]),O=()=>{r({...s,firstName:j.firstName,lastName:j.lastName,email:j.email,bio:j.bio}),p(!1)},w=()=>{k({firstName:s?.firstName||"",lastName:s?.lastName||"",email:s?.email||"",bio:s?.bio||""}),p(!1)},I=()=>{const N=()=>{n(),i&&i()},z=document.createElement("div");z.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `,z.innerHTML=`
      <div style="
        background: white;
        border-radius: 16px;
        padding: 24px;
        max-width: 320px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      ">
        <div style="
          width: 48px;
          height: 48px;
          background: #fef3c7;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 16px;
        ">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
            <path d="M9 12l2 2 4-4"/>
            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
          </svg>
        </div>
        <h3 style="
          font-size: 18px;
          font-weight: 700;
          color: #111827;
          margin: 0 0 8px 0;
        ">Sign Out</h3>
        <p style="
          font-size: 14px;
          color: #6b7280;
          margin: 0 0 24px 0;
          line-height: 1.5;
        ">Are you sure you want to sign out of your account?</p>
        <div style="
          display: flex;
          gap: 12px;
          justify-content: center;
        ">
          <button onclick="dialog.remove()" style="
            padding: 10px 20px;
            background: #f3f4f6;
            color: #374151;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
          " onmouseover="this.style.backgroundColor='#e5e7eb'" onmouseout="this.style.backgroundColor='#f3f4f6'">
            Cancel
          </button>
          <button onclick="window.confirmLogout()" style="
            padding: 10px 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
          " onmouseover="this.style.backgroundColor='#dc2626'" onmouseout="this.style.backgroundColor='#ef4444'">
            Sign Out
          </button>
        </div>
      </div>
    `,window.confirmLogout=()=>{z.remove(),N()},document.body.appendChild(z)};return ue.useEffect(()=>{f&&d!=="overview"&&u("overview")},[f,d]),!f&&d==="account"?e.jsx(Nh,{onBack:()=>u("overview")}):!f&&d==="notifications"?e.jsx(Sh,{onBack:()=>u("overview")}):!f&&d==="security"?e.jsx(_h,{onBack:()=>u("overview")}):!f&&d==="help"?e.jsx(Ph,{onBack:()=>u("overview")}):!f&&d==="leaderboard"?e.jsx(Ch,{onBack:()=>u("overview")}):f&&b?e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",minHeight:"300px"},children:[e.jsx("div",{style:{height:"44px"}}),e.jsx("div",{style:{padding:"20px 16px",position:"relative",zIndex:10},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"40px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i&&e.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:e.jsx(yt,{size:20,style:{color:"white"}})}),e.jsx("h1",{style:{color:"white",fontSize:"24px",fontWeight:"700",margin:0},children:"Profile"})]})})})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #059669",borderTop:"3px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),e.jsx("p",{style:{color:"#6b7280",fontSize:"16px"},children:"Loading profile..."})]})})]}):f&&!b&&!x?e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[e.jsxs("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",minHeight:"300px"},children:[e.jsx("div",{style:{height:"44px"}}),e.jsx("div",{style:{padding:"20px 16px",position:"relative",zIndex:10},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"40px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i&&e.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:e.jsx(yt,{size:20,style:{color:"white"}})}),e.jsx("h1",{style:{color:"white",fontSize:"24px",fontWeight:"700",margin:0},children:"Profile"})]})})})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{width:"48px",height:"48px",background:"#fef3c7",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#f59e0b",strokeWidth:"2",children:e.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",margin:"0 0 8px 0"},children:"Profile Not Found"}),e.jsx("p",{style:{color:"#6b7280",fontSize:"16px",margin:"0 0 24px 0"},children:"The user profile you're looking for doesn't exist or is not available."}),i&&e.jsx("button",{onClick:i,style:{background:"#059669",color:"white",border:"none",borderRadius:"12px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},children:"Go Back"})]})})]}):e.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[$&&e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-emerald-600 pt-12 pb-6",children:e.jsx("div",{className:"px-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[i&&e.jsx("button",{onClick:i,className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-white text-2xl font-bold",children:"Profile"})]})})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-24 bg-white rounded-2xl shadow mb-4"}),e.jsx("div",{className:"h-32 bg-white rounded-2xl shadow"})]})})]}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",minHeight:"300px"},"data-tour-id":"profile-header",children:[e.jsx("div",{style:{position:"absolute",top:"20px",right:"20px",width:"100px",height:"100px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%",filter:"blur(20px)"}}),e.jsx("div",{style:{position:"absolute",bottom:"20px",left:"30px",width:"80px",height:"80px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%",filter:"blur(15px)"}}),e.jsx("div",{style:{height:"44px"}}),e.jsx("div",{style:{padding:"20px 16px",position:"relative",zIndex:10},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"40px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i&&e.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:e.jsx(yt,{size:20,style:{color:"white"}})}),e.jsx("h1",{style:{color:"white",fontSize:"24px",fontWeight:"700",margin:0},children:f?"User Profile":"Profile"})]}),!f&&e.jsx("button",{onClick:()=>p(!h),style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:h?e.jsx(ge,{size:20,style:{color:"white"}}):e.jsx(Gr,{size:20,style:{color:"white"}})})]})}),e.jsx("div",{"data-tour-id":"profile-card",style:{margin:"16px",background:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1)",minHeight:"180px"},children:e.jsx(fe,{mode:"wait",children:!f&&h?e.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px",marginBottom:"16px"},children:[e.jsxs("div",{style:{position:"relative",flexShrink:0},children:[e.jsx(Ts,{email:j.email,avatarUrl:s?.avatar,size:"xl",className:"ring-4 ring-white"}),e.jsx("button",{style:{position:"absolute",bottom:"0",right:"0",width:"28px",height:"28px",background:"#059669",border:"2px solid white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>{const N=document.createElement("input");N.type="file",N.accept="image/*",N.onchange=async z=>{const R=z.target.files?.[0];if(R)try{const S=await oe.getState().uploadAvatar(R);console.log("Avatar uploaded:",S)}catch(S){console.error("Avatar upload failed",S),alert("Failed to upload image. Please try again.")}},N.click()},children:e.jsx(hd,{size:12,style:{color:"white"}})})]}),e.jsxs("div",{style:{flex:1,minWidth:0,paddingTop:"4px"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"10px"},children:[e.jsx("input",{type:"text",placeholder:"First Name",value:j.firstName,onChange:N=>k({...j,firstName:N.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontWeight:"600",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:N=>N.target.style.borderColor="#059669",onBlur:N=>N.target.style.borderColor="#e5e7eb"}),e.jsx("input",{type:"text",placeholder:"Last Name",value:j.lastName,onChange:N=>k({...j,lastName:N.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontWeight:"600",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:N=>N.target.style.borderColor="#059669",onBlur:N=>N.target.style.borderColor="#e5e7eb"})]}),e.jsx("input",{type:"email",placeholder:"Email",value:j.email,onChange:N=>k({...j,email:N.target.value}),style:{width:"100%",padding:"8px 10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"13px",marginBottom:"6px",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:N=>N.target.style.borderColor="#059669",onBlur:N=>N.target.style.borderColor="#e5e7eb"}),e.jsx("textarea",{placeholder:"Bio (optional)",value:j.bio,onChange:N=>k({...j,bio:N.target.value}),style:{width:"100%",padding:"8px 10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"13px",resize:"none",height:"50px",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:N=>N.target.style.borderColor="#059669",onBlur:N=>N.target.style.borderColor="#e5e7eb"})]})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[e.jsx("button",{onClick:w,style:{padding:"8px 16px",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"14px",transition:"background-color 0.2s"},onMouseEnter:N=>N.currentTarget.style.backgroundColor="#e5e7eb",onMouseLeave:N=>N.currentTarget.style.backgroundColor="#f3f4f6",children:"Cancel"}),e.jsxs("button",{onClick:O,style:{padding:"8px 16px",background:"#059669",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center",gap:"4px",transition:"background-color 0.2s"},onMouseEnter:N=>N.currentTarget.style.backgroundColor="#7B2FF7",onMouseLeave:N=>N.currentTarget.style.backgroundColor="#059669",children:[e.jsx(Sd,{size:16}),"Save"]})]})]},"editing"):e.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px",marginBottom:"16px"},children:[e.jsx("div",{style:{position:"relative",flexShrink:0},children:e.jsx(Ts,{email:x?.email,username:x?.username,avatarUrl:x?.avatar,size:"lg",className:"ring-4 ring-white"})}),e.jsxs("div",{style:{flex:1,minWidth:0,paddingTop:"4px"},children:[e.jsx("h2",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",marginBottom:"4px",margin:0,lineHeight:"1.2"},children:x?.firstName&&x?.lastName?`${x.firstName} ${x.lastName}`:x?.email?.split("@")[0]||"User"}),e.jsx("p",{style:{color:"#6b7280",fontSize:"14px",marginBottom:"4px",margin:"4px 0",lineHeight:"1.3"},children:f?"":x?.email||"No email provided"}),x?.bio&&e.jsx("p",{style:{color:"#6b7280",fontSize:"13px",margin:"4px 0",lineHeight:"1.3"},children:x.bio}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"6px"},children:[e.jsx(Cd,{size:14,style:{color:"#fbbf24"}}),e.jsxs("span",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:["Rank #",ee.rank," • ",ee.level]})]})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginTop:"12px"},children:[e.jsxs("div",{style:{textAlign:"center",padding:"6px"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"700",color:"#111827"},children:ee.totalPredictions}),e.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:"Predictions"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"6px"},children:[e.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#059669"},children:[ee.winRate,"%"]}),e.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:"Win Rate"})]}),e.jsxs("div",{style:{textAlign:"center",padding:"6px"},children:[e.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#111827"},children:["$",(ee.totalEarnings-ee.totalInvested).toLocaleString()]}),e.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:"Net Profit"})]})]})]},"viewing")})})]}),e.jsxs("div",{style:{padding:"0 24px 100px 24px"},children:[e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",marginBottom:"16px",margin:"0 0 16px 0"},children:"Performance Overview"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",background:"rgba(5, 150, 105, 0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(st,{size:20,style:{color:"#059669"}})}),e.jsxs("div",{style:{minWidth:0},children:[e.jsxs("div",{style:{fontSize:"16px",fontWeight:"700",color:"#111827"},children:["$",ee.totalEarnings.toLocaleString()]}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Total Earnings"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[e.jsx("div",{style:{width:"40px",height:"40px",background:"rgba(59, 130, 246, 0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(Oe,{size:20,style:{color:"#3b82f6"}})}),e.jsxs("div",{style:{minWidth:0},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"700",color:"#111827"},children:ee.activePredictions}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Active"})]})]})]})]}),e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",margin:0},children:"Achievements"}),!f&&e.jsxs("button",{onClick:()=>u("leaderboard"),style:{background:"rgba(5, 150, 105, 0.1)",border:"1px solid rgba(5, 150, 105, 0.3)",borderRadius:"8px",padding:"6px 12px",fontSize:"12px",fontWeight:"600",color:"#059669",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s ease"},onMouseEnter:N=>{N.currentTarget.style.background="rgba(5, 150, 105, 0.15)"},onMouseLeave:N=>{N.currentTarget.style.background="rgba(5, 150, 105, 0.1)"},children:[e.jsx(Pr,{size:14}),"Leaderboard"]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",padding:"0 4px"},children:F.map(N=>e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px",padding:"12px 10px",borderRadius:"10px",backgroundColor:N.unlocked?"rgba(5, 150, 105, 0.05)":"#f9fafb",border:N.unlocked?"1px solid rgba(5, 150, 105, 0.2)":"1px solid #e5e7eb",opacity:N.unlocked?1:.7,minWidth:0,minHeight:"70px",transition:"all 0.2s ease"},children:[e.jsx("div",{style:{fontSize:"20px",flexShrink:0,paddingTop:"2px"},children:N.icon}),e.jsxs("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:[e.jsx("div",{style:{fontSize:"13px",fontWeight:"600",color:"#111827",lineHeight:"1.3",marginBottom:"2px",wordBreak:"break-word",hyphens:"auto"},children:N.title}),e.jsx("div",{style:{fontSize:"11px",color:"#6b7280",lineHeight:"1.3",wordBreak:"break-word",hyphens:"auto",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:N.description})]}),N.unlocked&&e.jsx("div",{style:{flexShrink:0,paddingTop:"2px"},children:e.jsx(Pr,{size:14,style:{color:"#059669"}})})]},N.id))})]}),!f&&e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",marginBottom:"16px",margin:"0 0 16px 0"},children:"Settings"}),e.jsx("div",{style:{display:"flex",flexDirection:"column"},children:q.map((N,z)=>{const R=N.icon;return e.jsxs("button",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 12px",background:"none",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"background-color 0.2s",borderBottom:z<q.length-1?"1px solid #f3f4f6":"none"},onMouseEnter:S=>{S.currentTarget.style.backgroundColor="#f9fafb"},onMouseLeave:S=>{S.currentTarget.style.backgroundColor="transparent"},onClick:N.action,children:[e.jsx("div",{style:{width:"40px",height:"40px",background:"rgba(107, 114, 128, 0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:e.jsx(R,{size:20,style:{color:"#6b7280"}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"#111827"},children:N.label}),e.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginTop:"2px"},children:N.description})]}),e.jsx(Ee,{size:20,style:{color:"#9ca3af",flexShrink:0}})]},N.id)})})]}),!f&&e.jsxs(e.Fragment,{children:[e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[e.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",marginBottom:"16px",margin:"0 0 16px 0"},children:"Account Information"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Email"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:s?.email||"Not provided"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Member Since"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:ee.joinedDate})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Account Status"}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#059669"},children:"Active"})]})]})]}),e.jsxs(P.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#dc2626",border:"none",borderRadius:"12px",cursor:"pointer",fontSize:"16px",fontWeight:"600",marginBottom:"20px",transition:"background-color 0.2s"},onClick:I,onMouseEnter:N=>N.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)",onMouseLeave:N=>N.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.1)",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(bd,{size:20}),e.jsx("span",{children:"Sign Out"})]})]})]})]})},Eh=({onNavigateBack:i})=>{const[t,s]=m.useState("overview"),[r,n]=m.useState(!1),[a,o]=m.useState(!1),[l,c]=m.useState(null),[d,u]=m.useState(""),{getBalance:h,getTransactionHistory:p,addFunds:f,resetDemoBalance:g,isDemoMode:x,initializeWallet:y}=ls(),{user:b}=oe(),[,v]=xe();m.useEffect(()=>{Ot({delay:200}),b?.id&&y()},[b?.id,y]);const j=h("USD")||0,k=p({currency:"USD"})||[],L=[10,25,50,100],C=async O=>{if(O<=0){G.error("Please enter a valid amount");return}n(!0);try{await f(O,"USD","Demo funds added"),G.success(`Successfully added $${O.toLocaleString()} to your wallet!`),c(null),u("")}catch{G.error("Failed to add funds. Please try again.")}finally{n(!1)}},$=async()=>{o(!0);try{await g(),G.success("Demo balance reset successfully!")}catch{G.error("Failed to reset demo balance. Please try again.")}finally{o(!1)}},J=()=>{i?i():v("/")},V=O=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(O),ee=O=>O.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),q=O=>{switch(O){case"deposit":return e.jsx(Es,{size:16,className:"text-emerald-500"});case"withdrawal":return e.jsx(Ed,{size:16,className:"text-red-500"});case"prediction":return e.jsx(Oe,{size:16,className:"text-blue-500"});case"win":return e.jsx(et,{size:16,className:"text-emerald-500"});default:return e.jsx(st,{size:16,className:"text-gray-500"})}},F=O=>{switch(O){case"deposit":case"win":return"text-emerald-600";case"withdrawal":case"prediction":return"text-red-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 wallet-page",children:[e.jsxs("div",{className:"bg-white border-b border-gray-100",children:[e.jsx("div",{className:"h-11"}),e.jsx("div",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between","data-tour-id":"wallet-balance",children:[e.jsx("button",{onClick:J,className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",children:e.jsx(yt,{size:20,className:"text-gray-700"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Wallet"}),x&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Demo Mode"})]}),e.jsx("div",{className:"w-10"})," "]})})]}),x&&e.jsx(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mx-4 mt-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Sr,{size:20,className:"text-white"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-white font-semibold text-sm",children:"Demo Funds"}),e.jsx("p",{className:"text-blue-100 text-xs",children:"This is a demo wallet. All transactions are simulated."})]})]})}),e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mx-4 mt-4 bg-gradient-to-br from-purple-500 to-emerald-600 rounded-2xl p-6 text-white","data-tour-id":"wallet-balance-card",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium text-green-100 uppercase tracking-wide",children:"Available Balance"}),e.jsx("div",{className:"text-3xl font-bold mt-1",children:V(j)})]}),e.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:e.jsx(st,{size:24,className:"text-white"})})]}),e.jsxs("div",{className:"flex gap-2","data-tour-id":"wallet-actions",children:[e.jsx("button",{onClick:()=>c(25),className:"flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-2 px-3 text-sm font-medium transition-all",children:"Add Funds"}),x&&e.jsx("button",{onClick:$,disabled:a,className:"flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-2 px-3 text-sm font-medium transition-all disabled:opacity-50",children:a?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ss,{size:14,className:"animate-spin"}),"Resetting..."]}):"Reset Demo"})]})]}),e.jsx("div",{className:"mx-4 mt-6",children:e.jsxs("div",{className:"bg-white rounded-xl p-1 flex",children:[e.jsx("button",{onClick:()=>s("overview"),className:`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${t==="overview"?"bg-emerald-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Overview"}),e.jsx("button",{onClick:()=>s("transactions"),className:`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${t==="transactions"?"bg-emerald-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Transactions"})]})}),e.jsx("div",{className:"mx-4 mt-4",children:e.jsx(fe,{mode:"wait",children:t==="overview"?e.jsxs(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Oe,{size:16,className:"text-emerald-500"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Won"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:V(k.filter(O=>O.type==="win").reduce((O,w)=>O+w.amount,0))})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pd,{size:16,className:"text-red-500"}),e.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Lost"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900",children:V(Math.abs(k.filter(O=>O.type==="prediction").reduce((O,w)=>O+w.amount,0)))})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"Recent Activity"})}),e.jsx("div",{className:"p-4",children:k.slice(0,3).length>0?e.jsx("div",{className:"space-y-3",children:k.slice(0,3).map((O,w)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:q(O.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:O.description}),e.jsx("div",{className:"text-xs text-gray-500",children:ee(O.date)})]}),e.jsxs("div",{className:`text-sm font-semibold ${F(O.type)}`,children:[O.amount>0?"+":"",V(O.amount)]})]},w))}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(tt,{size:24,className:"text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"No transactions yet"})]})})]})]},"overview"):e.jsx(P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-100",children:[e.jsx("div",{className:"p-4 border-b border-gray-100",children:e.jsx("h3",{className:"font-semibold text-gray-900",children:"All Transactions"})}),e.jsx("div",{className:"divide-y divide-gray-100",children:k.length>0?k.map((O,w)=>e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:q(O.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:O.description}),e.jsx("div",{className:"text-xs text-gray-500",children:ee(O.date)})]}),e.jsxs("div",{className:`text-sm font-semibold ${F(O.type)}`,children:[O.amount>0?"+":"",V(O.amount)]})]})},w)):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(tt,{size:32,className:"text-gray-400 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500",children:"No transactions yet"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Start making predictions to see your activity"})]})})]})},"transactions")})}),e.jsx(fe,{children:l!==null&&e.jsx(P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>c(null),children:e.jsxs(P.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl w-full max-w-sm p-6",onClick:O=>O.stopPropagation(),children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Add Demo Funds"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:L.map(O=>e.jsxs("button",{onClick:()=>u(O.toString()),className:`py-3 px-4 rounded-lg border-2 text-sm font-medium transition-all ${d===O.toString()?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-gray-200 text-gray-700 hover:border-gray-300"}`,children:["$",O]},O))}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",placeholder:"0",value:d,onChange:O=>u(O.target.value),className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",min:"1",max:"10000"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>c(null),className:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>C(parseFloat(d)||0),disabled:!d||parseFloat(d)<=0||r,className:`flex-1 py-3 rounded-lg font-medium transition-colors ${!d||parseFloat(d)<=0||r?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-emerald-600 text-white hover:bg-green-700"}`,children:r?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(ss,{size:16,className:"animate-spin"}),"Adding..."]}):"Add Funds"})]})]})})})]})},Th=()=>{const{login:i,register:t,loginWithOAuth:s,loading:r}=oe(),[n,a]=m.useState(""),[o,l]=m.useState(""),[c,d]=m.useState(""),[u,h]=m.useState(""),[p,f]=m.useState(""),[g,x]=m.useState(!1),[y,b]=m.useState(!1),[v,j]=m.useState(!0),[k,L]=m.useState(!1),[C,$]=m.useState({}),[J,V]=m.useState(null);m.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[]);const ee=R=>{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(R))return!1;const E=R.split("@"),D=E[0],T=E[1];if(D.length<1||D.length>64||T.length<3||T.length>255)return!1;const A=T.split(".");return A.length<2?!1:A.every(_=>_.length>0&&_.length<=63)},q=()=>{const R={};return n?ee(n)||(R.email="Please enter a valid email address (e.g., user@example.com)"):R.email="Email is required",o?o.length<6&&(R.password="Password must be at least 6 characters"):R.password="Password is required",v||(c.trim()||(R.firstName="First name is required"),u.trim()||(R.lastName="Last name is required"),p?o!==p&&(R.confirmPassword="Passwords do not match"):R.confirmPassword="Please confirm your password"),$(R),Object.keys(R).length===0},F=async R=>{if(R.preventDefault(),!(!q()||r)){$({}),V(null);try{v?await i(n,o):await t(n,o,c,u)}catch(S){console.error("Auth error:",S);let E="Authentication failed. Please try again.";if(S.message){const D=S.message.toLowerCase();D.includes("invalid")&&D.includes("credentials")?E="Invalid email or password. Please check your credentials and try again.":D.includes("user already registered")||D.includes("already exists")?(E="An account with this email already exists. Please try signing in instead.",setTimeout(()=>j(!0),2e3)):D.includes("email not confirmed")?E="Please check your email and confirm your account before signing in.":D.includes("too many requests")||D.includes("rate limit")?E="Too many attempts. Please wait a moment and try again.":D.includes("user not found")?(E="No account found with this email. Please register first.",v&&setTimeout(()=>j(!1),2e3)):E="Something went wrong. Please try again or contact support if the issue continues."}V(E)}}},O=async(R,S,E,D)=>{try{a(R),l(S),E&&d(E),D&&h(D),f(S),V(null),v?await i(R,S):await t(R,S,E||"Test",D||"User")}catch(T){console.error("Test auth error:",T),V(T.message||"Test authentication failed")}},w=async R=>{try{V(null),await s(R)}catch(S){console.error(`${R} auth error:`,S),V(`${R} sign-in failed. Please try again.`)}},I=()=>{j(!v),$({}),V(null),a(""),l(""),d(""),h(""),f(""),window.scrollTo({top:0,behavior:"smooth"})},N=()=>x(!g),z=()=>b(!y);return e.jsxs("div",{style:{minHeight:"100vh",width:"100%",maxWidth:"100vw",background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 30%, #ecfdf5 70%, #f0fdfa 100%)",display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"8px",position:"relative",overflow:"hidden",boxSizing:"border-box"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{position:"fixed",top:"10px",left:"10px",zIndex:1001},children:e.jsx("button",{onClick:()=>L(!k),style:{padding:"8px 12px",background:"#374151",color:"white",border:"none",borderRadius:"6px",fontSize:"12px",cursor:"pointer"},children:"🧪 Test Mode"})}),k&&e.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",background:"rgba(0, 0, 0, 0.9)",color:"white",padding:"16px",borderRadius:"8px",fontSize:"12px",zIndex:1e3,maxWidth:"280px"},children:[e.jsx("div",{style:{marginBottom:"12px",fontWeight:"bold",color:"#00ff88"},children:"🚀 FIXED AUTHENTICATION"}),e.jsx("div",{style:{marginBottom:"8px",fontSize:"10px",color:"#ccc"},children:"✅ Business domains now supported:"}),e.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#00F5D4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>O("userten@fcz.app","test123","User","Ten"),children:v?"🔑 Login userten@fcz.app":"📝 Register userten@fcz.app"}),e.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#00F5D4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>O("demo@example.com","demo123","Demo","User"),children:v?"🔑 Login demo@example.com":"📝 Register demo@example.com"}),e.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#00F5D4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>O("user@gmail.com","test123","Test","Person"),children:v?"🔑 Login user@gmail.com":"📝 Register user@gmail.com"}),e.jsx("div",{style:{margin:"12px 0 8px 0",fontSize:"10px",color:"#00ff88"},children:"✅ ALL email formats now work!"}),e.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#dc2626",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>L(!1),children:"❌ Close"})]})]}),e.jsx("style",{children:`
          @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
          }
          
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
          
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
          }
          
          @media (max-width: 768px) {
            .auth-card {
              padding: 16px !important;
              margin: 8px !important;
              max-width: calc(100vw - 16px) !important;
              width: calc(100vw - 16px) !important;
              min-height: calc(100vh - 16px) !important;
              border-radius: 16px !important;
              box-sizing: border-box !important;
              overflow: hidden !important;
            }
            
            .auth-card h1 {
              font-size: 28px !important;
            }
            
            .auth-card p {
              font-size: 14px !important;
            }
          }
          
          .auth-error {
            animation: shake 0.5s ease-in-out;
          }
        `}),e.jsx("div",{style:{position:"absolute",top:"-160px",right:"-160px",width:"320px",height:"320px",background:"radial-gradient(circle, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 50%, transparent 100%)",borderRadius:"50%",filter:"blur(40px)",animation:"float 8s ease-in-out infinite"}}),e.jsx("div",{style:{position:"absolute",bottom:"-160px",left:"-160px",width:"320px",height:"320px",background:"radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.03) 50%, transparent 100%)",borderRadius:"50%",filter:"blur(40px)",animation:"float 10s ease-in-out infinite reverse"}}),e.jsxs("div",{className:"auth-card",style:{width:"100%",maxWidth:"calc(100vw - 16px)",minHeight:"calc(100vh - 16px)",backgroundColor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",borderRadius:"24px",padding:"24px",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.3)",position:"relative",zIndex:10,margin:"8px",marginTop:"8px",display:"flex",flexDirection:"column",justifyContent:"flex-start",boxSizing:"border-box",overflow:"hidden"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px",filter:"drop-shadow(0 12px 24px rgba(123, 47, 247, 0.3))"},children:e.jsx(da,{size:"xl",variant:"icon"})}),e.jsx("h1",{style:{fontSize:"32px",fontWeight:"bold",color:"#111827",marginBottom:"8px",margin:"0 0 8px 0",background:"linear-gradient(135deg, #111827 0%, #374151 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",lineHeight:"1.2"},children:v?"Welcome Back":"Join Fan Club Z"}),e.jsx("p",{style:{fontSize:"16px",color:"#6b7280",margin:"0",lineHeight:"1.5"},children:v?"Sign in to continue your prediction journey":"Create your account and start making predictions"})]}),J&&e.jsxs("div",{className:"auth-error",style:{marginBottom:"20px",padding:"16px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",color:"#dc2626",fontSize:"14px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[e.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",style:{flexShrink:0,marginTop:"2px"},children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"600",marginBottom:"4px"},children:v?"Sign In Failed":"Registration Failed"}),e.jsx("div",{style:{lineHeight:"1.4"},children:J}),J.includes("valid email")&&e.jsx("div",{style:{marginTop:"8px",fontSize:"12px",color:"#7c2d12",background:"rgba(34, 197, 94, 0.1)",padding:"8px",borderRadius:"6px"},children:"✅ Business domains like @fcz.app, @company.com are now fully supported!"})]})]}),e.jsxs("div",{style:{marginBottom:"32px"},children:[e.jsxs("p",{style:{fontSize:"15px",color:"#6b7280",textAlign:"center",marginBottom:"16px",fontWeight:"500"},children:["Recommended: Quick ",v?"sign in":"sign up"," with Google"]}),e.jsxs("button",{type:"button",onClick:()=>w("google"),disabled:r,style:{width:"100%",height:"56px",backgroundColor:"#4285F4",border:"none",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",fontSize:"16px",fontWeight:"600",color:"white",cursor:r?"not-allowed":"pointer",opacity:r?"0.7":"1",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 8px 16px rgba(66, 133, 244, 0.3)",transform:"translateY(0)",position:"relative",overflow:"hidden"},onMouseEnter:R=>{R.currentTarget.style.transform="translateY(-2px)",R.currentTarget.style.boxShadow="0 12px 24px rgba(66, 133, 244, 0.4)"},onMouseLeave:R=>{R.currentTarget.style.transform="translateY(0)",R.currentTarget.style.boxShadow="0 8px 16px rgba(66, 133, 244, 0.3)"},children:[r?e.jsx("div",{style:{width:"24px",height:"24px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"white",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"white",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"white",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"white",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),e.jsxs("div",{style:{position:"relative",textAlign:"center",margin:"24px 0",fontSize:"14px",color:"#6b7280"},children:[e.jsx("div",{style:{position:"absolute",top:"50%",left:"0",right:"0",height:"1px",backgroundColor:"#e5e7eb"}}),e.jsxs("span",{style:{backgroundColor:"white",padding:"0 16px",position:"relative",zIndex:1},children:["Or ",v?"sign in":"sign up"," with email"]})]}),e.jsxs("form",{onSubmit:F,style:{marginBottom:"20px",flex:1},children:[!v&&e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"18px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"First Name"}),e.jsx("input",{type:"text",value:c,onChange:R=>d(R.target.value),placeholder:"Enter first name",style:{width:"100%",padding:"14px 16px",border:`2px solid ${C.firstName?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!v}),C.firstName&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),C.firstName]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Last Name"}),e.jsx("input",{type:"text",value:u,onChange:R=>h(R.target.value),placeholder:"Enter last name",style:{width:"100%",padding:"14px 16px",border:`2px solid ${C.lastName?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!v}),C.lastName&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),C.lastName]})]})]}),e.jsxs("div",{style:{marginBottom:"18px",position:"relative"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Email Address"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"email",value:n,onChange:R=>a(R.target.value),placeholder:"Enter your email address",style:{width:"100%",padding:"14px 16px",paddingRight:"52px",border:`2px solid ${C.email?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!0}),e.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"20px",color:"#9ca3af",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})})]}),C.email&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),C.email]})]}),e.jsxs("div",{style:{marginBottom:"18px",position:"relative"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Password"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:g?"text":"password",value:o,onChange:R=>l(R.target.value),placeholder:"Enter your password",style:{width:"100%",padding:"14px 16px",paddingRight:"52px",border:`2px solid ${C.password?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!0}),e.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"20px",color:"#9ca3af",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"all 0.2s"},onClick:N,children:g?e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):e.jsxs("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),C.password&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),C.password]})]}),!v&&e.jsxs("div",{style:{marginBottom:"18px",position:"relative"},children:[e.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Confirm Password"}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:y?"text":"password",value:p,onChange:R=>f(R.target.value),placeholder:"Confirm your password",style:{width:"100%",padding:"14px 16px",paddingRight:"52px",border:`2px solid ${C.confirmPassword?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!v}),e.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"20px",color:"#9ca3af",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"all 0.2s"},onClick:z,children:y?e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):e.jsxs("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),C.confirmPassword&&e.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),C.confirmPassword]})]}),v&&e.jsx("div",{style:{textAlign:"right",marginBottom:"20px"},children:e.jsx("a",{href:"#",onClick:R=>{R.preventDefault(),alert("Password reset functionality will be available soon!")},style:{color:"#00F5D4",textDecoration:"none",fontSize:"14px",fontWeight:"500",padding:"4px 8px",borderRadius:"6px",transition:"all 0.2s"},children:"Forgot your password?"})}),e.jsx("button",{type:"submit",disabled:r,style:{width:"100%",height:"56px",background:"linear-gradient(135deg, #00F5D4 0%, #7B2FF7 100%)",color:"white",border:"none",borderRadius:"16px",fontSize:"16px",fontWeight:"600",cursor:r?"not-allowed":"pointer",opacity:r?"0.8":"1",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 8px 16px rgba(16, 185, 129, 0.3)",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:r?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"20px",height:"20px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),v?"Signing in...":"Creating account..."]}):v?"Sign In":"Create Account"})]}),e.jsx("div",{style:{textAlign:"center",paddingTop:"20px",paddingBottom:"16px",borderTop:"1px solid #f3f4f6"},children:e.jsxs("p",{style:{color:"#6b7280",fontSize:"15px",margin:"0"},children:[v?"Don't have an account?":"Already have an account?"," ",e.jsx("a",{href:"#",onClick:R=>{R.preventDefault(),I()},style:{color:"#00F5D4",textDecoration:"none",fontWeight:"600",padding:"8px 12px",borderRadius:"6px",transition:"all 0.2s",display:"inline-block",marginTop:"8px"},children:v?"Create one now":"Sign in"})]})})]}),e.jsx(Rn,{})]})},Ah=()=>{const{handleOAuthCallback:i,isAuthenticated:t,loading:s}=oe(),[,r]=xe(),[n,a]=m.useState(!1),[o,l]=m.useState(null);return m.useEffect(()=>{let c=!0;const u=setTimeout(async()=>{if(!n)try{console.log("🔄 Processing OAuth callback..."),a(!0),await i(),setTimeout(()=>{c&&(console.log("✅ OAuth callback processed, redirecting to app..."),r("/"))},1e3)}catch(h){console.error("❌ OAuth callback processing failed:",h),c&&(l(h.message||"Authentication failed"),setTimeout(()=>{window.location.href="/auth?error=oauth_failed"},3e3))}},100);return()=>{c=!1,clearTimeout(u)}},[i,n,r]),m.useEffect(()=>{t&&!s&&(console.log("✅ User already authenticated, redirecting..."),r("/"))},[t,s,r]),o?e.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 30%, #ecfdf5 70%, #f0fdfa 100%)"},children:e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15)",textAlign:"center",maxWidth:"400px",width:"90%",border:"1px solid #fee2e2"},children:[e.jsx("div",{style:{width:"60px",height:"60px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",borderRadius:"50%",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("svg",{width:"24",height:"24",fill:"white",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})}),e.jsx("h2",{style:{margin:"0 0 12px 0",color:"#111827",fontSize:"24px",fontWeight:"bold"},children:"Authentication Failed"}),e.jsx("p",{style:{margin:"0 0 24px 0",color:"#6b7280",fontSize:"16px"},children:o}),e.jsx("p",{style:{margin:"0",color:"#9ca3af",fontSize:"14px"},children:"Redirecting to login page in a few seconds..."})]})}):e.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 30%, #ecfdf5 70%, #f0fdfa 100%)"},children:[e.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15)",textAlign:"center",maxWidth:"400px",width:"90%"},children:[e.jsx("div",{style:{width:"60px",height:"60px",background:"linear-gradient(135deg, #00F5D4 0%, #7B2FF7 100%)",borderRadius:"50%",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",animation:"spin 2s linear infinite"},children:e.jsx("span",{style:{fontSize:"24px",color:"white"},children:"Z"})}),e.jsx("h2",{style:{margin:"0 0 12px 0",color:"#111827",fontSize:"24px",fontWeight:"bold"},children:"Completing Sign In..."}),e.jsx("p",{style:{margin:"0 0 24px 0",color:"#6b7280",fontSize:"16px"},children:"Please wait while we finish setting up your account."}),e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"4px"},children:[0,1,2].map(c=>e.jsx("div",{style:{width:"8px",height:"8px",background:"#00F5D4",borderRadius:"50%",animation:`bounce 1.4s ease-in-out ${c*.16}s infinite both`}},c))}),e.jsxs("div",{style:{marginTop:"20px",fontSize:"12px",color:"#9ca3af"},children:["Processed: ",n?"Yes":"No"," | Authenticated: ",t?"Yes":"No"," | Loading: ",s?"Yes":"No"]})]}),e.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
          
          @keyframes bounce {
            0%, 80%, 100% {
              transform: scale(0);
            }
            40% {
              transform: scale(1);
            }
          }
        `})]})},$h=({isOpen:i,onClose:t,predictionId:s,predictionTitle:r})=>{const[n,a]=m.useState(null),[o,l]=m.useState(!0),[c,d]=m.useState(!1),[u,h]=m.useState(""),[p,f]=m.useState(!1),{user:g}=oe();m.useEffect(()=>{i&&g?.id&&x()},[i,g?.id,s]);const x=async()=>{try{l(!0);const b=await fetch(`${de()}/api/v2/settlement/${s}/status?userId=${g?.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!b.ok)throw new Error("Failed to fetch settlement status");const v=await b.json();a(v.data)}catch(b){console.error("Error fetching settlement status:",b),Y.error("Failed to load settlement information")}finally{l(!1)}},y=async b=>{try{if(d(!0),!(await fetch(`${de()}/api/v2/settlement/${s}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g?.id,action:b,reason:b==="dispute"?u:void 0})})).ok)throw new Error(`Failed to ${b} settlement`);Y.success(b==="accept"?"Settlement accepted successfully!":"Dispute submitted successfully!"),t()}catch(v){console.error(`Error ${b}ing settlement:`,v),Y.error(`Failed to ${b} settlement`)}finally{d(!1)}};return i?e.jsx(fe,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs(P.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Settlement Validation"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ge,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:o?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"})}):n?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:r}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(st,{className:"w-4 h-4"}),e.jsxs("span",{children:["Pool: $",n.prediction.pool_total.toLocaleString()]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n.prediction.status==="settled"?"bg-emerald-100 text-emerald-800":n.prediction.status==="disputed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:n.prediction.status})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Your Entry"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount Staked:"}),e.jsxs("span",{className:"font-medium",children:["$",n.userEntry.amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ${n.userEntry.status==="won"?"text-emerald-600":n.userEntry.status==="lost"?"text-red-600":n.userEntry.status==="refunded"?"text-blue-600":"text-yellow-600"}`,children:n.userEntry.status})]}),n.userEntry.actual_payout>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payout:"}),e.jsxs("span",{className:"font-medium text-emerald-600",children:["$",n.userEntry.actual_payout.toLocaleString()]})]})]})]}),n.settlement?e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Settlement Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Payout:"}),e.jsxs("span",{className:"font-medium",children:["$",n.settlement.total_payout.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Settled At:"}),e.jsx("span",{className:"font-medium",children:new Date(n.settlement.settlement_time).toLocaleDateString()})]})]})]}):n.needsSettlement?e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(tt,{className:"w-4 h-4 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-900",children:"Awaiting Settlement"})]}),e.jsx("p",{className:"text-sm text-yellow-800",children:"This prediction is waiting for the creator to provide settlement details."})]}):null,n.canValidate&&n.settlement&&!p&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Validate Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Do you agree with this settlement outcome?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>y("accept"),disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[e.jsx(et,{className:"w-4 h-4"}),"Accept"]}),e.jsxs("button",{onClick:()=>f(!0),disabled:c,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(Se,{className:"w-4 h-4"}),"Dispute"]})]})]}),p&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Dispute Settlement"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Dispute"}),e.jsx("textarea",{value:u,onChange:b=>h(b.target.value),placeholder:"Please explain why you disagree with this settlement...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",rows:4})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>f(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:()=>y("dispute"),disabled:c||!u.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:"Submit Dispute"})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"Failed to load settlement information"})})})]})})}):null},ar=({id:i,value:t,onValueChange:s,placeholder:r,rows:n=3,maxLength:a=500,autoFocus:o=!1,className:l="",disabled:c=!1})=>{const d=m.useCallback(u=>{s(u.target.value)},[s]);return e.jsx("textarea",{id:i,value:t,onChange:d,className:`w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors ${l}`,rows:n,placeholder:r,maxLength:a,disabled:c,autoFocus:o,spellCheck:!1,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",style:{minHeight:`${n*1.5}rem`,fontFamily:"inherit"}})},Rh=({predictionId:i})=>{const{user:t}=oe(),{comments:s,commentCount:r,isLoading:n,error:a,isSubmitting:o,fetchComments:l,addComment:c,toggleCommentLike:d,editComment:u,deleteComment:h,clearError:p}=Hr(i),[f,g]=m.useState(""),[x,y]=m.useState({}),[b,v]=m.useState({}),[j,k]=m.useState(null),[L,C]=m.useState(null),[$,J]=m.useState(!1),V=m.useRef(i);m.useEffect(()=>{V.current!==i&&(V.current=i,J(!1))},[i]),m.useEffect(()=>{i&&i.trim()&&!$&&!n&&(console.log(`🔄 Fetching comments for prediction ${i}`),J(!0),l().catch(A=>{console.error("❌ Failed to fetch comments:",A),J(!1)}))},[i,$,n,l]),m.useEffect(()=>{console.log(`📊 CommentSystem for ${i}: count=${r}, comments.length=${s.length}`)},[i,r,s.length]);const[ee,q]=m.useState(10);m.useEffect(()=>{q(Math.min(10,s.length||0))},[s.length]);const F=m.useCallback(async A=>{const _=A?x[A]||"":f;if(_.trim()){if(!t){console.error("User not authenticated");return}try{await c(_.trim(),A,{id:t.id,username:t.firstName||t.email?.split("@")[0]||"Anonymous",full_name:`${t.firstName} ${t.lastName}`.trim()||t.email?.split("@")[0]||"Anonymous User",avatar_url:t.avatar,is_verified:!1}),A?(y(K=>({...K,[A]:""})),k(null)):g("")}catch(K){console.error("Failed to add comment:",K)}}},[t,f,x,c]),O=m.useCallback(async A=>{if(t)try{await d(A)}catch(_){console.error("Failed to toggle like:",_)}},[t,d]),w=m.useCallback((A,_)=>{y(K=>({...K,[A]:_}))},[]),I=m.useCallback((A,_)=>{v(K=>({...K,[A]:_}))},[]),N=m.useCallback((A,_)=>{C(A),v(K=>({...K,[A]:_}))},[]),z=m.useCallback(A=>{C(null),v(_=>{const K={..._};return delete K[A],K})},[]),R=m.useCallback(async A=>{const _=(b[A]||"").trim();if(_)try{await u(A,_),C(null),G.success("Comment updated")}catch(K){console.error("Failed to edit comment:",K),G.error("Failed to update comment")}},[b,u]),S=m.useCallback(async A=>{try{const _={...A};await h(A.id),G(K=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{children:"Comment deleted"}),e.jsx("button",{onClick:async()=>{G.dismiss(K.id);try{await c(_.content,_.parent_comment_id||void 0,t?{id:t.id,username:t.firstName||t.email?.split("@")[0]||"Anonymous",full_name:`${t.firstName} ${t.lastName}`.trim()||t.email?.split("@")[0]||"Anonymous User",avatar_url:t.avatar,is_verified:!1}:void 0),G.success("Comment restored")}catch{G.error("Unable to restore comment")}},className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded",children:"Undo"})]}),{duration:5e3})}catch(_){console.error("Failed to delete comment:",_),G.error("Failed to delete comment")}},[h,c,t]),E=m.useCallback(A=>{k(A),y(_=>({..._,[A]:""}))},[]),D=m.useCallback(A=>{k(null),y(_=>{const K={..._};return delete K[A],K})},[]),T=ue.memo(function A({comment:_,isReply:K=!1}){const[se,re]=m.useState(!1),$e=L===_.id,ke=j===_.id,[ie,Le]=m.useState(!0),_e=(_.replies_count??(_.replies?.length||0))||0;return e.jsx("div",{className:`comment-item ${K?"ml-8 pl-4 border-l-2 border-gray-100":""} p-4 bg-white rounded-lg border border-gray-100 shadow-sm hover:shadow-md transition-shadow`,children:e.jsxs("div",{className:"flex space-x-3",children:[_.user?.avatar_url&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("img",{src:_.user.avatar_url,alt:_.user.username,className:"w-8 h-8 rounded-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(is,{username:_.user?.username||_.username||"Anonymous",userId:_.user?.id,className:"font-semibold text-sm text-gray-900 hover:text-teal-600 transition-colors"}),(_.user?.is_verified||_.is_verified)&&e.jsx("span",{className:"text-blue-500 text-xs",children:"✓"}),e.jsx("span",{className:"text-xs text-gray-500",children:_.created_at?Sa(new Date(_.created_at),{addSuffix:!0}):"Recently"}),_.is_edited&&e.jsx("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),e.jsx("div",{className:"mb-2",children:$e?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ar,{id:`edit-textarea-${_.id}`,value:b[_.id]||_.content,onValueChange:we=>I(_.id,we),placeholder:"Edit your comment...",rows:2,maxLength:500,autoFocus:!0}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[(b[_.id]||"").length,"/500"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>R(_.id),disabled:!(b[_.id]||"").trim(),className:"px-3 py-1 bg-teal-600 text-white text-xs rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save"}),e.jsx("button",{onClick:()=>z(_.id),className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]})]}):e.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap leading-relaxed",children:_.content})}),e.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[e.jsxs("button",{onClick:()=>O(_.id),className:`flex items-center space-x-1 hover:text-red-500 transition-colors ${_.is_liked?"text-red-500":"text-gray-500"}`,children:[e.jsx(vt,{size:14,className:_.is_liked?"fill-current":""}),e.jsx("span",{children:_.likes_count||0})]}),!K&&e.jsxs("button",{onClick:()=>ke?D(_.id):E(_.id),className:"flex items-center space-x-1 text-gray-500 hover:text-blue-500 transition-colors",children:[e.jsx(Nd,{size:14}),e.jsx("span",{children:ke?"Cancel":"Reply"})]}),!K&&_e>0&&e.jsx("button",{onClick:()=>Le(!ie),className:"text-gray-500 hover:text-gray-700",children:ie?`Hide replies (${_e})`:`Show replies (${_e})`}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>re(!se),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:e.jsx(wd,{size:14})}),se&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>re(!1)}),e.jsx("div",{className:"absolute right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 min-w-[120px]",children:_.is_own?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{N(_.id,_.content),re(!1)},className:"flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(jd,{size:14,className:"mr-2"}),"Edit"]}),e.jsxs("button",{onClick:()=>{re(!1),S(_)},className:"flex items-center w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[e.jsx(Bn,{size:14,className:"mr-2"}),"Delete"]})]}):e.jsxs("button",{onClick:()=>{re(!1)},className:"flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[e.jsx(gd,{size:14,className:"mr-2"}),"Report"]})})]})]})]}),ke&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(ar,{id:`reply-textarea-${_.id}`,value:x[_.id]||"",onValueChange:we=>w(_.id,we),placeholder:`Reply to ${_.user?.username||_.username}...`,rows:2,maxLength:500,autoFocus:!0}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[(x[_.id]||"").length,"/500"]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>F(_.id),disabled:!(x[_.id]||"").trim()||o,className:"px-3 py-1 bg-teal-600 text-white text-xs rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Replying...":"Reply"}),e.jsx("button",{onClick:()=>D(_.id),className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]})]}),ie&&_.replies&&_.replies.length>0&&e.jsx("div",{className:"mt-3",children:_.replies.map((we,U)=>e.jsx(A,{comment:we,isReply:!0},we.id||`${i}-reply-${U}`))})]})]})})});return e.jsxs("div",{className:"comment-system bg-white",children:[e.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(Fe,{size:20,className:"mr-2"}),"Comments (",r,")"]})}),a&&e.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-red-800 text-sm",children:a}),e.jsx("button",{onClick:p,className:"text-red-600 hover:text-red-800 text-sm",children:"Dismiss"})]})}),t&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"w-full",children:[e.jsx(ar,{id:"main-textarea",value:f,onValueChange:g,placeholder:"Share your thoughts...",rows:3,maxLength:500}),e.jsxs("div",{className:"flex justify-between items-center mt-3",children:[e.jsxs("span",{className:"text-xs text-gray-500",children:[f.length,"/500"]}),e.jsx("button",{onClick:()=>F(),disabled:!f.trim()||o,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:o?"Posting...":"Comment"})]})]})}),!t&&e.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:e.jsxs("p",{className:"text-gray-600 text-center",children:["Please ",e.jsx("span",{className:"text-teal-600 font-medium",children:"sign in"})," to join the conversation"]})}),n&&e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading comments..."})]}),!n&&e.jsx("div",{className:"divide-y divide-gray-100",children:s.map((A,_)=>e.jsx(T,{comment:A},A.id||`${i}-comment-${_}`))}),!n&&s.length===0&&!a&&e.jsxs("div",{className:"p-8 text-center text-gray-500",children:[e.jsx(Fe,{size:48,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h4",{className:"text-lg font-medium mb-2",children:"No comments yet"}),e.jsx("p",{children:"Be the first to share your thoughts!"})]})]})},Ih=({predictionId:i,settlementData:t,userHasEntry:s=!1,className:r=""})=>{const{acceptOutcome:n,setDisputeModalOpen:a,loading:o}=Wt(),[l,c]=m.useState(""),[d,u]=m.useState(!1);m.useEffect(()=>{if(!t.settled_at||t.state!=="settled")return;const f=()=>{const x=new Date(t.settled_at),y=new Date(x.getTime()+t.acceptance_window_hours*60*60*1e3),b=new Date,v=y.getTime()-b.getTime();if(v<=0){u(!0),c("Expired");return}const j=Math.floor(v/(1e3*60*60)),k=Math.floor(v%(1e3*60*60)/(1e3*60));c(`${j.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")} remaining`)};f();const g=setInterval(f,6e4);return()=>clearInterval(g)},[t.settled_at,t.acceptance_window_hours]);const h=async()=>{try{await n(i)}catch(f){console.error("Failed to accept outcome:",f)}},p=()=>{a(!0)};return t.state!=="settled"||!s||d?null:e.jsx("div",{className:`
      fixed bottom-0 left-0 right-0 z-50
      bg-white border-t border-gray-200 
      p-4 pb-safe-area-inset-bottom
      ${r}
    `,children:e.jsxs("div",{className:"max-w-lg mx-auto",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsxs("p",{className:"text-xs text-gray-600",children:["Review proof and Accept or Dispute within"," ",e.jsx("span",{className:"font-semibold text-amber-600",children:l})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"No action → auto-accept"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:h,disabled:o,className:`flex-1 bg-emerald-600 hover:bg-green-700 disabled:bg-emerald-400
                       text-white font-semibold py-3 px-4 rounded-lg
                       transition-colors duration-200
                       flex items-center justify-center gap-2`,children:o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Accepting..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-lg",children:"✓"}),e.jsx("span",{children:"Accept"})]})}),e.jsx("button",{onClick:p,disabled:o,className:`px-6 py-3 text-gray-700 hover:text-gray-900 
                       font-medium border border-gray-300 hover:border-gray-400
                       rounded-lg transition-colors duration-200`,children:"Dispute"})]})]})})},Oh=({events:i,className:t=""})=>{const s=(l,c)=>{switch(l.toLowerCase()){case"locked":return"🔒";case"source_fetched":return"📥";case"settled":return"✅";case"disputed":return"⚠️";case"voided":return"❌";case"accepted":return"👍";default:return c==="system"?"⚙️":"👤"}},r=l=>{switch(l.toLowerCase()){case"settled":return"text-emerald-600";case"disputed":return"text-red-600";case"voided":return"text-red-600";case"locked":return"text-amber-600";case"source_fetched":return"text-blue-600";case"accepted":return"text-emerald-600";default:return"text-gray-600"}},n=(l,c)=>{switch(l){case"system":return"System";case"oracle":return"Oracle";case"admin":return`Admin ${c?`(${c.slice(0,8)})`:""}`;case"user":return`User ${c?`(${c.slice(0,8)})`:""}`;default:return l}},a=l=>l.split("_").map(c=>c.charAt(0).toUpperCase()+c.slice(1)).join(" "),o=l=>new Date(l).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"});return!i||i.length===0?e.jsx("div",{className:`text-center py-8 text-gray-500 ${t}`,children:e.jsx("p",{className:"text-sm",children:"No audit events available"})}):e.jsxs("div",{className:`space-y-4 ${t}`,children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Audit Timeline"}),e.jsx("div",{className:"space-y-3",children:i.map((l,c)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:`
                w-8 h-8 rounded-full border-2 border-white 
                flex items-center justify-center text-xs
                ${r(l.event)} bg-gray-50
              `,children:s(l.event,l.actor_type)}),c<i.length-1&&e.jsx("div",{className:"w-0.5 bg-gray-200 h-6 mt-2"})]}),e.jsxs("div",{className:"flex-1 min-w-0 pb-2",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h5",{className:`text-sm font-medium ${r(l.event)}`,children:a(l.event)}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["by ",n(l.actor_type,l.actor_id)]})]}),e.jsx("time",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:o(l.timestamp)})]}),l.data&&Object.keys(l.data).length>0&&e.jsx("div",{className:"mt-2 p-2 bg-gray-50 rounded text-xs",children:e.jsx("pre",{className:"text-gray-700 whitespace-pre-wrap",children:JSON.stringify(l.data,null,2)})})]})]},l.id))})]})},Lh=({dispute:i,className:t=""})=>{const s=a=>{switch(a){case"open":return"bg-amber-100 text-amber-800 border-amber-200";case"under_review":return"bg-blue-100 text-blue-800 border-blue-200";case"upheld":return"bg-red-100 text-red-800 border-red-200";case"overturned":return"bg-emerald-100 text-emerald-800 border-emerald-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},r=a=>{switch(a){case"wrong_source":return"Wrong Source Used";case"timing":return"Timing Issue";case"source_updated":return"Source Was Updated";case"other":return"Other";default:return a}},n=a=>new Date(a).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${t}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-red-500 text-sm",children:"⚠️"}),e.jsxs("span",{className:"font-semibold text-gray-900 text-sm",children:["Dispute #",i.id.slice(0,8)]})]}),e.jsx("div",{className:`
          px-2 py-1 rounded-full text-xs font-medium border
          ${s(i.state)}
        `,children:i.state.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Reason:"}),e.jsx("p",{className:"text-sm text-gray-900 mt-1",children:r(i.reason)})]}),i.evidence&&i.evidence.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Evidence:"}),e.jsx("div",{className:"mt-1 space-y-1",children:i.evidence.map((a,o)=>e.jsx("div",{className:"text-sm",children:a.type==="link"?e.jsx("a",{href:a.value,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 underline",children:a.value}):e.jsx("span",{className:"text-gray-700",children:a.value})},o))})]}),i.resolution_note&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 rounded border",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500",children:"Resolution:"}),e.jsx("p",{className:"text-sm text-gray-700 mt-1",children:i.resolution_note})]}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[e.jsxs("div",{children:["Created: ",n(i.created_at)]}),i.updated_at&&i.updated_at!==i.created_at&&e.jsxs("div",{children:["Updated: ",n(i.updated_at)]})]})]})},Dh=({predictionId:i,isOpen:t,onClose:s})=>{const{createDispute:r,loading:n}=Wt(),[a,o]=m.useState("wrong_source"),[l,c]=m.useState(""),[d,u]=m.useState(""),h=[{value:"wrong_source",label:"Wrong Source Used",desc:"The settlement used an incorrect or unreliable source"},{value:"timing",label:"Timing Issue",desc:"Settlement occurred at wrong time or before event completion"},{value:"source_updated",label:"Source Was Updated",desc:"The source corrected or updated the information after settlement"},{value:"other",label:"Other",desc:"Other reason (please specify below)"}],p=async f=>{f.preventDefault();const g=l.split(`
`).filter(x=>x.trim()).map(x=>({type:"link",value:x.trim()}));a==="other"&&d.trim()&&g.push({type:"link",value:`Custom reason: ${d}`});try{await r(i,a,g),s(),o("wrong_source"),c(""),u("")}catch(x){console.error("Failed to create dispute:",x)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Dispute Settlement"}),e.jsxs("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Please provide a reason for your dispute and any supporting evidence."})]}),e.jsxs("form",{onSubmit:p,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Reason for dispute"}),e.jsx("div",{className:"space-y-2",children:h.map(f=>e.jsxs("label",{className:"flex items-start gap-3 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"reason",value:f.value,checked:a===f.value,onChange:g=>o(g.target.value),className:"mt-1 text-blue-600 focus:ring-blue-500"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:f.label}),e.jsx("div",{className:"text-xs text-gray-500",children:f.desc})]})]},f.value))})]}),a==="other"&&e.jsxs("div",{children:[e.jsx("label",{htmlFor:"customReason",className:"block text-sm font-medium text-gray-700 mb-1",children:"Please specify"}),e.jsx("textarea",{id:"customReason",value:d,onChange:f=>u(f.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Describe the issue in detail...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"evidence",className:"block text-sm font-medium text-gray-700 mb-1",children:"Supporting evidence (optional)"}),e.jsx("textarea",{id:"evidence",value:l,onChange:f=>c(f.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Paste URLs to supporting evidence, one per line..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Include links to news articles, official sources, or other relevant evidence."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:s,className:"flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 disabled:bg-red-400",disabled:n,children:n?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Submitting..."})]}):"Submit Dispute"})]})]}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("div",{className:"text-xs text-gray-500 bg-gray-50 rounded p-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," We've received your dispute. A reviewer will follow up within 24 hours. Fraudulent disputes may result in account restrictions."]})})})]})}):null},zh=({proof:i,className:t=""})=>{const s=async()=>{try{await navigator.clipboard.writeText(i.content_hash)}catch(a){console.error("Failed to copy hash:",a)}},r=()=>{window.open(i.source_url,"_blank","noopener,noreferrer")},n=a=>new Date(a).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"});return e.jsx("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${t}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-16 h-12 bg-gray-100 rounded border flex items-center justify-center flex-shrink-0",children:i.screenshot_url?e.jsx("img",{src:i.screenshot_url,alt:"Settlement proof",className:"w-full h-full object-cover rounded",loading:"lazy"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"📄"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 truncate",children:"Settlement Proof"}),e.jsx("span",{className:"text-xs text-gray-500 ml-2 flex-shrink-0",children:n(i.fetched_at)})]}),i.parser_note&&e.jsx("p",{className:"text-sm text-gray-700 mb-2",children:i.parser_note}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:r,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Open source ↗"}),e.jsx("button",{onClick:s,className:"text-xs text-gray-600 hover:text-gray-800 font-medium",title:`Hash: ${i.content_hash}`,children:"Copy hash"})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-500 font-mono truncate",children:[i.content_hash.slice(0,16),"...",i.content_hash.slice(-8)]})]})]})})},Uh=({method:i,badges:t=[],className:s=""})=>{const r=()=>t.includes("Oracle")?{text:"Oracle",icon:"🔮",bgColor:"bg-purple-100",textColor:"text-purple-700",borderColor:"border-purple-200"}:t.includes("Auto-Settled")?{text:"Auto-Settled",icon:"⚡",bgColor:"bg-emerald-100",textColor:"text-emerald-700",borderColor:"border-emerald-200"}:t.includes("Manual-Checked")?{text:"Manual-Checked",icon:"✓",bgColor:"bg-blue-100",textColor:"text-blue-700",borderColor:"border-blue-200"}:i==="auto"?{text:"Auto-Settlement",icon:"⚡",bgColor:"bg-gray-100",textColor:"text-gray-700",borderColor:"border-gray-200"}:{text:"Manual Settlement",icon:"👤",bgColor:"bg-amber-100",textColor:"text-amber-700",borderColor:"border-amber-200"},{text:n,icon:a,bgColor:o,textColor:l,borderColor:c}=r();return e.jsxs("div",{className:`
      inline-flex items-center gap-1.5 px-2.5 py-1 
      ${o} ${l} ${c}
      border rounded-full text-xs font-medium
      ${s}
    `,children:[e.jsx("span",{className:"text-xs",children:a}),e.jsx("span",{children:n})]})},Mh=({predictionId:i,state:t,userHasEntry:s=!1,className:r=""})=>{const{settlements:n,fetchSettlement:a}=Wt(),[o,l]=m.useState(null);m.useEffect(()=>{a(i)},[i,a]),m.useEffect(()=>{n[i]&&l(n[i])},[n,i]);const d=(()=>{switch(t){case"settling":return{title:"Settlement in Progress",description:"We're fetching the official result...",icon:"⏳",bgColor:"bg-blue-50",textColor:"text-blue-700",borderColor:"border-blue-200"};case"settled":return{title:"Settlement Complete",description:"Official outcome has been determined",icon:"✅",bgColor:"bg-emerald-50",textColor:"text-emerald-700",borderColor:"border-emerald-200"};case"voided":return{title:"Event Voided",description:"Event postponed/cancelled—stakes returned",icon:"❌",bgColor:"bg-red-50",textColor:"text-red-700",borderColor:"border-red-200"};case"disputed":return{title:"Under Dispute",description:"Settlement is being reviewed",icon:"⚠️",bgColor:"bg-amber-50",textColor:"text-amber-700",borderColor:"border-amber-200"};case"resolved":return{title:"Dispute Resolved",description:"Final outcome confirmed after review",icon:"🔍",bgColor:"bg-purple-50",textColor:"text-purple-700",borderColor:"border-purple-200"};default:return null}})();return d?e.jsx("div",{className:`
      ${d.bgColor} ${d.borderColor} ${d.textColor}
      border rounded-lg p-4 ${r}
    `,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("span",{className:"text-xl",children:d.icon}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-semibold text-sm mb-1",children:d.title}),e.jsx("p",{className:"text-sm opacity-90",children:d.description}),t==="settling"&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-xs",children:"Estimated time: ~10 minutes"})]}),e.jsx("p",{className:"text-xs mt-2 opacity-75",children:"We'll notify you when the outcome is available."})]}),t==="settled"&&o?.outcome&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1 bg-white rounded-full text-sm font-semibold",children:[e.jsx("span",{children:"Outcome:"}),e.jsx("span",{className:o.outcome==="YES"?"text-emerald-600":"text-red-600",children:o.outcome})]})}),t==="voided"&&e.jsx("div",{className:"mt-3",children:e.jsx("p",{className:"text-xs opacity-75",children:"All participants will receive their original stake back."})})]})]})}):null},Fh=({predictionId:i,settlement:t,isOpen:s,onClose:r})=>{const{settlementConfigs:n,fetchSettlement:a}=Wt(),[o,l]=m.useState(t||null);m.useEffect(()=>{s&&i&&!t&&a(i)},[s,i,t,a]),m.useEffect(()=>{i&&n[i]?l(n[i]):t&&l(t)},[n,i,t]);const c=async()=>{if(o)try{await navigator.clipboard.writeText(o.rule_text)}catch(u){console.error("Failed to copy rule:",u)}},d=(u,h)=>{const p={postponed:"If event is postponed",source_down:"If source is unavailable"},f={auto_void:"Automatically void and return stakes",extend_lock:"Extend the lock time",keep_open:"Keep prediction open",use_backup:"Use backup source",pause_and_escalate:"Pause and escalate to admin"};return`${p[u]||u}: ${f[h]||h}`};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"How This Settles"}),e.jsxs("button",{onClick:r,className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"This market will be settled using official sources."})]}),e.jsx("div",{className:"p-6 space-y-6",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Settlement Rule"}),e.jsx("button",{onClick:c,className:"text-xs text-blue-600 hover:text-blue-800 font-medium",children:"Copy rule"})]}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:o.rule_text})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Sources"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-emerald-50 border border-emerald-200 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.primary_source.name}),e.jsx("div",{className:"text-xs text-gray-600",children:o.primary_source.url})]}),e.jsx("span",{className:"text-xs bg-emerald-600 text-white px-2 py-1 rounded-full font-semibold",children:"PRIMARY"})]}),o.backup_source&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-amber-500 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:o.backup_source.name}),e.jsx("div",{className:"text-xs text-gray-600",children:o.backup_source.url})]}),e.jsx("span",{className:"text-xs bg-amber-600 text-white px-2 py-1 rounded-full font-semibold",children:"BACKUP"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 mb-1",children:"Settlement Method"}),e.jsx("p",{className:"text-sm text-gray-900 capitalize",children:o.method.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-xs font-medium text-gray-500 mb-1",children:"Timezone"}),e.jsx("p",{className:"text-sm text-gray-900",children:o.timezone})]})]}),o.contingencies&&Object.keys(o.contingencies).length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Contingency Rules"}),e.jsx("div",{className:"space-y-2",children:Object.entries(o.contingencies).map(([u,h])=>e.jsx("div",{className:"text-sm text-gray-700 bg-gray-50 p-3 rounded border",children:d(u,h)},u))})]}),o.badges&&o.badges.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Quality Indicators"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.badges.map((u,h)=>e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:u.replace("-"," ")},h))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading settlement information..."})]})}),e.jsx("div",{className:"px-6 pb-6",children:e.jsx("div",{className:"text-xs text-gray-500 bg-gray-50 rounded p-3",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," We settle using public, official sources—no rumors. All settlements are auditable and transparent."]})})})]})}):null},Ui=({timezone:i,timestamp:t,className:s=""})=>{const[r,n]=m.useState(!1),a=new Date(t),o=(c,d)=>{if(d==="UTC"||r)return c.toISOString().replace("T"," ").slice(0,19)+" UTC";try{return new Intl.DateTimeFormat("en-US",{timeZone:d,year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",timeZoneName:"short"}).format(c)}catch{return c.toISOString().replace("T"," ").slice(0,19)+" UTC"}},l=()=>{n(!r)};return e.jsx("div",{className:`inline-flex items-center ${s}`,children:e.jsxs("button",{onClick:l,className:`inline-flex items-center gap-1 px-2 py-1 text-xs font-medium 
                   text-gray-700 bg-gray-100 hover:bg-gray-200 
                   border border-gray-200 rounded transition-colors`,children:[e.jsx("span",{className:"text-[10px]",children:"🕐"}),e.jsx("span",{children:o(a,i)}),e.jsx("span",{className:"text-[10px] text-gray-500",children:r?"→ Local":"→ UTC"})]})})},Bh=({predictionId:i,onNavigateBack:t})=>{const[,s]=xe(),[r,n]=m.useState(null),[a,o]=m.useState(""),[l,c]=m.useState(!1),[d,u]=m.useState(null),[h,p]=m.useState(!0),[f,g]=m.useState(!1),[x,y]=m.useState(!1),[b,v]=m.useState(!1),[j,k]=m.useState(!1),[L,C]=m.useState(!1),$=m.useRef(null),J=m.useRef(null),{predictions:V,fetchPredictions:ee,fetchPredictionById:q,placePrediction:F}=at(),{isAuthenticated:O,user:w}=oe(),{getBalance:I}=ls(),{checkIfLiked:N,getLikeCount:z,toggleLike:R}=Br(),{settlements:S,disputes:E,auditTimeline:D,fetchSettlement:T,fetchDisputes:A,fetchAuditTimeline:_,disputeModalOpen:K,setDisputeModalOpen:se}=Wt(),re=m.useMemo(()=>{if(i)return i;const te=window.location.pathname.match(/\/prediction\/([^\/]+)/);return te?te[1]:null},[i]),$e=m.useMemo(()=>re||"",[re]),ke=m.useMemo(()=>re&&V.find(M=>M.id===re)||null,[V,re]),{commentCount:ie,fetchComments:Le}=Hr($e);m.useEffect(()=>{console.log(`📊 PredictionDetailsPage commentCount for ${$e}: ${ie}`)},[$e,ie]),m.useEffect(()=>{(async()=>{if(!re){console.log("❌ No prediction ID found"),s("/discover");return}console.log("🔍 Loading prediction with ID:",re),p(!0);try{const te=await q(re);te?(console.log("✅ Found prediction:",te.title),u(te),console.log("🔄 Force fetching comments for prediction details page"),await Le(),["locked","settling","settled","voided","disputed","resolved"].includes(te.status)&&(await T(re),await A(re),await _(re))):(console.log("❌ Prediction not found:",re),u(null))}catch(te){console.error("❌ Error loading prediction:",te),u(null)}finally{p(!1)}})()},[re,q,s,T,A,_,Le]),m.useEffect(()=>{ke&&d?.id===ke.id&&(console.log("🔄 Updating prediction with latest data from store"),u(ke))},[ke,d?.id]);const _e=()=>{if(console.log("🔙 Navigating back"),t)t();else try{window.history.length>1?window.history.back():s("/discover")}catch(M){console.error("Navigation error:",M),s("/discover")}},we=M=>{console.log("🎯 Option selected:",M),n(M)},U=M=>{const te=M.target.value;(te===""||/^\d+(\.\d{0,2})?$/.test(te))&&o(te)},le=async()=>{if(!O){G.error("Please sign in to place a prediction");return}if(!r){G.error("Please select an option");return}const M=parseFloat(a);if(!M||M<d.stake_min){G.error(`Minimum stake is $${d.stake_min}`);return}if(d.stake_max&&M>d.stake_max){G.error(`Maximum stake is $${d.stake_max}`);return}const te=I("USD");if(M>te){G.error("Insufficient wallet balance");return}c(!0);try{console.log("🎲 Placing prediction:",{predictionId:d.id,optionId:r,amount:M}),await F(d.id,r,M,w?.id||""),G.success("Prediction placed successfully!"),o(""),n(null),setTimeout(()=>{ee()},1e3)}catch(he){console.error("❌ Failed to place prediction:",he);const ye=he instanceof Error?he.message:"Failed to place prediction";G.error(ye)}finally{c(!1)}},Ne=async()=>{if(!d){G.error("No prediction to share");return}const M=`${window.location.origin}/predictions/${d.id}`,te=`${d.title}

Make your prediction on Fan Club Z!`;if(navigator.share&&navigator.canShare)try{await navigator.share({title:d.title,text:te,url:M});return}catch(he){console.log("Native sharing cancelled or failed:",he)}try{await navigator.clipboard.writeText(`${te}
${M}`),G.success("Link copied to clipboard!")}catch(he){console.error("Clipboard API failed:",he);const ye=document.createElement("textarea");ye.value=`${te}
${M}`,ye.style.position="fixed",ye.style.left="-999999px",ye.style.top="-999999px",document.body.appendChild(ye),ye.focus(),ye.select();try{document.execCommand("copy"),G.success("Link copied to clipboard!")}catch(Gs){G.error("Failed to copy link"),console.error("execCommand failed:",Gs)}finally{document.body.removeChild(ye)}}},be=async()=>{if(!O){G.error("Please sign in to like this prediction");return}try{await R(d.id),G.success(N(d.id)?"Liked prediction!":"Removed like")}catch{G.error("Failed to update like")}},Vs=()=>{console.log("💬 Toggling comments from:",f,"to:",!f);const M=!f;g(M),M?setTimeout(()=>{$.current&&$.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},300):J.current&&J.current.scrollIntoView({behavior:"smooth",block:"center"})},qs=()=>d?.creator?{id:d.creator.id||d.creator_id,username:d.creator.username||d.creator.full_name||"creator",displayName:d.creator.full_name||d.creator.username,avatar_url:d.creator.avatar_url}:d?.creator_id?{id:d.creator_id,username:"creator",displayName:"Creator"}:{id:"unknown",username:"Fan Club Z",displayName:"Fan Club Z"},Ht=d?.user_entry||d?.entries?.some(M=>M.user_id===w?.id),De=S[d?.id],ds=E[d?.id]||[],us=D[d?.id]||[];if(h)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:_e,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(yt,{size:20}),e.jsx("span",{className:"font-medium",children:"Back"})]})})})}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading prediction..."})]})})]});if(!d)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:e.jsx("div",{className:"px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("button",{onClick:_e,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(yt,{size:20}),e.jsx("span",{className:"font-medium",children:"Back"})]})})})}),e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Prediction Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The prediction you're looking for doesn't exist or has been removed."}),e.jsx("button",{onClick:()=>s("/discover"),className:"bg-emerald-500 text-white px-6 py-2 rounded-lg hover:bg-emerald-600 transition-colors",children:"Browse Predictions"})]})})]});const hs=d.options?.find(M=>M.id===r),ms=hs&&a?parseFloat(a)*hs.current_odds:0,Vt=d.status==="open"&&new Date(d.entry_deadline)>new Date,B=qs();return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:e.jsx("div",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:_e,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(yt,{size:20}),e.jsx("span",{className:"font-medium",children:"Back"})]}),e.jsx("button",{onClick:Ne,className:"p-2 text-gray-600 hover:text-gray-900 transition-colors rounded-lg hover:bg-gray-100",children:e.jsx(Mn,{size:20})})]})})}),e.jsxs("div",{className:"px-4 py-6 max-w-2xl mx-auto pb-24",children:[e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-emerald-600 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white font-bold text-lg",children:B.username?.charAt(0)?.toUpperCase()||"FC"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(is,{username:B.username,userId:B.id,displayName:B.displayName,className:"font-semibold text-gray-900 text-lg hover:text-emerald-600 transition-colors",showAt:!1})}),e.jsx("div",{className:"text-sm text-gray-500",children:new Date(d.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]}),d.settlement?.method&&e.jsx(Uh,{method:d.settlement.method,badges:d.settlement.badges})]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4 leading-tight",children:d.title}),d.description&&e.jsx("p",{className:"text-gray-600 mb-6 leading-relaxed text-base",children:d.description}),d.settlement&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Settlement Rule:"}),e.jsx("button",{onClick:()=>y(!0),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"View full rule"})]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:d.settlement.rule_text})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-emerald-50 rounded-xl",children:[e.jsxs("div",{className:"text-2xl font-bold text-emerald-600",children:["$",(d.pool_total||0).toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Total Pool"})]}),e.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:d.participant_count||0}),e.jsx("div",{className:"text-sm text-gray-600 font-medium whitespace-nowrap text-center",children:"Participants"})]}),e.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-xl",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:d.options?.length||0}),e.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Options"})]})]}),d.status==="open"&&e.jsxs("div",{className:"flex items-center gap-3 text-orange-600 bg-orange-50 px-4 py-3 rounded-xl",children:[e.jsx(tt,{size:20}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold",children:[qu(d.entry_deadline)," remaining"]}),e.jsx("div",{className:"text-sm text-orange-500",children:e.jsx(Ui,{timezone:d.settlement?.timezone||"UTC",timestamp:d.entry_deadline})})]})]}),d.lock_time&&d.status!=="open"&&e.jsxs("div",{className:"flex items-center gap-3 text-gray-600 bg-gray-50 px-4 py-3 rounded-xl",children:[e.jsx(tt,{size:20}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold",children:"Locked at"}),e.jsx("div",{className:"text-sm",children:e.jsx(Ui,{timezone:d.settlement?.timezone||"UTC",timestamp:d.lock_time})})]})]})]}),["settling","settled","voided","disputed","resolved"].includes(d.status)&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05},className:"mb-6",children:e.jsx(Mh,{predictionId:d.id,state:d.status,userHasEntry:Ht})}),d.status==="settled"&&De?.proof&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Settlement Proof"}),e.jsx("button",{onClick:()=>v(!b),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:b?"Hide details":"Show details"})]}),e.jsx(zh,{proof:De.proof}),b&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Technical Details"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Content Hash:"})," ",De.proof.content_hash]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Fetched At:"})," ",new Date(De.proof.fetched_at).toLocaleString()]}),De.proof.parser_note&&e.jsxs("div",{children:[e.jsx("strong",{children:"Parser Note:"})," ",De.proof.parser_note]})]})]})]})}),ds.length>0&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"mb-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Disputes"}),e.jsx("div",{className:"space-y-4",children:ds.map(M=>e.jsx(Lh,{dispute:M},M.id))})]})}),us.length>0&&e.jsx(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Audit Timeline"}),e.jsx("button",{onClick:()=>k(!j),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:j?"Hide timeline":"Show timeline"})]}),j&&e.jsx(Oh,{events:us})]})}),!Vt&&d?.user_entry&&d?.status==="awaiting_settlement"&&e.jsx(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-6 mb-6 shadow-lg",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 text-white"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-amber-900 mb-1",children:"⚖️ Settlement Ready for Validation"}),e.jsx("p",{className:"text-amber-800 mb-3",children:"The creator has settled this prediction. Please review and validate the outcome."}),e.jsx(P.button,{onClick:()=>C(!0),className:"px-6 py-3 bg-amber-500 hover:bg-amber-600 text-white font-semibold rounded-xl transition-colors shadow-md",whileHover:{scale:1.02},whileTap:{scale:.98},children:"🔍 Review Settlement"})]})]})}),!Vt&&d?.user_entry&&(d?.status==="closed"||d?.status==="awaiting_settlement"||d?.status==="settled")&&e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border border-gray-100",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Settlement Status"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Your Position:"}),e.jsx("span",{className:"font-medium",children:d.user_entry.option?.label||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Amount Staked:"}),e.jsxs("span",{className:"font-medium",children:["$",d.user_entry.amount?.toLocaleString()||0]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium px-2 py-1 rounded-full text-xs ${d.user_entry.status==="won"?"bg-emerald-100 text-emerald-800":d.user_entry.status==="lost"?"bg-red-100 text-red-800":d.user_entry.status==="refunded"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:d.user_entry.status||"pending"})]})]}),d?.status!=="settled"&&e.jsx(P.button,{onClick:()=>C(!0),className:"w-full py-3 rounded-xl font-semibold text-white transition-all text-lg bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 shadow-lg",whileHover:{scale:1.02},whileTap:{scale:.98},children:"View Settlement Details"})]})]}),Vt&&e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border border-gray-100",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Place Your Prediction"}),e.jsx("div",{className:"space-y-3 mb-6",children:d.options?.map((M,te)=>e.jsx(P.button,{onClick:()=>we(M.id),className:`w-full p-4 rounded-xl border-2 transition-all ${r===M.id?"border-emerald-500 bg-emerald-50 shadow-lg":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-left flex-1",children:[e.jsx("div",{className:"font-semibold text-gray-900 text-lg mb-1",children:M.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[d.pool_total>0?`${(M.total_staked/d.pool_total*100).toFixed(1)}% of pool`:"0% of pool"," • $",(M.total_staked||0).toLocaleString()," staked"]})]}),e.jsxs("div",{className:"text-right ml-4",children:[e.jsxs("div",{className:"text-2xl font-bold text-emerald-600",children:[(M.current_odds||1).toFixed(2),"x"]}),e.jsx("div",{className:"text-xs text-gray-500",children:"odds"})]})]})},M.id))}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Stake Amount (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"$"}),e.jsx("input",{type:"text",value:a,onChange:U,placeholder:"0.00",className:"w-full pl-10 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-lg"})]}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mt-2",children:[e.jsxs("span",{children:["Min: $",d.stake_min]}),e.jsxs("span",{children:["Max: $",d.stake_max||"No limit"]})]})]}),e.jsx(fe,{children:r&&a&&e.jsxs(P.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-emerald-50 border-2 border-emerald-200 rounded-xl p-4 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-emerald-800 font-semibold",children:"Potential Payout:"}),e.jsxs("span",{className:"text-emerald-800 font-bold text-xl",children:["$",ms.toFixed(2)]})]}),e.jsxs("div",{className:"text-emerald-700 text-sm",children:["Profit: $",Math.max(0,ms-parseFloat(a)).toFixed(2)]})]})}),e.jsx(P.button,{onClick:le,disabled:!r||!a||l,className:`w-full py-4 rounded-xl font-semibold text-white transition-all text-lg ${r&&a&&!l?"bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 shadow-lg":"bg-gray-300 cursor-not-allowed"}`,whileHover:r&&a&&!l?{scale:1.02}:{},whileTap:r&&a&&!l?{scale:.98}:{},children:l?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Placing Prediction..."]}):"Place Prediction"})]}),e.jsxs(P.div,{ref:J,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Community Engagement"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(P.button,{onClick:be,className:`flex items-center gap-2 transition-colors ${N(d.id)?"text-red-500":"text-gray-600 hover:text-red-500"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(vt,{size:20,fill:N(d.id)?"currentColor":"none"}),e.jsxs("span",{className:"font-medium",children:[z(d.id)," likes"]})]}),e.jsxs(P.button,{onClick:Vs,className:`flex items-center gap-2 transition-colors ${f?"text-blue-500":"text-gray-600 hover:text-blue-500"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(Fe,{size:20}),e.jsxs("span",{className:"font-medium",children:[ie," comments"]}),e.jsx(md,{size:16,className:`transition-transform ml-1 ${f?"rotate-180":""}`})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[e.jsx(Oe,{size:20}),e.jsxs("span",{className:"font-medium",children:[d.participant_count||0," participants"]})]})]})]}),e.jsx(fe,{children:f&&e.jsxs(P.div,{ref:$,initial:{opacity:0,y:-20,height:0},animate:{opacity:1,y:0,height:"auto"},exit:{opacity:0,y:-20,height:0},transition:{duration:.4,ease:"easeInOut"},className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Comments"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Join the conversation about this prediction"})]}),e.jsx("div",{className:"min-h-[300px] max-h-[600px] overflow-y-auto",children:e.jsx(Rh,{predictionId:$e})})]})})]})]}),e.jsx(Fh,{predictionId:d?.id,settlement:d?.settlement,isOpen:x,onClose:()=>y(!1)}),e.jsx(Dh,{predictionId:d?.id||"",isOpen:K,onClose:()=>se(!1)}),d.status==="settled"&&Ht&&De&&e.jsx(Ih,{predictionId:d.id,settlementData:De,userHasEntry:Ht}),L&&e.jsx($h,{isOpen:L,onClose:()=>C(!1),predictionId:d.id,predictionTitle:d.title})]})},Wh=({activeTab:i="discover",onTabChange:t,showFAB:s=!1,onFABClick:r})=>{const n=[{id:"discover",label:"Discover",icon:zn},{id:"bets",label:"My Bets",icon:Oe},{id:"wallet",label:"Wallet",icon:rs},{id:"profile",label:"Profile",icon:Kr}],a=o=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"smooth"}),t&&t(o)};return e.jsx("div",{style:{position:"fixed",bottom:"0",left:"0",right:"0",zIndex:"1000",backgroundColor:"white",borderTop:"1px solid #e5e7eb",paddingBottom:"max(env(safe-area-inset-bottom), 0.5rem)",paddingTop:"0.5rem",boxShadow:"0 -4px 20px rgba(0, 0, 0, 0.1)"},children:e.jsxs("nav",{style:{padding:"0 1rem",position:"relative"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around",maxWidth:"400px",margin:"0 auto",position:"relative"},children:n.map(o=>{const l=o.icon,c=i===o.id;return e.jsxs(P.button,{onClick:()=>a(o.id),whileHover:{scale:1.05},whileTap:{scale:.95},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",minWidth:"0",flex:"1",position:"relative",background:"none",border:"none",cursor:"pointer",borderRadius:"12px",transition:"all 0.2s ease"},onMouseEnter:d=>{c||(d.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:d=>{c||(d.currentTarget.style.backgroundColor="transparent")},"data-tour-id":`tab-${o.id}`,children:[e.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"6px",marginTop:"2px",width:"24px",height:"24px"},children:[e.jsx("div",{style:{transition:"all 0.2s ease",color:c?"#7B2FF7":"#6b7280",transform:c?"scale(1.1)":"scale(1)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(l,{size:20})}),c&&e.jsx(P.div,{layoutId:"activeTab",style:{position:"absolute",top:"-6px",left:"50%",transform:"translateX(-50%)",width:"4px",height:"4px",backgroundColor:"#7B2FF7",borderRadius:"50%",boxShadow:"0 0 6px rgba(34, 197, 94, 0.6)"},initial:!1,transition:{type:"spring",stiffness:400,damping:30}})]}),e.jsx("span",{style:{fontSize:"11px",fontWeight:c?"600":"500",transition:"all 0.2s ease",color:c?"#7B2FF7":"#6b7280",textAlign:"center",lineHeight:"1.2"},children:o.label})]},o.id)})}),s&&e.jsx(P.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:r,"data-tour-id":"create-fab",style:{position:"fixed",bottom:"calc(80px + env(safe-area-inset-bottom, 0px))",right:"16px",width:"56px",height:"56px",borderRadius:"50%",background:"linear-gradient(135deg, #7B2FF7, #00F5D4)",border:"none",boxShadow:"0 8px 24px rgba(34, 197, 94, 0.4)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:e.jsx(kt,{size:24,style:{color:"white"}})})]})})},ei=({message:i="Loading..."})=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:i})]})}),ga=m.memo(({children:i})=>{const{isAuthenticated:t,loading:s,initialized:r,initializeAuth:n}=oe();return m.useEffect(()=>{!r&&!s&&n()},[r,s,n]),!r||s&&!t?e.jsx(ei,{message:"Authenticating..."}):t?e.jsx(e.Fragment,{children:i}):e.jsx(Th,{})});ga.displayName="AuthGuard";const xa=m.memo(({children:i})=>{const[t,s]=xe(),r=m.useCallback(()=>{const l=t.toLowerCase();return l==="/"||l==="/discover"?"discover":l==="/bets"||l==="/predictions"?"bets":l==="/profile"?"profile":l==="/wallet"?"wallet":"discover"},[t]),n=m.useCallback(l=>{if(r()!==l){switch(jt(t),zt(),l){case"discover":s("/");break;case"bets":s("/predictions");break;case"profile":s("/profile");break;case"wallet":s("/wallet");break;default:s("/")}setTimeout(()=>{Ot({behavior:"instant"})},50)}},[s,r,t]),a=m.useCallback(()=>{jt(t),zt(),s("/create")},[s,t]),o=r()==="discover";return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col","data-scroll-container":!0,children:[e.jsx("main",{className:"flex-1 pb-20",children:e.jsx(m.Suspense,{fallback:e.jsx(ei,{message:"Loading page..."}),children:i})}),e.jsx(Wh,{activeTab:r(),onTabChange:n,showFAB:o,onFABClick:a}),e.jsx(Rn,{}),e.jsx(Od,{}),e.jsx(ld,{position:"top-center",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})});xa.displayName="MainLayout";const or=()=>{const[i,t]=xe(),s=m.useCallback(()=>{jt(i),t("/profile")},[t,i]),r=m.useCallback(n=>{jt(i),t(`/prediction/${n}`)},[t,i]);return e.jsx(Ge,{title:"Discover",children:e.jsx(ma,{onNavigateToProfile:s,onNavigateToPrediction:r})})},Mi=()=>{const[i,t]=xe(),s=m.useCallback(()=>{jt(i),t("/")},[t,i]);return e.jsx(Ge,{title:"My Predictions",children:e.jsx(xh,{onNavigateToDiscover:s})})},Hh=()=>{const[i,t]=xe(),s=m.useCallback(()=>{zt(),t("/")},[t]);return e.jsx(Ge,{title:"Create Prediction",children:e.jsx(dh,{onNavigateBack:s})})},Vh=({params:i})=>{const[t,s]=xe(),r=m.useCallback(()=>{window.history.length>1?window.history.back():(zt(),s("/"))},[s]),n=ue.useMemo(()=>{const a=i?.userId;if(!a){console.warn("⚠️ No userId provided in profile route");return}const o=a.trim();if(!o){console.warn("⚠️ Empty userId in profile route");return}if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(o))return console.log("✅ Valid UUID userId:",o),o;if(o.length>2)return console.log("⚠️ Non-UUID userId (might be username):",o),o;console.warn("⚠️ Invalid userId format:",o)},[i?.userId]);return n?(console.log("🔍 UserProfilePageWrapper rendering with userId:",n),e.jsx(Ge,{title:"User Profile",children:e.jsx(fa,{onNavigateBack:r,userId:n})})):(ue.useEffect(()=>{console.warn("⚠️ Invalid userId in profile route, redirecting to own profile"),zt(),s("/profile")},[s]),e.jsx(ei,{message:"Redirecting..."}))},qh=()=>{const[i,t]=xe(),s=m.useCallback(()=>{jt(i),t("/")},[t,i]);return e.jsx(Ge,{title:"My Profile",children:e.jsx(fa,{onNavigateBack:s})})},Gh=()=>{const[i,t]=xe(),s=m.useCallback(()=>{jt(i),t("/")},[t,i]);return e.jsx(Ge,{title:"Wallet",children:e.jsx(Eh,{onNavigateBack:s})})},Fi=({params:i})=>{const[t,s]=xe(),r=m.useCallback(()=>{console.log("🔙 Navigating back from prediction details"),window.history.length>1?window.history.back():(zt(),s("/"))},[s]);return i?.id?e.jsx(Ge,{title:"Prediction Details",children:e.jsx(Bh,{predictionId:i.id,onNavigateBack:r})}):e.jsx(Ge,{title:"Error",children:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Prediction Not Found"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"The prediction you're looking for doesn't exist."}),e.jsx("button",{onClick:r,className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Go Back"})]})})})};function Jh(){const{initializeWallet:i}=ls(),{initializeAuth:t,isAuthenticated:s,loading:r,initialized:n}=oe(),{initializeLikes:a}=Br(),{initialize:o}=Wr();return m.useEffect(()=>{if(!n&&!r)try{console.log("App: Initializing auth..."),t()}catch(l){console.error("Auth initialization failed:",l)}},[t,n,r]),m.useEffect(()=>{if(s&&!r&&n)try{console.log("App: Initializing wallet and social features..."),i(),a(),o(),console.log("✅ All stores initialized successfully")}catch(l){console.error("Store initialization failed:",l)}},[s,r,n,i,a,o]),e.jsx(Yr,{children:e.jsx(Qi,{children:e.jsxs(oi,{children:[e.jsx(Ce,{path:"/auth/callback",children:e.jsx(Ge,{title:"Authentication",children:e.jsx(Ah,{})})}),e.jsx(ga,{children:e.jsx(Jd,{children:e.jsx(xa,{children:e.jsxs(oi,{children:[e.jsx(Ce,{path:"/",component:or}),e.jsx(Ce,{path:"/discover",component:or}),e.jsx(Ce,{path:"/predictions",component:Mi}),e.jsx(Ce,{path:"/predictions/:id",component:Fi}),e.jsx(Ce,{path:"/bets",component:Mi}),e.jsx(Ce,{path:"/create",component:Hh}),e.jsx(Ce,{path:"/profile",component:qh}),e.jsx(Ce,{path:"/profile/:userId",component:Vh}),e.jsx(Ce,{path:"/wallet",component:Gh}),e.jsx(Ce,{path:"/prediction/:id",component:Fi}),e.jsx(Ce,{component:or})]})})})})]})})})}console.log(`🚀 Fan Club Z ${Hs} - CONSOLIDATED ARCHITECTURE - SINGLE SOURCE OF TRUTH`);window.addEventListener("unhandledrejection",i=>{console.error("Unhandled promise rejection:",i.reason)});window.addEventListener("error",i=>{console.error("Global error:",i.error)});cr.createRoot(document.getElementById("root")).render(e.jsx(ue.StrictMode,{children:e.jsx(Yr,{onError:(i,t)=>{console.error("React Error Boundary triggered:",i,t)},children:e.jsx(Jh,{})})}));console.log(`✅ Fan Club Z ${Hs} - Application started successfully`);console.log("🚀 Build timestamp:",kh);
