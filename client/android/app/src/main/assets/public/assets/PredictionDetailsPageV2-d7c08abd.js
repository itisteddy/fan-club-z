import{j as e,m as P,A as ye}from"./ui-6244b3df.js";import{r as y}from"./vendor-499a370b.js";import{f as Ue,c as Fe,d as ze,a as Oe}from"./utils-17ec81d9.js";import{f as ee,r as me,m as ge,p as fe,o as X,i as be,E as qe,F as B,u as pe,z as _,e as I,R as je,X as Re,U as Qe,D as T,T as se,Q as A,d as He,G as Ke,b as Ve}from"./index-6112b649.js";import{u as Ge}from"./useUnifiedBalance-2a41b6ef.js";import{D as Je}from"./DepositUSDCModal-2048ba50.js";import{A as Ye}from"./activity-3ea54dab.js";import{C as ae,u as Ze}from"./useMerkleClaim-85bb6a08.js";import{M as We,A as Xe,S as Ie}from"./share-2-7efa6e5d.js";import{C as et,u as tt}from"./CreatorByline-a08ae8e5.js";import{u as st,a as at}from"./useActivityFeed-5b825cb0.js";import{c as rt,b as N}from"./format-ae98e2f4.js";import{u as it}from"./useWriteContract-ab9d8160.js";import{A as Y}from"./arrow-left-94b37ebf.js";import{U as nt}from"./users-10201f65.js";import"./public-3a03d500.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=ee("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=ee("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=ee("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=ee("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),ct=({activeTab:s,onTabChange:o,commentCount:t=0,activityCount:a=0,participantCount:r=0,children:l})=>{const n=[{id:"overview",label:"Overview",count:0,icon:ge},{id:"comments",label:"Comments",count:t,icon:ve},{id:"activity",label:"Activity",count:a||r||0,icon:Ye}];return e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:n.map((i,u)=>{const x=i.icon;return e.jsxs("button",{onClick:()=>o(i.id),className:me("px-3 py-1 rounded-lg text-sm font-medium transition-colors",s===i.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:i.label}),e.jsx("span",{className:"sm:hidden",children:i.id==="overview"?"Overview":i.id==="comments"?"Comments":"Activity"})]}),i.count>0&&e.jsx("span",{className:me("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold",s===i.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:i.count>99?"99+":i.count})]},i.id)})})})}),e.jsx("div",{children:l})]})},dt=({onSubmit:s,isPosting:o,placeholder:t="Share your thoughts..."})=>{const[a,r]=y.useState(""),{user:l}=fe(),c=async n=>{if(n.preventDefault(),!(!a.trim()||o)){if(!l){X({intent:"comment_prediction"});return}try{await s(a.trim()),r("")}catch{}}};return l?e.jsxs("form",{onSubmit:c,className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:a,onChange:n=>r(n.target.value),placeholder:t,disabled:o,rows:3,className:"w-full p-3 border rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",maxLength:1e3}),e.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-500",children:[a.length,"/1000"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Commenting as ",l.user_metadata?.username||l.email]}),e.jsxs("button",{type:"submit",disabled:!a.trim()||o,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(lt,{className:"w-4 h-4"}),o?"Posting...":"Post"]})]})]}):e.jsx("div",{className:"p-4 border rounded-lg bg-gray-50",children:e.jsx("button",{onClick:()=>X({intent:"comment_prediction"}),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Sign in to comment"})})},mt=({comment:s,onToggleLike:o})=>{const t=()=>{o&&o(s.id)},a=s.likes_count||s.likeCount||0,r=s.is_liked||s.likedByMe||!1,l=s.created_at||s.createdAt,c=s.content||s.text,n=s.user?.username||"Anonymous",i=s.user?.avatar_url||s.user?.avatarUrl;return e.jsx("div",{className:"border-b border-gray-100 pb-4 last:border-b-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:i?e.jsx("img",{src:i,alt:n,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-600",children:n.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:n}),s.user?.is_verified&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"âœ“"})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(ae,{className:"w-3 h-3"}),Ue(new Date(l),{addSuffix:!0})]})]}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed mb-2",children:c}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:t,className:`flex items-center gap-1 text-xs transition-colors ${r?"text-red-600 hover:text-red-700":"text-gray-500 hover:text-red-600"}`,children:[e.jsx(we,{className:`w-4 h-4 ${r?"fill-current":""}`}),a>0&&e.jsx("span",{children:a})]})})]})]})})},ut=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:s}).map((o,t)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]})]})},t))}),xt=({comments:s,isLoading:o,hasMore:t,onLoadMore:a,onToggleLike:r})=>o&&s.length===0?e.jsx(ut,{count:3}):s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-lg mb-2",children:"No comments yet"}),e.jsx("div",{className:"text-sm",children:"Be the first to share your thoughts!"})]}):e.jsxs("div",{className:"space-y-4",children:[s.map(l=>e.jsx(mt,{comment:l,onToggleLike:r},l.id)),t&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:a,disabled:o,className:"px-6 py-2 text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:o?"Loading...":"Load more comments"})})]}),ht=be(),yt="v2",Z=`${ht}/api/${yt}`,W=()=>localStorage.getItem("token"),b={get:async(s,o)=>{const t=W();try{const a=await fetch(`${Z}${s}`,{method:"GET",headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`},...o?.headers},...o});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}catch(a){throw console.warn(`API call failed: ${s}`,a),a}},post:async(s,o,t)=>{const a=W();try{const r=await fetch(`${Z}${s}`,{method:"POST",headers:{"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`},...t?.headers},body:o?JSON.stringify(o):void 0,...t});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}catch(r){throw console.warn(`API call failed: ${s}`,r),r}},put:async(s,o,t)=>{const a=W();try{const r=await fetch(`${Z}${s}`,{method:"PUT",headers:{"Content-Type":"application/json",...a&&{Authorization:`Bearer ${a}`},...t?.headers},body:o?JSON.stringify(o):void 0,...t});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}catch(r){throw console.warn(`API call failed: ${s}`,r),r}},delete:async(s,o)=>{const t=W();try{const a=await fetch(`${Z}${s}`,{method:"DELETE",headers:{"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`},...o?.headers},...o});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}catch(a){throw console.warn(`API call failed: ${s}`,a),a}}},p=s=>({id:s.id,predictionId:s.prediction_id,user:{id:s.user?.id||s.user_id,username:s.user?.username||"Anonymous",full_name:s.user?.full_name,avatarUrl:s.user?.avatar_url,avatar_url:s.user?.avatar_url,is_verified:s.user?.is_verified||!1},text:s.content||s.text||"",content:s.content,createdAt:s.created_at||s.createdAt||new Date().toISOString(),created_at:s.created_at,updatedAt:s.updated_at||s.updatedAt||new Date().toISOString(),updated_at:s.updated_at,edited:s.is_edited||s.edited||!1,is_edited:s.is_edited,isDeleted:s.is_deleted||!1,likeCount:s.likes_count||s.likeCount||0,likes_count:s.likes_count,likedByMe:s.is_liked||s.likedByMe||!1,is_liked:s.is_liked});function ue(s){return!s||s.name==="TypeError"||s.message?.includes("Failed to fetch")?"network_error":s.status>=500?"server_error":s.status>=400&&s.status<500?"client_error":s.name==="SyntaxError"||s.message?.includes("JSON")?"parse_error":"network_error"}const gt=Fe()(qe((s,o)=>({byPrediction:{},getComments:t=>o().byPrediction[t]?.items||[],getCommentCount:t=>o().byPrediction[t]?.items?.length||0,getStatus:t=>o().byPrediction[t]?.status||"idle",getDraft:t=>o().byPrediction[t]?.draft||"",isPosting:t=>o().byPrediction[t]?.posting||!1,hasMore:t=>o().byPrediction[t]?.nextCursor!==null,fetchComments:async t=>{if(!(!t?.trim()||o().byPrediction[t]?.status==="loading")){s(r=>({byPrediction:{...r.byPrediction,[t]:{...r.byPrediction[t],status:"loading"}}}));try{let r;try{r=await b.get(`/social/predictions/${t}/comments?page=1&limit=20`)}catch(n){B("Social endpoint failed, trying comments endpoint:",n),r=await b.get(`/comments/predictions/${t}/comments?page=1&limit=20`)}let l=[],c=null;r.data&&Array.isArray(r.data)?(l=r.data.map(p),c=r.pagination?.hasNext?"next":null):r.comments&&Array.isArray(r.comments)?(l=r.comments.map(p),c=r.hasMore?"next":null):Array.isArray(r)&&(l=r.map(p)),B(`Fetched ${l.length} comments for ${t}`),s(n=>({byPrediction:{...n.byPrediction,[t]:{...n.byPrediction[t],items:l,nextCursor:c,status:"loaded"}}}))}catch(r){if(r.status===404){s(c=>({byPrediction:{...c.byPrediction,[t]:{...c.byPrediction[t],items:[],nextCursor:null,status:"loaded"}}}));return}const l=ue(r);s(c=>({byPrediction:{...c.byPrediction,[t]:{...c.byPrediction[t],items:c.byPrediction[t]?.items||[],status:l}}}))}}},loadMore:async t=>{if(!t?.trim())return;const a=o().byPrediction[t];if(!(!a?.nextCursor||a?.status==="paginating")){s(r=>({byPrediction:{...r.byPrediction,[t]:{...r.byPrediction[t],status:"paginating"}}}));try{const r=Math.ceil((a.items?.length||0)/20)+1;let l;try{l=await b.get(`/social/predictions/${t}/comments?page=${r}&limit=20`)}catch{l=await b.get(`/comments/predictions/${t}/comments?page=${r}&limit=20`)}let c=[],n=null;l.data&&Array.isArray(l.data)?(c=l.data.map(p),n=l.pagination?.hasNext?"next":null):l.comments&&Array.isArray(l.comments)&&(c=l.comments.map(p),n=l.hasMore?"next":null),B(`Loaded ${c.length} more comments for ${t}`),s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],items:[...i.byPrediction[t]?.items||[],...c],nextCursor:n,status:"loaded"}}}))}catch(r){const l=ue(r);s(c=>({byPrediction:{...c.byPrediction,[t]:{...c.byPrediction[t],status:l}}}))}}},addComment:async(t,a)=>{if(!t?.trim()||!a?.trim())throw new Error("Invalid input");const r=a.trim();if(r.length>280)throw new Error("Comment too long");s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],posting:!0}}}));const{user:l}=pe.getState(),c=`temp_${Date.now()}`,n={id:c,predictionId:t,user:{id:l?.id||"demo-user",username:l?.username||"You",full_name:l?.full_name,avatarUrl:l?.avatar_url,is_verified:l?.is_verified||!1},text:r,content:r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),edited:!1,isDeleted:!1,likeCount:0,likedByMe:!1};s(i=>{const u=i.byPrediction[t]?.items||[];return{byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],items:[n,...u]}}}});try{let i;try{i=await b.post(`/social/predictions/${t}/comments`,{content:r,userId:l?.id||"demo-user",user:l})}catch(x){B("Social endpoint failed, trying comments endpoint:",x),i=await b.post(`/comments/predictions/${t}/comments`,{content:r,user:l})}let u;i.data||i.success&&i.data?u=p(i.data):u=p(i),B(`Comment added successfully for ${t}`),s(x=>({byPrediction:{...x.byPrediction,[t]:{...x.byPrediction[t],items:(x.byPrediction[t]?.items??[]).map(h=>h.id===c?u:h)||[u],posting:!1,draft:""}}}));try{sessionStorage.removeItem(`fcz_comment_draft_${t}`)}catch{}}catch(i){throw s(u=>({byPrediction:{...u.byPrediction,[t]:{...u.byPrediction[t],items:(u.byPrediction[t]?.items??[]).filter(x=>x.id!==c),posting:!1}}})),i}},editComment:async(t,a,r)=>{if(!t?.trim()||!a?.trim()||!r?.trim())throw new Error("Invalid input");const l=r.trim();if(l.length>280)throw new Error("Comment too long");const c=o().byPrediction[t]?.items?.find(n=>n.id===a);if(!c)throw new Error("Comment not found");s(n=>({byPrediction:{...n.byPrediction,[t]:{...n.byPrediction[t],items:(n.byPrediction[t]?.items??[]).map(i=>i.id===a?{...i,text:l,edited:!0,updatedAt:new Date().toISOString()}:i)||[]}}}));try{let n;try{n=await b.put(`/social/comments/${a}`,{content:l})}catch{n=await b.put(`/comments/${a}`,{content:l})}let i;n.data?i=p(n.data):i=p(n),s(u=>({byPrediction:{...u.byPrediction,[t]:{...u.byPrediction[t],items:(u.byPrediction[t]?.items??[]).map(x=>x.id===a?i:x)||[]}}}))}catch(n){throw s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],items:(i.byPrediction[t]?.items??[]).map(u=>u.id===a?c:u)||[]}}})),n}},deleteComment:async(t,a)=>{if(!t?.trim()||!a?.trim())throw new Error("Invalid input");const r=o().byPrediction[t]?.items??[];if(!r.find(c=>c.id===a))throw new Error("Comment not found");s(c=>({byPrediction:{...c.byPrediction,[t]:{...c.byPrediction[t],items:(c.byPrediction[t]?.items??[]).filter(n=>n.id!==a)}}}));try{try{await b.delete(`/social/comments/${a}`)}catch{await b.delete(`/comments/${a}`)}B(`Comment ${a} deleted successfully`)}catch(c){throw s(n=>({byPrediction:{...n.byPrediction,[t]:{...n.byPrediction[t],items:r}}})),c}},setDraft:(t,a)=>{s(r=>({byPrediction:{...r.byPrediction,[t]:{...r.byPrediction[t],draft:a}}}));try{a.trim()?sessionStorage.setItem(`fcz_comment_draft_${t}`,a):sessionStorage.removeItem(`fcz_comment_draft_${t}`)}catch{}},clearDraft:t=>{s(a=>({byPrediction:{...a.byPrediction,[t]:{...a.byPrediction[t],draft:""}}}));try{sessionStorage.removeItem(`fcz_comment_draft_${t}`)}catch{}},setHighlighted:(t,a)=>{s(r=>({byPrediction:{...r.byPrediction,[t]:{...r.byPrediction[t],highlightedId:a}}})),a&&setTimeout(()=>{s(r=>({byPrediction:{...r.byPrediction,[t]:{...r.byPrediction[t],highlightedId:void 0}}}))},1500)}}),{name:"fcz-unified-comments",partialize:s=>({})})),ft=({predictionId:s,className:o=""})=>{const{getComments:t,getCommentCount:a,getStatus:r,isPosting:l,hasMore:c,fetchComments:n,loadMore:i,addComment:u}=gt(),x=t(s),h=r(s),E=l(s),L=c(s);y.useEffect(()=>{h==="idle"&&n(s).catch(j=>{j?.status>=500&&_.error("Failed to load comments. Please try again.")})},[s,h,n]);const O=async j=>{try{await u(s,j)}catch(w){const M=w?.message||"Failed to post comment";throw _.error(M),w}},k=async j=>{try{_.success("Like feature coming soon!")}catch(w){w?.status>=500&&_.error("Failed to update like. Please try again.")}},q=async()=>{try{await i(s)}catch(j){j?.status>=500&&_.error("Failed to load more comments. Please try again.")}},R=h==="loading"||h==="paginating",Q=a(s);return e.jsxs("div",{className:`bg-white rounded-lg ${o}`,children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-gray-100",children:[e.jsx(We,{className:"w-5 h-5 text-gray-600"}),e.jsxs("h3",{className:"font-medium text-gray-900",children:["Comments ",Q>0&&`(${Q})`]})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(dt,{onSubmit:O,isPosting:E}),e.jsx(xt,{comments:x,isLoading:R,hasMore:L,onLoadMore:q,onToggleLike:k})]})]})},bt=({message:s="Loading...",size:o="md",className:t="",fullScreen:a=!1})=>{const l=(()=>{switch(o){case"sm":return{spinner:"h-4 w-4",text:"text-sm",container:"py-4"};case"lg":return{spinner:"h-8 w-8",text:"text-lg",container:"py-8"};case"md":default:return{spinner:"h-6 w-6",text:"text-base",container:"py-6"}}})(),c=e.jsxs("div",{className:`flex flex-col items-center justify-center ${l.container} ${t}`,children:[e.jsx(P.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:`${l.spinner} text-emerald-500`,children:e.jsx(I,{className:"h-full w-full"})}),s&&e.jsx("p",{className:`mt-3 text-gray-600 ${l.text}`,children:s})]});return a?e.jsx("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50",children:c}):c},pt=({error:s,onRetry:o,onDismiss:t,type:a="error",showRetry:r=!0,showDismiss:l=!1,className:c=""})=>{const i=(()=>{switch(a){case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:"text-yellow-600"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"};case"error":default:return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"}}})();return e.jsx(ye,{children:e.jsx(P.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:`rounded-lg border p-4 ${i.bg} ${i.border} ${c}`,role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Xe,{className:`h-5 w-5 ${i.icon}`})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsx("p",{className:`text-sm font-medium ${i.text}`,children:s})}),e.jsxs("div",{className:"ml-3 flex space-x-2",children:[r&&o&&e.jsxs("button",{onClick:o,className:`inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors ${i.text} hover:bg-white/50`,"aria-label":"Retry",children:[e.jsx(je,{className:"h-3 w-3"}),"Retry"]}),l&&t&&e.jsx("button",{onClick:t,className:`inline-flex items-center rounded-md p-1 transition-colors ${i.text} hover:bg-white/50`,"aria-label":"Dismiss",children:e.jsx(Re,{className:"h-4 w-4"})})]})]})})})},jt=({icon:s,title:o,description:t,action:a,className:r=""})=>e.jsxs(P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex flex-col items-center justify-center py-12 px-6 text-center ${r}`,children:[s&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(s,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:o}),t&&e.jsx("p",{className:"text-gray-600 mb-6 max-w-sm",children:t}),a&&e.jsx(P.button,{className:"bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",onClick:a.onClick,whileHover:{scale:1.02},whileTap:{scale:.98},children:a.label})]});function wt({item:s}){const t=(r=>{const{type:l,actor:c,data:n}=r,i=c?.full_name||c?.username||"Anonymous";switch(l){case"comment":return{message:`${i} commented`,details:n.content?n.content.substring(0,100)+(n.content.length>100?"...":""):"",icon:ve};case"entry.create":return{message:`${i} placed a bet`,details:`${N(n.amount,{compact:!0})}${n.option_label?` on ${n.option_label}`:""}`,icon:T};case"reaction.like":return{message:`${i} liked this prediction`,details:"",icon:we};case"prediction.open":return{message:"Prediction is now open for betting",details:"",icon:se};case"prediction.settled":return{message:"Prediction has been settled",details:n.settled_outcome_id?"Outcome determined":"",icon:se};case"wallet.unlock":return{message:"Escrow funds released",details:n.amount?N(n.amount,{compact:!0}):"",icon:T};case"wallet.payout":return{message:"Settlement payout received",details:n.amount?`${N(n.amount,{compact:!0})}${n.prediction_title?` Â· ${n.prediction_title}`:""}`:n.prediction_title??"",icon:T};case"wallet.platform_fee":return{message:"Platform fee credited",details:n.amount?N(n.amount,{compact:!0}):"",icon:T};case"wallet.creator_fee":return{message:"Creator earnings received",details:n.amount?`${N(n.amount,{compact:!0})}${n.prediction_title?` Â· ${n.prediction_title}`:""}`:n.prediction_title??"",icon:T};default:return{message:"Activity occurred",details:"",icon:ae}}})(s),a=t.icon;return e.jsxs(P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx("div",{className:"flex-shrink-0",children:s.actor?.avatar_url?e.jsx("img",{src:s.actor.avatar_url,alt:s.actor.full_name||s.actor.username||"User",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(Qe,{className:"w-4 h-4 text-gray-500"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(a,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.message})]}),t.details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.details}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:rt(s.timestamp)}),s.actor?.is_verified&&e.jsx("span",{className:"text-xs text-emerald-600 font-medium",children:"âœ“ Verified"})]})]})]})}function vt({predictionId:s,className:o=""}){const{items:t,loading:a,error:r,hasMore:l,loadMore:c,refresh:n}=st({predictionId:s,limit:25,autoLoad:!0});return r?e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border ${o}`,children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-red-500 mb-2",children:"âš ï¸"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Failed to load activity feed"}),e.jsx("button",{onClick:n,className:"text-sm text-emerald-600 hover:text-emerald-700 font-medium",children:"Try again"})]})}):a&&t.length===0?e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border ${o}`,children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(I,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading activity..."})]})}):t.length===0?e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border ${o}`,children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(ae,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No activity yet"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Be the first to comment or place a bet!"})]})}):e.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border ${o}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Recent Activity"}),e.jsx("button",{onClick:n,disabled:a,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Refresh",children:e.jsx(je,{className:`w-4 h-4 ${a?"animate-spin":""}`})})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:t.map(i=>e.jsx(wt,{item:i},i.id))}),l&&e.jsx("div",{className:"p-4 border-t border-gray-100",children:e.jsx("button",{onClick:c,disabled:a,className:"w-full py-2 text-sm text-emerald-600 hover:text-emerald-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(I,{className:"w-4 h-4 animate-spin"}),"Loading more..."]}):"Load more activity"})})]})}function Nt({onSignIn:s,title:o="Sign in to place a bet",description:t="Create an account or sign in to participate."}){return e.jsxs("div",{className:"rounded-2xl border shadow-sm bg-white p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"shrink-0 rounded-xl bg-emerald-50 p-2",children:e.jsx(ot,{className:"h-5 w-5 text-emerald-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:o}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:t})]})]}),e.jsx("button",{onClick:s,className:"shrink-0 rounded-xl h-10 px-4 bg-emerald-600 text-white font-medium shadow hover:bg-emerald-700 active:bg-emerald-800 transition-colors",children:"Sign In"})]})}function Pt({title:s,creator:o,className:t=""}){return e.jsxs("header",{className:`space-y-2 ${t}`,children:[e.jsx("h1",{className:"text-2xl font-bold leading-snug text-gray-900",children:s}),e.jsx(et,{creator:o})]})}function kt({options:s,selectedId:o,onSelect:t,disabled:a=!1}){return e.jsx("section",{className:"rounded-2xl bg-white border shadow-sm overflow-hidden",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:s.map(r=>{const l=r.current_odds??r.odds??1,c=o===r.id,n=r.percentage??0;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>!a&&t(r.id),disabled:a,className:`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${c?"bg-emerald-50 border-l-2 border-l-emerald-600":"hover:bg-gray-50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium text-gray-900",children:r.label}),n>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-500",children:[e.jsx(se,{className:"h-3 w-3"}),e.jsxs("span",{children:[n.toFixed(0),"% of pool"]})]})]}),e.jsxs("span",{className:"text-emerald-600 font-semibold ml-3",children:[l.toFixed(2),"x"]})]})},r.id)})})})}function St({canBet:s,onPlace:o,loading:t=!1,label:a="Place Bet"}){return e.jsx("div",{className:"fixed inset-x-0 z-50 px-4 pb-[calc(env(safe-area-inset-bottom))] pointer-events-none",style:{bottom:"calc(var(--bottom-nav-h, 64px) + 16px)"},children:e.jsx("div",{className:"pointer-events-auto mx-auto max-w-screen-sm",children:e.jsxs("button",{disabled:!s||t,onClick:o,className:"w-full h-12 rounded-2xl bg-emerald-600 text-white font-semibold shadow-lg hover:bg-emerald-700 active:bg-emerald-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:[t&&e.jsx(I,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:t?"Placing Bet...":a})]})})})}function $t(s,o){return ze({queryKey:[...A.prediction(s||"unknown"),"merkle-proof",(o||"").toLowerCase()],enabled:!!(s&&o),queryFn:async()=>{const t=new URLSearchParams({address:String(o)}),a=await fetch(`${be()}/api/v2/settlement/${s}/merkle-proof?${t.toString()}`,{headers:{Accept:"application/json"},credentials:"include"});if(!a.ok){const l=await a.json().catch(()=>({}));throw new Error(l?.message||"Failed to fetch merkle proof")}return(await a.json()).data},staleTime:1e4,refetchInterval:3e4})}const xe={announce:s=>console.log("Announce:",s)},he=s=>_.success(s),D=s=>_.error(s),Gt=({predictionId:s})=>{const o=He(),t=Ke(),{user:a}=fe(),{isAuthenticated:r,user:l}=pe(),c=!!a||r,n=a||l;console.log("ðŸ” PredictionDetailsPageV2 Auth State:",{sessionUser:!!a,storeAuth:r,isAuthenticated:c,hasUser:!!n,userEmail:n?.email});const i=s||t.id||t.predictionId||"",[u,x]=y.useState(null),[h,E]=y.useState(""),[L,O]=y.useState(!1),[k,q]=y.useState("overview"),[R,Q]=y.useState(""),[j,w]=y.useState(!1),[M,re]=y.useState(null),{predictions:H,fetchPredictionById:ie,placePrediction:Ne,loading:ne,error:Pe}=Ve(),S=Oe(),{wallet:ke,available:te,locked:Ct,total:At,isLoading:K,refetch:Se}=Ge(),{address:$}=it(),$e=$?.toLowerCase(),V=y.useMemo(()=>!!H.find(v=>v.id===i)?.settledAt,[H,i]),{data:U,isLoading:Ce}=$t(V?i:void 0,$),{claim:Ae,isClaiming:oe}=Ze(),F=te,m=y.useMemo(()=>i&&H.find(d=>d.id===i)||null,[H,i]),le=y.useMemo(()=>{if(!m)return!1;const d=(m.status||"").toLowerCase();return V||d==="closed"||d==="settled"||d==="cancelled"},[m,V]),{media:z,status:ce}=tt(m?.id||"",m?{id:m.id,title:m.title,category:m.category}:void 0);y.useEffect(()=>{},[z,m]);const C=c?F:0;y.useEffect(()=>{c&&console.log("ðŸ’° PredictionDetailsPageV2 - Balance:",{escrowTotal:te,availableToStake:F,userBalance:C,isLoadingBalance:K,formatted:`${C.toFixed(2)}`})},[c,te,F,C,K]);const G=y.useCallback(async()=>{if(!i){console.log("âŒ No prediction ID found"),o("/discover");return}try{console.log("ðŸ” Loading prediction:",i),await ie(i)}catch(d){console.error("âŒ Error loading prediction:",d),D("Failed to load prediction details")}},[i,ie,o]);y.useEffect(()=>{G()},[G]);const{items:_e,refresh:_t}=at(i,{limit:25,autoLoad:!0});y.useEffect(()=>{if(typeof window>"u")return;const v=(m?.title||m?.question||"").toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").slice(0,80),f=`${window.location.origin}/predictions/${v}`;Q(f);try{let g=document.querySelector('link[rel="canonical"]');g||(g=document.createElement("link"),g.setAttribute("rel","canonical"),document.head.appendChild(g)),g.setAttribute("href",f)}catch{}try{const g=`/predictions/${v}`;window.location.pathname!==g&&o(g,{replace:!0})}catch{}},[m?.title,i]);const J=()=>{window.history.length>1?window.history.back():o("/discover")},Te=async()=>{if(navigator.share&&m)try{await navigator.share({title:m.title,text:`Check out this prediction: ${m.title}`,url:R})}catch{de()}else de()},de=async()=>{try{await navigator.clipboard.writeText(R),he("Link copied to clipboard!"),xe.announce("Link copied to clipboard")}catch(d){console.error("Failed to copy link:",d),D("Failed to copy link")}},Ee=d=>{x(d===u?null:d),d!==u&&E("")},Le=async()=>{if(!c){X({intent:"place_prediction",payload:{predictionId:i}});return}if(!u||!h||!m||!n?.id){n?.id||D("User not authenticated. Please sign in.");return}const d=parseFloat(h);if(d>F){w(!0);return}O(!0);try{console.log("ðŸŽ² Placing prediction with amount:",{stakeAmount:h,parsedAmount:d,availableBalance:C,userId:n.id,isNaN:isNaN(d),isPositive:d>0}),await Ne(m.id,u,d,n.id,$),he(`Bet placed: $${h} | lock consumed`),xe.announce(`Prediction placed successfully for ${h} dollars`);const f=m.options.find(Me=>Me.id===u)?.label||"Your bet";re({amount:d,optionLabel:f}),setTimeout(()=>re(null),6e3),x(null),E("");const g=n?.id;g&&await Promise.all([S.invalidateQueries({queryKey:A.walletSummary(g,$e)}),S.invalidateQueries({queryKey:A.walletActivity(g)}),S.invalidateQueries({queryKey:A.escrowBalance(g)}),S.invalidateQueries({queryKey:A.onchainActivity(g)}),S.invalidateQueries({queryKey:A.prediction(i)}),S.invalidateQueries({queryKey:A.predictionEntries(i)})]),S.invalidateQueries({queryKey:["readContract"]}),await Se(),await G()}catch(f){if(console.error("[FCZ-BET] Error placing prediction:",f),f instanceof Error){if(f.message==="INSUFFICIENT_ESCROW"){w(!0),D("Insufficient escrow balance. Opening deposit modal...");return}D(f.message||"Failed to place prediction. Please try again.")}else D("Failed to place prediction. Please try again.")}finally{O(!1)}};if(ne&&!m)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:J,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(Y,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Loading..."})}),e.jsx("div",{className:"min-w-[40px]"})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx(bt,{message:"Loading prediction details...",className:"py-20"})]});if(Pe&&!m)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:J,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(Y,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Error"})}),e.jsx("div",{className:"min-w-[40px]"})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx(pt,{error:"Failed to load prediction details",onRetry:G,className:"m-4"})]});if(!m&&!ne)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:J,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(Y,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Not Found"})}),e.jsx("div",{className:"min-w-[40px]"})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx(jt,{icon:ge,title:"Prediction Not Found",description:"The prediction you're looking for doesn't exist or has been removed.",action:{label:"Browse Predictions",onClick:()=>o("/discover")},className:"py-20"})]});if(!m)return null;const Be=m.participant_count||0,De=m.pool_total||0;return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:J,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(Y,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Prediction Details"})}),e.jsx("div",{className:"min-w-[40px] flex items-center justify-end gap-1",children:e.jsx("button",{onClick:Te,className:"p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100","aria-label":"Share prediction",children:e.jsx(Ie,{className:"w-5 h-5"})})})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx("div",{className:"mx-4 mt-4 rounded-2xl overflow-hidden border border-gray-100 aspect-video",children:ce==="ready"&&z?.url?e.jsx("img",{src:z.url,alt:z.alt||m?.title,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):ce==="loading"?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 animate-pulse"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-gray-500 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"ðŸ“Š"}),e.jsx("div",{className:"text-sm font-medium capitalize",children:m?.category||"Prediction"})]})})}),e.jsxs("main",{className:"px-4 pb-[calc(var(--bottom-nav-h,64px)+72px+env(safe-area-inset-bottom))] pt-4 space-y-4 bg-gray-50",children:[e.jsx(Pt,{title:m.title,creator:m.creator}),e.jsx(ct,{activeTab:k,onTabChange:q,commentCount:m.comments_count||0,activityCount:_e.length,children:e.jsxs(ye,{mode:"wait",children:[k==="overview"&&e.jsxs(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Prediction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(T,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Volume"}),e.jsx("p",{className:"font-semibold text-gray-900",children:N(De,{compact:!0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(nt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Participants"}),e.jsx("p",{className:"font-semibold text-gray-900",children:Be})]})]})]})]}),le&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-3",children:[e.jsx("div",{className:"text-sm text-yellow-900 font-medium",children:"This prediction is closed."}),e.jsx("div",{className:"text-xs text-yellow-800 mt-1",children:V?"Results are finalized.":"No new bets can be placed."})]}),m.description&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:m.description})]}),!!$&&!!U&&Number(U.amountUnits)>0&&!(()=>{try{return!!localStorage.getItem(`fcz:claimed:${i}:${$.toLowerCase()}`)}catch{return!1}})()&&e.jsx("div",{className:"bg-gradient-to-br from-emerald-50 to-blue-50 rounded-2xl p-4 shadow-sm border border-emerald-100",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"You have winnings to claim"}),e.jsxs("p",{className:"text-sm text-gray-600 mt-0.5",children:["Connected: ",e.jsxs("span",{className:"font-mono",children:[$.slice(0,6),"â€¦",$.slice(-4)]})]})]}),e.jsx("button",{type:"button",className:"h-10 px-4 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:oe||Ce,onClick:async()=>{const d=BigInt(U.amountUnits);await Ae({predictionId:i,amountUnits:d,proof:U.proof})},children:oe?"Claimingâ€¦":`Claim ${N(U.amountUSD,{compact:!1})}`})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:"How This Works"}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-gray-600",children:[e.jsx("li",{children:"â€¢ Choose an outcome you believe will happen"}),e.jsx("li",{children:"â€¢ Stake an amount you're comfortable with"}),e.jsx("li",{children:"â€¢ If you're right, win based on the current odds"}),e.jsx("li",{children:"â€¢ Betting closes when the prediction expires"})]})]}),c?e.jsx(kt,{options:m.options||[],selectedId:u||void 0,onSelect:Ee,disabled:L}):e.jsx(Nt,{onSignIn:()=>X({intent:"place_prediction",payload:{predictionId:i}})}),M&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-emerald-800 font-medium",children:["You staked $",M.amount.toFixed(2)," on â€œ",M.optionLabel,"â€."]}),e.jsx("button",{type:"button",onClick:()=>q("activity"),className:"text-xs font-semibold text-emerald-700 hover:text-emerald-800 underline",children:"View activity"})]}),c&&u&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stake-input",className:"block text-sm font-medium text-gray-900 mb-2",children:"Stake Amount (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}),e.jsx("input",{id:"stake-input",type:"number",inputMode:"decimal",placeholder:"0.00",value:h,onChange:d=>E(d.target.value),disabled:L,className:"w-full rounded-xl border bg-background pl-10 pr-4 py-3 text-lg font-semibold transition-colors border-border focus:border-primary focus:ring-primary/20 focus:outline-none focus:ring-2 disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Available: ",K?"Loadingâ€¦":N(C,{compact:!0})]}),h&&!K&&parseFloat(h)>C&&e.jsx("span",{className:"text-red-600 font-medium",children:"Insufficient balance"})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:[10,25,50,100,250,500].map(d=>e.jsxs("button",{onClick:()=>E(d.toString()),disabled:L||d>C,className:"rounded-lg border bg-gray-50 px-3 py-2 text-sm font-medium hover:bg-gray-100 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:["$",d]},d))})]})]},"overview"),k==="comments"&&e.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},"data-qa":"comments-section",children:e.jsx(ft,{predictionId:i})},"comments"),k==="activity"&&e.jsx(P.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(vt,{predictionId:i})},"activity")]})})]}),k==="overview"&&!le&&(()=>{const d=parseFloat(h||"0"),v=Math.max(0,d-F),f=!d||d<=0?"Place Bet":v>0?`Add funds (need $${v.toFixed(2)})`:`Place Bet: $${d.toFixed(2)}`,g=!!h&&d>0;return e.jsx(St,{canBet:g,onPlace:Le,loading:L,label:f})})(),j&&n?.id&&e.jsx(Je,{open:j,onClose:()=>w(!1),onSuccess:()=>w(!1),availableUSDC:ke,userId:n.id})]})};export{Gt as default};
