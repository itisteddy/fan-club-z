import{r as C}from"./vendor-c36eaa8e.js";import{u as k,b as $}from"./utils-617af415.js";import{u as j}from"./useEscrowBalance-5c6e362b.js";import{u as F}from"./DepositUSDCModal-4620608e.js";import{Q as O,l as I,a as P}from"./index-78beacc5.js";import{m as _}from"./wagmi-c444efa6.js";function V(r,v={}){const{walletAddress:t,enabled:y=!0,refetchIntervalMs:i=3e4}=v,l=t?.toLowerCase()??null;return k({queryKey:O.walletSummary(r??"anon",l),enabled:!!r&&y,refetchInterval:i,staleTime:2e4,gcTime:6e4,refetchOnWindowFocus:!1,refetchOnMount:!1,retry:2,queryFn:async()=>{if(!r)throw new Error("userId is required to load wallet summary");const o=new URLSearchParams;l&&o.set("walletAddress",l);const u=I(),n=new AbortController,c=setTimeout(()=>n.abort(),12e3),d=`${u}/api/wallet/summary/${r}${o.size?`?${o.toString()}`:""}`;let s;try{s=await fetch(d,{headers:{Accept:"application/json"},signal:n.signal})}catch(a){throw a?.name==="AbortError"?new Error("Wallet summary request timed out. Please try again."):a}finally{clearTimeout(c)}if(!s.ok){const a=await s.json().catch(()=>({}));throw new Error(a.message||"Failed to load wallet summary")}const e=await s.json();return{currency:"USD",available:Number(e.available??0),reserved:Number(e.reserved??0),total:Number(e.total??0),availableToStakeUSDC:Number(e.availableToStakeUSDC??e.available??0),reservedUSDC:Number(e.reservedUSDC??e.reserved??0),escrowUSDC:Number(e.escrowUSDC??e.total??0),totalDeposited:Number(e.totalDeposited??e.totalDepositedUSDC??0),totalWithdrawn:Number(e.totalWithdrawn??e.totalWithdrawnUSDC??0),updatedAt:e.updatedAt??e.updated_at??new Date().toISOString(),walletAddress:e.walletAddress??e.wallet_address??null}}})}function ee(){const{user:r}=P(),{address:v}=_(),t=$(),{balance:y,isLoading:i,error:l,refetch:o}=F(),{availableUSD:u,reservedUSD:n,totalUSD:c,isLoading:d,error:s,refetch:e}=j(),{data:a,isLoading:g,error:p,refetch:S}=V(r?.id,{walletAddress:v,refetchIntervalMs:3e4,enabled:!!r?.id}),E=typeof u=="number"?u:0,x=typeof n=="number"?n:0,L=typeof c=="number"&&!Number.isNaN(c)?c:E+x,D=Number(a?.availableToStakeUSDC??a?.available??0),U=Number(a?.reservedUSDC??a?.reserved??0),T=Number(a?.escrowUSDC??0),q=typeof D=="number"&&typeof U=="number"?D+U:0,A=!!a&&!g&&!p,B=A?Math.max(0,D):Math.max(0,E),Q=A?Math.max(0,U):Math.max(0,x),R=A?Math.max(0,T||q||L):Math.max(0,L),m=Math.max(B,0),f=Math.max(Q,0),w=Math.max(R,0),b=C.useRef({available:m,reserved:f,total:w});C.useEffect(()=>{b.current={available:m,reserved:f,total:w}},[m,f,w]);const h=i||d||g,W=h?b.current.available:m,z=h?b.current.reserved:f,K=h?b.current.total:w,N=()=>{o(),e(),r?.id&&S()};return C.useEffect(()=>{const M=()=>{t.invalidateQueries({queryKey:["readContract"],exact:!1}),t.invalidateQueries({queryKey:["wallet"],exact:!1}),t.invalidateQueries({queryKey:["escrow-balance"],exact:!1}),t.invalidateQueries({queryKey:["usdcBalance"],exact:!1}),N()};return window.addEventListener("fcz:balance:refresh",M),()=>window.removeEventListener("fcz:balance:refresh",M)},[t,o,e,S,r?.id]),{wallet:y||0,available:W,locked:z,total:K,summary:a,isLoading:h,isWalletLoading:i,isEscrowLoading:d,error:l||s||p,walletError:l,escrowError:s,summaryError:p,refetch:N,refetchWallet:o,refetchEscrow:e,refetchSummary:S}}export{ee as u};
