{"version":3,"file":"PredictionsPage-5d5dcaba.js","sources":["../../src/components/auth/SignedOutGateCard.tsx","../../src/components/modals/ConfirmationModal.tsx","../../src/hooks/useSettlement.ts","../../src/hooks/useSettlementMerkle.ts","../../src/components/ui/textarea.tsx","../../src/components/modals/SettlementModal.tsx","../../src/components/modals/DisputeResolutionModal.tsx","../../src/components/modals/EditModal.tsx","../../src/components/modals/ManagePredictionModal.tsx","../../src/lib/predictionCardVM.ts","../../src/pages/PredictionsPage.tsx"],"sourcesContent":["import React from 'react';\nimport { ArrowRight } from 'lucide-react';\nimport { motion } from 'framer-motion';\nimport { openAuthGate } from '../../auth/authGateAdapter';\nimport { AuthIntent } from '../../auth/authIntents';\n\ninterface SignedOutGateCardProps {\n  icon?: React.ReactElement<{ className?: string }>;\n  title?: string;\n  body?: string;\n  primaryLabel?: string;\n  onPrimary?: () => void;\n  secondaryLabel?: string;\n  onSecondary?: () => void;\n  // New auth gate specific props\n  intent?: AuthIntent;\n  payload?: Record<string, unknown>;\n}\n\n/**\n * SignedOutGateCard - Consistent auth-required gate component\n * Now matches the design pattern used across Wallet, Profile, and other pages\n */\nconst SignedOutGateCard: React.FC<SignedOutGateCardProps> = ({\n  icon,\n  title,\n  body,\n  primaryLabel = 'Sign In',\n  onPrimary,\n  secondaryLabel,\n  onSecondary,\n  intent,\n  payload,\n}) => {\n\n  const handlePrimary = async () => {\n    if (onPrimary) {\n      // Use legacy callback if provided for backward compatibility\n      onPrimary();\n    } else if (intent) {\n      // Use new auth gate adapter\n      try {\n        const result = await openAuthGate({ intent, payload });\n        if (result.status === 'success') {\n          // Auth completed successfully - the calling component should handle the resume\n          if (import.meta.env.DEV && import.meta.env.VITE_DEBUG_LOGS === 'true') {\n            console.log('[FCZ-QA] Auth gate completed successfully for intent:', intent);\n          }\n        } else if (result.status === 'cancel') {\n          if (import.meta.env.DEV && import.meta.env.VITE_DEBUG_LOGS === 'true') {\n            console.log('[FCZ-QA] Auth gate cancelled by user');\n          }\n        } else if (result.status === 'error') {\n          if (import.meta.env.DEV && import.meta.env.VITE_DEBUG_LOGS === 'true') {\n            console.error('[FCZ-QA] Auth gate error:', result.reason);\n          }\n        }\n      } catch (error) {\n        if (import.meta.env.DEV && import.meta.env.VITE_DEBUG_LOGS === 'true') {\n          console.error('[FCZ-QA] Auth gate exception:', error);\n        }\n      }\n    } else {\n      console.warn('SignedOutGateCard: No onPrimary or intent provided');\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col items-center justify-center text-center py-12 px-4\">\n      {/* Icon - minimal 24-32px as per design system */}\n      {icon && (\n        <div className=\"mb-4 text-gray-300\">\n          {React.cloneElement(icon, {\n            className: 'w-6 h-6 md:w-8 md:h-8'\n          })}\n        </div>\n      )}\n\n      {/* Title - 16-18px */}\n      <h3 className=\"text-base md:text-lg font-semibold text-gray-900 mb-2\">\n        {title || 'Sign in required'}\n      </h3>\n\n      {/* Body - 14-15px */}\n      <p className=\"text-sm md:text-base text-gray-600 mb-6 max-w-sm leading-relaxed\">\n        {body || 'Please sign in to continue with this action.'}\n      </p>\n\n      {/* Actions */}\n      <div className=\"flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-3\">\n        {/* Primary CTA */}\n        <button\n          onClick={handlePrimary}\n          className=\"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors\"\n          data-qa=\"authgate-open\"\n        >\n          {primaryLabel}\n        </button>\n\n        {/* Secondary CTA */}\n        {secondaryLabel && onSecondary && (\n          <button\n            onClick={onSecondary}\n            className=\"px-6 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg font-medium transition-colors\"\n          >\n            {secondaryLabel}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default SignedOutGateCard;\n","import React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { AlertTriangle, X } from 'lucide-react';\n\ninterface ConfirmationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onConfirm: () => void;\n  title: string;\n  message: string;\n  confirmText?: string;\n  cancelText?: string;\n  variant?: 'danger' | 'warning' | 'info';\n  isLoading?: boolean;\n}\n\nexport const ConfirmationModal: React.FC<ConfirmationModalProps> = ({\n  isOpen,\n  onClose,\n  onConfirm,\n  title,\n  message,\n  confirmText = 'Confirm',\n  cancelText = 'Cancel',\n  variant = 'danger',\n  isLoading = false\n}) => {\n  const getVariantStyles = () => {\n    switch (variant) {\n      case 'danger':\n        return {\n          icon: <AlertTriangle className=\"w-6 h-6 text-red-600\" />,\n          confirmButton: 'bg-red-600 hover:bg-red-700 text-white',\n          border: 'border-red-200'\n        };\n      case 'warning':\n        return {\n          icon: <AlertTriangle className=\"w-6 h-6 text-amber-600\" />,\n          confirmButton: 'bg-amber-600 hover:bg-amber-700 text-white',\n          border: 'border-amber-200'\n        };\n      case 'info':\n        return {\n          icon: <AlertTriangle className=\"w-6 h-6 text-blue-600\" />,\n          confirmButton: 'bg-blue-600 hover:bg-blue-700 text-white',\n          border: 'border-blue-200'\n        };\n      default:\n        return {\n          icon: <AlertTriangle className=\"w-6 h-6 text-red-600\" />,\n          confirmButton: 'bg-red-600 hover:bg-red-700 text-white',\n          border: 'border-red-200'\n        };\n    }\n  };\n\n  const styles = getVariantStyles();\n\n  const handleConfirm = () => {\n    if (!isLoading) {\n      onConfirm();\n    }\n  };\n\n  const handleClose = () => {\n    if (!isLoading) {\n      onClose();\n    }\n  };\n\n  return (\n    <AnimatePresence mode=\"wait\">\n      {isOpen && (\n        <div className=\"fixed inset-0 z-[12000] flex items-center justify-center p-4\">\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"absolute inset-0 bg-black bg-opacity-50\"\n            onClick={handleClose}\n          />\n          \n          {/* Modal */}\n          <motion.div\n            initial={{ opacity: 0, scale: 0.95, y: 20 }}\n            animate={{ opacity: 1, scale: 1, y: 0 }}\n            exit={{ opacity: 0, scale: 0.95, y: 20 }}\n            transition={{ duration: 0.2, ease: 'easeOut' }}\n            className=\"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden\"\n          >\n            {/* Header */}\n            <div className={`flex items-center justify-between p-6 border-b ${styles.border}`}>\n              <div className=\"flex items-center gap-3\">\n                {styles.icon}\n                <h3 className=\"text-lg font-semibold text-gray-900\">{title}</h3>\n              </div>\n              <button\n                onClick={handleClose}\n                disabled={isLoading}\n                className=\"p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50\"\n              >\n                <X className=\"w-5 h-5 text-gray-500\" />\n              </button>\n            </div>\n\n            {/* Content */}\n            <div className=\"p-6\">\n              <p className=\"text-gray-600 leading-relaxed\">{message}</p>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-3 p-6 pt-0\">\n              <button\n                onClick={handleClose}\n                disabled={isLoading}\n                className=\"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50\"\n              >\n                {cancelText}\n              </button>\n              <button\n                onClick={handleConfirm}\n                disabled={isLoading}\n                className={`flex-1 px-4 py-3 rounded-xl font-medium transition-colors disabled:opacity-50 ${styles.confirmButton}`}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center justify-center gap-2\">\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    Processing...\n                  </div>\n                ) : (\n                  confirmText\n                )}\n              </button>\n            </div>\n          </motion.div>\n        </div>\n      )}\n    </AnimatePresence>\n  );\n};\n","import { useState, useCallback } from 'react';\nimport { getApiUrl } from '../config';\n\ninterface SettlementRequest {\n  predictionId: string;\n  winningOptionId: string;\n  proofUrl?: string;\n  reason?: string;\n  userId: string; // In production, this would come from auth context\n}\n\ninterface SettlementResponse {\n  success: boolean;\n  data: {\n    settlement: any;\n    totalPayout: number;\n    platformFee: number;\n    creatorFee: number;\n    winnersCount: number;\n    participantsCount: number;\n    results: Array<{\n      userId: string;\n      entryId: string;\n      stake: number;\n      payout: number;\n    }>;\n  };\n  message: string;\n}\n\ninterface SettlementError {\n  error: string;\n  message: string;\n  version?: string;\n}\n\nexport const useSettlement = () => {\n  const [isSettling, setIsSettling] = useState(false);\n  const [settlementError, setSettlementError] = useState<string | null>(null);\n\n  const settleManually = useCallback(async (request: SettlementRequest): Promise<SettlementResponse | null> => {\n    setIsSettling(true);\n    setSettlementError(null);\n\n    try {\n      console.log('ðŸ”¨ Starting manual settlement:', request);\n\n      const response = await fetch(`${getApiUrl()}/api/v2/settlement/manual`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Accept': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify(request)\n      });\n\n      console.log('ðŸ“¡ Settlement response status:', response.status);\n\n      if (!response.ok) {\n        const errorData: SettlementError = await response.json();\n        console.error('âŒ Settlement failed:', errorData);\n        setSettlementError(errorData.message || 'Settlement failed');\n        return null;\n      }\n\n      const settlementData: SettlementResponse = await response.json();\n      console.log('âœ… Settlement successful:', settlementData);\n\n      return settlementData;\n\n    } catch (error) {\n      console.error('âŒ Settlement network error:', error);\n      setSettlementError('Network error during settlement');\n      return null;\n    } finally {\n      setIsSettling(false);\n    }\n  }, []);\n\n  const getSettlementInfo = useCallback(async (predictionId: string) => {\n    try {\n      console.log('ðŸ“Š Fetching settlement info for:', predictionId);\n\n      const response = await fetch(`${getApiUrl()}/api/v2/settlement/prediction/${predictionId}`, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json',\n        },\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        if (response.status === 404) {\n          return null; // No settlement found (not settled yet)\n        }\n        throw new Error(`Failed to fetch settlement: ${response.status}`);\n      }\n\n      const data = await response.json();\n      console.log('ðŸ“Š Settlement info fetched:', data);\n      return data.data;\n\n    } catch (error) {\n      console.error('âŒ Error fetching settlement info:', error);\n      return null;\n    }\n  }, []);\n\n  return {\n    settleManually,\n    getSettlementInfo,\n    isSettling,\n    settlementError,\n    clearError: () => setSettlementError(null)\n  };\n};\n\nexport default useSettlement;","import { useCallback, useState } from 'react';\nimport { useAccount, usePublicClient, useSwitchChain, useWriteContract } from 'wagmi';\nimport { baseSepolia } from 'wagmi/chains';\nimport { waitForTransactionReceipt } from 'viem/actions';\nimport { BaseError, type Hash } from 'viem';\nimport { getAddress } from 'viem';\nimport toast from 'react-hot-toast';\nimport { getApiUrl } from '@/utils/environment';\nimport { ESCROW_MERKLE_ABI } from '@/chain/escrowMerkleAbi';\nimport { useWalletConnectSession } from '@/hooks/useWalletConnectSession';\nimport { useWeb3Recovery } from '@/providers/Web3Provider';\nimport { \n  logTransaction, \n  parseOnchainError, \n  isSessionError,\n  cleanupWalletConnectStorage,\n  broadcastReconnectRequired,\n  broadcastBalanceRefresh,\n  ensureWalletReady,\n} from '@/services/onchainTransactionService';\n\nfunction toBytes32FromUuid(uuid: string): `0x${string}` {\n  const hex = uuid.replace(/-/g, '').toLowerCase().padEnd(64, '0');\n  return `0x${hex}` as const;\n}\n\nexport type MerklePrepareResponse = {\n  success: boolean;\n  data: {\n    predictionId: string;\n    title: string;\n    winningOptionId: string;\n    // Present for crypto-rail settlements (winners claim on-chain).\n    // Omitted for demo-only settlements (already finalized off-chain).\n    merkleRoot?: `0x${string}`;\n    platformFeeUnits?: string;\n    creatorFeeUnits?: string;\n    leaves: Array<{\n      user_id: string;\n      address: `0x${string}`;\n      amountUnits: string;\n      leaf: `0x${string}`;\n      proof: `0x${string}`[];\n    }>;\n    summary: {\n      platformFeeUSD: number;\n      creatorFeeUSD: number;\n      payoutPoolUSD: number;\n      prizePoolUSD: number;\n      winnersCount: number;\n    };\n  };\n  message: string;\n  version: string;\n};\n\nexport function useSettlementMerkle() {\n  const { address, chainId, isConnected } = useAccount();\n  const publicClient = usePublicClient();\n  const { switchChainAsync } = useSwitchChain();\n  const { writeContractAsync } = useWriteContract();\n  const { withSessionRecovery, recoverFromError } = useWalletConnectSession();\n  const { sessionHealthy } = useWeb3Recovery();\n\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  /**\n   * Handle session errors with recovery\n   */\n  async function handleSessionErrorRecovery(err: unknown): Promise<boolean> {\n    if (!isSessionError(err)) {\n      return false;\n    }\n    \n    console.log('[FCZ-SETTLE] Detected stale WalletConnect session, attempting recovery...');\n    \n    try {\n      cleanupWalletConnectStorage();\n      await recoverFromError();\n      toast.error('Wallet session expired. Please try again.', { id: 'session-error' });\n      broadcastReconnectRequired('Wallet session expired');\n      return true;\n    } catch (recoveryErr) {\n      console.error('[FCZ-SETTLE] Session recovery failed:', recoveryErr);\n      cleanupWalletConnectStorage();\n      toast.error('Wallet connection lost. Please reconnect.', { id: 'session-error' });\n      return true;\n    }\n  }\n\n  const settleWithMerkle = useCallback(\n    async (args: {\n      predictionId: string;\n      winningOptionId: string;\n      reason?: string;\n      userId: string;\n      escrowAddress?: `0x${string}`;\n      platformTreasury?: `0x${string}`;\n    }): Promise<{ txHash?: `0x${string}`; root?: `0x${string}`; queuedFinalize?: boolean } | null> => {\n      setIsSubmitting(true);\n      setError(null);\n      \n      let txHash: Hash | null = null;\n      let preparedRoot: `0x${string}` | null = null;\n      \n      try {\n        // NOTE: We trust the backend to verify creator identity via userId\n        // The connected wallet MAY sign the on-chain settlement transaction (optional).\n        // The backend /api/v2/settlement/manual/merkle endpoint validates:\n        // 1. The userId matches the prediction creator\n        // 2. The prediction exists and can be settled\n        console.log('[FCZ-SETTLE] Preparing settlement on server for prediction:', args.predictionId);\n\n        // Prepare merkle distribution on the server\n        console.log('[FCZ-SETTLE] Preparing merkle settlement for prediction:', args.predictionId);\n        \n        const prepare = await fetch(`${getApiUrl()}/api/v2/settlement/manual/merkle`, {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({\n            predictionId: args.predictionId,\n            winningOptionId: args.winningOptionId,\n            userId: args.userId,\n            reason: args.reason || '',\n          }),\n        });\n        \n        if (!prepare.ok) {\n          const err = await prepare.json().catch(() => ({}));\n          throw new Error(err?.message || 'Failed to prepare merkle settlement');\n        }\n        \n        const data: MerklePrepareResponse = await prepare.json();\n\n        // Demo-only settlement: server already completed off-chain; no on-chain action required.\n        if (!data?.data?.merkleRoot) {\n          toast.success('Settlement completed (demo only).', { id: 'settle' });\n          return { queuedFinalize: false };\n        }\n\n        const escrowAddress =\n          args.escrowAddress ||\n          (import.meta.env.VITE_BASE_ESCROW_ADDRESS as `0x${string}`) ||\n          (import.meta.env.VITE_ESCROW_CONTRACT_ADDRESS as `0x${string}`);\n        if (!escrowAddress) {\n          throw new Error('Escrow contract address missing (VITE_BASE_ESCROW_ADDRESS)');\n        }\n        const platformAddress =\n          args.platformTreasury ||\n          (import.meta.env.VITE_PLATFORM_TREASURY_ADDRESS as `0x${string}`) ||\n          ('0x0000000000000000000000000000000000000000' as `0x${string}`);\n\n        const predictionIdHex = toBytes32FromUuid(args.predictionId);\n        const root = data.data.merkleRoot as `0x${string}`;\n        preparedRoot = root;\n        const creatorFee = BigInt(data.data.creatorFeeUnits || '0');\n        const platformFee = BigInt(data.data.platformFeeUnits || '0');\n        \n        // Calculate total fee amount for logging (used for wallet_transactions)\n        const totalFeeUSD =\n          (data.data.summary?.platformFeeUSD ?? 0) +\n          (data.data.summary?.creatorFeeUSD ?? 0);\n\n        // If wallet isn't connected/healthy, queue finalization for the admin relayer.\n        // This avoids WalletConnect timeouts and prevents unsafe off-chain fallback for crypto rail.\n        const canUseWallet = Boolean(address && isConnected && sessionHealthy);\n        if (!canUseWallet) {\n          try {\n            await fetch(`${getApiUrl()}/api/v2/settlement/${args.predictionId}/request-finalize`, {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n              credentials: 'include',\n              body: JSON.stringify({ userId: args.userId }),\n            });\n          } catch {}\n\n          toast.success('Settlement prepared. Finalization queued for relayer.', { id: 'settle' });\n          return { root, queuedFinalize: true };\n        }\n\n        // Ensure correct chain (auto-switch to Base Sepolia)\n        if (chainId !== baseSepolia.id) {\n          await switchChainAsync({ chainId: baseSepolia.id });\n        }\n\n        // Double-check wallet readiness (session health, connection, chain)\n        try {\n          ensureWalletReady({\n            address,\n            chainId: baseSepolia.id,\n            expectedChainId: baseSepolia.id,\n            isConnected,\n            sessionHealthy,\n          });\n        } catch (err) {\n          const parsed = parseOnchainError(err);\n          toast.error(parsed.message, { id: 'settle' });\n          setError(parsed.message);\n          // Queue finalize rather than failing the settlement flow.\n          try {\n            await fetch(`${getApiUrl()}/api/v2/settlement/${args.predictionId}/request-finalize`, {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n              credentials: 'include',\n              body: JSON.stringify({ userId: args.userId }),\n            });\n          } catch {}\n          return { root, queuedFinalize: true };\n        }\n\n        console.log('[FCZ-SETTLE] Submitting settlement root on-chain:', {\n          predictionId: args.predictionId,\n          root,\n          creatorFee: creatorFee.toString(),\n          platformFee: platformFee.toString(),\n        });\n\n        if (!address) {\n          throw new Error('Connect wallet to submit settlement on-chain');\n        }\n\n        toast.loading('Submitting settlement root on-chain...', { id: 'settle' });\n        \n        // Execute with session recovery wrapper\n        // Use connected wallet as creator fee recipient (they're paying for gas, they're the authenticated creator)\n        txHash = await withSessionRecovery(async () => {\n          return await writeContractAsync({\n            address: escrowAddress,\n            abi: ESCROW_MERKLE_ABI,\n            functionName: 'postSettlementRoot',\n            args: [predictionIdHex, root, address, creatorFee, platformAddress, platformFee],\n          } as any);\n        }, { maxRetries: 1, operationTimeoutMs: 20000 });\n\n        if (!txHash) {\n          throw new Error('Missing transaction hash after settlement submission');\n        }\n\n        console.log('[FCZ-SETTLE] Settlement tx sent:', txHash);\n\n        // Log settlement as pending\n        await logTransaction({\n          userId: args.userId,\n          walletAddress: address,\n          txHash,\n          type: 'settlement',\n          status: 'pending',\n          amount: totalFeeUSD,\n          predictionId: args.predictionId,\n        }).catch(e => console.warn('[FCZ-SETTLE] Log failed:', e));\n\n        // Wait for receipt\n        if (publicClient) {\n          const receipt = await waitForTransactionReceipt(publicClient as any, { \n            hash: txHash,\n            confirmations: 1,\n            timeout: 180_000,\n          });\n          \n          if (receipt.status === 'reverted') {\n            throw new Error('Settlement transaction reverted on-chain');\n          }\n        }\n\n        console.log('[FCZ-SETTLE] âœ“ Settlement confirmed:', txHash);\n\n        // Log settlement as completed\n        await logTransaction({\n          userId: args.userId,\n          walletAddress: address,\n          txHash,\n          type: 'settlement',\n          status: 'completed',\n          amount: totalFeeUSD,\n          predictionId: args.predictionId,\n        }).catch(e => console.warn('[FCZ-SETTLE] Log failed:', e));\n\n        // Store tx hash locally for reference\n        try {\n          const key = `fcz:lastTx:settlement:${args.predictionId}`;\n          localStorage.setItem(key, txHash);\n          window.dispatchEvent(new CustomEvent('fcz:tx', { \n            detail: { kind: 'settlement', txHash, predictionId: args.predictionId } \n          }));\n        } catch {}\n\n        // Notify backend that on-chain posting is complete\n        try {\n          await fetch(`${getApiUrl()}/api/v2/settlement/manual/merkle/posted`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ predictionId: args.predictionId, txHash, root }),\n          });\n        } catch {}\n        \n        const short = `${txHash.slice(0, 8)}â€¦${txHash.slice(-6)}`;\n        toast.success('Settlement root posted! Tx: ' + short, { id: 'settle' });\n        \n        // Trigger balance refresh\n        broadcastBalanceRefresh();\n        \n        return { txHash: txHash as `0x${string}`, root };\n      } catch (e: any) {\n        console.error('[FCZ-SETTLE] Settlement failed:', e);\n        \n        // Check for session errors\n        const wasSessionError = await handleSessionErrorRecovery(e);\n\n        // If we already prepared a crypto settlement root, queue finalize for relayer so users aren't blocked.\n        if (wasSessionError && preparedRoot) {\n          try {\n            await fetch(`${getApiUrl()}/api/v2/settlement/${args.predictionId}/request-finalize`, {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json', Accept: 'application/json' },\n              credentials: 'include',\n              body: JSON.stringify({ userId: args.userId }),\n            });\n          } catch {}\n          toast.success('Wallet session expired. Finalization queued for relayer.', { id: 'settle' });\n          return { root: preparedRoot, queuedFinalize: true };\n        }\n        \n        // Log failure if we had a tx hash\n        if (txHash && !wasSessionError) {\n          const parsed = parseOnchainError(e);\n          await logTransaction({\n            userId: args.userId,\n            walletAddress: address!,\n            txHash,\n            type: 'settlement',\n            status: 'failed',\n            predictionId: args.predictionId,\n            error: parsed.message,\n          }).catch(err => console.warn('[FCZ-SETTLE] Log failed:', err));\n        }\n        \n        let msg = e?.shortMessage || e?.message || 'Failed to submit settlement';\n        if (e instanceof BaseError) {\n          const lower = (e.shortMessage || '').toLowerCase();\n          if (lower.includes('insufficient funds')) msg = 'Insufficient funds to pay gas';\n          if (lower.includes('user rejected')) msg = 'User rejected the transaction';\n          if (lower.includes('execution reverted')) msg = 'Contract reverted â€” check merkle root or fees';\n        }\n        \n        setError(msg);\n        toast.error(msg, { id: 'settle' });\n        return null;\n      } finally {\n        setIsSubmitting(false);\n      }\n    },\n    [address, chainId, isConnected, publicClient, sessionHealthy, switchChainAsync, writeContractAsync, withSessionRecovery, recoverFromError]\n  );\n\n  return {\n    isSubmitting,\n    error,\n    settleWithMerkle,\n  };\n}\n\nexport default useSettlementMerkle;\n","import * as React from 'react';\nimport { cn } from '../../lib/utils';\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          'flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50',\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nTextarea.displayName = 'Textarea';\n\nexport { Textarea };","import React, { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Check, AlertTriangle, DollarSign, Users, Trophy } from 'lucide-react';\nimport { Prediction, PredictionOption, usePredictionStore } from '../../store/predictionStore';\nimport useSettlement from '../../hooks/useSettlement';\nimport useSettlementMerkle from '../../hooks/useSettlementMerkle';\nimport { Button } from '../ui/button';\nimport { Textarea } from '../ui/textarea';\nimport { Input } from '../ui/input';\nimport toast from 'react-hot-toast';\nimport { useNotificationStore } from '../../store/notificationStore';\n\ninterface SettlementModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  prediction: Prediction;\n  onSettlementComplete?: () => void;\n}\n\nconst SettlementModal: React.FC<SettlementModalProps> = ({\n  isOpen,\n  onClose,\n  prediction,\n  onSettlementComplete\n}) => {\n  const [selectedOptionId, setSelectedOptionId] = useState<string>('');\n  const [proofUrl, setProofUrl] = useState('');\n  const [reason, setReason] = useState('');\n  const [showConfirmation, setShowConfirmation] = useState(false);\n  const [options, setOptions] = useState<PredictionOption[]>(prediction.options || []);\n  const [poolTotalOverride, setPoolTotalOverride] = useState<number | null>(null);\n  const [participantCountOverride, setParticipantCountOverride] = useState<number | null>(null);\n  const [platformFeePctOverride, setPlatformFeePctOverride] = useState<number | null>(null);\n  const [creatorFeePctOverride, setCreatorFeePctOverride] = useState<number | null>(null);\n\n  const { isSettling, settlementError, clearError } = useSettlement();\n  const { settleWithMerkle, isSubmitting: isPostingRoot, error: merkleError } = useSettlementMerkle();\n  const { notifySettlementReady } = useNotificationStore();\n\n  const handleSubmit = async () => {\n    if (!selectedOptionId) {\n      toast.error('Please select a winning option');\n      return;\n    }\n\n    if (!reason.trim()) {\n      toast.error('Please provide a reason for settlement');\n      return;\n    }\n\n    try {\n      clearError();\n\n      // 1) Try on-chain Merkle settlement first\n      console.log('[SETTLEMENT] Attempting on-chain Merkle settlement...');\n      const result = await settleWithMerkle({\n        predictionId: prediction.id,\n        winningOptionId: selectedOptionId,\n        reason: reason.trim(),\n        userId: prediction.creator_id || '',\n      });\n\n      if (result) {\n        // If txHash exists, root was posted on-chain by the creator wallet.\n        // If queuedFinalize is true, settlement was prepared and finalization was queued for the relayer.\n        console.log('[SETTLEMENT] Settlement flow completed:', result);\n        setShowConfirmation(false);\n        onClose();\n        if (onSettlementComplete) onSettlementComplete();\n        return;\n      }\n\n      // If we reach here, Merkle settlement did not complete.\n      // IMPORTANT: Do NOT fall back to off-chain settlement for crypto rail, to avoid double-settlement/logging.\n      toast.error(merkleError || 'Settlement failed. Please reconnect wallet (if needed) and try again.');\n    } catch (error) {\n      console.error('Settlement submit error:', error);\n      const msg = (error as any)?.message || 'Settlement failed. Please try again.';\n      toast.error(msg);\n    }\n  };\n\n  const handleClose = () => {\n    setSelectedOptionId('');\n    setProofUrl('');\n    setReason('');\n    setShowConfirmation(false);\n    clearError();\n    onClose();\n  };\n\n  // Ensure options are loaded even if parent did not pass them yet\n  const { fetchPredictionById } = usePredictionStore();\n  React.useEffect(() => {\n    let isMounted = true;\n    const ensureOptions = async () => {\n      try {\n        if (prediction.options && prediction.options.length > 0) {\n          if (!isMounted) return;\n          setOptions(prediction.options);\n          // Still keep fee percentages/pool/participants aligned from the freshest data we have\n          setPoolTotalOverride(typeof prediction.pool_total === 'number' ? prediction.pool_total : null);\n          setParticipantCountOverride(typeof prediction.participant_count === 'number' ? prediction.participant_count : null);\n          setPlatformFeePctOverride(\n            Number.isFinite((prediction as any).platform_fee_percentage) ? Number((prediction as any).platform_fee_percentage) : null\n          );\n          setCreatorFeePctOverride(\n            Number.isFinite((prediction as any).creator_fee_percentage) ? Number((prediction as any).creator_fee_percentage) : null\n          );\n          console.log('âœ… SettlementModal: Using options from props:', prediction.options.length);\n          return;\n        }\n        const full = await fetchPredictionById(String(prediction.id));\n        if (isMounted && full?.options?.length) {\n          setOptions(full.options);\n          setPoolTotalOverride(typeof (full as any).pool_total === 'number' ? Number((full as any).pool_total) : null);\n          setParticipantCountOverride(\n            typeof (full as any).participant_count === 'number' ? Number((full as any).participant_count) : null\n          );\n          setPlatformFeePctOverride(\n            Number.isFinite((full as any).platform_fee_percentage) ? Number((full as any).platform_fee_percentage) : null\n          );\n          setCreatorFeePctOverride(\n            Number.isFinite((full as any).creator_fee_percentage) ? Number((full as any).creator_fee_percentage) : null\n          );\n          console.log('âœ… SettlementModal: Loaded options via fetch:', full.options.length);\n        } else if (isMounted) {\n          console.warn('âš ï¸ SettlementModal: No options available for prediction:', prediction.id);\n        }\n      } catch (err) {\n        console.warn('âš ï¸ SettlementModal: Failed to ensure options:', err);\n      }\n    };\n    ensureOptions();\n    return () => { isMounted = false; };\n  }, [prediction.id]);\n  \n  const selectedOption = options.find(opt => opt.id === selectedOptionId);\n  const getOptionTotalStaked = (opt?: PredictionOption | null) =>\n    Number(((opt as any)?.total_staked ?? (opt as any)?.totalStaked ?? 0) || 0);\n\n  // Use the most reliable pool total available:\n  // - prediction.pool_total can be stale in the list view\n  // - option totals are usually fresher because we fetch the full prediction before settling\n  const optionsPoolTotal = options.reduce((sum, o) => sum + getOptionTotalStaked(o), 0);\n  const poolFromPrediction = Number((poolTotalOverride ?? prediction.pool_total) || 0);\n  const totalPool = Math.max(poolFromPrediction, optionsPoolTotal, 0);\n\n  const participantCount = Number((participantCountOverride ?? prediction.participant_count) || 0);\n\n  const platformFeePercent = Number.isFinite(platformFeePctOverride ?? (prediction as any).platform_fee_percentage)\n    ? Number(platformFeePctOverride ?? (prediction as any).platform_fee_percentage)\n    : 2.5;\n  const creatorFeePercent = Number.isFinite(creatorFeePctOverride ?? (prediction as any).creator_fee_percentage)\n    ? Number(creatorFeePctOverride ?? (prediction as any).creator_fee_percentage)\n    : 1.0;\n\n  // Determine total staked on the selected (winning) option\n  const selectedStake = selectedOption ? getOptionTotalStaked(selectedOption) : 0;\n\n  // House take applies ONLY to losing stakes (round to cents deterministically)\n  const totalLosingStake = Math.max(0, totalPool - selectedStake);\n  const platformFeeCents = Math.round(totalLosingStake * 100 * platformFeePercent / 100);\n  const creatorFeeCents = Math.round(totalLosingStake * 100 * creatorFeePercent / 100);\n  const platformFee = platformFeeCents / 100;\n  const creatorFee = creatorFeeCents / 100;\n  // Winners receive their stake back plus proportional share of (losing stakes - fees)\n  const payoutPool = Math.max(0, selectedStake + Math.max(0, (totalLosingStake * 100 - platformFeeCents - creatorFeeCents) / 100));\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[110] p-4\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.9 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.9 }}\n          className=\"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto\"\n        >\n          {!showConfirmation ? (\n            <>\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-100\">\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  Settle Prediction\n                </h2>\n                <button\n                  onClick={handleClose}\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n\n              {/* Content */}\n              <div className=\"p-6 space-y-6 pb-40\" style={{ paddingBottom: 'max(10rem, env(safe-area-inset-bottom))' }}>\n                {/* Prediction Info */}\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  <h3 className=\"font-medium text-gray-900 mb-2 line-clamp-2\">\n                    {prediction.title}\n                  </h3>\n                  <div className=\"flex items-center gap-4 text-sm text-gray-600\">\n                    <div className=\"flex items-center gap-1\">\n                      <DollarSign className=\"w-4 h-4\" />\n                      <span>${totalPool.toFixed(2)} pool</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <Users className=\"w-4 h-4\" />\n                      <span>{participantCount} participants</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Select Winning Option */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-3\">\n                    Select Winning Option *\n                  </label>\n                  <div className=\"space-y-2\">\n                    {options.length === 0 ? (\n                      <div className=\"p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                        <div className=\"flex items-center gap-2 mb-2\">\n                          <AlertTriangle className=\"w-5 h-5 text-yellow-600\" />\n                          <p className=\"text-yellow-800 font-medium\">No Options Available</p>\n                        </div>\n                        <p className=\"text-yellow-700 text-sm mb-3\">\n                          This prediction doesn't have any options to select from. This might be because:\n                        </p>\n                        <ul className=\"text-yellow-700 text-sm space-y-1 ml-4\">\n                          <li>â€¢ The prediction data is still loading</li>\n                          <li>â€¢ The prediction was created without options</li>\n                          <li>â€¢ There was an error fetching the prediction details</li>\n                        </ul>\n                        <p className=\"text-yellow-600 text-xs mt-3\">\n                          Please close this modal and try opening it again. If the problem persists, contact support.\n                        </p>\n                      </div>\n                    ) : (\n                      options.map((option) => {\n                      const isSelected = selectedOptionId === option.id;\n                      const optionStaked = getOptionTotalStaked(option);\n                      \n                      const percentage = totalPool > 0 ? (optionStaked / totalPool) * 100 : 0;\n                      const optionOdds = option.current_odds || (totalPool > 0 && optionStaked > 0 ? totalPool / optionStaked : 2.00);\n\n                      return (\n                        <motion.button\n                          key={option.id}\n                          onClick={() => setSelectedOptionId(option.id)}\n                          className={`w-full p-4 rounded-lg border-2 transition-all text-left ${\n                            isSelected\n                              ? 'border-emerald-500 bg-emerald-50'\n                              : 'border-gray-200 hover:border-gray-300'\n                          }`}\n                          whileHover={{ scale: 1.01 }}\n                          whileTap={{ scale: 0.99 }}\n                        >\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"flex-1\">\n                              <div className={`font-medium ${\n                                isSelected ? 'text-emerald-700' : 'text-gray-900'\n                              }`}>\n                                {option.label}\n                              </div>\n                              <div className=\"text-sm text-gray-500\">\n                                {percentage.toFixed(1)}% â€¢ ${optionStaked.toFixed(2)} staked â€¢ {optionOdds.toFixed(2)}x odds\n                              </div>\n                            </div>\n                            {isSelected && (\n                              <Check className=\"w-5 h-5 text-emerald-500\" />\n                            )}\n                          </div>\n                        </motion.button>\n                      );\n                    }))}\n                  </div>\n                </div>\n\n                {/* Proof URL */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Proof URL (optional)\n                  </label>\n                  <Input\n                    type=\"url\"\n                    placeholder=\"https://example.com/proof\"\n                    value={proofUrl}\n                    onChange={(e) => setProofUrl(e.target.value)}\n                    className=\"w-full\"\n                  />\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    Link to evidence supporting this outcome (news article, official result, etc.)\n                  </p>\n                </div>\n\n                {/* Reason */}\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    Settlement Reason *\n                  </label>\n                  <Textarea\n                    placeholder=\"Explain why this option is the winner...\"\n                    value={reason}\n                    onChange={(e) => setReason(e.target.value)}\n                    className=\"w-full h-20 resize-none\"\n                    maxLength={500}\n                  />\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    {reason.length}/500 characters\n                  </p>\n                </div>\n\n                {/* Error Display */}\n                {(settlementError || merkleError) && (\n                  <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <AlertTriangle className=\"w-4 h-4 text-red-500 flex-shrink-0\" />\n                      <p className=\"text-red-700 text-sm\">{settlementError || merkleError}</p>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Footer - sticky above bottom nav */}\n              <div className=\"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3\" style={{ bottom: 'max(4rem, env(safe-area-inset-bottom))' }}>\n                <Button\n                  variant=\"outline\"\n                  onClick={handleClose}\n                  disabled={isSettling}\n                >\n                  Cancel\n                </Button>\n                <Button\n                  onClick={() => setShowConfirmation(true)}\n                  disabled={!selectedOptionId || !reason.trim() || isSettling}\n                  className=\"bg-emerald-600 hover:bg-emerald-700\"\n                >\n                  Continue\n                </Button>\n              </div>\n            </>\n          ) : (\n            <>\n              {/* Confirmation Screen */}\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-100\">\n                <h2 className=\"text-xl font-semibold text-gray-900\">\n                  Confirm Settlement\n                </h2>\n                <button\n                  onClick={() => setShowConfirmation(false)}\n                  className=\"text-gray-400 hover:text-gray-600 transition-colors\"\n                  disabled={isSettling}\n                >\n                  <X className=\"w-5 h-5\" />\n                </button>\n              </div>\n\n              <div className=\"p-6 space-y-6\">\n                {/* Settlement Summary */}\n                <div className=\"bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg p-4 border border-emerald-100\">\n                  <div className=\"flex items-center gap-2 mb-3\">\n                    <Trophy className=\"w-5 h-5 text-emerald-600\" />\n                    <h3 className=\"font-medium text-gray-900\">Settlement Summary</h3>\n                  </div>\n                  \n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Winning Option:</span>\n                      <span className=\"font-medium text-gray-900\">{selectedOption?.label}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Total Pool:</span>\n                      <span className=\"font-medium text-gray-900\">${totalPool.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Platform Fee ({platformFeePercent}%):</span>\n                      <span className=\"text-gray-900\">${platformFee.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Creator Fee ({creatorFeePercent}%):</span>\n                      <span className=\"text-gray-900\">${creatorFee.toFixed(2)}</span>\n                    </div>\n                    <hr className=\"border-gray-200\" />\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Winner Payout:</span>\n                      <span className=\"font-semibold text-emerald-600\">${payoutPool.toFixed(2)}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Participants:</span>\n                      <span className=\"text-gray-900\">{participantCount}</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Warning */}\n                <div className=\"bg-amber-50 border border-amber-200 rounded-lg p-4\">\n                  <div className=\"flex items-start gap-2\">\n                    <AlertTriangle className=\"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5\" />\n                    <div className=\"text-amber-800 text-sm\">\n                      <p><strong>Warning:</strong> This action cannot be undone.</p>\n                      <p className=\"mt-1\">All participants will be notified of the settlement result.</p>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Error Display */}\n                {settlementError && (\n                  <div className=\"bg-red-50 border border-red-200 rounded-lg p-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <AlertTriangle className=\"w-4 h-4 text-red-500 flex-shrink-0\" />\n                      <p className=\"text-red-700 text-sm\">{settlementError}</p>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Footer - sticky above bottom nav */}\n              <div className=\"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3\" style={{ bottom: 'max(4rem, env(safe-area-inset-bottom))' }}>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setShowConfirmation(false)}\n                  disabled={isSettling || isPostingRoot}\n                >\n                  Back\n                </Button>\n                <Button\n                  onClick={handleSubmit}\n                  disabled={isSettling || isPostingRoot}\n                  className=\"bg-emerald-600 hover:bg-emerald-700\"\n                >\n                  {isPostingRoot ? 'Submitting...' : isSettling ? 'Settling...' : 'Confirm Settlement'}\n                </Button>\n              </div>\n            </>\n          )}\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n};\n\nexport default SettlementModal;","import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, AlertTriangle, CheckCircle, Clock, MessageSquare, Gavel, Users } from 'lucide-react';\nimport { getApiUrl } from '../../config';\nimport { useAuthStore } from '../../store/authStore';\nimport { toast } from 'react-hot-toast';\n\ninterface DisputeResolutionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  predictionId: string;\n  predictionTitle: string;\n  onResolutionComplete?: () => void;\n}\n\ninterface Dispute {\n  id: string;\n  user_id: string;\n  user: {\n    username: string;\n    full_name: string;\n  };\n  reason: string;\n  created_at: string;\n  status: 'pending' | 'resolved' | 'rejected';\n}\n\ninterface DisputeData {\n  disputes: Dispute[];\n  totalDisputes: number;\n  pendingDisputes: number;\n}\n\nconst DisputeResolutionModal: React.FC<DisputeResolutionModalProps> = ({\n  isOpen,\n  onClose,\n  predictionId,\n  predictionTitle,\n  onResolutionComplete\n}) => {\n  const [disputeData, setDisputeData] = useState<DisputeData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [resolving, setResolving] = useState(false);\n  const [selectedAction, setSelectedAction] = useState<'accept' | 'reject' | 'revise' | null>(null);\n  const [resolutionReason, setResolutionReason] = useState('');\n  const [newWinningOption, setNewWinningOption] = useState('');\n  const { user } = useAuthStore();\n\n  useEffect(() => {\n    if (isOpen) {\n      fetchDisputes();\n    }\n  }, [isOpen, predictionId]);\n\n  const fetchDisputes = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`${getApiUrl()}/api/v2/settlement/${predictionId}/disputes`);\n      \n      if (!response.ok) {\n        throw new Error('Failed to fetch disputes');\n      }\n      \n      const data = await response.json();\n      setDisputeData(data.data);\n    } catch (error) {\n      console.error('Error fetching disputes:', error);\n      toast.error('Failed to load disputes');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleResolution = async () => {\n    if (!selectedAction || !resolutionReason.trim()) {\n      toast.error('Please select an action and provide a reason');\n      return;\n    }\n\n    try {\n      setResolving(true);\n      \n      const response = await fetch(`${getApiUrl()}/api/v2/settlement/${predictionId}/resolve-disputes`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          action: selectedAction,\n          reason: resolutionReason,\n          newWinningOption: selectedAction === 'revise' ? newWinningOption : undefined,\n          creatorId: user?.id\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Failed to resolve disputes');\n      }\n\n      toast.success('Disputes resolved successfully!');\n      onClose();\n      if (onResolutionComplete) {\n        onResolutionComplete();\n      }\n    } catch (error) {\n      console.error('Error resolving disputes:', error);\n      toast.error('Failed to resolve disputes');\n    } finally {\n      setResolving(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4\">\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95 }}\n          animate={{ opacity: 1, scale: 1 }}\n          exit={{ opacity: 0, scale: 0.95 }}\n          className=\"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden\"\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center\">\n                <AlertTriangle className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-bold text-gray-900\">Dispute Resolution</h2>\n                <p className=\"text-sm text-gray-600\">{predictionTitle}</p>\n              </div>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n            >\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6 max-h-[70vh] overflow-y-auto\">\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <div className=\"w-8 h-8 border-2 border-red-500 border-t-transparent rounded-full animate-spin\" />\n              </div>\n            ) : disputeData ? (\n              <div className=\"space-y-6\">\n                {/* Dispute Summary */}\n                <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <Users className=\"w-5 h-5 text-red-600\" />\n                    <h3 className=\"font-semibold text-red-900\">Dispute Summary</h3>\n                  </div>\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <span className=\"text-red-700\">Total Disputes:</span>\n                      <span className=\"font-medium ml-2\">{disputeData.totalDisputes}</span>\n                    </div>\n                    <div>\n                      <span className=\"text-red-700\">Pending:</span>\n                      <span className=\"font-medium ml-2\">{disputeData.pendingDisputes}</span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Individual Disputes */}\n                <div className=\"space-y-4\">\n                  <h3 className=\"font-semibold text-gray-900\">Individual Disputes</h3>\n                  {disputeData.disputes.map((dispute) => (\n                    <div key={dispute.id} className=\"border border-gray-200 rounded-lg p-4\">\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div>\n                          <p className=\"font-medium text-gray-900\">\n                            {dispute.user.full_name || dispute.user.username}\n                          </p>\n                          <p className=\"text-sm text-gray-500\">\n                            {new Date(dispute.created_at).toLocaleDateString()}\n                          </p>\n                        </div>\n                        <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                          dispute.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :\n                          dispute.status === 'resolved' ? 'bg-emerald-100 text-emerald-800' :\n                          'bg-red-100 text-red-800'\n                        }`}>\n                          {dispute.status}\n                        </span>\n                      </div>\n                      <div className=\"bg-gray-50 rounded p-3\">\n                        <div className=\"flex items-start gap-2\">\n                          <MessageSquare className=\"w-4 h-4 text-gray-500 mt-0.5\" />\n                          <p className=\"text-sm text-gray-700\">{dispute.reason}</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n\n                {/* Resolution Actions */}\n                {disputeData.pendingDisputes > 0 && (\n                  <div className=\"space-y-4\">\n                    <h3 className=\"font-semibold text-gray-900\">Resolution Actions</h3>\n                    \n                    {/* Action Selection */}\n                    <div className=\"grid grid-cols-1 gap-3\">\n                      <button\n                        onClick={() => setSelectedAction('reject')}\n                        className={`p-4 border-2 rounded-lg text-left transition-all ${\n                          selectedAction === 'reject'\n                            ? 'border-red-500 bg-red-50'\n                            : 'border-gray-200 hover:border-red-300'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <X className=\"w-5 h-5 text-red-600\" />\n                          <div>\n                            <p className=\"font-medium text-gray-900\">Reject Disputes</p>\n                            <p className=\"text-sm text-gray-600\">Maintain original settlement</p>\n                          </div>\n                        </div>\n                      </button>\n\n                      <button\n                        onClick={() => setSelectedAction('revise')}\n                        className={`p-4 border-2 rounded-lg text-left transition-all ${\n                          selectedAction === 'revise'\n                            ? 'border-blue-500 bg-blue-50'\n                            : 'border-gray-200 hover:border-blue-300'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <Gavel className=\"w-5 h-5 text-blue-600\" />\n                          <div>\n                            <p className=\"font-medium text-gray-900\">Revise Settlement</p>\n                            <p className=\"text-sm text-gray-600\">Change the winning option</p>\n                          </div>\n                        </div>\n                      </button>\n\n                      <button\n                        onClick={() => setSelectedAction('accept')}\n                        className={`p-4 border-2 rounded-lg text-left transition-all ${\n                          selectedAction === 'accept'\n                            ? 'border-emerald-500 bg-emerald-50'\n                            : 'border-gray-200 hover:border-emerald-300'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <CheckCircle className=\"w-5 h-5 text-emerald-600\" />\n                          <div>\n                            <p className=\"font-medium text-gray-900\">Accept Disputes & Refund</p>\n                            <p className=\"text-sm text-gray-600\">Refund all participants</p>\n                          </div>\n                        </div>\n                      </button>\n                    </div>\n\n                    {/* New Winning Option (if revising) */}\n                    {selectedAction === 'revise' && (\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          New Winning Option ID\n                        </label>\n                        <input\n                          type=\"text\"\n                          value={newWinningOption}\n                          onChange={(e) => setNewWinningOption(e.target.value)}\n                          placeholder=\"Enter the correct winning option ID\"\n                          className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        />\n                      </div>\n                    )}\n\n                    {/* Resolution Reason */}\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Resolution Reason\n                      </label>\n                      <textarea\n                        value={resolutionReason}\n                        onChange={(e) => setResolutionReason(e.target.value)}\n                        placeholder=\"Explain your resolution decision...\"\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                        rows={3}\n                      />\n                    </div>\n\n                    {/* Action Buttons */}\n                    <div className=\"flex gap-3 pt-4\">\n                      <button\n                        onClick={onClose}\n                        className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\"\n                      >\n                        Cancel\n                      </button>\n                      <button\n                        onClick={handleResolution}\n                        disabled={resolving || !selectedAction || !resolutionReason.trim()}\n                        className=\"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                      >\n                        {resolving ? 'Resolving...' : 'Resolve Disputes'}\n                      </button>\n                    </div>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <p className=\"text-gray-500\">No dispute data available</p>\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n};\n\nexport default DisputeResolutionModal;\n","import React, { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Edit3, Loader2, AlertCircle } from 'lucide-react';\nimport { toast } from 'react-hot-toast';\n\ninterface EditModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  prediction: {\n    id: string | number;\n    title: string;\n    description?: string;\n  };\n  onUpdate: (updates: { title?: string; description?: string }) => Promise<void>;\n}\n\nconst EditModal: React.FC<EditModalProps> = ({\n  isOpen,\n  onClose,\n  prediction,\n  onUpdate\n}) => {\n  const [title, setTitle] = useState(prediction.title || '');\n  const [description, setDescription] = useState(prediction.description || '');\n  const [isUpdating, setIsUpdating] = useState(false);\n  const [errors, setErrors] = useState<{ title?: string; description?: string }>({});\n  \n  const titleRef = useRef<HTMLInputElement>(null);\n  const descriptionRef = useRef<HTMLTextAreaElement>(null);\n\n  // Reset form when modal opens/closes or prediction changes\n  useEffect(() => {\n    if (isOpen) {\n      setTitle(prediction.title || '');\n      setDescription(prediction.description || '');\n      setErrors({});\n      // Focus title input after modal animation\n      setTimeout(() => titleRef.current?.focus(), 150);\n    }\n  }, [isOpen, prediction.title, prediction.description]);\n\n  // Auto-resize description textarea\n  useEffect(() => {\n    const textarea = descriptionRef.current;\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';\n    }\n  }, [description]);\n\n  const validateForm = () => {\n    const newErrors: { title?: string; description?: string } = {};\n\n    if (!title.trim()) {\n      newErrors.title = 'Title is required';\n    } else if (title.trim().length < 3) {\n      newErrors.title = 'Title must be at least 3 characters';\n    } else if (title.trim().length > 200) {\n      newErrors.title = 'Title must be less than 200 characters';\n    }\n\n    if (description.trim().length > 1000) {\n      newErrors.description = 'Description must be less than 1000 characters';\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleSave = async () => {\n    if (!validateForm()) {\n      return;\n    }\n\n    const trimmedTitle = title.trim();\n    const trimmedDescription = description.trim();\n\n    // Check if anything actually changed\n    if (trimmedTitle === prediction.title && trimmedDescription === (prediction.description || '')) {\n      toast.error('No changes detected');\n      return;\n    }\n\n    setIsUpdating(true);\n    \n    try {\n      const updates: { title?: string; description?: string } = {};\n      \n      if (trimmedTitle !== prediction.title) {\n        updates.title = trimmedTitle;\n      }\n      \n      if (trimmedDescription !== (prediction.description || '')) {\n        updates.description = trimmedDescription;\n      }\n\n      await onUpdate(updates);\n      toast.success('Prediction updated successfully!');\n      onClose();\n    } catch (error) {\n      console.error('Failed to update prediction:', error);\n      toast.error(error instanceof Error ? error.message : 'Failed to update prediction');\n    } finally {\n      setIsUpdating(false);\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Escape' && !isUpdating) {\n      onClose();\n    } else if (e.key === 'Enter' && (e.metaKey || e.ctrlKey) && !isUpdating) {\n      handleSave();\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      <div className=\"fixed inset-0 z-[120] flex items-center justify-center p-4\">\n        {/* Backdrop */}\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          exit={{ opacity: 0 }}\n          className=\"absolute inset-0 bg-black/60 backdrop-blur-sm\"\n          onClick={!isUpdating ? onClose : undefined}\n        />\n\n        {/* Modal */}\n        <motion.div\n          initial={{ opacity: 0, scale: 0.95, y: 20 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.95, y: 20 }}\n          transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n          className=\"relative bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden\"\n          onKeyDown={handleKeyDown}\n        >\n          {/* Header */}\n          <div className=\"flex items-center justify-between p-6 border-b border-gray-100\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center\">\n                <Edit3 className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">Edit Prediction</h2>\n                <p className=\"text-sm text-gray-500\">Update your prediction details</p>\n              </div>\n            </div>\n            \n            <button\n              onClick={onClose}\n              disabled={isUpdating}\n              className=\"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50\"\n            >\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </button>\n          </div>\n\n          {/* Content */}\n          <div className=\"p-6 space-y-6\">\n            {/* Title Field */}\n            <div className=\"space-y-2\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Prediction Title *\n              </label>\n              <input\n                ref={titleRef}\n                type=\"text\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                className={`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${\n                  errors.title\n                    ? 'border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200'\n                    : 'border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200'\n                }`}\n                placeholder=\"Enter prediction title...\"\n                disabled={isUpdating}\n                maxLength={200}\n              />\n              {errors.title && (\n                <div className=\"flex items-center gap-2 text-red-600 text-sm\">\n                  <AlertCircle className=\"w-4 h-4\" />\n                  {errors.title}\n                </div>\n              )}\n              <p className=\"text-xs text-gray-500\">{title.length}/200 characters</p>\n            </div>\n\n            {/* Description Field */}\n            <div className=\"space-y-2\">\n              <label className=\"block text-sm font-medium text-gray-700\">\n                Description (Optional)\n              </label>\n              <textarea\n                ref={descriptionRef}\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                className={`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${\n                  errors.description\n                    ? 'border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200'\n                    : 'border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200'\n                }`}\n                placeholder=\"Add more details about your prediction...\"\n                disabled={isUpdating}\n                rows={3}\n                maxLength={1000}\n                style={{ minHeight: '80px', maxHeight: '120px' }}\n              />\n              {errors.description && (\n                <div className=\"flex items-center gap-2 text-red-600 text-sm\">\n                  <AlertCircle className=\"w-4 h-4\" />\n                  {errors.description}\n                </div>\n              )}\n              <p className=\"text-xs text-gray-500\">{description.length}/1000 characters</p>\n            </div>\n          </div>\n\n          {/* Footer */}\n          <div className=\"flex items-center justify-end gap-3 p-6 bg-gray-50 border-t border-gray-100\">\n            <button\n              onClick={onClose}\n              disabled={isUpdating}\n              className=\"px-6 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n            >\n              Cancel\n            </button>\n            \n            <motion.button\n              onClick={handleSave}\n              disabled={isUpdating || !title.trim() || !!errors.title || !!errors.description}\n              className=\"px-6 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200\"\n              whileHover={{ scale: isUpdating ? 1 : 1.02 }}\n              whileTap={{ scale: isUpdating ? 1 : 0.98 }}\n            >\n              {isUpdating ? (\n                <div className=\"flex items-center gap-2\">\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  Updating...\n                </div>\n              ) : (\n                'Update Prediction'\n              )}\n            </motion.button>\n          </div>\n\n          {/* Keyboard shortcuts hint */}\n          <div className=\"px-6 pb-4\">\n            <p className=\"text-xs text-gray-400 text-center\">\n              Press <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded text-xs\">Esc</kbd> to cancel or{' '}\n              <kbd className=\"px-1.5 py-0.5 bg-gray-100 rounded text-xs\">âŒ˜ Enter</kbd> to save\n            </p>\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n};\n\nexport default EditModal;\n","import React, { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, Users, Clock, DollarSign, BarChart3, Settings, Trash2, Eye, Share2, Edit3, CheckCircle, Loader2, Gavel, AlertTriangle } from 'lucide-react';\nimport { usePredictionStore, ActivityItem, Participant } from '../../store/predictionStore';\nimport { useToast } from '../../hooks/use-toast';\nimport { useAuthStore } from '../../store/authStore';\nimport { ConfirmationModal } from './ConfirmationModal';\nimport { toast } from 'react-hot-toast';\nimport { getApiUrl } from '../../config';\nimport SettlementModal from './SettlementModal';\nimport DisputeResolutionModal from './DisputeResolutionModal';\nimport EditModal from './EditModal';\nimport { formatTimeRemaining } from '@/lib/utils';\n\ninterface ManagePredictionModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  prediction: {\n    id: number | string;\n    title: string;\n    category: string;\n    totalPool: number;\n    participants: number;\n    timeRemaining: string;\n    yourCut: number;\n    status: string;\n    description?: string;\n    pool_total?: number;\n    participant_count?: number;\n    creator_fee_percentage?: number;\n    entry_deadline?: string;\n    options?: any[];\n  };\n}\n\nconst ManagePredictionModal: React.FC<ManagePredictionModalProps> = ({\n  isOpen,\n  onClose,\n  prediction\n}) => {\n  const [activeTab, setActiveTab] = useState('overview');\n  const [emailNotifications, setEmailNotifications] = useState(true);\n  const [publicVisibility, setPublicVisibility] = useState(true);\n  const [autoClose, setAutoClose] = useState(true);\n  const [activityData, setActivityData] = useState<ActivityItem[]>([]);\n  const [participantData, setParticipantData] = useState<Participant[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [savingSettings, setSavingSettings] = useState(false);\n  const [showDeleteConfirmation, setShowDeleteConfirmation] = useState(false);\n  const [confirmLoading, setConfirmLoading] = useState(false);\n  const [updating, setUpdating] = useState(false);\n  const [showSettlementModal, setShowSettlementModal] = useState(false);\n  const [showEditModal, setShowEditModal] = useState(false);\n  const [showCloseModal, setShowCloseModal] = useState(false);\n  const [showDisputeResolution, setShowDisputeResolution] = useState(false);\n  const [editTitle, setEditTitle] = useState('');\n  const [predictionData, setPredictionData] = useState(prediction);\n\n  // Update predictionData when prediction prop changes\n  useEffect(() => {\n    setPredictionData(prediction);\n  }, [prediction]);\n\n  const { \n    updatePrediction, \n    deletePrediction, \n    closePrediction, \n    fetchPredictionActivity, \n    fetchPredictionParticipants,\n    fetchPredictionById,\n    refreshPredictions,\n    fetchUserCreatedPredictions,\n    fetchUserPredictionEntries\n  } = usePredictionStore();\n  \n  const { user } = useAuthStore();\n\n  // Helper function to determine if prediction can be settled\n  const canSettle = (pred: any) => {\n    // Can settle if prediction is closed, ended, or if it's past the deadline\n    if (pred.status === 'closed' || pred.status === 'ended') return true;\n    \n    // Check if deadline has passed for open predictions\n    const deadline = pred.entry_deadline;\n    if (deadline) {\n      const isPastDeadline = new Date(deadline).getTime() <= Date.now();\n      if (isPastDeadline) return true;\n    }\n    if (typeof pred.timeRemaining === 'string' && pred.timeRemaining.toLowerCase().includes('ended')) return true;\n    \n    return false;\n  };\n\n  const tabs = [\n    { id: 'overview', label: 'Overview', icon: BarChart3 },\n    { id: 'settings', label: 'Settings', icon: Settings },\n    { id: 'participants', label: 'Participants', icon: Users }\n  ];\n\n  // Load real data when modal opens\n  useEffect(() => {\n    if (isOpen && prediction.id) {\n      loadPredictionData();\n    }\n  }, [isOpen, prediction.id]);\n\n  const loadPredictionData = useCallback(async () => {\n    setLoading(true);\n    try {\n      console.log('ðŸ”„ Loading prediction data for modal:', prediction.id);\n      \n      // Ensure we have the full prediction data with options\n      const fullPrediction = await fetchPredictionById(String(prediction.id));\n      \n      if (fullPrediction?.options?.length) {\n        console.log('ðŸ”„ ManagePredictionModal: Updated prediction with', fullPrediction.options.length, 'options');\n        // Force update the prediction object with all data from API\n        Object.assign(prediction, fullPrediction);\n        // Update state to force re-render of all components (map to expected type)\n        setPredictionData({\n          id: fullPrediction.id,\n          title: fullPrediction.title,\n          category: fullPrediction.category,\n          totalPool: fullPrediction.pool_total || fullPrediction.poolTotal || 0,\n          participants: fullPrediction.participant_count || fullPrediction.participantCount || 0,\n          timeRemaining: formatTimeRemaining(fullPrediction.entry_deadline || fullPrediction.entryDeadline || ''),\n          yourCut: fullPrediction.creator_fee_percentage || 3.5,\n          status: fullPrediction.status || 'open',\n          description: fullPrediction.description,\n          pool_total: fullPrediction.pool_total || fullPrediction.poolTotal,\n          participant_count: fullPrediction.participant_count || fullPrediction.participantCount,\n          creator_fee_percentage: fullPrediction.creator_fee_percentage,\n          entry_deadline: fullPrediction.entry_deadline || fullPrediction.entryDeadline,\n          options: fullPrediction.options\n        });\n      } else {\n        console.warn('âš ï¸ ManagePredictionModal: No options found for prediction:', prediction.id);\n        // Try to fetch again with a delay\n        setTimeout(async () => {\n          const retryPrediction = await fetchPredictionById(String(prediction.id));\n          if (retryPrediction?.options?.length) {\n            console.log('ðŸ”„ Retry successful: Found', retryPrediction.options.length, 'options');\n            Object.assign(prediction, retryPrediction);\n            setPredictionData({\n              id: retryPrediction.id,\n              title: retryPrediction.title,\n              category: retryPrediction.category,\n              totalPool: retryPrediction.pool_total || retryPrediction.poolTotal || 0,\n              participants: retryPrediction.participant_count || retryPrediction.participantCount || 0,\n              timeRemaining: formatTimeRemaining(retryPrediction.entry_deadline || retryPrediction.entryDeadline || ''),\n              yourCut: retryPrediction.creator_fee_percentage || 3.5,\n              status: retryPrediction.status || 'open',\n              description: retryPrediction.description,\n              pool_total: retryPrediction.pool_total || retryPrediction.poolTotal,\n              participant_count: retryPrediction.participant_count || retryPrediction.participantCount,\n              creator_fee_percentage: retryPrediction.creator_fee_percentage,\n              entry_deadline: retryPrediction.entry_deadline || retryPrediction.entryDeadline,\n              options: retryPrediction.options\n            });\n          }\n        }, 1000);\n      }\n      \n      const [activity, participants] = await Promise.all([\n        fetchPredictionActivity(String(prediction.id)).catch(err => {\n          console.warn('Failed to fetch activity:', err);\n          return [];\n        }),\n        fetchPredictionParticipants(String(prediction.id)).catch(err => {\n          console.warn('Failed to fetch participants:', err);\n          return [];\n        })\n      ]);\n      \n      setActivityData(activity);\n      setParticipantData(participants);\n      console.log('âœ… Modal data loaded successfully');\n    } catch (error) {\n      console.error('Failed to load prediction data:', error);\n      toast.error('Failed to load prediction data. Using cached information.');\n    } finally {\n      setLoading(false);\n    }\n  }, [prediction.id, fetchPredictionActivity, fetchPredictionParticipants, fetchPredictionById]);\n\n  // Comprehensive data refresh after any operation\n  const refreshAllData = useCallback(async () => {\n    if (!user?.id) return;\n\n    try {\n      console.log('ðŸ”„ Refreshing all prediction data...');\n      \n      await Promise.all([\n        refreshPredictions(true), // Force refresh main predictions\n        fetchUserCreatedPredictions(user.id), // Refresh user's created predictions\n        fetchUserPredictionEntries(user.id), // Refresh user's prediction entries\n        loadPredictionData() // Refresh modal-specific data\n      ]);\n      \n      console.log('âœ… All prediction data refreshed');\n    } catch (error) {\n      console.error('âŒ Error refreshing prediction data:', error);\n    }\n  }, [user?.id, refreshPredictions, fetchUserCreatedPredictions, fetchUserPredictionEntries, loadPredictionData]);\n\n  const handleClose = useCallback(async () => {\n    console.log('âŒ Closing modal and triggering data refresh');\n    \n    // Trigger a comprehensive refresh before closing\n    await refreshAllData();\n    \n    // Small delay to ensure state updates are processed\n    setTimeout(() => {\n    onClose();\n    }, 100);\n  }, [onClose, refreshAllData]);\n\n  const handleEditPrediction = () => {\n    setEditTitle(prediction.title);\n    setShowEditModal(true);\n  };\n\n  const handleEditUpdate = async (updates: { title?: string; description?: string }) => {\n    try {\n      setUpdating(true);\n      console.log('ðŸ”§ Updating prediction:', prediction.id, updates);\n      \n      await updatePrediction(String(prediction.id), updates);\n      \n      // Refresh all data after successful update\n      await refreshAllData();\n      \n    } catch (error) {\n      console.error('Failed to update prediction:', error);\n      throw error; // Re-throw so EditModal can handle the error display\n    } finally {\n      setUpdating(false);\n    }\n  };\n\n  const handleDeletePrediction = async () => {\n    setShowDeleteConfirmation(true);\n  };\n\n  const handleClosePrediction = () => {\n    console.log('ðŸ”’ Close Early clicked:', {\n      predictionId: prediction.id,\n      status: prediction.status,\n      updating,\n      loading,\n      canClose: prediction.status === 'open' && !updating && !loading\n    });\n    \n    if (prediction.status !== 'open') {\n      toast.error('Can only close predictions that are currently open');\n      return;\n    }\n    \n    setShowCloseModal(true);\n  };\n\n  const confirmClosePrediction = async () => {\n    try {\n      setUpdating(true);\n      console.log('ðŸ”’ Closing prediction:', prediction.id);\n      \n      await closePrediction(String(prediction.id));\n      \n      // Refresh all data after successful close\n      await refreshAllData();\n      \n      // Update the prediction object to reflect the new status\n      Object.assign(prediction, { status: 'closed' });\n      \n      toast.success('Prediction closed successfully! You can now settle it.');\n      setShowCloseModal(false);\n      setShowSettlementModal(true);\n      // Don't close the modal - let user access settlement\n    } catch (error) {\n      console.error('Failed to close prediction:', error);\n      toast.error(error instanceof Error ? error.message : 'Failed to close prediction');\n    } finally {\n      setUpdating(false);\n    }\n  };\n\n  const handleSharePrediction = async () => {\n    try {\n      const predictionUrl = `${window.location.origin}/predictions/${prediction.id}`;\n      const shareText = `Check out this prediction: ${prediction.title}`;\n      \n      // Try native sharing first (mobile devices)\n      if (navigator.share) {\n        try {\n          await navigator.share({\n            title: prediction.title,\n            text: shareText,\n            url: predictionUrl,\n          });\n          return;\n        } catch (shareError) {\n          // User cancelled or sharing failed, fall back to clipboard\n          console.log('Native sharing cancelled or failed:', shareError);\n        }\n      }\n      \n      // Fallback to clipboard\n      if (navigator.clipboard && navigator.clipboard.writeText) {\n        await navigator.clipboard.writeText(`${shareText}\\n${predictionUrl}`);\n        toast.success('Link copied to clipboard!');\n      } else {\n        // Fallback for older browsers\n        const textArea = document.createElement('textarea');\n        textArea.value = `${shareText}\\n${predictionUrl}`;\n        document.body.appendChild(textArea);\n        textArea.select();\n        try {\n          document.execCommand('copy');\n          toast.success('Link copied to clipboard!');\n        } catch (execError) {\n          toast.error('Failed to copy link. Please copy manually.');\n          console.error('execCommand failed:', execError);\n        } finally {\n          document.body.removeChild(textArea);\n        }\n      }\n    } catch (error) {\n      console.error('Error sharing prediction:', error);\n      toast.error('Failed to share prediction');\n    }\n  };\n\n  const handleSaveSettings = async () => {\n    try {\n      setSavingSettings(true);\n      console.log('âš™ï¸ Saving prediction settings:', prediction.id);\n      \n      // Update prediction settings via API\n      await updatePrediction(String(prediction.id), {\n        is_private: !publicVisibility,\n        // Add other settings as needed\n      });\n      \n      // Refresh data after successful settings update\n      await refreshAllData();\n      \n      toast.success('Settings saved successfully!');\n    } catch (error) {\n      console.error('Failed to save settings:', error);\n      toast.error('Failed to save settings. Please try again.');\n    } finally {\n      setSavingSettings(false);\n    }\n  };\n\n  const confirmDeletePrediction = async () => {\n    try {\n      setConfirmLoading(true);\n      console.log('ðŸ—‘ï¸ Deleting prediction:', prediction.id);\n      \n      await deletePrediction(String(prediction.id));\n      \n      // Refresh all data after successful deletion\n      await refreshAllData();\n      \n      toast.success('Prediction deleted successfully!');\n      setShowDeleteConfirmation(false);\n      handleClose();\n    } catch (error) {\n      console.error('Failed to delete prediction:', error);\n      toast.error(error instanceof Error ? error.message : 'Failed to delete prediction');\n    } finally {\n      setConfirmLoading(false);\n    }\n  };\n\n  const OverviewTab = () => {\n    const totalPool = prediction.pool_total || prediction.totalPool || 0;\n    const participantCount = prediction.participant_count || prediction.participants || 0;\n    const creatorFee = prediction.creator_fee_percentage || prediction.yourCut || 0;\n    const estimatedEarnings = (totalPool * creatorFee) / 100;\n\n    return (\n      <div className=\"space-y-6\">\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"bg-gray-50 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <DollarSign className=\"w-4 h-4 text-emerald-600\" />\n              <span className=\"text-sm font-medium text-gray-700\">Total Pool</span>\n            </div>\n            <p className=\"text-2xl font-bold text-gray-900\">${totalPool.toLocaleString()}</p>\n          </div>\n          \n          <div className=\"bg-gray-50 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <Users className=\"w-4 h-4 text-blue-600\" />\n              <span className=\"text-sm font-medium text-gray-700\">Participants</span>\n            </div>\n            <p className=\"text-2xl font-bold text-gray-900\">{participantCount}</p>\n          </div>\n          \n          <div className=\"bg-gray-50 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <BarChart3 className=\"w-4 h-4 text-purple-600\" />\n              <span className=\"text-sm font-medium text-gray-700\">Your Cut</span>\n            </div>\n            <p className=\"text-2xl font-bold text-gray-900\">{creatorFee}%</p>\n          </div>\n          \n          <div className=\"bg-gray-50 rounded-lg p-4\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <DollarSign className=\"w-4 h-4 text-emerald-600\" />\n              <span className=\"text-sm font-medium text-gray-700\">Est. Earnings</span>\n            </div>\n            <p className=\"text-2xl font-bold text-emerald-600\">${estimatedEarnings.toLocaleString()}</p>\n          </div>\n        </div>\n\n        {/* Action Buttons - Redesigned with better spacing and UX */}\n        <div className=\"space-y-4\">\n          {/* Primary Actions Row */}\n          <div className=\"grid grid-cols-2 gap-4\">\n            <motion.button\n              onClick={handleEditPrediction}\n              disabled={updating || loading}\n              className=\"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed\"\n              whileHover={{ scale: updating || loading ? 1 : 1.02 }}\n              whileTap={{ scale: updating || loading ? 1 : 0.98 }}\n            >\n              {updating ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <Edit3 className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />}\n              <span>Edit Details</span>\n            </motion.button>\n\n            <motion.button\n              onClick={handleSharePrediction}\n              disabled={updating || loading}\n              className=\"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed\"\n              whileHover={{ scale: updating || loading ? 1 : 1.02 }}\n              whileTap={{ scale: updating || loading ? 1 : 0.98 }}\n            >\n              <Share2 className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n              <span>Share</span>\n            </motion.button>\n          </div>\n\n          {/* Secondary Actions Row */}\n          <div className=\"flex gap-4\">\n            <motion.button\n              onClick={handleClosePrediction}\n              disabled={updating || loading || prediction.status !== 'open'}\n              className={`flex-1 flex items-center justify-center gap-3 px-6 py-4 rounded-2xl font-semibold shadow-lg transition-all duration-200 group ${\n                prediction.status !== 'open' \n                  ? 'bg-gray-400 text-gray-600 cursor-not-allowed opacity-50' \n                  : 'bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-xl'\n              } disabled:opacity-50 disabled:cursor-not-allowed`}\n              whileHover={{ scale: (updating || loading || prediction.status !== 'open') ? 1 : 1.02 }}\n              whileTap={{ scale: (updating || loading || prediction.status !== 'open') ? 1 : 0.98 }}\n            >\n              {updating ? <Loader2 className=\"w-5 h-5 animate-spin\" /> : <Clock className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />}\n              <span>{prediction.status === 'open' ? 'Close Early' : 'Already Closed'}</span>\n            </motion.button>\n\n            {/* Settle Button - Show for closed predictions or ended predictions */}\n            <motion.button\n              onClick={() => setShowSettlementModal(true)}\n              disabled={updating || loading || !canSettle(prediction)}\n              className=\"flex-1 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group border-2 border-emerald-400/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300/30\"\n              whileHover={{ scale: (updating || loading || !canSettle(prediction)) ? 1 : 1.02 }}\n              whileTap={{ scale: (updating || loading || !canSettle(prediction)) ? 1 : 0.98 }}\n            >\n              <Gavel className=\"w-5 h-5 group-hover:scale-110 transition-transform\" />\n              <span>Settle</span>\n            </motion.button>\n          </div>\n        </div>\n\n        {/* Dispute Management - Show if prediction has disputes */}\n        {prediction.status === 'disputed' && (\n          <div className=\"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <div className=\"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center\">\n                <AlertTriangle className=\"w-5 h-5 text-white\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-bold text-red-900\">âš ï¸ Settlement Disputed</h3>\n                <p className=\"text-red-700\">Participants have disputed your settlement. Review and resolve.</p>\n              </div>\n            </div>\n            <motion.button\n              onClick={() => setShowDisputeResolution(true)}\n              className=\"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors\"\n              whileHover={{ scale: 1.02 }}\n              whileTap={{ scale: 0.98 }}\n            >\n              ðŸ” Manage Disputes\n            </motion.button>\n          </div>\n        )}\n\n        {/* Recent Activity */}\n        <div>\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-3\">Recent Activity</h3>\n            {loading ? (\n            <div className=\"flex items-center justify-center py-8\">\n              <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n              <span className=\"ml-2 text-gray-600\">Loading activity...</span>\n              </div>\n            ) : activityData.length > 0 ? (\n            <div className=\"space-y-3 max-h-64 overflow-y-auto\">\n              {activityData.map((activity, index) => (\n                <div key={`activity-${index}`} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                    <div>\n                      <p className=\"text-sm font-medium text-gray-900\">{activity.description}</p>\n                      <p className=\"text-xs text-gray-500\">{activity.timeAgo}</p>\n                  </div>\n                  {activity.amount && (\n                    <span className=\"text-sm font-semibold text-emerald-600\">\n                      ${activity.amount.toLocaleString()}\n                    </span>\n                  )}\n                </div>\n              ))}\n            </div>\n            ) : (\n            <div className=\"text-center py-8\">\n              <BarChart3 className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\n              <p className=\"text-gray-600\">No activity yet</p>\n              </div>\n            )}\n        </div>\n      </div>\n    );\n  };\n\n  const SettingsTab = () => (\n    <div className=\"space-y-6\">\n      <div>\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Prediction Settings</h3>\n        \n        <div className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h4 className=\"font-medium text-gray-900\">Public Visibility</h4>\n              <p className=\"text-sm text-gray-500\">Allow anyone to find and join this prediction</p>\n            </div>\n            <button\n              onClick={() => setPublicVisibility(!publicVisibility)}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                publicVisibility ? 'bg-purple-600' : 'bg-gray-300'\n              }`}\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                  publicVisibility ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n          </div>\n          \n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h4 className=\"font-medium text-gray-900\">Email Notifications</h4>\n              <p className=\"text-sm text-gray-500\">Receive updates about this prediction via email</p>\n            </div>\n            <button\n              onClick={() => setEmailNotifications(!emailNotifications)}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                emailNotifications ? 'bg-purple-600' : 'bg-gray-300'\n              }`}\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                  emailNotifications ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n          </div>\n          \n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h4 className=\"font-medium text-gray-900\">Auto Close</h4>\n              <p className=\"text-sm text-gray-500\">Automatically close when deadline is reached</p>\n            </div>\n            <button\n              onClick={() => setAutoClose(!autoClose)}\n              className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${\n                autoClose ? 'bg-purple-600' : 'bg-gray-300'\n              }`}\n            >\n              <span\n                className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${\n                  autoClose ? 'translate-x-6' : 'translate-x-1'\n                }`}\n              />\n            </button>\n            </div>\n          </div>\n        </div>\n\n      <div className=\"sticky bottom-0 left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end\">\n        <button\n          onClick={handleSaveSettings}\n          disabled={savingSettings}\n          className=\"inline-flex items-center justify-center gap-2 px-5 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50\"\n        >\n          {savingSettings ? <Loader2 className=\"w-4 h-4 animate-spin\" /> : <CheckCircle className=\"w-4 h-4\" />}\n          <span>Save Settings</span>\n        </button>\n      </div>\n\n      {/* Danger Zone */}\n      <div className=\"border-t border-gray-200 pt-6\">\n        <h3 className=\"text-lg font-semibold text-red-600 mb-4\">Danger Zone</h3>\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <h4 className=\"font-medium text-red-800 mb-2\">Delete Prediction</h4>\n          <p className=\"text-sm text-red-700 mb-4\">\n            This action cannot be undone. This will permanently delete the prediction and all associated data.\n          </p>\n          <button\n            onClick={handleDeletePrediction}\n            disabled={updating || loading}\n            className=\"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50\"\n          >\n            <Trash2 className=\"w-4 h-4\" />\n            Delete Prediction\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n\n  const ParticipantsTab = () => (\n    <div className=\"space-y-6\">\n      <div>\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">\n          Participants ({participantData.length})\n        </h3>\n        \n            {loading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n            <span className=\"ml-2 text-gray-600\">Loading participants...</span>\n              </div>\n            ) : participantData.length > 0 ? (\n          <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n            {participantData.map((participant, index) => (\n              <div key={`participant-${index}`} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                  <div className=\"flex items-center gap-3\">\n                  <div className=\"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center\">\n                    <span className=\"text-sm font-semibold text-purple-600\">\n                      {participant.username.charAt(0).toUpperCase()}\n                    </span>\n                  </div>\n                  <div>\n                    <p className=\"text-sm font-medium text-gray-900\">@{participant.username}</p>\n                    <p className=\"text-xs text-gray-500\">\n                      Chose: {participant.option} â€¢ {participant.timeAgo}\n                    </p>\n                  </div>\n                </div>\n                <span className=\"text-sm font-semibold text-gray-900\">\n                  ${participant.amount.toLocaleString()}\n                </span>\n              </div>\n            ))}\n          </div>\n        ) : (\n          <div className=\"text-center py-8\">\n            <Users className=\"w-8 h-8 text-gray-400 mx-auto mb-2\" />\n            <p className=\"text-gray-600\">No participants yet</p>\n          </div>\n        )}\n        </div>\n      </div>\n    );\n\n  if (!isOpen) return null;\n\n  return (\n    <>\n    <AnimatePresence>\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n          className=\"fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              handleClose();\n            }\n          }}\n        >\n          <motion.div\n            initial={{ scale: 0.95, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            exit={{ scale: 0.95, opacity: 0 }}\n            className=\"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden\"\n          >\n              {/* Header */}\n              <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n              <div>\n                <h2 className=\"text-xl font-semibold text-gray-900\">Manage Prediction</h2>\n                <p className=\"text-sm text-gray-600 mt-1 line-clamp-1\">{prediction.title}</p>\n                </div>\n              <button\n                    onClick={handleClose}\n                className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n                  >\n                <X className=\"w-5 h-5 text-gray-500\" />\n              </button>\n              </div>\n\n            {/* Tabs */}\n              <div className=\"flex border-b border-gray-200\">\n                {tabs.map((tab) => {\n                  const Icon = tab.icon;\n                  return (\n                    <button\n                      key={tab.id}\n                      onClick={() => setActiveTab(tab.id)}\n                    className={`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${\n                        activeTab === tab.id\n                        ? 'border-purple-500 text-purple-600'\n                        : 'border-transparent text-gray-500 hover:text-gray-700'\n                      }`}\n                    >\n                      <Icon className=\"w-4 h-4\" />\n                    {tab.label}\n                    </button>\n                  );\n                })}\n              </div>\n\n              {/* Tab Content */}\n            <div className=\"p-6 pb-40 max-h-[calc(90vh-200px)] overflow-y-auto\" style={{ paddingBottom: 'max(10rem, env(safe-area-inset-bottom))' }}>\n                {activeTab === 'overview' && <OverviewTab />}\n                {activeTab === 'settings' && <SettingsTab />}\n                {activeTab === 'participants' && <ParticipantsTab />}\n            </div>\n          </motion.div>\n        </motion.div>\n      </AnimatePresence>\n\n      {/* Delete Confirmation Modal */}\n      {showDeleteConfirmation && (\n        <ConfirmationModal\n          isOpen={showDeleteConfirmation}\n          onClose={() => setShowDeleteConfirmation(false)}\n          onConfirm={confirmDeletePrediction}\n          title=\"Delete Prediction\"\n          message=\"Are you sure you want to delete this prediction? This action cannot be undone and all participant data will be lost.\"\n          confirmText=\"Delete\"\n          variant=\"danger\"\n          isLoading={confirmLoading}\n        />\n      )}\n\n      {/* Edit Modal */}\n      {showEditModal && (\n        <EditModal\n          isOpen={showEditModal}\n          onClose={() => setShowEditModal(false)}\n          prediction={{\n            id: String(prediction.id),\n            title: prediction.title,\n            description: prediction.description || ''\n          }}\n          onUpdate={handleEditUpdate}\n        />\n      )}\n\n      {/* Close Early Confirmation Modal */}\n      <ConfirmationModal\n        isOpen={showCloseModal}\n        onClose={() => setShowCloseModal(false)}\n        onConfirm={confirmClosePrediction}\n        title=\"Close Prediction Early\"\n        message=\"Are you sure you want to close this prediction early? No new participants will be able to join once closed.\"\n        confirmText=\"Close Early\"\n        cancelText=\"Cancel\"\n        variant=\"warning\"\n        isLoading={updating}\n      />\n\n      {/* Settlement Modal */}\n      {showSettlementModal && (\n        <SettlementModal\n          isOpen={showSettlementModal}\n          onClose={() => setShowSettlementModal(false)}\n          prediction={{\n            ...predictionData,\n            id: String(predictionData.id),\n            creator_id: user?.id || '',\n            type: 'multi_outcome' as const,\n            stake_min: 1,\n            settlement_method: 'manual' as const,\n            is_private: false,\n            platform_fee_percentage: 2.5,\n            club_id: undefined,\n            image_url: undefined,\n            tags: [],\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n            creator: {\n              id: user?.id || '',\n              username: user?.username || '',\n              full_name: user?.full_name || '',\n              avatar_url: user?.avatar_url || null\n            },\n            options: prediction.options || [],\n            pool_total: prediction.pool_total || prediction.totalPool || 0,\n            participant_count: prediction.participant_count || prediction.participants || 0,\n            entry_deadline: prediction.entry_deadline || new Date().toISOString()\n          } as any}\n          onSettlementComplete={refreshAllData}\n        />\n      )}\n\n      {/* Dispute Resolution Modal */}\n      {showDisputeResolution && (\n        <DisputeResolutionModal\n          isOpen={showDisputeResolution}\n          onClose={() => setShowDisputeResolution(false)}\n          predictionId={String(prediction.id)}\n          predictionTitle={prediction.title}\n          onResolutionComplete={refreshAllData}\n        />\n      )}\n    </>\n  );\n};\n\nexport default ManagePredictionModal; ","/**\n * Prediction Card View Model\n * \n * Centralizes the mapping from API data to card display values.\n * Ensures consistency across all prediction card renders.\n */\n\nexport type PredictionCardVM = {\n  id: string;\n  title: string;\n  categoryLabel?: string;\n  statusBadge: { text: string; tone: 'default' | 'success' | 'warning' | 'danger' };\n  statusSubtext?: string;\n  participantsCount?: number;\n  yourPositionLabel?: string;\n  staked: number;\n  returned: number;\n  profitLoss: number;\n  railLabel?: 'Demo' | 'Crypto' | 'Fiat' | null;\n  settledAtText?: string | null;\n};\n\ntype PredictionInput = {\n  id: string;\n  title: string;\n  category?: string;\n  status: string;\n  settled_at?: string | null;\n  settledAt?: string | null;\n  entry_deadline?: string;\n  participant_count?: number;\n  participants?: number;\n  options?: Array<{ id: string; label: string }>;\n  closedAt?: string | null;\n  [key: string]: any;\n};\n\ntype EntryInput = {\n  id?: string;\n  option_id?: string;\n  amount: number;\n  actual_payout?: number | null;\n  status?: string;\n  provider?: string;\n  option?: { id?: string; label?: string };\n  [key: string]: any;\n};\n\n/**\n * Build prediction card view model from API data\n */\nexport function buildPredictionCardVM(input: {\n  prediction: PredictionInput;\n  myEntry?: EntryInput | EntryInput[]; // Single entry or array of entries\n  now?: number;\n}): PredictionCardVM {\n  const { prediction, myEntry, now = Date.now() } = input;\n\n  // Normalize entry to array\n  const entries = Array.isArray(myEntry) ? myEntry : myEntry ? [myEntry] : [];\n\n  // Determine if prediction is settled\n  const statusLower = (prediction.status || '').toLowerCase();\n  const hasSettledAt = !!(prediction.settled_at || prediction.settledAt);\n  const isSettled = hasSettledAt || statusLower === 'settled' || statusLower === 'complete';\n\n  // Determine if prediction is closed (but not settled)\n  // IMPORTANT: If settled, it's not \"closed\" - it's \"complete\"\n  const entryDeadline = prediction.entry_deadline;\n  const isPastDeadline = entryDeadline ? new Date(entryDeadline).getTime() <= now : false;\n  const isClosed = !isSettled && (statusLower === 'closed' || statusLower === 'awaiting_settlement' || isPastDeadline);\n\n  // Status badge and subtext mapping (fixes contradictions)\n  let statusBadge: { text: string; tone: 'default' | 'success' | 'warning' | 'danger' };\n  let statusSubtext: string | undefined;\n\n  if (statusLower === 'cancelled' || statusLower === 'voided' || statusLower === 'refunded') {\n    statusBadge = {\n      text: statusLower === 'refunded' ? 'Refunded' : statusLower === 'cancelled' ? 'Cancelled' : 'Voided',\n      tone: 'danger',\n    };\n    if (prediction.settled_at || prediction.settledAt) {\n      const date = new Date(prediction.settled_at || prediction.settledAt || '');\n      statusSubtext = `${statusLower === 'refunded' ? 'Refunded' : 'Cancelled'} on ${date.toLocaleDateString()}`;\n    }\n  } else if (isSettled) {\n    statusBadge = { text: 'Complete', tone: 'success' };\n    if (hasSettledAt) {\n      const date = new Date(prediction.settled_at || prediction.settledAt || '');\n      statusSubtext = `Settled on ${date.toLocaleDateString()}`;\n    }\n  } else if (isClosed) {\n    statusBadge = { text: 'Closed', tone: 'default' };\n    statusSubtext = 'Awaiting settlement';\n    // CRITICAL: Must NOT contain word \"Settled\" when awaiting settlement\n  } else {\n    statusBadge = { text: 'Active', tone: 'default' };\n    // Optional: Add relative time if helpers exist\n    if (entryDeadline) {\n      const deadline = new Date(entryDeadline);\n      const hoursLeft = (deadline.getTime() - now) / (1000 * 60 * 60);\n      if (hoursLeft > 0 && hoursLeft < 48) {\n        statusSubtext = `Closes in ${Math.round(hoursLeft)}h`;\n      }\n    }\n  }\n\n  // Monetary fields - Phase 6B: Prefer canonical server fields\n  let staked: number;\n  let returned: number;\n  let profitLoss: number;\n\n  // Phase 6A: Use canonical fields if available (from server)\n  if (\n    typeof prediction.myStakeTotal === 'number' ||\n    typeof prediction.myReturnedTotal === 'number' ||\n    typeof prediction.myNet === 'number'\n  ) {\n    staked = typeof prediction.myStakeTotal === 'number' ? prediction.myStakeTotal : 0;\n    returned = typeof prediction.myReturnedTotal === 'number' ? prediction.myReturnedTotal : 0;\n    profitLoss = typeof prediction.myNet === 'number' ? prediction.myNet : 0;\n  } else {\n    // Fallback: Compute from entries (backward compatible)\n    staked = entries.reduce((sum, e) => sum + (Number(e.amount) || 0), 0);\n    returned = isSettled\n      ? entries.reduce((sum, e) => sum + (Number(e.actual_payout) || 0), 0)\n      : 0;\n    profitLoss = returned - staked;\n  }\n\n  // Your position label\n  let yourPositionLabel: string | undefined;\n  if (entries.length > 0) {\n    const firstEntry = entries[0];\n    if (firstEntry) {\n      const optionId = firstEntry.option_id;\n    \n      // Try to find option label from prediction.options\n      if (prediction.options && optionId) {\n        const option = prediction.options.find((o: any) => o.id === optionId);\n        if (option?.label) {\n          yourPositionLabel = option.label;\n        }\n      }\n    \n      // Fallback to entry.option.label if available\n      if (!yourPositionLabel && firstEntry.option?.label) {\n        yourPositionLabel = firstEntry.option.label;\n      }\n    }\n\n    // If multiple entries across different options (rare)\n    if (entries.length > 1) {\n      const uniqueOptions = new Set(entries.map(e => e.option_id).filter(Boolean));\n      if (uniqueOptions.size > 1) {\n        yourPositionLabel = 'Multiple positions';\n      }\n    }\n  }\n\n  // Rail label (subtle chip)\n  let railLabel: 'Demo' | 'Crypto' | 'Fiat' | null = null;\n  if (entries.length > 0) {\n    const firstProvider = entries[0]?.provider;\n    if (firstProvider === 'demo-wallet') {\n      railLabel = 'Demo';\n    } else if (firstProvider && firstProvider.includes('crypto')) {\n      railLabel = 'Crypto';\n    } else if (firstProvider && (firstProvider.includes('fiat') || firstProvider.includes('paystack'))) {\n      railLabel = 'Fiat';\n    }\n  }\n\n  // Settled date text (only if actually settled)\n  const settledAtText = isSettled && hasSettledAt\n    ? new Date(prediction.settled_at || prediction.settledAt || '').toLocaleDateString()\n    : null;\n\n  return {\n    id: prediction.id,\n    title: prediction.title,\n    categoryLabel: prediction.category?.replace('_', ' '),\n    statusBadge,\n    statusSubtext,\n    participantsCount: prediction.participant_count || prediction.participants || 0,\n    yourPositionLabel,\n    staked,\n    returned,\n    profitLoss,\n    railLabel,\n    settledAtText,\n  };\n}\n","import React, { useState, useEffect, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuthStore } from '../store/authStore';\nimport { useAuthSession } from '../providers/AuthSessionProvider';\nimport { usePredictionStore } from '../store/predictionStore';\nimport type { Prediction, PredictionOption } from '../store/predictionStore';\nimport { openAuthGate } from '../auth/authGateAdapter';\nimport SignedOutGateCard from '../components/auth/SignedOutGateCard';\nimport { \n  TrendingUp, \n  Target, \n  CheckCircle, \n  Plus, \n  Settings,\n  Users,\n  Clock\n} from 'lucide-react';\nimport ManagePredictionModal from '../components/modals/ManagePredictionModal';\nimport { cn } from '../utils/cn';\nimport { AppHeader } from '../components/layout/AppHeader';\nimport { formatTimeRemaining } from '@/lib/utils';\nimport { getApiUrl } from '@/utils/environment';\nimport toast from 'react-hot-toast';\nimport { useAccount } from 'wagmi';\nimport { useMerkleClaim } from '@/hooks/useMerkleClaim';\nimport { useClaimableClaims } from '@/hooks/useClaimableClaims';\nimport { formatCurrency } from '@/lib/format';\nimport { t } from '@/lib/lexicon';\nimport { buildPredictionCardVM } from '@/lib/predictionCardVM';\n\ntype TabKey = 'Active' | 'Created' | 'Completed';\n\n// Production BetsTab Component - Extracted from production bundle\nconst PredictionsPage: React.FC<{ onNavigateToDiscover?: () => void }> = ({ onNavigateToDiscover }) => {\n  const navigate = useNavigate();\n  const { \n    predictions, \n    getUserCreatedPredictions, \n    fetchUserCreatedPredictions, \n    fetchUserPredictionEntries, \n    getUserPredictionEntries, \n    loading \n  } = usePredictionStore();\n  const { user: storeUser, isAuthenticated: storeAuthenticated } = useAuthStore();\n  const { user: sessionUser, initialized: sessionInitialized } = useAuthSession();\n  \n  // Use session as source of truth for authentication, fallback to store\n  const isAuthenticated = sessionUser ? true : storeAuthenticated;\n  const user = sessionUser ? {\n    id: sessionUser.id,\n    firstName: sessionUser.user_metadata?.firstName || sessionUser.user_metadata?.first_name || sessionUser.user_metadata?.full_name?.split(' ')[0] || 'User',\n    lastName: sessionUser.user_metadata?.lastName || sessionUser.user_metadata?.last_name || sessionUser.user_metadata?.full_name?.split(' ').slice(1).join(' ') || '',\n    email: sessionUser.email || '',\n    phone: sessionUser.phone,\n    avatar: sessionUser.user_metadata?.avatar_url || sessionUser.user_metadata?.picture,\n    provider: sessionUser.app_metadata?.provider || 'email',\n    createdAt: sessionUser.created_at\n  } : storeUser;\n\n  const [activeTab, setActiveTab] = useState<TabKey>('Active');\n  const [showManageModal, setShowManageModal] = useState(false);\n  const [selectedPrediction, setSelectedPrediction] = useState(null);\n  const [entriesHydrated, setEntriesHydrated] = useState(false);\n  const isEntryActive = useCallback((status: string) => {\n    const normalized = (status || '').toLowerCase();\n    return !(normalized === 'won' || normalized === 'lost' || normalized === 'refunded');\n  }, []);\n\n  // Helper function to get time remaining with proper status context\n  const getTimeRemaining = (deadline: string | null | undefined, predictionStatus?: string) => {\n    if (!deadline) return 'Unknown';\n\n    const normalizedStatus = (predictionStatus || '').toLowerCase();\n    if (normalizedStatus === 'closed') return 'Closed';\n    if (normalizedStatus === 'settled') return 'Settled';\n    if (normalizedStatus === 'awaiting_settlement') return 'Awaiting settlement';\n    if (normalizedStatus === 'disputed') return 'Disputed';\n    if (normalizedStatus === 'refunded') return 'Refunded';\n    if (normalizedStatus === 'ended') return 'Ended';\n\n    const formatted = formatTimeRemaining(deadline);\n    if (!formatted) return 'Unknown';\n    return formatted;\n  };\n\n  // Helper function to calculate confidence\n  const calculateConfidence = (prediction: any) => {\n    if (!prediction || !prediction.options) return 68;\n    const totalStaked = prediction.options.reduce((sum: number, option: any) => sum + (option.total_staked || 0), 0);\n    if (totalStaked === 0) return 68;\n    const maxStaked = Math.max(...prediction.options.map((option: any) => option.total_staked || 0));\n    return Math.round((maxStaked / totalStaked) * 100);\n  };\n\n  // Scroll to top on mount\n  useEffect(() => {\n    window.scrollTo({ behavior: 'instant' });\n  }, []);\n\n  // Fetch user data\n  useEffect(() => {\n    let cancelled = false;\n    const run = async () => {\n      if (!user?.id || !isAuthenticated) return;\n      try {\n        setEntriesHydrated(false);\n        console.log('ðŸ“Š BetsTab: Fetching data for user:', user.id);\n        await Promise.all([\n          fetchUserCreatedPredictions(user.id),\n          fetchUserPredictionEntries(user.id)\n        ]);\n      } finally {\n        if (!cancelled) {\n          setEntriesHydrated(true);\n        }\n      }\n    };\n    run();\n    return () => {\n      cancelled = true;\n    };\n  }, [user?.id, isAuthenticated, fetchUserCreatedPredictions, fetchUserPredictionEntries]);\n\n  // Get counts for tabs\n  const getCounts = () => {\n    if (!isAuthenticated || !user) return { active: 0, created: 0, completed: 0 };\n    \n    const userCreated = getUserCreatedPredictions(user.id);\n    const userEntries = getUserPredictionEntries(user.id);\n    \n    // Count active entries - only truly active/open predictions\n    const activeEntries = userEntries.filter(entry => {\n      const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n      const entryActive = isEntryActive(entry.status);\n      if (!prediction) {\n        return entryActive;\n      }\n      \n      const status = (prediction.status || '').toLowerCase();\n      const isOpen = status === 'open';\n      const beforeDeadline = new Date(prediction.entry_deadline) > new Date();\n      \n      // Only include if entry is active, prediction is open, and deadline hasn't passed\n      return entryActive && isOpen && beforeDeadline;\n    });\n    \n    // Count created predictions (only open and before deadline)\n    const activeCreated = userCreated.filter(prediction => {\n      // Include predictions that need management: open, closed, or awaiting settlement\n      const needsManagement = prediction.status === 'open' || \n                             prediction.status === 'closed' || \n                             prediction.status === 'awaiting_settlement';\n      return needsManagement;\n    });\n    \n    // Count completed entries (settled or ended)\n    const completedEntries = userEntries.filter(entry => {\n      const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n      if (!prediction) return false;\n      \n      const isSettled = entry.status === 'won' || entry.status === 'lost';\n      const predictionEnded = prediction.status === 'closed' || prediction.status === 'settled' || prediction.status === 'ended';\n      const pastDeadline = new Date(prediction.entry_deadline) <= new Date();\n      \n      return isSettled || predictionEnded || pastDeadline;\n    });\n    \n    return {\n      active: activeEntries.length,\n      created: activeCreated.length,\n      completed: completedEntries.length\n    };\n  };\n\n  const counts = getCounts();\n\n  // Tab configuration\n  const tabs: Array<{ id: TabKey; label: string; icon: typeof TrendingUp; count: number }> = [\n    { id: 'Active', label: 'Active', icon: TrendingUp, count: counts.active },\n    { id: 'Created', label: 'Created', icon: Target, count: counts.created },\n    { id: 'Completed', label: 'Completed', icon: CheckCircle, count: counts.completed }\n  ];\n\n  // Get user predictions data\n  const getUserPredictions = (): Record<TabKey, (Prediction | null)[]> => {\n    if (!isAuthenticated || !user) {\n      return { Active: [], Created: [], Completed: [] };\n    }\n\n    const userEntries = getUserPredictionEntries(user.id);\n    const userCreated = getUserCreatedPredictions(user.id);\n    \n    const activePredictions = userEntries\n      .filter(entry => {\n        const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n        const entryActive = isEntryActive(entry.status);\n        if (!prediction) return entryActive;\n        \n        const status = (prediction.status || '').toLowerCase();\n        const isOpen = status === 'open';\n        const beforeDeadline = new Date(prediction.entry_deadline) > new Date();\n        \n        // Only include if entry is active, prediction is open, and deadline hasn't passed\n        return entryActive && isOpen && beforeDeadline;\n      })\n      .map(entry => {\n        const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n        if (!prediction) {\n          console.warn('âš ï¸ No prediction found for entry:', entry.id);\n          return null;\n        }\n\n        const option = (entry as any).option || prediction.options?.find((o: PredictionOption) => o.id === entry.option_id);\n        const timeRemaining = getTimeRemaining(prediction.entry_deadline, prediction.status);\n        \n        return {\n          id: entry.id,\n          title: prediction.title,\n          category: prediction.category,\n          position: option?.label || 'Unknown',\n          stake: entry.amount,\n          potentialReturn: entry.potential_payout || 0,\n          odds: entry.potential_payout ? `${(entry.potential_payout / entry.amount).toFixed(2)}x` : '1.00x',\n          timeRemaining,\n          status: 'active',\n          participants: prediction.participant_count || 0,\n          confidence: calculateConfidence(prediction)\n        };\n      })\n      .filter(Boolean);\n\n    const createdPredictions = userCreated\n      .filter(prediction => {\n        // Show predictions that need management: open, closed, or awaiting settlement\n        const needsManagement = prediction.status === 'open' || \n                               prediction.status === 'closed' || \n                               prediction.status === 'awaiting_settlement';\n        return needsManagement;\n      })\n      .map(prediction => {\n        // Determine the actual status based on current time and prediction state\n        let actualStatus = prediction.status;\n        const now = new Date();\n        const deadline = new Date(prediction.entry_deadline);\n        \n        // If prediction is still \"open\" but deadline has passed, it should be considered \"ended\"\n        if (actualStatus === 'open' && deadline <= now) {\n          actualStatus = 'ended';\n        }\n        \n        const timeRemaining = getTimeRemaining(prediction.entry_deadline, actualStatus);\n        \n        return {\n          id: prediction.id,\n          title: prediction.title,\n          category: prediction.category,\n          totalPool: prediction.pool_total || 0,\n          participants: prediction.participant_count || 0,\n          timeRemaining,\n          status: actualStatus,\n          yourCut: prediction.creator_fee_percentage || 3.5,\n          description: prediction.description,\n          pool_total: prediction.pool_total,\n          participant_count: prediction.participant_count,\n          creator_fee_percentage: prediction.creator_fee_percentage,\n          entry_deadline: prediction.entry_deadline\n        };\n      });\n\n    const completedPredictions = userEntries\n      .filter(entry => {\n        const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n        if (!prediction) return false;\n        \n        // Include entries that are settled (won/lost) OR predictions that have ended\n        const isSettled = entry.status === 'won' || entry.status === 'lost';\n        const predictionEnded =\n          prediction.status === 'closed' ||\n          prediction.status === 'awaiting_settlement' ||\n          prediction.status === 'settled' ||\n          prediction.status === 'ended';\n        const pastDeadline = new Date(prediction.entry_deadline) <= new Date();\n        \n        return isSettled || predictionEnded || pastDeadline;\n      })\n      .map(entry => {\n        const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n        if (!prediction) {\n          console.warn('âš ï¸ No prediction found for completed entry:', entry.id);\n        return null;\n    }\n\n        // Use view-model helper for consistent mapping\n        const vm = buildPredictionCardVM({\n          prediction: {\n            id: prediction.id,\n            title: prediction.title,\n            category: prediction.category,\n            status: prediction.status,\n            settled_at: prediction.settled_at || prediction.settledAt || null,\n            entry_deadline: prediction.entry_deadline,\n            participant_count: prediction.participant_count,\n            participants: prediction.participant_count,\n            options: prediction.options,\n            updated_at: prediction.updated_at,\n            created_at: prediction.created_at,\n          },\n          myEntry: {\n            id: entry.id,\n            option_id: entry.option_id,\n            amount: entry.amount,\n            actual_payout: entry.actual_payout || null,\n            status: entry.status,\n            provider: (entry as any).provider,\n            option: entry.option || (entry as any).option,\n          },\n        });\n        \n        return {\n          // IMPORTANT: Use the prediction id (not the entry id) so users can tap\n          // Completed items and open the prediction details page reliably.\n          // Also required for claim flows which key off predictionId.\n          id: prediction.id,\n          predictionId: prediction.id,\n          entryId: entry.id,\n          title: vm.title,\n          category: prediction.category,\n          position: vm.yourPositionLabel || 'Unknown',\n          stake: vm.staked,\n          actualReturn: vm.returned,\n          profit: vm.profitLoss,\n          status: entry.status, // Keep entry status for win/lost display\n          participants: vm.participantsCount || 0,\n          settledAt: vm.statusSubtext || vm.settledAtText || '',\n          // Include prediction status and other fields needed for VM fallback\n          predictionStatus: prediction.status,\n          entry_deadline: prediction.entry_deadline,\n          options: prediction.options,\n          // VM fields for card rendering\n          vm,\n        };\n      })\n      .filter(Boolean);\n\n    return {\n      Active: activePredictions as unknown as (Prediction | null)[],\n      Created: createdPredictions as unknown as (Prediction | null)[],\n      Completed: completedPredictions as unknown as (Prediction | null)[]\n    };\n  };\n\n  const userPredictions = useMemo(() => {\n    try {\n      return getUserPredictions();\n    } catch (error) {\n      console.error('Error getting user predictions:', error);\n      return { Active: [], Created: [], Completed: [] };\n    }\n  }, [user?.id, isAuthenticated, predictions, activeTab]);\n\n  const userEntriesList = (isAuthenticated && user) ? getUserPredictionEntries(user.id) : [];\n\n  const activeEntryCards = useMemo(() => {\n    if (!isAuthenticated || !user) return [];\n    return userEntriesList\n      .filter(entry => {\n        const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n        const entryActive = isEntryActive(entry.status);\n        if (!prediction) {\n          return entryActive;\n        }\n        const status = (prediction.status || '').toLowerCase();\n        const isOpen = status === 'open';\n        const beforeDeadline = new Date(prediction.entry_deadline) > new Date();\n        // Only include if entry is active, prediction is open, and deadline hasn't passed\n        return entryActive && isOpen && beforeDeadline;\n      })\n      .map(entry => {\n        const prediction = (entry as any).prediction || predictions.find(p => p.id === entry.prediction_id);\n        if (!prediction) {\n          return { entry, prediction: null, card: null };\n        }\n        const option = (entry as any).option || prediction.options?.find((o: any) => o.id === entry.option_id);\n        return { \n          entry, \n          prediction,\n          card: {\n            id: entry.id,\n            predictionId: prediction.id,\n            title: prediction.title,\n            category: prediction.category || 'custom',\n            position: option?.label || 'Unknown',\n            stake: entry.amount,\n            potentialReturn: entry.potential_payout || 0,\n            odds: entry.potential_payout ? `${(entry.potential_payout / entry.amount).toFixed(2)}x` : '1.00x',\n            confidence: calculateConfidence(prediction),\n            participants: prediction.participant_count || 0,\n            status: 'active',\n            timeRemaining: getTimeRemaining(prediction.entry_deadline, prediction.status)\n          }\n        };\n      });\n  }, [isAuthenticated, user, userEntriesList, predictions, isEntryActive]);\n\n  const currentPredictions = userPredictions[activeTab as TabKey] || [];\n\n  // Helper functions for styling\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'active': return 'bg-emerald-50 text-emerald-700 border-emerald-200';\n      case 'winning': return 'bg-emerald-50 text-emerald-700 border-emerald-200';\n      case 'losing': return 'bg-red-50 text-red-700 border-red-200';\n      case 'open': return 'bg-blue-50 text-blue-700 border-blue-200';\n      default: return 'bg-gray-50 text-gray-700 border-gray-200';\n    }\n  };\n\n  const getCategoryColor = (category: string) => ({\n    'custom': 'bg-orange-100 text-orange-700',\n    'sports': 'bg-blue-100 text-blue-700',\n    'esports': 'bg-purple-100 text-purple-700',\n    'pop_culture': 'bg-pink-100 text-pink-700',\n    'politics': 'bg-red-100 text-red-700',\n    'celebrity_gossip': 'bg-emerald-100 text-emerald-700'\n  })[category] || 'bg-gray-100 text-gray-700';\n\n  // Not authenticated state\n  if (!isAuthenticated) {\n    return (\n      <>\n        <AppHeader title={t('myBets')} />\n        <div className=\"min-h-screen bg-gray-50 px-4 py-6\">\n          <SignedOutGateCard\n            icon={<TrendingUp />}\n            title=\"Sign in to view your predictions\"\n            body=\"See your portfolio, performance, and history.\"\n            intent=\"view_my_bets\"\n            primaryLabel=\"Sign In\"\n          />\n        </div>\n      </>\n    );\n  }\n\n  // Contextual empty state component\n  const EmptyState = ({ tab }: { tab: string }) => {\n    const emptyStateConfig = {\n      'Active': {\n        icon: TrendingUp,\n        title: 'No active predictions',\n        description: `You haven't placed any ${t('bets')} yet. Start by exploring trending topics and making your first prediction!`,\n        buttonText: 'Discover Predictions',\n        buttonColor: 'from-emerald-500 to-emerald-600',\n        iconBg: 'bg-emerald-100',\n        iconColor: 'text-emerald-500'\n      },\n      'Created': {\n        icon: Target,\n        title: 'No predictions created',\n        description: \"Share your insights with the community! Create predictions and earn fees when others participate.\",\n        buttonText: 'Create Prediction',\n        buttonColor: 'from-blue-500 to-blue-600',\n        iconBg: 'bg-blue-100',\n        iconColor: 'text-blue-500'\n      },\n      'Completed': {\n        icon: CheckCircle,\n        title: 'No completed predictions',\n        description: \"Your prediction history and earnings will appear here as you complete predictions.\",\n        buttonText: 'Browse Active Predictions',\n        buttonColor: 'from-purple-500 to-purple-600',\n        iconBg: 'bg-purple-100',\n        iconColor: 'text-purple-500'\n      }\n    };\n\n    const config = emptyStateConfig[tab as TabKey];\n    const Icon = config.icon;\n\n  return (\n    <motion.div \n        className=\"flex flex-col items-center justify-center py-20 px-6\"\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5, delay: 0.1 }}\n      >\n        {/* Animated Icon */}\n        <motion.div \n          className={cn(\n            \"w-20 h-20 rounded-full flex items-center justify-center mb-6\",\n            config.iconBg\n          )}\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ \n            type: \"spring\", \n            stiffness: 260, \n            damping: 20,\n            delay: 0.2 \n          }}\n        >\n          <motion.div \n            initial={{ rotateY: -180 }}\n            animate={{ rotateY: 0 }}\n            transition={{ delay: 0.4, duration: 0.6 }}\n          >\n            <Icon className={cn(\"w-10 h-10\", config.iconColor)} />\n          </motion.div>\n        </motion.div>\n\n        {/* Title */}\n        <motion.h3 \n          className=\"text-xl font-bold text-gray-900 mb-3 text-center\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.3 }}\n        >\n          {config.title}\n        </motion.h3>\n\n        {/* Description */}\n        <motion.p \n          className=\"text-gray-600 text-center mb-8 max-w-md leading-relaxed\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.4 }}\n        >\n          {config.description}\n        </motion.p>\n\n        {/* Action Button */}\n        <motion.button\n          className={cn(\n            \"bg-gradient-to-r text-white px-8 py-3 rounded-xl font-semibold\",\n            \"transition-all duration-200 flex items-center gap-2 shadow-lg\",\n            \"hover:shadow-xl hover:scale-105 active:scale-95\",\n            `${config.buttonColor}`\n          )}\n          onClick={() => {\n            if (tab === 'Created') {\n              navigate('/create');\n              window.scrollTo({ top: 0, behavior: 'instant' });\n            } else {\n              onNavigateToDiscover && onNavigateToDiscover();\n            }\n          }}\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.5 }}\n          whileHover={{ scale: 1.05 }}\n          whileTap={{ scale: 0.95 }}\n        >\n          <Plus className=\"w-5 h-5\" />\n          {config.buttonText}\n        </motion.button>\n      </motion.div>\n    );\n  };\n\n  const ActivePredictionCard = ({ prediction }: { prediction: any }) => (\n    <div\n      className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200 cursor-pointer\"\n      onClick={() => navigate(`/predictions/${prediction.predictionId || prediction.id}`)}\n      role=\"button\"\n      aria-label={`View prediction ${prediction.title}`}\n    >\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <span className={`px-2 py-1 rounded-lg text-xs font-medium ${getCategoryColor(prediction.category)}`}>\n              {(prediction.category || 'custom').replace('_', ' ')}\n            </span>\n            <span className={`px-2 py-1 rounded-lg text-xs font-medium border ${getStatusColor(prediction.status)}`}>\n              Active\n            </span>\n          </div>\n          <h3 className=\"font-semibold text-gray-900 text-lg leading-tight\">{prediction.title}</h3>\n        </div>\n      </div>\n      \n      <div className=\"bg-emerald-50 rounded-xl p-4 mb-4\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-sm font-medium text-emerald-800\">Your Position</span>\n          <span className=\"text-lg font-bold text-emerald-700\">{prediction.position}</span>\n        </div>\n        <div className=\"grid grid-cols-3 gap-4 mt-3\">\n          <div>\n            <p className=\"text-xs text-emerald-600 mb-1\">Staked</p>\n            <p className=\"font-semibold text-emerald-900\">${prediction.stake.toLocaleString()}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-emerald-600 mb-1\">Potential</p>\n            <p className=\"font-semibold text-emerald-900\">${prediction.potentialReturn.toLocaleString()}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-emerald-600 mb-1\">{t('odds')}</p>\n            <p className=\"font-semibold text-emerald-900\">{prediction.odds}</p>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"mb-4\">\n        <div className=\"flex justify-between items-center mb-2\">\n          <span className=\"text-sm text-gray-600\">Market Confidence</span>\n          <span className=\"text-sm font-medium text-gray-900\">{prediction.confidence}%</span>\n        </div>\n        <div className=\"w-full bg-gray-200 rounded-full h-2\">\n          <div \n            className=\"bg-emerald-500 h-2 rounded-full transition-all duration-500\" \n            style={{ width: `${prediction.confidence}%` }}\n          />\n        </div>\n      </div>\n      \n      <div className=\"flex items-center justify-between text-sm text-gray-500\">\n        <div className=\"flex items-center gap-1\">\n          <Users className=\"w-4 h-4\" />\n          <span>{prediction.participants} participants</span>\n        </div>\n        <div className=\"flex items-center gap-1\">\n          <Clock className=\"w-4 h-4\" />\n          <span className={`font-medium ${\n            prediction.timeRemaining.includes('Closed') || \n            prediction.timeRemaining.includes('Settled') || \n            prediction.timeRemaining.includes('Disputed') || \n            prediction.timeRemaining.includes('Ended') ? 'text-red-600' :\n            prediction.timeRemaining.includes('Awaiting') ? 'text-yellow-600' :\n            'text-amber-600'\n          }`}>\n            {(prediction.timeRemaining.includes('h') || prediction.timeRemaining.includes('d')) && \n             !prediction.timeRemaining.includes('Closed') && \n             !prediction.timeRemaining.includes('Ended') && \n             !prediction.timeRemaining.includes('Settled') && \n             !prediction.timeRemaining.includes('Disputed') && \n             !prediction.timeRemaining.includes('Awaiting') ? \n              `${prediction.timeRemaining} left` : \n              prediction.timeRemaining\n            }\n          </span>\n        </div>\n      </div>\n    </div>\n  );\n\n  const ActivePredictionCardSkeleton = () => (\n    <div className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4\">\n      <div className=\"animate-pulse space-y-4\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"h-5 w-16 bg-gray-200 rounded-full\" />\n          <div className=\"h-5 w-12 bg-gray-200 rounded-full\" />\n        </div>\n        <div className=\"h-6 w-3/4 bg-gray-200 rounded\" />\n        <div className=\"bg-emerald-50 rounded-xl p-4 space-y-3\">\n          <div className=\"h-4 w-24 bg-emerald-200 rounded\" />\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div className=\"h-10 bg-emerald-100 rounded\" />\n            <div className=\"h-10 bg-emerald-100 rounded\" />\n            <div className=\"h-10 bg-emerald-100 rounded\" />\n          </div>\n        </div>\n        <div className=\"h-3 w-full bg-gray-200 rounded-full\" />\n        <div className=\"flex items-center justify-between\">\n          <div className=\"h-4 w-24 bg-gray-200 rounded\" />\n          <div className=\"h-4 w-20 bg-gray-200 rounded\" />\n        </div>\n      </div>\n    </div>\n  );\n\n  // Created prediction card\n  const CreatedPredictionCard = ({ prediction }: { prediction: any }) => (\n    <div\n      className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200\"\n    >\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <span className={`px-2 py-1 rounded-lg text-xs font-medium ${getCategoryColor(prediction.category)}`}>\n              {prediction.category.replace('_', ' ')}\n            </span>\n            <span className=\"px-2 py-1 rounded-lg text-xs font-medium border bg-blue-50 text-blue-700 border-blue-200\">\n              {prediction.status === 'open' ? 'Open' : prediction.status}\n            </span>\n          </div>\n          <h3 className=\"font-semibold text-gray-900 text-lg leading-tight\">{prediction.title}</h3>\n          </div>\n        </div>\n\n      <div className=\"bg-blue-50 rounded-xl p-4 mb-4\">\n        <div className=\"grid grid-cols-3 gap-4\">\n          <div>\n            <p className=\"text-xs text-blue-600 mb-1\">Total Pool</p>\n            <p className=\"font-semibold text-blue-900\">${prediction.totalPool.toLocaleString()}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-blue-600 mb-1\">Participants</p>\n            <p className=\"font-semibold text-blue-900\">{prediction.participants}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-blue-600 mb-1\">Your Cut</p>\n            <p className=\"font-semibold text-blue-900\">{prediction.yourCut}%</p>\n          </div>\n        </div>\n      </div>\n      \n      <div className=\"flex items-center justify-between\">\n        <span className={`text-sm ${\n          prediction.timeRemaining.includes('Closed') || \n          prediction.timeRemaining.includes('Settled') || \n          prediction.timeRemaining.includes('Disputed') || \n          prediction.timeRemaining.includes('Ended') ? 'text-red-600' :\n          prediction.timeRemaining.includes('Awaiting') ? 'text-yellow-600' :\n          'text-gray-500'\n        }`}>\n          {(prediction.timeRemaining.includes('h') || prediction.timeRemaining.includes('d')) && \n           !prediction.timeRemaining.includes('Closed') && \n           !prediction.timeRemaining.includes('Ended') && \n           !prediction.timeRemaining.includes('Settled') && \n           !prediction.timeRemaining.includes('Disputed') && \n           !prediction.timeRemaining.includes('Awaiting') ? \n            `Closes in ${prediction.timeRemaining}` : \n            prediction.timeRemaining\n          }\n        </span>\n        <button\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            setSelectedPrediction(prediction);\n            setShowManageModal(true);\n          }}\n          className=\"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-1 hover:bg-blue-700 transition-colors\"\n        >\n          Manage <Settings className=\"w-4 h-4\" />\n        </button>\n      </div>\n    </div>\n  );\n\n  // Completed prediction card\n  const CompletedPredictionCard = ({ prediction }: { prediction: any }) => {\n    const { address } = useAccount();\n    const { data: claimables } = useClaimableClaims(address || undefined, 100);\n    const claimMap = new Map((claimables || []).map(c => [c.predictionId, c]));\n    const { claim, isClaiming } = useMerkleClaim();\n    const [archived, setArchived] = React.useState(false);\n    const predictionId = prediction.predictionId || prediction.id;\n    const localClaimed = (() => {\n      try {\n        const addrLower = (address || '').toLowerCase();\n        return Boolean(localStorage.getItem(`fcz:claimed:${predictionId}:${addrLower}`));\n      } catch {\n        return false;\n      }\n    })();\n    const claimData = claimMap.get(predictionId);\n    const hasClaim = !!address && !!claimData && !localClaimed;\n    \n    // Use VM for status determination (should already be set from getUserPredictions, but fallback if needed)\n    const vm = prediction.vm || buildPredictionCardVM({\n      prediction: {\n        id: prediction.id || prediction.predictionId,\n        title: prediction.title,\n        category: prediction.category,\n        status: prediction.predictionStatus || prediction.status || 'settled', // Use prediction status (not entry status)\n        settled_at: prediction.settledAt ? (typeof prediction.settledAt === 'string' ? prediction.settledAt : new Date(prediction.settledAt).toISOString()) : null,\n        entry_deadline: prediction.entry_deadline,\n        participant_count: prediction.participants,\n        options: prediction.options,\n      },\n      myEntry: {\n        amount: prediction.stake,\n        actual_payout: prediction.actualReturn,\n        status: prediction.status, // Entry status (won/lost) is in prediction.status for completed cards\n        option_id: prediction.option_id,\n        option: { label: prediction.position },\n      },\n    });\n    \n    const isSettled = vm.statusBadge.text === 'Complete';\n\n    const openSafely = async () => {\n      // If status already indicates archived, do not fire a detail request at all\n      const statusLower = String(prediction?.status || '').toLowerCase();\n      if (statusLower === 'archived' || archived) {\n        setArchived(true);\n        toast('This prediction has been archived', { icon: 'ðŸ—„ï¸' });\n        return;\n      }\n      try {\n        // Lightweight HEAD preflight to avoid full payload\n        const r = await fetch(`${getApiUrl()}/api/v2/predictions/${predictionId}`, { method: 'HEAD' });\n        if (!r.ok) {\n          setArchived(true);\n          toast('This prediction has been archived', { icon: 'ðŸ—„ï¸' });\n          return;\n        }\n        navigate(`/predictions/${predictionId}`);\n      } catch {\n        navigate(`/predictions/${predictionId}`);\n      }\n    };\n\n    return (\n    <div\n      className={`bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 transition-all duration-200 ${archived ? 'opacity-60 cursor-not-allowed' : 'hover:shadow-md cursor-pointer'}`}\n      onClick={() => { if (!archived) void openSafely(); }}\n      role=\"button\"\n      aria-label={`View prediction ${prediction.title}`}\n    >\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-2\">\n            <span className={`px-2 py-1 rounded-lg text-xs font-medium ${getCategoryColor(prediction.category)}`}>\n              {vm.categoryLabel || prediction.category.replace('_', ' ')}\n            </span>\n            {archived ? (\n              <span className=\"px-2 py-1 rounded-lg text-xs font-medium border bg-gray-50 text-gray-700 border-gray-200\">Archived</span>\n            ) : (\n              <span className={`px-2 py-1 rounded-lg text-xs font-medium border ${\n                vm.statusBadge.tone === 'success' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :\n                vm.statusBadge.tone === 'danger' ? 'bg-red-50 text-red-700 border-red-200' :\n                vm.statusBadge.tone === 'warning' ? 'bg-yellow-50 text-yellow-700 border-yellow-200' :\n                'bg-gray-50 text-gray-700 border-gray-200'\n              }`}>\n                {vm.statusBadge.text}\n              </span>\n            )}\n            {vm.railLabel && (\n              <span className=\"px-1.5 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200\">\n                {vm.railLabel}\n              </span>\n            )}\n          </div>\n          <h3 className=\"font-semibold text-gray-900 text-lg leading-tight\">{prediction.title}</h3>\n        </div>\n      </div>\n\n      <div className={`rounded-xl p-4 mb-4 ${\n        archived ? 'bg-gray-50' : isSettled ? (prediction.status === 'won' ? 'bg-emerald-50' : 'bg-red-50') : 'bg-yellow-50'\n      }`}>\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className={`text-sm font-medium ${\n            archived ? 'text-gray-700' : isSettled ? (prediction.status === 'won' ? 'text-emerald-800' : 'text-red-800') : 'text-yellow-800'\n          }`}>\n            {archived ? 'Archived' : vm.yourPositionLabel ? `Your Position: ${vm.yourPositionLabel}` : 'No position'}\n          </span>\n          <div className=\"flex items-center gap-3\">\n            {isSettled && (\n              <span className={`text-lg font-bold ${prediction.status === 'won' ? 'text-emerald-700' : 'text-red-700'}`}>\n                {vm.profitLoss >= 0 ? '+' : 'âˆ’'}${Math.abs(vm.profitLoss).toLocaleString()}\n              </span>\n            )}\n            {hasClaim && claimData && (\n              <button\n                type=\"button\"\n                className=\"h-8 px-3 rounded-lg bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                disabled={isClaiming}\n                onClick={async (e) => {\n                  e.stopPropagation();\n                  const units = BigInt(claimData.amountUnits);\n                  const tx = await claim({\n                    predictionId,\n                    amountUnits: units,\n                    proof: claimData.proof as `0x${string}`[],\n                  });\n                  if (tx) {\n                    // Prevent card click navigation; show claimed state inline\n                    // The global cache invalidation will hide the button next refresh\n                  }\n                }}\n              >\n                {isClaiming ? 'Claimingâ€¦' : `Claim ${formatCurrency(claimData.amountUSD, { compact: true })}`}\n              </button>\n            )}\n          </div>\n        </div>\n        <div className=\"grid grid-cols-3 gap-4 mt-3\">\n          <div>\n            <p className={`text-xs mb-1 ${\n              archived ? 'text-gray-600' : isSettled ? (prediction.status === 'won' ? 'text-emerald-600' : 'text-red-600') : 'text-yellow-600'\n            }`}>Staked</p>\n            <p className={`font-semibold ${\n              archived ? 'text-gray-900' : isSettled ? (prediction.status === 'won' ? 'text-emerald-900' : 'text-red-900') : 'text-yellow-900'\n            }`}>\n              ${vm.staked.toLocaleString()}\n            </p>\n          </div>\n          <div>\n            <p className={`text-xs mb-1 ${\n              archived ? 'text-gray-600' : isSettled ? (prediction.status === 'won' ? 'text-emerald-600' : 'text-red-600') : 'text-yellow-600'\n            }`}>Returned</p>\n            <p className={`font-semibold ${\n              archived ? 'text-gray-900' : isSettled ? (prediction.status === 'won' ? 'text-emerald-900' : 'text-red-900') : 'text-yellow-900'\n            }`}>{isSettled ? `$${vm.returned.toLocaleString()}` : 'â€”'}</p>\n          </div>\n          <div>\n            <p className={`text-xs mb-1 ${\n              archived ? 'text-gray-600' : isSettled ? (prediction.status === 'won' ? 'text-emerald-600' : 'text-red-600') : 'text-yellow-600'\n            }`}>Profit/Loss</p>\n            <p className={`font-semibold ${\n              archived ? 'text-gray-900' : isSettled ? (prediction.status === 'won' ? 'text-emerald-900' : 'text-red-900') : 'text-yellow-900'\n            }`}>{isSettled ? `${vm.profitLoss >= 0 ? '+' : 'âˆ’'}$${Math.abs(vm.profitLoss).toLocaleString()}` : 'Pending'}</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-between text-sm text-gray-500\">\n        <span>{vm.participantsCount || prediction.participants || 0} participants</span>\n        <span>{archived ? 'Archived' : vm.statusSubtext || (vm.settledAtText ? `Settled ${vm.settledAtText}` : '') || ''}</span>\n      </div>\n      </div>\n  );\n  }\n\n  return (\n    <>\n      <AppHeader title={t('myBets')} />\n      <div className=\"bg-white border-b border-gray-200\">\n        <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex space-x-4 py-3\">\n            {tabs.map((tab, index) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => setActiveTab(tab.id)}\n                  className={cn(\n                    \"px-3 py-1 rounded-lg text-sm font-medium transition-colors whitespace-nowrap\",\n                    activeTab === tab.id\n                      ? 'bg-emerald-100 text-emerald-700'\n                      : 'text-gray-600 hover:text-gray-900'\n                  )}\n                >\n                  <Icon className=\"w-4 h-4 inline mr-1\" />\n                  <span className=\"hidden sm:inline\">{tab.label}</span>\n                  <span className=\"sm:hidden\">{tab.id === 'Active' ? 'Active' : tab.id === 'Created' ? 'Created' : 'Complete'}</span>\n                  {tab.count > 0 && (\n                    <span className={cn(\n                      \"ml-1 px-2 py-0.5 rounded-full text-xs font-semibold inline-block\",\n                      activeTab === tab.id \n                        ? 'bg-emerald-200 text-emerald-900' \n                        : 'bg-gray-200 text-gray-600'\n                    )}>\n                      {tab.count > 99 ? '99+' : tab.count}\n                    </span>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n      <div className=\"min-h-screen bg-gray-50 pb-[calc(5rem+env(safe-area-inset-bottom))]\">\n        <div className=\"px-4 py-6\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-16\">\n              <div className=\"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin\" />\n              <span className=\"ml-3 text-gray-600\">Loading predictions...</span>\n            </div>\n          ) : activeTab === 'Active' ? (\n            !entriesHydrated ? (\n              <div className=\"space-y-4\">\n              {Array.from({ length: Math.max(3, counts.active || 1) }).map((_, idx) => (\n                <ActivePredictionCardSkeleton key={`active-loading-${idx}`} />\n              ))}\n              </div>\n            ) : activeEntryCards.length > 0 ? (\n              <div className=\"space-y-4\">\n                <AnimatePresence mode=\"popLayout\">\n                  {activeEntryCards.map(({ entry, prediction, card }, index) => (\n                    <motion.div\n                      key={`active-${prediction?.id || entry.id}-${index}`}\n                      initial={{ opacity: 0, y: 12 }}\n                      animate={{ opacity: 1, y: 0 }}\n                      exit={{ opacity: 0, y: -12 }}\n                      transition={{ duration: 0.2, delay: index * 0.02 }}\n                    >\n                      {prediction && card ? (\n                        <ActivePredictionCard prediction={card} />\n                      ) : (\n                        <ActivePredictionCardSkeleton />\n                      )}\n                    </motion.div>\n                  ))}\n                </AnimatePresence>\n              </div>\n            ) : (\n              <EmptyState tab={activeTab} />\n            )\n          ) : currentPredictions.length > 0 ? (\n            <div className=\"space-y-4\">\n              {activeTab === 'Created' && currentPredictions.map((prediction: Prediction | null, index: number) => \n                !prediction || typeof prediction.id === 'undefined' ? (\n                  console.warn('Invalid prediction object:', prediction), null\n                ) : (\n                  <CreatedPredictionCard key={`created-${prediction.id}-${index}`} prediction={prediction} />\n                )\n              )}\n              {activeTab === 'Completed' && currentPredictions.map((prediction: Prediction | null, index: number) => \n                !prediction || typeof prediction.id === 'undefined' ? (\n                  console.warn('Invalid prediction object:', prediction), null\n                ) : (\n                  <CompletedPredictionCard key={`completed-${prediction.id}-${index}`} prediction={prediction} />\n                )\n              )}\n            </div>\n          ) : (\n            <EmptyState tab={activeTab} />\n          )}\n        </div>\n      </div>\n\n      {/* Manage Prediction Modal */}\n      {selectedPrediction && (\n        <ManagePredictionModal\n          isOpen={showManageModal}\n          onClose={() => {\n            setShowManageModal(false);\n            setSelectedPrediction(null);\n          }}\n          prediction={{\n            id: (selectedPrediction as any).id,\n            title: (selectedPrediction as any).title,\n            category: (selectedPrediction as any).category,\n            totalPool:\n              (selectedPrediction as any).totalPool ||\n              (selectedPrediction as any).pool_total ||\n              0,\n            participants:\n              (selectedPrediction as any).participants ||\n              (selectedPrediction as any).participant_count ||\n              0,\n            timeRemaining: getTimeRemaining((selectedPrediction as any).entry_deadline, (selectedPrediction as any).status) || 'Ended',\n            yourCut:\n              (selectedPrediction as any).yourCut ||\n              (selectedPrediction as any).creator_fee_percentage ||\n              3.5,\n            status: (selectedPrediction as any).status || 'open',\n            description: (selectedPrediction as any).description,\n            pool_total: (selectedPrediction as any).pool_total,\n            participant_count: (selectedPrediction as any).participant_count,\n            creator_fee_percentage: (selectedPrediction as any).creator_fee_percentage,\n            entry_deadline: (selectedPrediction as any).entry_deadline,\n          }}\n        />\n      )}\n    </>\n  );\n};\n\nexport default PredictionsPage;"],"names":["SignedOutGateCard","icon","title","body","primaryLabel","onPrimary","secondaryLabel","onSecondary","intent","payload","handlePrimary","result","openAuthGate","jsxs","React","jsx","SignedOutGateCard$1","ConfirmationModal","isOpen","onClose","onConfirm","message","confirmText","cancelText","variant","isLoading","styles","AlertTriangle","handleConfirm","handleClose","AnimatePresence","motion","X","useSettlement","isSettling","setIsSettling","useState","settlementError","setSettlementError","settleManually","useCallback","request","response","getApiUrl","errorData","getSettlementInfo","predictionId","useSettlement$1","toBytes32FromUuid","uuid","useSettlementMerkle","address","chainId","isConnected","useAccount","publicClient","usePublicClient","switchChainAsync","useSwitchChain","writeContractAsync","useWriteContract","withSessionRecovery","recoverFromError","useWalletConnectSession","sessionHealthy","useWeb3Recovery","isSubmitting","setIsSubmitting","error","setError","handleSessionErrorRecovery","err","isSessionError","cleanupWalletConnectStorage","toast","broadcastReconnectRequired","settleWithMerkle","args","txHash","preparedRoot","prepare","data","escrowAddress","platformAddress","predictionIdHex","root","creatorFee","platformFee","totalFeeUSD","baseSepolia","ensureWalletReady","parsed","parseOnchainError","ESCROW_MERKLE_ABI","logTransaction","e","waitForTransactionReceipt","key","short","broadcastBalanceRefresh","wasSessionError","msg","BaseError","lower","Textarea","React.forwardRef","className","props","ref","cn","SettlementModal","prediction","onSettlementComplete","selectedOptionId","setSelectedOptionId","proofUrl","setProofUrl","reason","setReason","showConfirmation","setShowConfirmation","options","setOptions","poolTotalOverride","setPoolTotalOverride","participantCountOverride","setParticipantCountOverride","platformFeePctOverride","setPlatformFeePctOverride","creatorFeePctOverride","setCreatorFeePctOverride","clearError","isPostingRoot","merkleError","useNotificationStore","handleSubmit","fetchPredictionById","usePredictionStore","isMounted","full","selectedOption","opt","getOptionTotalStaked","optionsPoolTotal","sum","o","poolFromPrediction","totalPool","participantCount","platformFeePercent","creatorFeePercent","selectedStake","totalLosingStake","platformFeeCents","creatorFeeCents","payoutPool","Fragment","Trophy","Button","DollarSign","Users","option","isSelected","optionStaked","percentage","optionOdds","Check","Input","SettlementModal$1","DisputeResolutionModal","predictionTitle","onResolutionComplete","disputeData","setDisputeData","loading","setLoading","resolving","setResolving","selectedAction","setSelectedAction","resolutionReason","setResolutionReason","newWinningOption","setNewWinningOption","user","useAuthStore","useEffect","fetchDisputes","handleResolution","dispute","MessageSquare","Gavel","CheckCircle","DisputeResolutionModal$1","EditModal","onUpdate","setTitle","description","setDescription","isUpdating","setIsUpdating","errors","setErrors","titleRef","useRef","descriptionRef","textarea","validateForm","newErrors","handleSave","trimmedTitle","trimmedDescription","updates","handleKeyDown","Edit3","AlertCircle","Loader2","EditModal$1","ManagePredictionModal","activeTab","setActiveTab","emailNotifications","setEmailNotifications","publicVisibility","setPublicVisibility","autoClose","setAutoClose","activityData","setActivityData","participantData","setParticipantData","savingSettings","setSavingSettings","showDeleteConfirmation","setShowDeleteConfirmation","confirmLoading","setConfirmLoading","updating","setUpdating","showSettlementModal","setShowSettlementModal","showEditModal","setShowEditModal","showCloseModal","setShowCloseModal","showDisputeResolution","setShowDisputeResolution","editTitle","setEditTitle","predictionData","setPredictionData","updatePrediction","deletePrediction","closePrediction","fetchPredictionActivity","fetchPredictionParticipants","refreshPredictions","fetchUserCreatedPredictions","fetchUserPredictionEntries","canSettle","pred","deadline","tabs","BarChart3","Settings","loadPredictionData","fullPrediction","formatTimeRemaining","retryPrediction","activity","participants","refreshAllData","handleEditPrediction","handleEditUpdate","handleDeletePrediction","handleClosePrediction","confirmClosePrediction","handleSharePrediction","predictionUrl","shareText","textArea","handleSaveSettings","confirmDeletePrediction","OverviewTab","estimatedEarnings","Share2","Clock","index","SettingsTab","Trash2","ParticipantsTab","participant","tab","Icon","ManagePredictionModal$1","buildPredictionCardVM","input","myEntry","now","entries","statusLower","hasSettledAt","isSettled","entryDeadline","isPastDeadline","isClosed","statusBadge","statusSubtext","date","hoursLeft","staked","returned","profitLoss","yourPositionLabel","firstEntry","optionId","railLabel","firstProvider","settledAtText","PredictionsPage","onNavigateToDiscover","navigate","useNavigate","predictions","getUserCreatedPredictions","getUserPredictionEntries","storeUser","storeAuthenticated","sessionUser","sessionInitialized","useAuthSession","isAuthenticated","showManageModal","setShowManageModal","selectedPrediction","setSelectedPrediction","entriesHydrated","setEntriesHydrated","isEntryActive","status","normalized","getTimeRemaining","predictionStatus","normalizedStatus","formatted","calculateConfidence","totalStaked","maxStaked","cancelled","counts","userCreated","userEntries","activeEntries","entry","p","entryActive","beforeDeadline","activeCreated","completedEntries","predictionEnded","pastDeadline","TrendingUp","Target","getUserPredictions","activePredictions","timeRemaining","createdPredictions","actualStatus","completedPredictions","vm","userPredictions","useMemo","userEntriesList","activeEntryCards","currentPredictions","getStatusColor","getCategoryColor","category","AppHeader","t","EmptyState","config","Plus","ActivePredictionCard","ActivePredictionCardSkeleton","CreatedPredictionCard","CompletedPredictionCard","claimables","useClaimableClaims","claimMap","c","claim","isClaiming","useMerkleClaim","archived","setArchived","localClaimed","addrLower","claimData","hasClaim","openSafely","units","formatCurrency","card","_","idx"],"mappings":"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"}