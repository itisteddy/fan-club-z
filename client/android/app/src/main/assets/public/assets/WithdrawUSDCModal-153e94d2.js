import{f as B,Q as D,h,z as S,u as U}from"./index-6112b649.js";import{d as z,a as R}from"./utils-17ec81d9.js";import{r as u}from"./vendor-499a370b.js";import{j as t}from"./ui-6244b3df.js";import{i as q}from"./DepositUSDCModal-2048ba50.js";import{u as O,a as P,b as H,c as K}from"./useWriteContract-ab9d8160.js";import{w as Q}from"./public-3a03d500.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=B("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function V(e){const a=Y(e.type,e.channel,e.direction);return{id:e.id,kind:a,amountUSD:Math.abs(Number(e.amount||0)),txHash:e.meta?.txHash||e.external_ref?.split(":")[0],createdAt:e.created_at||e.timestamp,meta:{predictionId:e.prediction_id,predictionTitle:e.meta?.prediction_title||e.description,optionId:e.meta?.option_id,optionLabel:e.meta?.option_label,entryId:e.entry_id,lockId:e.meta?.lock_id,userId:e.user_id,provider:e.provider,channel:e.channel,description:e.description,...e.meta}}}function Y(e,a,s){return e==="credit"&&a==="escrow_deposit"||e==="credit"&&a==="crypto"?"deposit":e==="debit"&&a==="escrow_withdrawal"||e==="debit"&&a==="crypto"?"withdraw":e==="unlock"?"unlock":e==="bet_lock"||a==="escrow_consumed"?"lock":e==="bet_release"||a==="escrow_release"?"release":e==="bet_entry"||a==="prediction_entry"?"entry":e==="bet_refund"?"bet_refund":e==="creator_fee"?"creator_fee":e==="platform_fee"?"platform_fee":e==="claim"||a==="settlement_claim"?"claim":e==="payout"||a==="settlement_payout"?"payout":s==="credit"?"deposit":s==="debit"?"withdraw":"entry"}function oe(e,a=20){const s=z({queryKey:D.walletActivity(e??"anon",a),enabled:!!e,queryFn:async()=>{if(!e)throw new Error("userId is required");const n=new URLSearchParams({userId:e,limit:String(a)}),c=await fetch(`/api/wallet/activity?${n.toString()}`);if(!c.ok){const d=await c.json().catch(()=>({message:c.statusText}));throw new Error(d.message||"Failed to load transactions")}const m=((await c.json()).items||[]).map(d=>V(d));return console.log("[FCZ-PAY] ui: fetched wallet activity",{count:m.length}),{items:m}},refetchInterval:1e4,staleTime:5e3,retry:2});return u.useEffect(()=>{const n=()=>{e&&document.hasFocus()&&s.refetch()};return window.addEventListener("focus",n),()=>window.removeEventListener("focus",n)},[e,s]),s}const Z="0x30c60f688A0082D1b761610ec3c70f6dC1374E95",X=[{type:"function",name:"withdraw",stateMutability:"nonpayable",inputs:[{name:"amount",type:"uint256"}],outputs:[]}];function G(e){return BigInt(Math.round(e*1e6))}function g(e){return Math.max(0,Math.floor(e*100)/100)}function C(e){return`$${e.toLocaleString(void 0,{maximumFractionDigits:2})}`}function ce({open:e,isOpen:a,onClose:s,availableUSDC:n=0,userId:c="",escrowAddress:y=Z,escrowAbi:m=X,title:d="Withdraw from Base",onSuccess:A}){const E=R(),{address:p,chainId:w,isConnected:v}=O(),j=P(),{switchChainAsync:W}=H(),{writeContractAsync:I}=K(),[b,x]=u.useState(0),[o,N]=u.useState(!1),l=e??a??!1;if(u.useEffect(()=>{l||x(0)},[l]),u.useEffect(()=>{if(!l)return;const i=r=>r.key==="Escape"&&!o&&s();return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[l,s,o]),!l)return null;const f=g(b||0),_=f>g(n),k=w===h.id,L=!v||!k||o||f<=0||_;async function M(){w!==h.id&&await W({chainId:h.id})}async function T(){try{N(!0),await M();const i=G(f),r=await I({address:y,abi:m,functionName:"withdraw",args:[i]});j&&await Q(j,{hash:r}),console.log("[FCZ-PAY] ui: withdraw success",r);const F=`${r.slice(0,6)}...${r.slice(-4)}`;S.success(`Withdrew ${C(f)}! Tx: ${F}`,{duration:5e3});const $=U.getState().user?.id||c;q(E,{userId:$,txHash:r}),s(),A?.()}catch(i){console.error("[withdraw] failed:",i),S.error(i?.shortMessage??i?.message??"Withdrawal failed")}finally{N(!1)}}return t.jsxs("div",{className:"fixed inset-0 z-modal",children:[t.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:o?void 0:s}),t.jsxs("div",{className:"z-modal fixed inset-x-0 mx-auto w-full max-w-md rounded-t-2xl bg-white shadow-xl bottom-[calc(64px+env(safe-area-inset-bottom,0px))] max-h-[calc(100vh-env(safe-area-inset-top,0px)-64px-env(safe-area-inset-bottom,0px))] focus:outline-none",children:[t.jsx("div",{className:"mx-auto mt-2 mb-3 h-1.5 w-16 rounded-full bg-gray-200"}),t.jsxs("div",{className:"px-4 pb-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-lg font-semibold",children:d}),t.jsx("button",{"aria-label":"Close",onClick:s,className:"rounded-full p-2 hover:bg-gray-100",disabled:o,children:"✕"})]}),t.jsxs("div",{className:"mt-1 text-xs text-gray-500",children:["Wallet: ",p?`${p.slice(0,6)}…${p.slice(-4)}`:"Not connected"," · Chain:"," ",w===h.id?"Base Sepolia":t.jsx("span",{className:"text-amber-600",children:"Switch to Base Sepolia"})]})]}),t.jsxs("div",{className:"overflow-y-auto pb-safe px-4 pt-3",children:[t.jsx("label",{className:"mb-1 block text-sm font-medium",children:"Amount (USDC)"}),t.jsxs("div",{className:"mb-2 flex items-center gap-2",children:[t.jsxs("div",{className:"relative flex-1 min-w-0",children:[t.jsx("input",{inputMode:"decimal",pattern:"[0-9]*",value:b?String(b):"",onChange:i=>{const r=Number(i.target.value.replace(/[^\d.]/g,""));x(Number.isFinite(r)?r:0)},placeholder:"0.00",className:"w-full rounded-lg border border-gray-200 bg-white pl-3 pr-12 py-2 text-base outline-none ring-emerald-500 focus:ring-2 tabular-nums"}),t.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-gray-500 whitespace-nowrap",children:"USDC"})]}),t.jsx("button",{type:"button",onClick:()=>x(g(n)),className:"rounded-lg border border-gray-200 px-3 py-2 text-xs font-semibold hover:bg-gray-50 whitespace-nowrap min-w-[56px]",children:"MAX"})]}),t.jsx("div",{className:"mb-1 text-xs text-gray-500",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("span",{children:"Available to withdraw"}),t.jsx("span",{className:"font-medium text-gray-700 tabular-nums",children:C(n)})]})}),_&&t.jsx("div",{className:"mb-3 text-xs font-medium text-red-600",children:"Insufficient balance"}),t.jsx("div",{className:"h-3"})]}),t.jsxs("div",{className:"sticky bottom-0 bg-white px-4 pt-3 pb-4 shadow-[0_-8px_24px_rgba(0,0,0,0.06)]",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:s,className:"h-11 flex-1 rounded-xl border border-gray-200 font-medium hover:bg-gray-50",disabled:o,children:"Cancel"}),t.jsx("button",{onClick:T,className:"h-11 flex-1 rounded-xl bg-emerald-600 font-semibold text-white hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-50",disabled:L,children:o?"Processing…":v?k?"Withdraw":"Switch to Base":"Connect wallet"})]}),t.jsx("div",{className:"pb-safe"})]})]})]})}export{ne as L,ce as W,oe as u};
