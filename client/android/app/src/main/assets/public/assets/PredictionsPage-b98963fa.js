import{j as e,A as ce,m as M}from"./ui-6244b3df.js";import{R as Se,r}from"./vendor-499a370b.js";import{f as Re,o as Ke,X as ne,A as X,g as fe,z as q,h as Pe,i as ge,j as Je,B as Xe,k as Ze,b as _e,D as Ne,l as Qe,u as ke,n as L,C as be,e as le,m as we,c as et,p as tt,T as ve,q as $e,r as me,P as st}from"./index-6112b649.js";import{E as at,C as Te,u as it}from"./useMerkleClaim-85bb6a08.js";import{u as Me,a as nt,b as rt,c as lt}from"./useWriteContract-ab9d8160.js";import{w as ot}from"./public-3a03d500.js";import{I as ct,B as he}from"./input-89d34c09.js";import{c as dt,f as Ce}from"./utils-a40dfe8b.js";import{U as oe}from"./users-10201f65.js";import{C as mt,S as Ie}from"./settings-ffba16fc.js";import{M as xt,A as Ee,S as ut}from"./share-2-7efa6e5d.js";import{P as Le}from"./pen-line-d6794a46.js";import{A as De}from"./AppHeader-78d14113.js";import{u as pt}from"./useClaimableClaims-c78a938a.js";import{b as ht}from"./format-ae98e2f4.js";import"./utils-17ec81d9.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=Re("Gavel",[["path",{d:"m14.5 12.5-8 8a2.119 2.119 0 1 1-3-3l8-8",key:"15492f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=Re("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),ft=({icon:j,title:f,body:s,primaryLabel:_="Sign In",onPrimary:w,secondaryLabel:C,onSecondary:S,intent:x,payload:c})=>{const R=async()=>{if(w)w();else if(x)try{const o=await Ke({intent:x,payload:c});o.status==="success"||o.status==="cancel"||o.status}catch{}else console.warn("SignedOutGateCard: No onPrimary or intent provided")};return e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-12 px-4",children:[j&&e.jsx("div",{className:"mb-4 text-gray-300",children:Se.cloneElement(j,{className:"w-6 h-6 md:w-8 md:h-8"})}),e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-2",children:f||"Sign in required"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6 max-w-sm leading-relaxed",children:s||"Please sign in to continue with this action."}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:R,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors","data-qa":"authgate-open",children:_}),C&&S&&e.jsx("button",{onClick:S,className:"px-6 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg font-medium transition-colors",children:C})]})]})},Ae=({isOpen:j,onClose:f,onConfirm:s,title:_,message:w,confirmText:C="Confirm",cancelText:S="Cancel",variant:x="danger",isLoading:c=!1})=>{const o=(()=>{switch(x){case"danger":return{icon:e.jsx(X,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"};case"warning":return{icon:e.jsx(X,{className:"w-6 h-6 text-amber-600"}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white",border:"border-amber-200"};case"info":return{icon:e.jsx(X,{className:"w-6 h-6 text-blue-600"}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",border:"border-blue-200"};default:return{icon:e.jsx(X,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"}}})(),h=()=>{c||s()},y=()=>{c||f()};return e.jsx(ce,{mode:"wait",children:j&&e.jsxs("div",{className:"fixed inset-0 z-[12000] flex items-center justify-center p-4",children:[e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50",onClick:y}),e.jsxs(M.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${o.border}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o.icon,e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:_})]}),e.jsx("button",{onClick:y,disabled:c,className:"p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(ne,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-600 leading-relaxed",children:w})}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:y,disabled:c,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50",children:S}),e.jsx("button",{onClick:h,disabled:c,className:`flex-1 px-4 py-3 rounded-xl font-medium transition-colors disabled:opacity-50 ${o.confirmButton}`,children:c?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):C})]})]})]})})},bt=()=>{const[j,f]=r.useState(!1),[s,_]=r.useState(null),w=r.useCallback(async S=>{f(!0),_(null);try{console.log("ðŸ”¨ Starting manual settlement:",S);const x=await fetch(`${fe()}/api/v2/settlement/manual`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(S)});if(console.log("ðŸ“¡ Settlement response status:",x.status),!x.ok){const R=await x.json();return console.error("âŒ Settlement failed:",R),_(R.message||"Settlement failed"),null}const c=await x.json();return console.log("âœ… Settlement successful:",c),c}catch(x){return console.error("âŒ Settlement network error:",x),_("Network error during settlement"),null}finally{f(!1)}},[]),C=r.useCallback(async S=>{try{console.log("ðŸ“Š Fetching settlement info for:",S);const x=await fetch(`${fe()}/api/v2/settlement/prediction/${S}`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!x.ok){if(x.status===404)return null;throw new Error(`Failed to fetch settlement: ${x.status}`)}const c=await x.json();return console.log("ðŸ“Š Settlement info fetched:",c),c.data}catch(x){return console.error("âŒ Error fetching settlement info:",x),null}},[]);return{settleManually:w,getSettlementInfo:C,isSettling:j,settlementError:s,clearError:()=>_(null)}};function yt(j){return`0x${j.replace(/-/g,"").toLowerCase().padEnd(64,"0")}`}function jt(){const{address:j,chainId:f,isConnected:s}=Me(),_=nt(),{switchChainAsync:w}=rt(),{writeContractAsync:C}=lt(),[S,x]=r.useState(!1),[c,R]=r.useState(null),o=r.useCallback(async h=>{x(!0),R(null);try{if(!s||!j)return q.error("Connect wallet as the creator"),null;f!==Pe.id&&await w({chainId:Pe.id});const d=await(await fetch(`${ge()}/api/wallet/summary/${h.userId}`)).json().catch(()=>({})),A=d?.walletAddress?Je(d.walletAddress):null;if(!A)return q.error("Creator wallet address not found. Link your wallet first."),null;if(A.toLowerCase()!==j.toLowerCase())return q.error("Please connect the creator wallet to submit settlement"),null;const u=await fetch(`${ge()}/api/v2/settlement/manual/merkle`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({predictionId:h.predictionId,winningOptionId:h.winningOptionId,userId:h.userId,reason:h.reason||""})});if(!u.ok){const z=await u.json().catch(()=>({}));throw new Error(z?.message||"Failed to prepare merkle settlement")}const F=await u.json(),m=h.escrowAddress||"0x30c60f688A0082D1b761610ec3c70f6dC1374E95";if(!m)throw new Error("Escrow contract address missing (VITE_BASE_ESCROW_ADDRESS)");const v=h.platformTreasury||"0x80f204ea1b41f08227b87334e1384e5687f332d2",I=yt(h.predictionId),b=F.data.merkleRoot,K=BigInt(F.data.creatorFeeUnits),W=BigInt(F.data.platformFeeUnits);q.loading("Submitting settlement root on-chain...",{id:"settle"});const g=await C({address:m,abi:at,functionName:"postSettlementRoot",args:[I,b,A,K,v,W]});_&&await ot(_,{hash:g});try{const z=`fcz:lastTx:settlement:${h.predictionId}`;localStorage.setItem(z,g),window.dispatchEvent(new CustomEvent("fcz:tx",{detail:{kind:"settlement",txHash:g,predictionId:h.predictionId}}))}catch{}try{await fetch(`${ge()}/api/v2/settlement/manual/merkle/posted`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({predictionId:h.predictionId,txHash:g,root:b})})}catch{}const O=`${g.slice(0,8)}â€¦${g.slice(-6)}`;q.success("Settlement root posted! Tx: "+O,{id:"settle"});try{window.dispatchEvent(new CustomEvent("fcz:balance:refresh"))}catch{}return{txHash:g,root:b}}catch(y){let d=y?.shortMessage||y?.message||"Failed to submit settlement";if(y instanceof Xe){const A=(y.shortMessage||"").toLowerCase();A.includes("insufficient funds")&&(d="Insufficient funds to pay gas"),A.includes("user rejected")&&(d="User rejected the transaction"),A.includes("execution reverted")&&(d="Contract reverted â€” check merkle root or fees")}return R(d),q.error(d,{id:"settle"}),null}finally{x(!1)}},[j,f,s,_,w,C]);return{isSubmitting:S,error:c,settleWithMerkle:o}}const Oe=r.forwardRef(({className:j,...f},s)=>e.jsx("textarea",{className:dt("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",j),ref:s,...f}));Oe.displayName="Textarea";const wt=({isOpen:j,onClose:f,prediction:s,onSettlementComplete:_})=>{const[w,C]=r.useState(""),[S,x]=r.useState(""),[c,R]=r.useState(""),[o,h]=r.useState(!1),[y,d]=r.useState(s.options||[]),{settleManually:A,isSettling:u,settlementError:F,clearError:m}=bt(),{settleWithMerkle:v,isSubmitting:I,error:b}=jt();Ze();const K=async()=>{if(!w){q.error("Please select a winning option");return}if(!c.trim()){q.error("Please provide a reason for settlement");return}try{await v({predictionId:s.id,winningOptionId:w,reason:c.trim(),userId:s.creator_id||""})&&(q.success("Settlement root posted on-chain!"),h(!1),f(),_&&_())}catch(k){console.error("Settlement submit error:",k)}},W=()=>{C(""),x(""),R(""),h(!1),m(),f()},{fetchPredictionById:g}=_e();Se.useEffect(()=>{let k=!0;return(async()=>{try{if(s.options&&s.options.length>0){if(!k)return;d(s.options),console.log("âœ… SettlementModal: Using options from props:",s.options.length);return}const B=await g(String(s.id));k&&B?.options?.length?(d(B.options),console.log("âœ… SettlementModal: Loaded options via fetch:",B.options.length)):k&&console.warn("âš ï¸ SettlementModal: No options available for prediction:",s.id)}catch(B){console.warn("âš ï¸ SettlementModal: Failed to ensure options:",B)}})(),()=>{k=!1}},[s.id]);const O=y.find(k=>k.id===w),z=s.pool_total||0,G=s.participant_count||0,se=(()=>O&&Number(O.total_staked||O.staked_amount||O.amount_staked||O.total_amount||O.totalStaked||0)||0)(),ee=Math.max(0,z-se),re=Math.round(ee*100*2.5/100),Z=Math.round(ee*100*1/100),ae=re/100,te=Z/100,xe=Math.max(0,se+Math.max(0,(ee*100-re-Z)/100));return j?e.jsx(ce,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[110] p-4",children:e.jsx(M.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Confirm Settlement"}),e.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:u,children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg p-4 border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Qe,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Settlement Summary"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winning Option:"}),e.jsx("span",{className:"font-medium text-gray-900",children:O?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Pool:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",z.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Platform Fee (2.5%):"}),e.jsxs("span",{className:"text-gray-900",children:["$",ae.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Creator Fee (1.0%):"}),e.jsxs("span",{className:"text-gray-900",children:["$",te.toFixed(2)]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winner Payout:"}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:["$",xe.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Participants:"}),e.jsx("span",{className:"text-gray-900",children:G})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-amber-600 flex-shrink-0"}),e.jsxs("p",{className:"text-amber-800 text-sm",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone. All participants will be notified of the settlement result."]})]})}),F&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:F})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(he,{variant:"outline",onClick:()=>h(!1),disabled:u||I,children:"Back"}),e.jsx(he,{onClick:K,disabled:u||I,className:"bg-emerald-600 hover:bg-emerald-700",children:I?"Submitting...":u?"Settling...":"Confirm Settlement"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Settle Prediction"}),e.jsx("button",{onClick:W,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(ne,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6 pb-40",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsxs("span",{children:["$",z.toFixed(2)," pool"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[G," participants"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Winning Option *"}),e.jsx("div",{className:"space-y-2",children:y.length===0?e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"w-5 h-5 text-yellow-600"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"No Options Available"})]}),e.jsx("p",{className:"text-yellow-700 text-sm mb-3",children:"This prediction doesn't have any options to select from. This might be because:"}),e.jsxs("ul",{className:"text-yellow-700 text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ The prediction data is still loading"}),e.jsx("li",{children:"â€¢ The prediction was created without options"}),e.jsx("li",{children:"â€¢ There was an error fetching the prediction details"})]}),e.jsx("p",{className:"text-yellow-600 text-xs mt-3",children:"Please close this modal and try opening it again. If the problem persists, contact support."})]}):y.map(k=>{const J=w===k.id,B=Number(k.total_staked??k.totalStaked??0),ie=z>0?B/z*100:0,de=k.current_odds||(z>0&&B>0?z/B:2);return e.jsx(M.button,{onClick:()=>C(k.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${J?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${J?"text-emerald-700":"text-gray-900"}`,children:k.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[ie.toFixed(1),"% â€¢ $",B.toFixed(2)," staked â€¢ ",de.toFixed(2),"x odds"]})]}),J&&e.jsx(mt,{className:"w-5 h-5 text-emerald-500"})]})},k.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof URL (optional)"}),e.jsx(ct,{type:"url",placeholder:"https://example.com/proof",value:S,onChange:k=>x(k.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to evidence supporting this outcome (news article, official result, etc.)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Settlement Reason *"}),e.jsx(Oe,{placeholder:"Explain why this option is the winner...",value:c,onChange:k=>R(k.target.value),className:"w-full h-20 resize-none",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/500 characters"]})]}),(F||b)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:F||b})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(he,{variant:"outline",onClick:W,disabled:u,children:"Cancel"}),e.jsx(he,{onClick:()=>h(!0),disabled:!w||!c.trim()||u,className:"bg-emerald-600 hover:bg-emerald-700",children:"Continue"})]})]})})})}):null},vt=({isOpen:j,onClose:f,predictionId:s,predictionTitle:_,onResolutionComplete:w})=>{const[C,S]=r.useState(null),[x,c]=r.useState(!0),[R,o]=r.useState(!1),[h,y]=r.useState(null),[d,A]=r.useState(""),[u,F]=r.useState(""),{user:m}=ke();r.useEffect(()=>{j&&v()},[j,s]);const v=async()=>{try{c(!0);const b=await fetch(`${fe()}/api/v2/settlement/${s}/disputes`);if(!b.ok)throw new Error("Failed to fetch disputes");const K=await b.json();S(K.data)}catch(b){console.error("Error fetching disputes:",b),L.error("Failed to load disputes")}finally{c(!1)}},I=async()=>{if(!h||!d.trim()){L.error("Please select an action and provide a reason");return}try{if(o(!0),!(await fetch(`${fe()}/api/v2/settlement/${s}/resolve-disputes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:h,reason:d,newWinningOption:h==="revise"?u:void 0,creatorId:m?.id})})).ok)throw new Error("Failed to resolve disputes");L.success("Disputes resolved successfully!"),f(),w&&w()}catch(b){console.error("Error resolving disputes:",b),L.error("Failed to resolve disputes")}finally{o(!1)}};return j?e.jsx(ce,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Dispute Resolution"}),e.jsx("p",{className:"text-sm text-gray-600",children:_})]})]}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(ne,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:x?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-red-500 border-t-transparent rounded-full animate-spin"})}):C?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Dispute Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Total Disputes:"}),e.jsx("span",{className:"font-medium ml-2",children:C.totalDisputes})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Pending:"}),e.jsx("span",{className:"font-medium ml-2",children:C.pendingDisputes})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Individual Disputes"}),C.disputes.map(b=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.user.full_name||b.user.username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(b.created_at).toLocaleDateString()})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${b.status==="pending"?"bg-yellow-100 text-yellow-800":b.status==="resolved"?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"}`,children:b.status})]}),e.jsx("div",{className:"bg-gray-50 rounded p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(xt,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700",children:b.reason})]})})]},b.id))]}),C.pendingDisputes>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Resolution Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("button",{onClick:()=>y("reject"),className:`p-4 border-2 rounded-lg text-left transition-all ${h==="reject"?"border-red-500 bg-red-50":"border-gray-200 hover:border-red-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Reject Disputes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Maintain original settlement"})]})]})}),e.jsx("button",{onClick:()=>y("revise"),className:`p-4 border-2 rounded-lg text-left transition-all ${h==="revise"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Fe,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Revise Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change the winning option"})]})]})}),e.jsx("button",{onClick:()=>y("accept"),className:`p-4 border-2 rounded-lg text-left transition-all ${h==="accept"?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-emerald-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(be,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Accept Disputes & Refund"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Refund all participants"})]})]})})]}),h==="revise"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Winning Option ID"}),e.jsx("input",{type:"text",value:u,onChange:b=>F(b.target.value),placeholder:"Enter the correct winning option ID",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Reason"}),e.jsx("textarea",{value:d,onChange:b=>A(b.target.value),placeholder:"Explain your resolution decision...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:f,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:I,disabled:R||!h||!d.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:R?"Resolving...":"Resolve Disputes"})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No dispute data available"})})})]})})}):null},Nt=({isOpen:j,onClose:f,prediction:s,onUpdate:_})=>{const[w,C]=r.useState(s.title||""),[S,x]=r.useState(s.description||""),[c,R]=r.useState(!1),[o,h]=r.useState({}),y=r.useRef(null),d=r.useRef(null);r.useEffect(()=>{j&&(C(s.title||""),x(s.description||""),h({}),setTimeout(()=>y.current?.focus(),150))},[j,s.title,s.description]),r.useEffect(()=>{const m=d.current;m&&(m.style.height="auto",m.style.height=Math.min(m.scrollHeight,120)+"px")},[S]);const A=()=>{const m={};return w.trim()?w.trim().length<3?m.title="Title must be at least 3 characters":w.trim().length>200&&(m.title="Title must be less than 200 characters"):m.title="Title is required",S.trim().length>1e3&&(m.description="Description must be less than 1000 characters"),h(m),Object.keys(m).length===0},u=async()=>{if(!A())return;const m=w.trim(),v=S.trim();if(m===s.title&&v===(s.description||"")){L.error("No changes detected");return}R(!0);try{const I={};m!==s.title&&(I.title=m),v!==(s.description||"")&&(I.description=v),await _(I),L.success("Prediction updated successfully!"),f()}catch(I){console.error("Failed to update prediction:",I),L.error(I instanceof Error?I.message:"Failed to update prediction")}finally{R(!1)}},F=m=>{m.key==="Escape"&&!c?f():m.key==="Enter"&&(m.metaKey||m.ctrlKey)&&!c&&u()};return j?e.jsx(ce,{children:e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4",children:[e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:c?void 0:f}),e.jsxs(M.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",onKeyDown:F,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(Le,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Prediction"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your prediction details"})]})]}),e.jsx("button",{onClick:f,disabled:c,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(ne,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prediction Title *"}),e.jsx("input",{ref:y,type:"text",value:w,onChange:m=>C(m.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${o.title?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Enter prediction title...",disabled:c,maxLength:200}),o.title&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Ee,{className:"w-4 h-4"}),o.title]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[w.length,"/200 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description (Optional)"}),e.jsx("textarea",{ref:d,value:S,onChange:m=>x(m.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${o.description?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Add more details about your prediction...",disabled:c,rows:3,maxLength:1e3,style:{minHeight:"80px",maxHeight:"120px"}}),o.description&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Ee,{className:"w-4 h-4"}),o.description]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[S.length,"/1000 characters"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 border-t border-gray-100",children:[e.jsx("button",{onClick:f,disabled:c,className:"px-6 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx(M.button,{onClick:u,disabled:c||!w.trim()||!!o.title||!!o.description,className:"px-6 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",whileHover:{scale:c?1:1.02},whileTap:{scale:c?1:.98},children:c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):"Update Prediction"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Press ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel or"," ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"âŒ˜ Enter"})," to save"]})})]})]})}):null},Ct=({isOpen:j,onClose:f,prediction:s})=>{const[_,w]=r.useState("overview"),[C,S]=r.useState(!0),[x,c]=r.useState(!0),[R,o]=r.useState(!0),[h,y]=r.useState([]),[d,A]=r.useState([]),[u,F]=r.useState(!1),[m,v]=r.useState(!1),[I,b]=r.useState(!1),[K,W]=r.useState(!1),[g,O]=r.useState(!1),[z,G]=r.useState(!1),[se,ee]=r.useState(!1),[re,Z]=r.useState(!1),[ae,te]=r.useState(!1),[xe,k]=r.useState(""),[J,B]=r.useState(s);r.useEffect(()=>{B(s)},[s]);const{updatePrediction:ie,deletePrediction:de,closePrediction:ye,fetchPredictionActivity:t,fetchPredictionParticipants:l,fetchPredictionById:p,refreshPredictions:D,fetchUserCreatedPredictions:V,fetchUserPredictionEntries:i}=_e(),{user:a}=ke(),T=n=>{if(n.status==="closed"||n.status==="ended")return!0;const U=n.entry_deadline;return!!(U&&new Date(U).getTime()<=Date.now()||typeof n.timeRemaining=="string"&&n.timeRemaining.toLowerCase().includes("ended"))},H=[{id:"overview",label:"Overview",icon:we},{id:"settings",label:"Settings",icon:Ie},{id:"participants",label:"Participants",icon:oe}];r.useEffect(()=>{j&&s.id&&$()},[j,s.id]);const $=r.useCallback(async()=>{F(!0);try{console.log("ðŸ”„ Loading prediction data for modal:",s.id);const n=await p(String(s.id));n?.options?.length?(console.log("ðŸ”„ ManagePredictionModal: Updated prediction with",n.options.length,"options"),Object.assign(s,n),B({id:n.id,title:n.title,category:n.category,totalPool:n.pool_total||n.poolTotal||0,participants:n.participant_count||n.participantCount||0,timeRemaining:Ce(n.entry_deadline||n.entryDeadline||""),yourCut:n.creator_fee_percentage||3.5,status:n.status||"open",description:n.description,pool_total:n.pool_total||n.poolTotal,participant_count:n.participant_count||n.participantCount,creator_fee_percentage:n.creator_fee_percentage,entry_deadline:n.entry_deadline||n.entryDeadline,options:n.options})):(console.warn("âš ï¸ ManagePredictionModal: No options found for prediction:",s.id),setTimeout(async()=>{const N=await p(String(s.id));N?.options?.length&&(console.log("ðŸ”„ Retry successful: Found",N.options.length,"options"),Object.assign(s,N),B({id:N.id,title:N.title,category:N.category,totalPool:N.pool_total||N.poolTotal||0,participants:N.participant_count||N.participantCount||0,timeRemaining:Ce(N.entry_deadline||N.entryDeadline||""),yourCut:N.creator_fee_percentage||3.5,status:N.status||"open",description:N.description,pool_total:N.pool_total||N.poolTotal,participant_count:N.participant_count||N.participantCount,creator_fee_percentage:N.creator_fee_percentage,entry_deadline:N.entry_deadline||N.entryDeadline,options:N.options}))},1e3));const[U,Y]=await Promise.all([t(String(s.id)).catch(N=>(console.warn("Failed to fetch activity:",N),[])),l(String(s.id)).catch(N=>(console.warn("Failed to fetch participants:",N),[]))]);y(U),A(Y),console.log("âœ… Modal data loaded successfully")}catch(n){console.error("Failed to load prediction data:",n),L.error("Failed to load prediction data. Using cached information.")}finally{F(!1)}},[s.id,t,l,p]),P=r.useCallback(async()=>{if(a?.id)try{console.log("ðŸ”„ Refreshing all prediction data..."),await Promise.all([D(!0),V(a.id),i(a.id),$()]),console.log("âœ… All prediction data refreshed")}catch(n){console.error("âŒ Error refreshing prediction data:",n)}},[a?.id,D,V,i,$]),E=r.useCallback(async()=>{console.log("âŒ Closing modal and triggering data refresh"),await P(),setTimeout(()=>{f()},100)},[f,P]),je=()=>{k(s.title),ee(!0)},Q=async n=>{try{O(!0),console.log("ðŸ”§ Updating prediction:",s.id,n),await ie(String(s.id),n),await P()}catch(U){throw console.error("Failed to update prediction:",U),U}finally{O(!1)}},ue=async()=>{b(!0)},Ue=()=>{if(console.log("ðŸ”’ Close Early clicked:",{predictionId:s.id,status:s.status,updating:g,loading:u,canClose:s.status==="open"&&!g&&!u}),s.status!=="open"){L.error("Can only close predictions that are currently open");return}Z(!0)},Be=async()=>{try{O(!0),console.log("ðŸ”’ Closing prediction:",s.id),await ye(String(s.id)),await P(),Object.assign(s,{status:"closed"}),L.success("Prediction closed successfully! You can now settle it."),Z(!1),G(!0)}catch(n){console.error("Failed to close prediction:",n),L.error(n instanceof Error?n.message:"Failed to close prediction")}finally{O(!1)}},ze=async()=>{try{const n=`${window.location.origin}/predictions/${s.id}`,U=`Check out this prediction: ${s.title}`;if(navigator.share)try{await navigator.share({title:s.title,text:U,url:n});return}catch(Y){console.log("Native sharing cancelled or failed:",Y)}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(`${U}
${n}`),L.success("Link copied to clipboard!");else{const Y=document.createElement("textarea");Y.value=`${U}
${n}`,document.body.appendChild(Y),Y.select();try{document.execCommand("copy"),L.success("Link copied to clipboard!")}catch(N){L.error("Failed to copy link. Please copy manually."),console.error("execCommand failed:",N)}finally{document.body.removeChild(Y)}}}catch(n){console.error("Error sharing prediction:",n),L.error("Failed to share prediction")}},He=async()=>{try{v(!0),console.log("âš™ï¸ Saving prediction settings:",s.id),await ie(String(s.id),{is_private:!x}),await P(),L.success("Settings saved successfully!")}catch(n){console.error("Failed to save settings:",n),L.error("Failed to save settings. Please try again.")}finally{v(!1)}},We=async()=>{try{W(!0),console.log("ðŸ—‘ï¸ Deleting prediction:",s.id),await de(String(s.id)),await P(),L.success("Prediction deleted successfully!"),b(!1),E()}catch(n){console.error("Failed to delete prediction:",n),L.error(n instanceof Error?n.message:"Failed to delete prediction")}finally{W(!1)}},Ve=()=>{const n=s.pool_total||s.totalPool||0,U=s.participant_count||s.participants||0,Y=s.creator_fee_percentage||s.yourCut||0,N=n*Y/100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Pool"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",n.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(oe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Participants"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:U})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(we,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Cut"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[Y,"%"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ne,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Est. Earnings"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:["$",N.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(M.button,{onClick:je,disabled:g||u,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:g||u?1:1.02},whileTap:{scale:g||u?1:.98},children:[g?e.jsx(le,{className:"w-5 h-5 animate-spin"}):e.jsx(Le,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Edit Details"})]}),e.jsxs(M.button,{onClick:ze,disabled:g||u,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:g||u?1:1.02},whileTap:{scale:g||u?1:.98},children:[e.jsx(ut,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Share"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(M.button,{onClick:Ue,disabled:g||u||s.status!=="open",className:`flex-1 flex items-center justify-center gap-3 px-6 py-4 rounded-2xl font-semibold shadow-lg transition-all duration-200 group ${s.status!=="open"?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-xl"} disabled:opacity-50 disabled:cursor-not-allowed`,whileHover:{scale:g||u||s.status!=="open"?1:1.02},whileTap:{scale:g||u||s.status!=="open"?1:.98},children:[g?e.jsx(le,{className:"w-5 h-5 animate-spin"}):e.jsx(Te,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:s.status==="open"?"Close Early":"Already Closed"})]}),e.jsxs(M.button,{onClick:()=>G(!0),disabled:g||u||!T(s),className:"flex-1 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group border-2 border-emerald-400/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300/30",whileHover:{scale:g||u||!T(s)?1:1.02},whileTap:{scale:g||u||!T(s)?1:.98},children:[e.jsx(Fe,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Settle"})]})]})]}),s.status==="disputed"&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-900",children:"âš ï¸ Settlement Disputed"}),e.jsx("p",{className:"text-red-700",children:"Participants have disputed your settlement. Review and resolve."})]})]}),e.jsx(M.button,{onClick:()=>te(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:"ðŸ” Manage Disputes"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Recent Activity"}),u?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(le,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading activity..."})]}):h.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:h.map((pe,qe)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:pe.description}),e.jsx("p",{className:"text-xs text-gray-500",children:pe.timeAgo})]}),pe.amount&&e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:["$",pe.amount.toLocaleString()]})]},`activity-${qe}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(we,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No activity yet"})]})]})]})},Ye=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prediction Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Public Visibility"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow anyone to find and join this prediction"})]}),e.jsx("button",{onClick:()=>c(!x),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${x?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${x?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive updates about this prediction via email"})]}),e.jsx("button",{onClick:()=>S(!C),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${C?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${C?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Auto Close"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically close when deadline is reached"})]}),e.jsx("button",{onClick:()=>o(!R),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${R?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${R?"translate-x-6":"translate-x-1"}`})})]})]})]}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end",children:e.jsxs("button",{onClick:He,disabled:m,className:"inline-flex items-center justify-center gap-2 px-5 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[m?e.jsx(le,{className:"w-4 h-4 animate-spin"}):e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Settings"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-4",children:"Danger Zone"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Delete Prediction"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"This action cannot be undone. This will permanently delete the prediction and all associated data."}),e.jsxs("button",{onClick:ue,disabled:g||u,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(gt,{className:"w-4 h-4"}),"Delete Prediction"]})]})]})]}),Ge=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Participants (",d.length,")"]}),u?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(le,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading participants..."})]}):d.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:d.map((n,U)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-purple-600",children:n.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["@",n.username]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Chose: ",n.option," â€¢ ",n.timeAgo]})]})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",n.amount.toLocaleString()]})]},`participant-${U}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(oe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No participants yet"})]})]})});return j?e.jsxs(e.Fragment,{children:[e.jsx(ce,{children:e.jsx(M.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4",onClick:n=>{n.target===n.currentTarget&&E()},children:e.jsxs(M.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Manage Prediction"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-1",children:s.title})]}),e.jsx("button",{onClick:E,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(ne,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"flex border-b border-gray-200",children:H.map(n=>{const U=n.icon;return e.jsxs("button",{onClick:()=>w(n.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${_===n.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(U,{className:"w-4 h-4"}),n.label]},n.id)})}),e.jsxs("div",{className:"p-6 pb-40 max-h-[calc(90vh-200px)] overflow-y-auto",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[_==="overview"&&e.jsx(Ve,{}),_==="settings"&&e.jsx(Ye,{}),_==="participants"&&e.jsx(Ge,{})]})]})})}),I&&e.jsx(Ae,{isOpen:I,onClose:()=>b(!1),onConfirm:We,title:"Delete Prediction",message:"Are you sure you want to delete this prediction? This action cannot be undone and all participant data will be lost.",confirmText:"Delete",variant:"danger",isLoading:K}),se&&e.jsx(Nt,{isOpen:se,onClose:()=>ee(!1),prediction:{id:String(s.id),title:s.title,description:s.description||""},onUpdate:Q}),e.jsx(Ae,{isOpen:re,onClose:()=>Z(!1),onConfirm:Be,title:"Close Prediction Early",message:"Are you sure you want to close this prediction early? No new participants will be able to join once closed.",confirmText:"Close Early",cancelText:"Cancel",variant:"warning",isLoading:g}),z&&e.jsx(wt,{isOpen:z,onClose:()=>G(!1),prediction:{...J,id:String(J.id),creator_id:a?.id||"",type:"multi_outcome",stake_min:1,settlement_method:"manual",is_private:!1,platform_fee_percentage:2.5,club_id:void 0,image_url:void 0,tags:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString(),creator:{id:a?.id||"",username:a?.username||"",full_name:a?.full_name||"",avatar_url:a?.avatar_url||null},options:s.options||[],pool_total:s.pool_total||s.totalPool||0,participant_count:s.participant_count||s.participants||0,entry_deadline:s.entry_deadline||new Date().toISOString()},onSettlementComplete:P}),ae&&e.jsx(vt,{isOpen:ae,onClose:()=>te(!1),predictionId:String(s.id),predictionTitle:s.title,onResolutionComplete:P})]}):null},Bt=({onNavigateToDiscover:j})=>{const[,f]=et(),{predictions:s,getUserCreatedPredictions:_,fetchUserCreatedPredictions:w,fetchUserPredictionEntries:C,getUserPredictionEntries:S,loading:x}=_e(),{user:c,isAuthenticated:R}=ke(),{user:o,initialized:h}=tt(),y=o?!0:R,d=o?{id:o.id,firstName:o.user_metadata?.firstName||o.user_metadata?.first_name||o.user_metadata?.full_name?.split(" ")[0]||"User",lastName:o.user_metadata?.lastName||o.user_metadata?.last_name||o.user_metadata?.full_name?.split(" ").slice(1).join(" ")||"",email:o.email||"",phone:o.phone,avatar:o.user_metadata?.avatar_url||o.user_metadata?.picture,provider:o.app_metadata?.provider||"email",createdAt:o.created_at}:c,[A,u]=r.useState("Active"),[F,m]=r.useState(!1),[v,I]=r.useState(null),[b,K]=r.useState(!1),W=r.useCallback(t=>{const l=(t||"").toLowerCase();return!(l==="won"||l==="lost"||l==="refunded")},[]),g=(t,l)=>{if(!t)return"Unknown";const p=(l||"").toLowerCase();if(p==="closed")return"Closed";if(p==="settled")return"Settled";if(p==="awaiting_settlement")return"Awaiting settlement";if(p==="disputed")return"Disputed";if(p==="refunded")return"Refunded";if(p==="ended")return"Ended";const D=Ce(t);return D||"Unknown"},O=t=>{if(!t||!t.options)return 68;const l=t.options.reduce((D,V)=>D+(V.total_staked||0),0);if(l===0)return 68;const p=Math.max(...t.options.map(D=>D.total_staked||0));return Math.round(p/l*100)};r.useEffect(()=>{window.scrollTo({behavior:"instant"})},[]),r.useEffect(()=>{let t=!1;return(async()=>{if(!(!d?.id||!y))try{K(!1),console.log("ðŸ“Š BetsTab: Fetching data for user:",d.id),await Promise.all([w(d.id),C(d.id)])}finally{t||K(!0)}})(),()=>{t=!0}},[d?.id,y,w,C]);const G=(()=>{if(!y||!d)return{active:0,created:0,completed:0};const t=_(d.id),l=S(d.id),p=l.filter(i=>{const a=i.prediction||s.find(E=>E.id===i.prediction_id),T=W(i.status);if(!a)return T;const $=(a.status||"").toLowerCase()==="open",P=new Date(a.entry_deadline)>new Date;return T&&$&&P}),D=t.filter(i=>i.status==="open"||i.status==="closed"||i.status==="awaiting_settlement"),V=l.filter(i=>{const a=i.prediction||s.find(P=>P.id===i.prediction_id);if(!a)return!1;const T=i.status==="won"||i.status==="lost",H=a.status==="closed"||a.status==="settled"||a.status==="ended",$=new Date(a.entry_deadline)<=new Date;return T||H||$});return{active:p.length,created:D.length,completed:V.length}})(),se=[{id:"Active",label:"Active",icon:ve,count:G.active},{id:"Created",label:"Created",icon:$e,count:G.created},{id:"Completed",label:"Completed",icon:be,count:G.completed}],ee=()=>{if(!y||!d)return{Active:[],Created:[],Completed:[]};const t=S(d.id),l=_(d.id),p=t.filter(i=>{const a=i.prediction||s.find(E=>E.id===i.prediction_id),T=W(i.status);if(!a)return T;const $=(a.status||"").toLowerCase()==="open",P=new Date(a.entry_deadline)>new Date;return T&&$&&P}).map(i=>{const a=i.prediction||s.find($=>$.id===i.prediction_id);if(!a)return console.warn("âš ï¸ No prediction found for entry:",i.id),null;const T=i.option||a.options?.find($=>$.id===i.option_id),H=g(a.entry_deadline,a.status);return{id:i.id,title:a.title,category:a.category,position:T?.label||"Unknown",stake:i.amount,potentialReturn:i.potential_payout||0,odds:i.potential_payout?`${(i.potential_payout/i.amount).toFixed(2)}x`:"1.00x",timeRemaining:H,status:"active",participants:a.participant_count||0,confidence:O(a)}}).filter(Boolean),D=l.filter(i=>i.status==="open"||i.status==="closed"||i.status==="awaiting_settlement").map(i=>{let a=i.status;const T=new Date,H=new Date(i.entry_deadline);a==="open"&&H<=T&&(a="ended");const $=g(i.entry_deadline,a);return{id:i.id,title:i.title,category:i.category,totalPool:i.pool_total||0,participants:i.participant_count||0,timeRemaining:$,status:a,yourCut:i.creator_fee_percentage||3.5,description:i.description,pool_total:i.pool_total,participant_count:i.participant_count,creator_fee_percentage:i.creator_fee_percentage,entry_deadline:i.entry_deadline}}),V=t.filter(i=>{const a=i.prediction||s.find(P=>P.id===i.prediction_id);if(!a)return!1;const T=i.status==="won"||i.status==="lost",H=a.status==="closed"||a.status==="settled"||a.status==="ended",$=new Date(a.entry_deadline)<=new Date;return T||H||$}).map(i=>{const a=i.prediction||s.find(E=>E.id===i.prediction_id);if(!a)return console.warn("âš ï¸ No prediction found for completed entry:",i.id),null;const T=i.option||a.options?.find(E=>E.id===i.option_id),H=(i.actual_payout||0)-i.amount;let $=i.status,P="";return a.status==="settled"&&(i.status==="won"||i.status==="lost")?P=`Settled on ${new Date(i.updated_at).toLocaleDateString()}`:a.status==="closed"?P="Closed - Awaiting Settlement":a.status==="awaiting_settlement"?P="Awaiting Settlement":a.status==="disputed"?P="Settlement Disputed":a.status==="refunded"?P=`Refunded on ${new Date(a.updated_at||a.created_at).toLocaleDateString()}`:new Date(a.entry_deadline)<=new Date?(P=`Ended on ${new Date(a.entry_deadline).toLocaleDateString()}`,i.status==="active"&&($="active")):P=g(a.entry_deadline,a.status),{id:i.id,title:a.title,category:a.category,position:T?.label||"Unknown",stake:i.amount,actualReturn:i.actual_payout||0,profit:H,status:$,participants:a.participant_count||0,settledAt:P}}).filter(Boolean);return{Active:p,Created:D,Completed:V}},re=r.useMemo(()=>{try{return ee()}catch(t){return console.error("Error getting user predictions:",t),{Active:[],Created:[],Completed:[]}}},[d?.id,y,s,A]),Z=y&&d?S(d.id):[],ae=r.useMemo(()=>!y||!d?[]:Z.filter(t=>{const l=t.prediction||s.find(a=>a.id===t.prediction_id),p=W(t.status);if(!l)return p;const V=(l.status||"").toLowerCase()==="open",i=new Date(l.entry_deadline)>new Date;return p&&V&&i}).map(t=>{const l=t.prediction||s.find(D=>D.id===t.prediction_id);if(!l)return{entry:t,prediction:null,card:null};const p=t.option||l.options?.find(D=>D.id===t.option_id);return{entry:t,prediction:l,card:{id:t.id,predictionId:l.id,title:l.title,category:l.category||"custom",position:p?.label||"Unknown",stake:t.amount,potentialReturn:t.potential_payout||0,odds:t.potential_payout?`${(t.potential_payout/t.amount).toFixed(2)}x`:"1.00x",confidence:O(l),participants:l.participant_count||0,status:"active",timeRemaining:g(l.entry_deadline,l.status)}}}),[y,d,Z,s,W]),te=re[A]||[],xe=t=>{switch(t){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"winning":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"losing":return"bg-red-50 text-red-700 border-red-200";case"open":return"bg-blue-50 text-blue-700 border-blue-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},k=t=>({custom:"bg-orange-100 text-orange-700",sports:"bg-blue-100 text-blue-700",esports:"bg-purple-100 text-purple-700",pop_culture:"bg-pink-100 text-pink-700",politics:"bg-red-100 text-red-700",celebrity_gossip:"bg-emerald-100 text-emerald-700"})[t]||"bg-gray-100 text-gray-700";if(!y)return e.jsxs(e.Fragment,{children:[e.jsx(De,{title:"My Bets"}),e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-6",children:e.jsx(ft,{icon:e.jsx(ve,{}),title:"Sign in to view your predictions",body:"See your portfolio, performance, and history.",intent:"view_my_bets",primaryLabel:"Sign In"})})]});const J=({tab:t})=>{const p={Active:{icon:ve,title:"No active predictions",description:"You haven't placed any bets yet. Start by exploring trending topics and making your first prediction!",buttonText:"Discover Predictions",buttonColor:"from-emerald-500 to-emerald-600",iconBg:"bg-emerald-100",iconColor:"text-emerald-500"},Created:{icon:$e,title:"No predictions created",description:"Share your insights with the community! Create predictions and earn fees when others participate.",buttonText:"Create Prediction",buttonColor:"from-blue-500 to-blue-600",iconBg:"bg-blue-100",iconColor:"text-blue-500"},Completed:{icon:be,title:"No completed predictions",description:"Your prediction history and earnings will appear here as you complete predictions.",buttonText:"Browse Active Predictions",buttonColor:"from-purple-500 to-purple-600",iconBg:"bg-purple-100",iconColor:"text-purple-500"}}[t],D=p.icon;return e.jsxs(M.div,{className:"flex flex-col items-center justify-center py-20 px-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:[e.jsx(M.div,{className:me("w-20 h-20 rounded-full flex items-center justify-center mb-6",p.iconBg),initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20,delay:.2},children:e.jsx(M.div,{initial:{rotateY:-180},animate:{rotateY:0},transition:{delay:.4,duration:.6},children:e.jsx(D,{className:me("w-10 h-10",p.iconColor)})})}),e.jsx(M.h3,{className:"text-xl font-bold text-gray-900 mb-3 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:p.title}),e.jsx(M.p,{className:"text-gray-600 text-center mb-8 max-w-md leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:p.description}),e.jsxs(M.button,{className:me("bg-gradient-to-r text-white px-8 py-3 rounded-xl font-semibold","transition-all duration-200 flex items-center gap-2 shadow-lg","hover:shadow-xl hover:scale-105 active:scale-95",`${p.buttonColor}`),onClick:()=>{t==="Created"?(f("/create"),window.scrollTo({behavior:"instant"})):j&&j()},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(st,{className:"w-5 h-5"}),p.buttonText]})]})},B=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${k(t.category)}`,children:(t.category||"custom").replace("_"," ")}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${xe(t.status)}`,children:"Active"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-800",children:"Your Position"}),e.jsx("span",{className:"text-lg font-bold text-emerald-700",children:t.position})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Staked"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",t.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Potential"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",t.potentialReturn.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Odds"}),e.jsx("p",{className:"font-semibold text-emerald-900",children:t.odds})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Market Confidence"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[t.confidence,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${t.confidence}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.participants," participants"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{className:`font-medium ${t.timeRemaining.includes("Closed")||t.timeRemaining.includes("Settled")||t.timeRemaining.includes("Disputed")||t.timeRemaining.includes("Ended")?"text-red-600":t.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-amber-600"}`,children:(t.timeRemaining.includes("h")||t.timeRemaining.includes("d"))&&!t.timeRemaining.includes("Closed")&&!t.timeRemaining.includes("Ended")&&!t.timeRemaining.includes("Settled")&&!t.timeRemaining.includes("Disputed")&&!t.timeRemaining.includes("Awaiting")?`${t.timeRemaining} left`:t.timeRemaining})]})]})]}),ie=()=>e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-16 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-5 w-12 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"h-6 w-3/4 bg-gray-200 rounded"}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-emerald-200 rounded"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-10 bg-emerald-100 rounded"}),e.jsx("div",{className:"h-10 bg-emerald-100 rounded"}),e.jsx("div",{className:"h-10 bg-emerald-100 rounded"})]})]}),e.jsx("div",{className:"h-3 w-full bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded"})]})]})}),de=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>f(`/predictions/${t.id}`),role:"button","aria-label":`View prediction ${t.title}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${k(t.category)}`,children:t.category.replace("_"," ")}),e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-blue-50 text-blue-700 border-blue-200",children:t.status==="open"?"Open":t.status})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Total Pool"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:["$",t.totalPool.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Participants"}),e.jsx("p",{className:"font-semibold text-blue-900",children:t.participants})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Your Cut"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[t.yourCut,"%"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm ${t.timeRemaining.includes("Closed")||t.timeRemaining.includes("Settled")||t.timeRemaining.includes("Disputed")||t.timeRemaining.includes("Ended")?"text-red-600":t.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-gray-500"}`,children:(t.timeRemaining.includes("h")||t.timeRemaining.includes("d"))&&!t.timeRemaining.includes("Closed")&&!t.timeRemaining.includes("Ended")&&!t.timeRemaining.includes("Settled")&&!t.timeRemaining.includes("Disputed")&&!t.timeRemaining.includes("Awaiting")?`Closes in ${t.timeRemaining}`:t.timeRemaining}),e.jsxs("button",{onClick:()=>{I(t),m(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-1 hover:bg-blue-700 transition-colors",children:["Manage ",e.jsx(Ie,{className:"w-4 h-4"})]})]})]}),ye=({prediction:t})=>{const{address:l}=Me(),{data:p}=pt(l||void 0,100),D=new Map((p||[]).map(Q=>[Q.predictionId,Q])),{claim:V,isClaiming:i}=it(),[a,T]=Se.useState(!1),H=(()=>{try{const Q=(l||"").toLowerCase();return!!localStorage.getItem(`fcz:claimed:${t.id}:${Q}`)}catch{return!1}})(),$=D.get(t.id),P=!!l&&!!$&&!H,E=!!t?.settledAt||String(t?.status||"").toLowerCase()==="settled",je=async()=>{if(String(t?.status||"").toLowerCase()==="archived"||a){T(!0),q("This prediction has been archived",{icon:"ðŸ—„ï¸"});return}try{if(!(await fetch(`${ge()}/api/v2/predictions/${t.id}`,{method:"HEAD"})).ok){T(!0),q("This prediction has been archived",{icon:"ðŸ—„ï¸"});return}f(`/predictions/${t.id}`)}catch{f(`/predictions/${t.id}`)}};return e.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 transition-all duration-200 ${a?"opacity-60 cursor-not-allowed":"hover:shadow-md cursor-pointer"}`,onClick:()=>{a||je()},role:"button","aria-label":`View prediction ${t.title}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${k(t.category)}`,children:t.category.replace("_"," ")}),a?e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-gray-50 text-gray-700 border-gray-200",children:"Archived"}):E?e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${t.status==="won"?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-red-50 text-red-700 border-red-200"}`,children:t.status==="won"?"Won":"Lost"}):e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-yellow-50 text-yellow-700 border-yellow-200",children:"Awaiting Settlement"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsxs("div",{className:`rounded-xl p-4 mb-4 ${a?"bg-gray-50":E?t.status==="won"?"bg-emerald-50":"bg-red-50":"bg-yellow-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${a?"text-gray-700":E?t.status==="won"?"text-emerald-800":"text-red-800":"text-yellow-800"}`,children:a?"Archived":E?`Your Position: ${t.position}`:"Awaiting Settlement"}),e.jsxs("div",{className:"flex items-center gap-3",children:[E&&e.jsxs("span",{className:`text-lg font-bold ${t.status==="won"?"text-emerald-700":"text-red-700"}`,children:[t.profit>=0?"+":"âˆ’","$",Math.abs(t.profit).toLocaleString()]}),P&&$&&e.jsx("button",{type:"button",className:"h-8 px-3 rounded-lg bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,onClick:async Q=>{Q.stopPropagation();const ue=BigInt($.amountUnits);await V({predictionId:t.id,amountUnits:ue,proof:$.proof})},children:i?"Claimingâ€¦":`Claim ${ht($.amountUSD,{compact:!0})}`})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${a?"text-gray-600":E?t.status==="won"?"text-emerald-600":"text-red-600":"text-yellow-600"}`,children:"Staked"}),e.jsxs("p",{className:`font-semibold ${a?"text-gray-900":E?t.status==="won"?"text-emerald-900":"text-red-900":"text-yellow-900"}`,children:["$",t.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${a?"text-gray-600":E?t.status==="won"?"text-emerald-600":"text-red-600":"text-yellow-600"}`,children:"Returned"}),e.jsx("p",{className:`font-semibold ${a?"text-gray-900":E?t.status==="won"?"text-emerald-900":"text-red-900":"text-yellow-900"}`,children:E?`$${t.actualReturn.toLocaleString()}`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${a?"text-gray-600":E?t.status==="won"?"text-emerald-600":"text-red-600":"text-yellow-600"}`,children:"Profit/Loss"}),e.jsx("p",{className:`font-semibold ${a?"text-gray-900":E?t.status==="won"?"text-emerald-900":"text-red-900":"text-yellow-900"}`,children:E?`${t.profit>=0?"+":"âˆ’"}$${Math.abs(t.profit).toLocaleString()}`:"Pending"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[t.participants," participants"]}),e.jsx("span",{children:a?"Archived":E?`Settled ${t.settledAt}`:"Closed â€” awaiting settlement"})]})]})};return e.jsxs(e.Fragment,{children:[e.jsx(De,{title:"My Bets"}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:se.map((t,l)=>{const p=t.icon;return e.jsxs("button",{onClick:()=>u(t.id),className:me("px-3 py-1 rounded-lg text-sm font-medium transition-colors whitespace-nowrap",A===t.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsx(p,{className:"w-4 h-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:t.label}),e.jsx("span",{className:"sm:hidden",children:t.id==="Active"?"Active":t.id==="Created"?"Created":"Complete"}),t.count>0&&e.jsx("span",{className:me("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold inline-block",A===t.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:t.count>99?"99+":t.count})]},t.id)})})})}),e.jsx("div",{className:"min-h-screen bg-gray-50 pb-[calc(5rem+env(safe-area-inset-bottom))]",children:e.jsx("div",{className:"px-4 py-6",children:x?e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading predictions..."})]}):A==="Active"?b?ae.length>0?e.jsx("div",{className:"space-y-4",children:e.jsx(ce,{mode:"popLayout",children:ae.map(({entry:t,prediction:l,card:p},D)=>e.jsx(M.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{duration:.2,delay:D*.02},children:l&&p?e.jsx(B,{prediction:p}):e.jsx(ie,{})},`active-${l?.id||t.id}-${D}`))})}):e.jsx(J,{tab:A}):e.jsx("div",{className:"space-y-4",children:Array.from({length:Math.max(3,G.active||1)}).map((t,l)=>e.jsx(ie,{},`active-loading-${l}`))}):te.length>0?e.jsxs("div",{className:"space-y-4",children:[A==="Created"&&te.map((t,l)=>!t||typeof t.id>"u"?(console.warn("Invalid prediction object:",t),null):e.jsx(de,{prediction:t},`created-${t.id}-${l}`)),A==="Completed"&&te.map((t,l)=>!t||typeof t.id>"u"?(console.warn("Invalid prediction object:",t),null):e.jsx(ye,{prediction:t},`completed-${t.id}-${l}`))]}):e.jsx(J,{tab:A})})}),v&&e.jsx(Ct,{isOpen:F,onClose:()=>{m(!1),I(null)},prediction:{id:v.id,title:v.title,category:v.category,totalPool:v.totalPool||v.pool_total||0,participants:v.participants||v.participant_count||0,timeRemaining:g(v.entry_deadline,v.status)||"Ended",yourCut:v.yourCut||v.creator_fee_percentage||3.5,status:v.status||"open",description:v.description,pool_total:v.pool_total,participant_count:v.participant_count,creator_fee_percentage:v.creator_fee_percentage,entry_deadline:v.entry_deadline}})]})};export{Bt as default};
