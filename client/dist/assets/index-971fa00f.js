var lo=Object.defineProperty;var co=(i,e,t)=>e in i?lo(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var re=(i,e,t)=>(co(i,typeof e!="symbol"?e+"":e,t),t);import{j as s,A as xe,m as N,c as uo,P as gr,u as ho,a as qs,S as po}from"./ui-25d22b63.js";import{a as Pi,r as p,b as fo,c as mo,d as we,R as ne}from"./vendor-3a7118c2.js";import{s as Ei,c as Ke,f as go}from"./utils-9273f6b3.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();var Gs={},Mr=Pi;Gs.createRoot=Mr.createRoot,Gs.hydrateRoot=Mr.hydrateRoot;function xo(i,e){if(i instanceof RegExp)return{keys:!1,pattern:i};var t,r,n,o,a=[],l="",d=i.split("/");for(d[0]||d.shift();n=d.shift();)t=n[0],t==="*"?(a.push(t),l+=n[1]==="?"?"(?:/(.*))?":"/(.*)"):t===":"?(r=n.indexOf("?",1),o=n.indexOf(".",1),a.push(n.substring(1,~r?r:~o?o:n.length)),l+=~r&&!~o?"(?:/([^/]+?))?":"/([^/]+?)",~o&&(l+=(~r?"?":"")+"\\"+n.substring(o))):l+="/"+n;return{keys:a,pattern:new RegExp("^"+l+(e?"(?=$|/)":"/?$"),"i")}}const yo=fo["useInsertionEffect"],bo=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",vo=bo?p.useLayoutEffect:p.useEffect,wo=yo||vo,Ti=i=>{const e=p.useRef([i,(...t)=>e[0](...t)]).current;return wo(()=>{e[0]=i}),e[1]},jo="popstate",xr="pushState",yr="replaceState",ko="hashchange",Fr=[jo,xr,yr,ko],_o=i=>{for(const e of Fr)addEventListener(e,i);return()=>{for(const e of Fr)removeEventListener(e,i)}},Ai=(i,e)=>Ei.useSyncExternalStore(_o,i,e),So=()=>location.search,No=({ssrSearch:i=""}={})=>Ai(So,()=>i),Br=()=>location.pathname,Co=({ssrPath:i}={})=>Ai(Br,i?()=>i:Br),Po=(i,{replace:e=!1,state:t=null}={})=>history[e?yr:xr](t,"",i),Eo=(i={})=>[Co(i),Po],Wr=Symbol.for("wouter_v3");if(typeof history<"u"&&typeof window[Wr]>"u"){for(const i of[xr,yr]){const e=history[i];history[i]=function(){const t=e.apply(this,arguments),r=new Event(i);return r.arguments=arguments,dispatchEvent(r),t}}Object.defineProperty(window,Wr,{value:!0})}const To=(i,e)=>e.toLowerCase().indexOf(i.toLowerCase())?"~"+e:e.slice(i.length)||"/",Ii=(i="")=>i==="/"?"":i,Ao=(i,e)=>i[0]==="~"?i.slice(1):Ii(e)+i,Io=(i="",e)=>To(Hr(Ii(i)),Hr(e)),Hr=i=>{try{return decodeURI(i)}catch{return i}},$i={hook:Eo,searchHook:No,parser:xo,base:"",ssrPath:void 0,ssrSearch:void 0,ssrContext:void 0,hrefs:i=>i},Ri=p.createContext($i),Gt=()=>p.useContext(Ri),Oi={},Li=p.createContext(Oi),$o=()=>p.useContext(Li),xs=i=>{const[e,t]=i.hook(i);return[Io(i.base,e),Ti((r,n)=>t(Ao(r,i.base),n))]},pe=()=>xs(Gt()),zi=(i,e,t,r)=>{const{pattern:n,keys:o}=e instanceof RegExp?{keys:!1,pattern:e}:i(e||"*",r),a=n.exec(t)||[],[l,...d]=a;return l!==void 0?[!0,(()=>{const c=o!==!1?Object.fromEntries(o.map((h,f)=>[h,d[f]])):a.groups;let u={...d};return c&&Object.assign(u,c),u})(),...r?[l]:[]]:[!1,null]},Di=({children:i,...e})=>{const t=Gt(),r=e.hook?$i:t;let n=r;const[o,a]=e.ssrPath?.split("?")??[];a&&(e.ssrSearch=a,e.ssrPath=o),e.hrefs=e.hrefs??e.hook?.hrefs;let l=p.useRef({}),d=l.current,c=d;for(let u in r){const h=u==="base"?r[u]+(e[u]||""):e[u]||r[u];d===c&&h!==c[u]&&(l.current=c={...c}),c[u]=h,(h!==r[u]||h!==n[u])&&(n=c)}return p.createElement(Ri.Provider,{value:n,children:i})},Vr=({children:i,component:e},t)=>e?p.createElement(e,{params:t}):typeof i=="function"?i(t):i,Ro=i=>{let e=p.useRef(Oi);const t=e.current;return e.current=Object.keys(i).length!==Object.keys(t).length||Object.entries(i).some(([r,n])=>n!==t[r])?i:t},ye=({path:i,nest:e,match:t,...r})=>{const n=Gt(),[o]=xs(n),[a,l,d]=t??zi(n.parser,i,o,e),c=Ro({...$o(),...l});if(!a)return null;const u=d?p.createElement(Di,{base:d},Vr(r,c)):Vr(r,c);return p.createElement(Li.Provider,{value:c,children:u})};p.forwardRef((i,e)=>{const t=Gt(),[r,n]=xs(t),{to:o="",href:a=o,onClick:l,asChild:d,children:c,className:u,replace:h,state:f,...m}=i,g=Ti(y=>{y.ctrlKey||y.metaKey||y.altKey||y.shiftKey||y.button!==0||(l?.(y),y.defaultPrevented||(y.preventDefault(),n(a,i)))}),x=t.hrefs(a[0]==="~"?a.slice(1):t.base+a,t);return d&&p.isValidElement(c)?p.cloneElement(c,{onClick:g,href:x}):p.createElement("a",{...m,onClick:g,href:x,className:u?.call?u(r===a):u,children:c,ref:e})});const Ui=i=>Array.isArray(i)?i.flatMap(e=>Ui(e&&e.type===p.Fragment?e.props.children:e)):[i],qr=({children:i,location:e})=>{const t=Gt(),[r]=xs(t);for(const n of Ui(i)){let o=0;if(p.isValidElement(n)&&(o=zi(t.parser,n.props.path,e||r,n.props.nest))[0])return p.cloneElement(n,{match:o})}return null},Oo="modulepreload",Lo=function(i){return"/"+i},Gr={},pt=function(e,t,r){if(!t||t.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map(o=>{if(o=Lo(o),o in Gr)return;Gr[o]=!0;const a=o.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!r)for(let u=n.length-1;u>=0;u--){const h=n[u];if(h.href===o&&(!a||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${l}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":Oo,a||(c.as="script",c.crossOrigin=""),c.href=o,document.head.appendChild(c),a)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${o}`)))})})).then(()=>e()).catch(o=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o})},zo=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>pt(()=>Promise.resolve().then(()=>Tt),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class br extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Do extends br{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Jr extends br{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Kr extends br{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Js;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(Js||(Js={}));var Uo=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};class Mo{constructor(e,{headers:t={},customFetch:r,region:n=Js.Any}={}){this.url=e,this.headers=t,this.region=n,this.fetch=zo(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Uo(this,void 0,void 0,function*(){try{const{headers:n,method:o,body:a}=t;let l={},{region:d}=t;d||(d=this.region);const c=new URL(`${this.url}/${e}`);d&&d!=="any"&&(l["x-region"]=d,c.searchParams.set("forceFunctionRegion",d));let u;a&&(n&&!Object.prototype.hasOwnProperty.call(n,"Content-Type")||!n)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=a):typeof a=="string"?(l["Content-Type"]="text/plain",u=a):typeof FormData<"u"&&a instanceof FormData?u=a:(l["Content-Type"]="application/json",u=JSON.stringify(a)));const h=yield this.fetch(c.toString(),{method:o||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),n),body:u}).catch(x=>{throw new Do(x)}),f=h.headers.get("x-relay-error");if(f&&f==="true")throw new Jr(h);if(!h.ok)throw new Kr(h);let m=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),g;return m==="application/json"?g=yield h.json():m==="application/octet-stream"?g=yield h.blob():m==="text/event-stream"?g=h:m==="multipart/form-data"?g=yield h.formData():g=yield h.text(),{data:g,error:null,response:h}}catch(n){return{data:null,error:n,response:n instanceof Kr||n instanceof Jr?n.context:void 0}}})}}var ge={},vr={},ys={},Jt={},bs={},vs={},Fo=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Pt=Fo();const Bo=Pt.fetch,Mi=Pt.fetch.bind(Pt),Fi=Pt.Headers,Wo=Pt.Request,Ho=Pt.Response,Tt=Object.freeze(Object.defineProperty({__proto__:null,Headers:Fi,Request:Wo,Response:Ho,default:Mi,fetch:Bo},Symbol.toStringTag,{value:"Module"})),Vo=mo(Tt);var ws={};Object.defineProperty(ws,"__esModule",{value:!0});let qo=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ws.default=qo;var Bi=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(vs,"__esModule",{value:!0});const Go=Bi(Vo),Jo=Bi(ws);let Ko=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=Go.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const r=this.fetch;let n=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{var a,l,d;let c=null,u=null,h=null,f=o.status,m=o.statusText;if(o.ok){if(this.method!=="HEAD"){const v=await o.text();v===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=v:u=JSON.parse(v))}const x=(a=this.headers.Prefer)===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),y=(l=o.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");x&&y&&y.length>1&&(h=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,f=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{const x=await o.text();try{c=JSON.parse(x),Array.isArray(c)&&o.status===404&&(u=[],c=null,f=200,m="OK")}catch{o.status===404&&x===""?(f=204,m="No Content"):c={message:x}}if(c&&this.isMaybeSingle&&(!((d=c?.details)===null||d===void 0)&&d.includes("0 rows"))&&(c=null,f=200,m="OK"),c&&this.shouldThrowOnError)throw new Jo.default(c)}return{error:c,data:u,count:h,status:f,statusText:m}});return this.shouldThrowOnError||(n=n.catch(o=>{var a,l,d;return{error:{message:`${(a=o?.name)!==null&&a!==void 0?a:"FetchError"}: ${o?.message}`,details:`${(l=o?.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(d=o?.code)!==null&&d!==void 0?d:""}`},data:null,count:null,status:0,statusText:""}})),n.then(e,t)}returns(){return this}overrideTypes(){return this}};vs.default=Ko;var Yo=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(bs,"__esModule",{value:!0});const Zo=Yo(vs);let Qo=class extends Zo.default{select(e){let t=!1;const r=(e??"*").split("").map(n=>/\s/.test(n)&&!t?"":(n==='"'&&(t=!t),n)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:n,referencedTable:o=n}={}){const a=o?`${o}.order`:"order",l=this.url.searchParams.get(a);return this.url.searchParams.set(a,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const n=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:n=r}={}){const o=typeof n>"u"?"offset":`${n}.offset`,a=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(o,`${e}`),this.url.searchParams.set(a,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:n=!1,wal:o=!1,format:a="text"}={}){var l;const d=[e?"analyze":null,t?"verbose":null,r?"settings":null,n?"buffers":null,o?"wal":null].filter(Boolean).join("|"),c=(l=this.headers.Accept)!==null&&l!==void 0?l:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${a}; for="${c}"; options=${d};`,a==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};bs.default=Qo;var Xo=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Jt,"__esModule",{value:!0});const ea=Xo(bs);let ta=class extends ea.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(n=>typeof n=="string"&&new RegExp("[,()]").test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:n}={}){let o="";n==="plain"?o="pl":n==="phrase"?o="ph":n==="websearch"&&(o="w");const a=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${o}fts${a}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const n=r?`${r}.or`:"or";return this.url.searchParams.append(n,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Jt.default=ta;var sa=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ys,"__esModule",{value:!0});const $t=sa(Jt);let ra=class{constructor(e,{headers:t={},schema:r,fetch:n}){this.url=e,this.headers=t,this.schema=r,this.fetch=n}select(e,{head:t=!1,count:r}={}){const n=t?"HEAD":"GET";let o=!1;const a=(e??"*").split("").map(l=>/\s/.test(l)&&!o?"":(l==='"'&&(o=!o),l)).join("");return this.url.searchParams.set("select",a),r&&(this.headers.Prefer=`count=${r}`),new $t.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:r=!0}={}){const n="POST",o=[];if(this.headers.Prefer&&o.push(this.headers.Prefer),t&&o.push(`count=${t}`),r||o.push("missing=default"),this.headers.Prefer=o.join(","),Array.isArray(e)){const a=e.reduce((l,d)=>l.concat(Object.keys(d)),[]);if(a.length>0){const l=[...new Set(a)].map(d=>`"${d}"`);this.url.searchParams.set("columns",l.join(","))}}return new $t.default({method:n,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:n,defaultToNull:o=!0}={}){const a="POST",l=[`resolution=${r?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),o||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(e)){const d=e.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(d.length>0){const c=[...new Set(d)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new $t.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const r="PATCH",n=[];return this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),this.headers.Prefer=n.join(","),new $t.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",r=[];return e&&r.push(`count=${e}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new $t.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};ys.default=ra;var js={},ks={};Object.defineProperty(ks,"__esModule",{value:!0});ks.version=void 0;ks.version="0.0.0-automated";Object.defineProperty(js,"__esModule",{value:!0});js.DEFAULT_HEADERS=void 0;const ia=ks;js.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${ia.version}`};var Wi=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(vr,"__esModule",{value:!0});const na=Wi(ys),oa=Wi(Jt),aa=js;let la=class Hi{constructor(e,{headers:t={},schema:r,fetch:n}={}){this.url=e,this.headers=Object.assign(Object.assign({},aa.DEFAULT_HEADERS),t),this.schemaName=r,this.fetch=n}from(e){const t=new URL(`${this.url}/${e}`);return new na.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new Hi(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:n=!1,count:o}={}){let a;const l=new URL(`${this.url}/rpc/${e}`);let d;r||n?(a=r?"HEAD":"GET",Object.entries(t).filter(([u,h])=>h!==void 0).map(([u,h])=>[u,Array.isArray(h)?`{${h.join(",")}}`:`${h}`]).forEach(([u,h])=>{l.searchParams.append(u,h)})):(a="POST",d=t);const c=Object.assign({},this.headers);return o&&(c.Prefer=`count=${o}`),new oa.default({method:a,url:l,headers:c,schema:this.schemaName,body:d,fetch:this.fetch,allowEmpty:!1})}};vr.default=la;var At=we&&we.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(ge,"__esModule",{value:!0});ge.PostgrestError=ge.PostgrestBuilder=ge.PostgrestTransformBuilder=ge.PostgrestFilterBuilder=ge.PostgrestQueryBuilder=ge.PostgrestClient=void 0;const Vi=At(vr);ge.PostgrestClient=Vi.default;const qi=At(ys);ge.PostgrestQueryBuilder=qi.default;const Gi=At(Jt);ge.PostgrestFilterBuilder=Gi.default;const Ji=At(bs);ge.PostgrestTransformBuilder=Ji.default;const Ki=At(vs);ge.PostgrestBuilder=Ki.default;const Yi=At(ws);ge.PostgrestError=Yi.default;var ca=ge.default={PostgrestClient:Vi.default,PostgrestQueryBuilder:qi.default,PostgrestFilterBuilder:Gi.default,PostgrestTransformBuilder:Ji.default,PostgrestBuilder:Ki.default,PostgrestError:Yi.default};const{PostgrestClient:da,PostgrestQueryBuilder:Mh,PostgrestFilterBuilder:Fh,PostgrestTransformBuilder:Bh,PostgrestBuilder:Wh,PostgrestError:Hh}=ca;class ua{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"&&process.versions&&process.versions.node){const t=parseInt(process.versions.node.split(".")[0]);return t>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${t} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${t} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const ha="2.15.1",pa=`realtime-js/${ha}`,fa="1.0.0",Ks=1e4,ma=1e3,ga=100;var Dt;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Dt||(Dt={}));var ce;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(ce||(ce={}));var _e;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(_e||(_e={}));var Ys;(function(i){i.websocket="websocket"})(Ys||(Ys={}));var nt;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(nt||(nt={}));class xa{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const n=t.getUint8(1),o=t.getUint8(2);let a=this.HEADER_LENGTH+2;const l=r.decode(e.slice(a,a+n));a=a+n;const d=r.decode(e.slice(a,a+o));a=a+o;const c=JSON.parse(r.decode(e.slice(a,e.byteLength)));return{ref:null,topic:l,event:d,payload:c}}}class Zi{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var X;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(X||(X={}));const Yr=(i,e,t={})=>{var r;const n=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((o,a)=>(o[a]=ya(a,i,e,n),o),{})},ya=(i,e,t,r)=>{const n=e.find(l=>l.name===i),o=n?.type,a=t[i];return o&&!r.includes(o)?Qi(o,a):Zs(a)},Qi=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return ja(e,t)}switch(i){case X.bool:return ba(e);case X.float4:case X.float8:case X.int2:case X.int4:case X.int8:case X.numeric:case X.oid:return va(e);case X.json:case X.jsonb:return wa(e);case X.timestamp:return ka(e);case X.abstime:case X.date:case X.daterange:case X.int4range:case X.int8range:case X.money:case X.reltime:case X.text:case X.time:case X.timestamptz:case X.timetz:case X.tsrange:case X.tstzrange:return Zs(e);default:return Zs(e)}},Zs=i=>i,ba=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},va=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},wa=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},ja=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,r=i[t];if(i[0]==="{"&&r==="}"){let o;const a=i.slice(1,t);try{o=JSON.parse("["+a+"]")}catch{o=a?a.split(","):[]}return o.map(l=>Qi(e,l))}return i},ka=i=>typeof i=="string"?i.replace(" ","T"):i,Xi=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Is{constructor(e,t,r={},n=Ks){this.channel=e,this.event=t,this.payload=r,this.timeout=n,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Zr;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(Zr||(Zr={}));class Ut{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},n=>{const{onJoin:o,onLeave:a,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ut.syncState(this.state,n,o,a),this.pendingDiffs.forEach(d=>{this.state=Ut.syncDiff(this.state,d,o,a)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},n=>{const{onJoin:o,onLeave:a,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(n):(this.state=Ut.syncDiff(this.state,n,o,a),l())}),this.onJoin((n,o,a)=>{this.channel._trigger("presence",{event:"join",key:n,currentPresences:o,newPresences:a})}),this.onLeave((n,o,a)=>{this.channel._trigger("presence",{event:"leave",key:n,currentPresences:o,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,n){const o=this.cloneDeep(e),a=this.transformState(t),l={},d={};return this.map(o,(c,u)=>{a[c]||(d[c]=u)}),this.map(a,(c,u)=>{const h=o[c];if(h){const f=u.map(y=>y.presence_ref),m=h.map(y=>y.presence_ref),g=u.filter(y=>m.indexOf(y.presence_ref)<0),x=h.filter(y=>f.indexOf(y.presence_ref)<0);g.length>0&&(l[c]=g),x.length>0&&(d[c]=x)}else l[c]=u}),this.syncDiff(o,{joins:l,leaves:d},r,n)}static syncDiff(e,t,r,n){const{joins:o,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),n||(n=()=>{}),this.map(o,(l,d)=>{var c;const u=(c=e[l])!==null&&c!==void 0?c:[];if(e[l]=this.cloneDeep(d),u.length>0){const h=e[l].map(m=>m.presence_ref),f=u.filter(m=>h.indexOf(m.presence_ref)<0);e[l].unshift(...f)}r(l,u,d)}),this.map(a,(l,d)=>{let c=e[l];if(!c)return;const u=d.map(h=>h.presence_ref);c=c.filter(h=>u.indexOf(h.presence_ref)<0),e[l]=c,n(l,c,d),c.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const n=e[r];return"metas"in n?t[r]=n.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[r]=n,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Qr;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(Qr||(Qr={}));var Mt;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Mt||(Mt={}));var De;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(De||(De={}));class wr{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=ce.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Is(this,_e.join,this.params,this.timeout),this.rejoinTimer=new Zi(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ce.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(n=>n.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ce.closed,this.socket._remove(this)}),this._onError(n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ce.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",n=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,n),this.state=ce.errored,this.rejoinTimer.scheduleTimeout())}),this._on(_e.reply,{},(n,o)=>{this._trigger(this._replyEventName(o),n)}),this.presence=new Ut(this),this.broadcastEndpointURL=Xi(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,n;if(this.socket.isConnected()||this.socket.connect(),this.state==ce.closed){const{config:{broadcast:o,presence:a,private:l}}=this.params,d=(n=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&n!==void 0?n:[],c=!!this.bindings[Mt.PRESENCE]&&this.bindings[Mt.PRESENCE].length>0,u={},h={broadcast:o,presence:Object.assign(Object.assign({},a),{enabled:c}),postgres_changes:d,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(De.CHANNEL_ERROR,f)),this._onClose(()=>e?.(De.CLOSED)),this.updateJoinPayload(Object.assign({config:h},u)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var m;if(this.socket.setAuth(),f===void 0){e?.(De.SUBSCRIBED);return}else{const g=this.bindings.postgres_changes,x=(m=g?.length)!==null&&m!==void 0?m:0,y=[];for(let v=0;v<x;v++){const b=g[v],{filter:{event:w,schema:k,table:I,filter:_}}=b,A=f&&f[v];if(A&&A.event===w&&A.schema===k&&A.table===I&&A.filter===_)y.push(Object.assign(Object.assign({},b),{id:A.id}));else{this.unsubscribe(),this.state=ce.errored,e?.(De.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(De.SUBSCRIBED);return}}).receive("error",f=>{this.state=ce.errored,e?.(De.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(De.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===ce.joined&&e===Mt.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,n;if(!this._canPush()&&e.type==="broadcast"){const{event:o,payload:a}=e,d={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:a,private:this.private}]})};try{const c=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((n=c.body)===null||n===void 0?void 0:n.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var a,l,d;const c=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(l=(a=this.params)===null||a===void 0?void 0:a.config)===null||l===void 0?void 0:l.broadcast)===null||d===void 0)&&d.ack)&&o("ok"),c.receive("ok",()=>o("ok")),c.receive("error",()=>o("error")),c.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=ce.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(_e.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(n=>{r=new Is(this,_e.leave,{},e),r.receive("ok",()=>{t(),n("ok")}).receive("timeout",()=>{t(),n("timed out")}).receive("error",()=>{n("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=ce.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const n=new AbortController,o=setTimeout(()=>n.abort(),r),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:n.signal}));return clearTimeout(o),a}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let n=new Is(this,e,t,r);return this._canPush()?n.send():this._addToPushBuffer(n),n}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>ga){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var n,o;const a=e.toLocaleLowerCase(),{close:l,error:d,leave:c,join:u}=_e;if(r&&[l,d,c,u].indexOf(a)>=0&&r!==this._joinRef())return;let f=this._onMessage(a,t,r);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(n=this.bindings.postgres_changes)===null||n===void 0||n.filter(m=>{var g,x,y;return((g=m.filter)===null||g===void 0?void 0:g.event)==="*"||((y=(x=m.filter)===null||x===void 0?void 0:x.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===a}).map(m=>m.callback(f,r)):(o=this.bindings[a])===null||o===void 0||o.filter(m=>{var g,x,y,v,b,w;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in m){const k=m.id,I=(g=m.filter)===null||g===void 0?void 0:g.event;return k&&((x=t.ids)===null||x===void 0?void 0:x.includes(k))&&(I==="*"||I?.toLocaleLowerCase()===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const k=(b=(v=m?.filter)===null||v===void 0?void 0:v.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return k==="*"||k===((w=t?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return m.type.toLocaleLowerCase()===a}).map(m=>{if(typeof f=="object"&&"ids"in f){const g=f.data,{schema:x,table:y,commit_timestamp:v,type:b,errors:w}=g;f=Object.assign(Object.assign({},{schema:x,table:y,commit_timestamp:v,eventType:b,new:{},old:{},errors:w}),this._getPayloadRecords(g))}m.callback(f,r)})}_isClosed(){return this.state===ce.closed}_isJoined(){return this.state===ce.joined}_isJoining(){return this.state===ce.joining}_isLeaving(){return this.state===ce.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const n=e.toLocaleLowerCase(),o={type:n,filter:t,callback:r};return this.bindings[n]?this.bindings[n].push(o):this.bindings[n]=[o],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(n=>{var o;return!(((o=n.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===r&&wr.isEqual(n.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(_e.close,{},e)}_onError(e){this._on(_e.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ce.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Yr(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Yr(e.columns,e.old_record)),t}}const Xr=()=>{},ts={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},_a=[1e3,2e3,5e3,1e4],Sa=1e4,Na=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class Ca{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=Ks,this.transport=null,this.heartbeatIntervalMs=ts.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xr,this.ref=0,this.reconnectTimer=null,this.logger=Xr,this.conn=null,this.sendBuffer=[],this.serializer=new xa,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>pt(()=>Promise.resolve().then(()=>Tt),void 0).then(({default:l})=>l(...a)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):o=fetch,(...a)=>o(...a)},!(!((r=t?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${Ys.websocket}`,this.httpEndpoint=Xi(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ua.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:fa}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Dt.connecting:return nt.Connecting;case Dt.open:return nt.Open;case Dt.closing:return nt.Closing;default:return nt.Closed}}isConnected(){return this.connectionState()===nt.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,n=this.getChannels().find(o=>o.topic===r);if(n)return n;{const o=new wr(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:r,payload:n,ref:o}=e,a=()=>{this.encode(e,l=>{var d;(d=this.conn)===null||d===void 0||d.send(l)})};this.log("push",`${t} ${r} (${o})`,n),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(ma,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ts.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{t.topic==="phoenix"&&t.event==="phx_reply"&&this.heartbeatCallback(t.payload.status==="ok"?"ok":"error"),t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:n,payload:o,ref:a}=t,l=a?`(${a})`:"",d=o.status||"";this.log("receive",`${d} ${r} ${n} ${l}`.trim(),o),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(n,o,a)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(_e.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",n=new URLSearchParams(t);return`${e}${r}${n}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([Na],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const n={access_token:t,version:pa};t&&r.updateJoinPayload(n),r.joinedOnce&&r._isJoined()&&r._push(_e.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(n){this.log("error",`error in ${e} callback`,n)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Zi(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ts.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,n,o,a,l,d,c;if(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:Ks,this.heartbeatIntervalMs=(n=e?.heartbeatIntervalMs)!==null&&n!==void 0?n:ts.HEARTBEAT_INTERVAL,this.worker=(o=e?.worker)!==null&&o!==void 0?o:!1,this.accessToken=(a=e?.accessToken)!==null&&a!==void 0?a:null,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e?.reconnectAfterMs)!==null&&l!==void 0?l:u=>_a[u-1]||Sa,this.encode=(d=e?.encode)!==null&&d!==void 0?d:(u,h)=>h(JSON.stringify(u)),this.decode=(c=e?.decode)!==null&&c!==void 0?c:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}class jr extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function de(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class Pa extends jr{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Qs extends jr{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ea=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};const en=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>pt(()=>Promise.resolve().then(()=>Tt),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Ta=()=>Ea(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield pt(()=>Promise.resolve().then(()=>Tt),void 0)).Response:Response}),Xs=i=>{if(Array.isArray(i))return i.map(t=>Xs(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,r])=>{const n=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[n]=Xs(r)}),e},Aa=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var ft=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};const $s=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Ia=(i,e,t)=>ft(void 0,void 0,void 0,function*(){const r=yield Ta();i instanceof r&&!t?.noResolveJson?i.json().then(n=>{const o=i.status||500,a=n?.statusCode||o+"";e(new Pa($s(n),o,a))}).catch(n=>{e(new Qs($s(n),n))}):e(new Qs($s(i),i))}),$a=(i,e,t,r)=>{const n={method:i,headers:e?.headers||{}};return i==="GET"||!r?n:(Aa(r)?(n.headers=Object.assign({"Content-Type":"application/json"},e?.headers),n.body=JSON.stringify(r)):n.body=r,e?.duplex&&(n.duplex=e.duplex),Object.assign(Object.assign({},n),t))};function Kt(i,e,t,r,n,o){return ft(this,void 0,void 0,function*(){return new Promise((a,l)=>{i(t,$a(e,r,n,o)).then(d=>{if(!d.ok)throw d;return r?.noResolveJson?d:d.json()}).then(d=>a(d)).catch(d=>Ia(d,l,r))})})}function us(i,e,t,r){return ft(this,void 0,void 0,function*(){return Kt(i,"GET",e,t,r)})}function Ae(i,e,t,r,n){return ft(this,void 0,void 0,function*(){return Kt(i,"POST",e,r,n,t)})}function er(i,e,t,r,n){return ft(this,void 0,void 0,function*(){return Kt(i,"PUT",e,r,n,t)})}function Ra(i,e,t,r){return ft(this,void 0,void 0,function*(){return Kt(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function tn(i,e,t,r,n){return ft(this,void 0,void 0,function*(){return Kt(i,"DELETE",e,r,n,t)})}var fe=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};const Oa={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},ei={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class La{constructor(e,t={},r,n){this.url=e,this.headers=t,this.bucketId=r,this.fetch=en(n)}uploadOrUpdate(e,t,r,n){return fe(this,void 0,void 0,function*(){try{let o;const a=Object.assign(Object.assign({},ei),n);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const d=a.metadata;typeof Blob<"u"&&r instanceof Blob?(o=new FormData,o.append("cacheControl",a.cacheControl),d&&o.append("metadata",this.encodeMetadata(d)),o.append("",r)):typeof FormData<"u"&&r instanceof FormData?(o=r,o.append("cacheControl",a.cacheControl),d&&o.append("metadata",this.encodeMetadata(d))):(o=r,l["cache-control"]=`max-age=${a.cacheControl}`,l["content-type"]=a.contentType,d&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(d)))),n?.headers&&(l=Object.assign(Object.assign({},l),n.headers));const c=this._removeEmptyFolders(t),u=this._getFinalPath(c),h=yield(e=="PUT"?er:Ae)(this.fetch,`${this.url}/object/${u}`,o,Object.assign({headers:l},a?.duplex?{duplex:a.duplex}:{}));return{data:{path:c,id:h.Id,fullPath:h.Key},error:null}}catch(o){if(de(o))return{data:null,error:o};throw o}})}upload(e,t,r){return fe(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,n){return fe(this,void 0,void 0,function*(){const o=this._removeEmptyFolders(e),a=this._getFinalPath(o),l=new URL(this.url+`/object/upload/sign/${a}`);l.searchParams.set("token",t);try{let d;const c=Object.assign({upsert:ei.upsert},n),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(d=new FormData,d.append("cacheControl",c.cacheControl),d.append("",r)):typeof FormData<"u"&&r instanceof FormData?(d=r,d.append("cacheControl",c.cacheControl)):(d=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);const h=yield er(this.fetch,l.toString(),d,{headers:u});return{data:{path:o,fullPath:h.Key},error:null}}catch(d){if(de(d))return{data:null,error:d};throw d}})}createSignedUploadUrl(e,t){return fe(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");const o=yield Ae(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:n}),a=new URL(this.url+o.url),l=a.searchParams.get("token");if(!l)throw new jr("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:l},error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}update(e,t,r){return fe(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return fe(this,void 0,void 0,function*(){try{return{data:yield Ae(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}})}copy(e,t,r){return fe(this,void 0,void 0,function*(){try{return{data:{path:(yield Ae(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}})}createSignedUrl(e,t,r){return fe(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e),o=yield Ae(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},r?.transform?{transform:r.transform}:{}),{headers:this.headers});const a=r?.download?`&download=${r.download===!0?"":r.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${a}`)},{data:o,error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}})}createSignedUrls(e,t,r){return fe(this,void 0,void 0,function*(){try{const n=yield Ae(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),o=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${o}`):null})),error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}})}download(e,t){return fe(this,void 0,void 0,function*(){const n=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),a=o?`?${o}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield us(this.fetch,`${this.url}/${n}/${l}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(de(l))return{data:null,error:l};throw l}})}info(e){return fe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield us(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Xs(r),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}exists(e){return fe(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ra(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(de(r)&&r instanceof Qs){const n=r.originalError;if([400,404].includes(n?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),n=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&n.push(o);const l=typeof t?.transform<"u"?"render/image":"object",d=this.transformOptsToQueryString(t?.transform||{});d!==""&&n.push(d);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${c}`)}}}remove(e){return fe(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}list(e,t,r){return fe(this,void 0,void 0,function*(){try{const n=Object.assign(Object.assign(Object.assign({},Oa),t),{prefix:e||""});return{data:yield Ae(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},r),error:null}}catch(n){if(de(n))return{data:null,error:n};throw n}})}listV2(e,t){return fe(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield Ae(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const za="2.11.0",Da={"X-Client-Info":`storage-js/${za}`};var bt=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};class Ua{constructor(e,t={},r,n){const o=new URL(e);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},Da),t),this.fetch=en(r)}listBuckets(){return bt(this,void 0,void 0,function*(){try{return{data:yield us(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(de(e))return{data:null,error:e};throw e}})}getBucket(e){return bt(this,void 0,void 0,function*(){try{return{data:yield us(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return bt(this,void 0,void 0,function*(){try{return{data:yield Ae(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return bt(this,void 0,void 0,function*(){try{return{data:yield er(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(de(r))return{data:null,error:r};throw r}})}emptyBucket(e){return bt(this,void 0,void 0,function*(){try{return{data:yield Ae(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}deleteBucket(e){return bt(this,void 0,void 0,function*(){try{return{data:yield tn(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(de(t))return{data:null,error:t};throw t}})}}class Ma extends Ua{constructor(e,t={},r,n){super(e,t,r,n)}from(e){return new La(this.url,this.headers,e,this.fetch)}}const Fa="2.55.0";let zt="";typeof Deno<"u"?zt="deno":typeof document<"u"?zt="web":typeof navigator<"u"&&navigator.product==="ReactNative"?zt="react-native":zt="node";const Ba={"X-Client-Info":`supabase-js-${zt}/${Fa}`},Wa={headers:Ba},Ha={schema:"public"},Va={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},qa={};var Ga=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};const Ja=i=>{let e;return i?e=i:typeof fetch>"u"?e=Mi:e=fetch,(...t)=>e(...t)},Ka=()=>typeof Headers>"u"?Fi:Headers,Ya=(i,e,t)=>{const r=Ja(t),n=Ka();return(o,a)=>Ga(void 0,void 0,void 0,function*(){var l;const d=(l=yield e())!==null&&l!==void 0?l:i;let c=new n(a?.headers);return c.has("apikey")||c.set("apikey",i),c.has("Authorization")||c.set("Authorization",`Bearer ${d}`),r(o,Object.assign(Object.assign({},a),{headers:c}))})};var Za=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};function Qa(i){return i.endsWith("/")?i:i+"/"}function Xa(i,e){var t,r;const{db:n,auth:o,realtime:a,global:l}=i,{db:d,auth:c,realtime:u,global:h}=e,f={db:Object.assign(Object.assign({},d),n),auth:Object.assign(Object.assign({},c),o),realtime:Object.assign(Object.assign({},u),a),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h?.headers)!==null&&t!==void 0?t:{}),(r=l?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Za(this,void 0,void 0,function*(){return""})};return i.accessToken?f.accessToken=i.accessToken:delete f.accessToken,f}const sn="2.71.1",_t=30*1e3,tr=3,Rs=tr*_t,el="http://localhost:9999",tl="supabase.auth.token",sl={"X-Client-Info":`gotrue-js/${sn}`},sr="X-Supabase-Api-Version",rn={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},rl=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,il=10*60*1e3;class kr extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function H(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class nl extends kr{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function ol(i){return H(i)&&i.name==="AuthApiError"}class nn extends kr{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Ye extends kr{constructor(e,t,r,n){super(e,r,n),this.name=t,this.status=r}}class qe extends Ye{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function al(i){return H(i)&&i.name==="AuthSessionMissingError"}class ss extends Ye{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class rs extends Ye{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class is extends Ye{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function ll(i){return H(i)&&i.name==="AuthImplicitGrantRedirectError"}class ti extends Ye{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class rr extends Ye{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Os(i){return H(i)&&i.name==="AuthRetryableFetchError"}class si extends Ye{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class ir extends Ye{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const hs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),ri=` 	
\r=`.split(""),cl=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<ri.length;e+=1)i[ri[e].charCodeAt(0)]=-2;for(let e=0;e<hs.length;e+=1)i[hs[e].charCodeAt(0)]=e;return i})();function ii(i,e,t){if(i!==null)for(e.queue=e.queue<<8|i,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(hs[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(hs[r]),e.queuedBits-=6}}function on(i,e,t){const r=cl[i];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function ni(i){const e=[],t=a=>{e.push(String.fromCodePoint(a))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},o=a=>{hl(a,r,t)};for(let a=0;a<i.length;a+=1)on(i.charCodeAt(a),n,o);return e.join("")}function dl(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function ul(i,e){for(let t=0;t<i.length;t+=1){let r=i.charCodeAt(t);if(r>55295&&r<=56319){const n=(r-55296)*1024&65535;r=(i.charCodeAt(t+1)-56320&65535|n)+65536,t+=1}dl(r,e)}}function hl(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let r=1;r<6;r+=1)if(!(i>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function pl(i){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};for(let n=0;n<i.length;n+=1)on(i.charCodeAt(n),t,r);return new Uint8Array(e)}function fl(i){const e=[];return ul(i,t=>e.push(t)),new Uint8Array(e)}function ml(i){const e=[],t={queue:0,queuedBits:0},r=n=>{e.push(n)};return i.forEach(n=>ii(n,t,r)),ii(null,t,r),e.join("")}function gl(i){return Math.round(Date.now()/1e3)+i}function xl(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const ke=()=>typeof window<"u"&&typeof document<"u",Xe={tested:!1,writable:!1},an=()=>{if(!ke())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Xe.tested)return Xe.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Xe.tested=!0,Xe.writable=!0}catch{Xe.tested=!0,Xe.writable=!1}return Xe.writable};function yl(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((n,o)=>{e[o]=n})}catch{}return t.searchParams.forEach((r,n)=>{e[n]=r}),e}const ln=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>pt(()=>Promise.resolve().then(()=>Tt),void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},bl=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",St=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},et=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},We=async(i,e)=>{await i.removeItem(e)};class _s{constructor(){this.promise=new _s.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}_s.promiseConstructor=Promise;function Ls(i){const e=i.split(".");if(e.length!==3)throw new ir("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!rl.test(e[r]))throw new ir("JWT not in base64url format");return{header:JSON.parse(ni(e[0])),payload:JSON.parse(ni(e[1])),signature:pl(e[2]),raw:{header:e[0],payload:e[1]}}}async function vl(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function wl(i,e){return new Promise((r,n)=>{(async()=>{for(let o=0;o<1/0;o++)try{const a=await i(o);if(!e(o,null,a)){r(a);return}}catch(a){if(!e(o,a)){n(a);return}}})()})}function jl(i){return("0"+i.toString(16)).substr(-2)}function kl(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let n="";for(let o=0;o<56;o++)n+=t.charAt(Math.floor(Math.random()*r));return n}return crypto.getRandomValues(e),Array.from(e,jl).join("")}async function _l(i){const t=new TextEncoder().encode(i),r=await crypto.subtle.digest("SHA-256",t),n=new Uint8Array(r);return Array.from(n).map(o=>String.fromCharCode(o)).join("")}async function Sl(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await _l(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function vt(i,e,t=!1){const r=kl();let n=r;t&&(n+="/PASSWORD_RECOVERY"),await St(i,`${e}-code-verifier`,n);const o=await Sl(r);return[o,r===o?"plain":"s256"]}const Nl=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Cl(i){const e=i.headers.get(sr);if(!e||!e.match(Nl))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Pl(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function El(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Tl=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function wt(i){if(!Tl.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function zs(){const i={};return new Proxy(i,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function oi(i){return JSON.parse(JSON.stringify(i))}var Al=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};const rt=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),Il=[502,503,504];async function ai(i){var e;if(!bl(i))throw new rr(rt(i),0);if(Il.includes(i.status))throw new rr(rt(i),i.status);let t;try{t=await i.json()}catch(o){throw new nn(rt(o),o)}let r;const n=Cl(i);if(n&&n.getTime()>=rn["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new si(rt(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new qe}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,a)=>o&&typeof a=="string",!0))throw new si(rt(t),i.status,t.weak_password.reasons);throw new nl(rt(t),i.status||500,r)}const $l=(i,e,t,r)=>{const n={method:i,headers:e?.headers||{}};return i==="GET"?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),t))};async function G(i,e,t,r){var n;const o=Object.assign({},r?.headers);o[sr]||(o[sr]=rn["2024-01-01"].name),r?.jwt&&(o.Authorization=`Bearer ${r.jwt}`);const a=(n=r?.query)!==null&&n!==void 0?n:{};r?.redirectTo&&(a.redirect_to=r.redirectTo);const l=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",d=await Rl(i,e,t+l,{headers:o,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(d):{data:Object.assign({},d),error:null}}async function Rl(i,e,t,r,n,o){const a=$l(e,r,n,o);let l;try{l=await i(t,Object.assign({},a))}catch(d){throw console.error(d),new rr(rt(d),0)}if(l.ok||await ai(l),r?.noResolveJson)return l;try{return await l.json()}catch(d){await ai(d)}}function ze(i){var e;let t=null;Dl(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=gl(i.expires_in)));const r=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:r},error:null}}function li(i){const e=ze(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=i.weak_password),e}function Ge(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function Ol(i){return{data:i,error:null}}function Ll(i){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:o}=i,a=Al(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:r,redirect_to:n,verification_type:o},d=Object.assign({},a);return{data:{properties:l,user:d},error:null}}function zl(i){return i}function Dl(i){return i.access_token&&i.refresh_token&&i.expires_in}const Ds=["global","local","others"];var Ul=globalThis&&globalThis.__rest||function(i,e){var t={};for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&e.indexOf(r)<0&&(t[r]=i[r]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,r=Object.getOwnPropertySymbols(i);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(i,r[n])&&(t[r[n]]=i[r[n]]);return t};class Ml{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=ln(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Ds[0]){if(Ds.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Ds.join(", ")}`);try{return await G(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await G(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Ge})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ul(e,["options"]),n=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(n.new_email=r?.newEmail,delete n.newEmail),await G(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:n,headers:this.headers,xform:Ll,redirectTo:t?.redirectTo})}catch(t){if(H(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await G(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Ge})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,n,o,a,l,d;try{const c={nextPage:null,lastPage:0,total:0},u=await G(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(o=(n=e?.perPage)===null||n===void 0?void 0:n.toString())!==null&&o!==void 0?o:""},xform:zl});if(u.error)throw u.error;const h=await u.json(),f=(a=u.headers.get("x-total-count"))!==null&&a!==void 0?a:0,m=(d=(l=u.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&d!==void 0?d:[];return m.length>0&&(m.forEach(g=>{const x=parseInt(g.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(g.split(";")[1].split("=")[1]);c[`${y}Page`]=x}),c.total=parseInt(f)),{data:Object.assign(Object.assign({},h),c),error:null}}catch(c){if(H(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){wt(e);try{return await G(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Ge})}catch(t){if(H(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){wt(e);try{return await G(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Ge})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){wt(e);try{return await G(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Ge})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){wt(e.userId);try{const{data:t,error:r}=await G(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:n=>({data:{factors:n},error:null})});return{data:t,error:r}}catch(t){if(H(t))return{data:null,error:t};throw t}}async _deleteFactor(e){wt(e.userId),wt(e.id);try{return{data:await G(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}}function ci(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function Fl(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const jt={debug:!!(globalThis&&an()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cn extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Bl extends cn{}async function Wl(i,e,t){jt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),jt.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async n=>{if(n){jt.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,n.name);try{return await t()}finally{jt.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,n.name)}}else{if(e===0)throw jt.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new Bl(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(jt.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Fl();const Hl={url:el,storageKey:tl,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:sl,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function di(i,e,t){return await t()}const kt={};class Ft{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Ft.nextInstanceID,Ft.nextInstanceID+=1,this.instanceID>0&&ke()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const n=Object.assign(Object.assign({},Hl),e);if(this.logDebugMessages=!!n.debug,typeof n.debug=="function"&&(this.logger=n.debug),this.persistSession=n.persistSession,this.storageKey=n.storageKey,this.autoRefreshToken=n.autoRefreshToken,this.admin=new Ml({url:n.url,headers:n.headers,fetch:n.fetch}),this.url=n.url,this.headers=n.headers,this.fetch=ln(n.fetch),this.lock=n.lock||di,this.detectSessionInUrl=n.detectSessionInUrl,this.flowType=n.flowType,this.hasCustomAuthorizationHeader=n.hasCustomAuthorizationHeader,n.lock?this.lock=n.lock:ke()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=Wl:this.lock=di,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(n.storage?this.storage=n.storage:an()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=ci(this.memoryStorage)),n.userStorage&&(this.userStorage=n.userStorage)):(this.memoryStorage={},this.storage=ci(this.memoryStorage)),ke()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=kt[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){kt[this.storageKey]=Object.assign(Object.assign({},kt[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=kt[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){kt[this.storageKey]=Object.assign(Object.assign({},kt[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${sn}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=yl(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),ke()&&this.detectSessionInUrl&&r!=="none"){const{data:n,error:o}=await this._getSessionFromURL(t,r);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),ll(o)){const d=(e=o.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:o}}return await this._removeSession(),{error:o}}const{session:a,redirectType:l}=n;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return H(t)?{error:t}:{error:new nn("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,n;try{const o=await G(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(n=e?.options)===null||n===void 0?void 0:n.captchaToken}},xform:ze}),{data:a,error:l}=o;if(l||!a)return{data:{user:null,session:null},error:l};const d=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",d)),{data:{user:c,session:d},error:null}}catch(o){if(H(o))return{data:{user:null,session:null},error:o};throw o}}async signUp(e){var t,r,n;try{let o;if("email"in e){const{email:u,password:h,options:f}=e;let m=null,g=null;this.flowType==="pkce"&&([m,g]=await vt(this.storage,this.storageKey)),o=await G(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:u,password:h,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:g},xform:ze})}else if("phone"in e){const{phone:u,password:h,options:f}=e;o=await G(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:u,password:h,data:(r=f?.data)!==null&&r!==void 0?r:{},channel:(n=f?.channel)!==null&&n!==void 0?n:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:ze})}else throw new rs("You must provide either an email or phone number and a password");const{data:a,error:l}=o;if(l||!a)return{data:{user:null,session:null},error:l};const d=a.session,c=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",d)),{data:{user:c,session:d},error:null}}catch(o){if(H(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:a,options:l}=e;t=await G(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:li})}else if("phone"in e){const{phone:o,password:a,options:l}=e;t=await G(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:li})}else throw new rs("You must provide either an email or phone number and a password");const{data:r,error:n}=t;return n?{data:{user:null,session:null},error:n}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new ss}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:n})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,n,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(n=e.options)===null||n===void 0?void 0:n.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,n,o,a,l,d,c,u,h,f,m;let g,x;if("message"in e)g=e.message,x=e.signature;else{const{chain:y,wallet:v,statement:b,options:w}=e;let k;if(ke())if(typeof v=="object")k=v;else{const _=window;if("solana"in _&&typeof _.solana=="object"&&("signIn"in _.solana&&typeof _.solana.signIn=="function"||"signMessage"in _.solana&&typeof _.solana.signMessage=="function"))k=_.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof v!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");k=v}const I=new URL((t=w?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in k&&k.signIn){const _=await k.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:I.host,uri:I.href}),b?{statement:b}:null));let A;if(Array.isArray(_)&&_[0]&&typeof _[0]=="object")A=_[0];else if(_&&typeof _=="object"&&"signedMessage"in _&&"signature"in _)A=_;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in A&&"signature"in A&&(typeof A.signedMessage=="string"||A.signedMessage instanceof Uint8Array)&&A.signature instanceof Uint8Array)g=typeof A.signedMessage=="string"?A.signedMessage:new TextDecoder().decode(A.signedMessage),x=A.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in k)||typeof k.signMessage!="function"||!("publicKey"in k)||typeof k!="object"||!k.publicKey||!("toBase58"in k.publicKey)||typeof k.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");g=[`${I.host} wants you to sign in with your Solana account:`,k.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${I.href}`,`Issued At: ${(n=(r=w?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&n!==void 0?n:new Date().toISOString()}`,...!((o=w?.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((d=w?.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((h=(u=w?.signInWithSolana)===null||u===void 0?void 0:u.resources)===null||h===void 0)&&h.length?["Resources",...w.signInWithSolana.resources.map(A=>`- ${A}`)]:[]].join(`
`);const _=await k.signMessage(new TextEncoder().encode(g),"utf8");if(!_||!(_ instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");x=_}}try{const{data:y,error:v}=await G(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:g,signature:ml(x)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(m=e.options)===null||m===void 0?void 0:m.captchaToken}}:null),xform:ze});if(v)throw v;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new ss}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:v})}catch(y){if(H(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(e){const t=await et(this.storage,`${this.storageKey}-code-verifier`),[r,n]=(t??"").split("/");try{const{data:o,error:a}=await G(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:ze});if(await We(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!o||!o.session||!o.user?{data:{user:null,session:null,redirectType:null},error:new ss}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign(Object.assign({},o),{redirectType:n??null}),error:a})}catch(o){if(H(o))return{data:{user:null,session:null,redirectType:null},error:o};throw o}}async signInWithIdToken(e){try{const{options:t,provider:r,token:n,access_token:o,nonce:a}=e,l=await G(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:n,access_token:o,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:ze}),{data:d,error:c}=l;return c?{data:{user:null,session:null},error:c}:!d||!d.session||!d.user?{data:{user:null,session:null},error:new ss}:(d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),{data:d,error:c})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,n,o,a;try{if("email"in e){const{email:l,options:d}=e;let c=null,u=null;this.flowType==="pkce"&&([c,u]=await vt(this.storage,this.storageKey));const{error:h}=await G(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=d?.data)!==null&&t!==void 0?t:{},create_user:(r=d?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},code_challenge:c,code_challenge_method:u},redirectTo:d?.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:d}=e,{data:c,error:u}=await G(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(n=d?.data)!==null&&n!==void 0?n:{},create_user:(o=d?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:d?.captchaToken},channel:(a=d?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:u}}throw new rs("You must provide either an email or phone number.")}catch(l){if(H(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,r;try{let n,o;"options"in e&&(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:a,error:l}=await G(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:n,xform:ze});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");const d=a.session,c=a.user;return d?.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),{data:{user:c,session:d},error:null}}catch(n){if(H(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithSSO(e){var t,r,n;try{let o=null,a=null;return this.flowType==="pkce"&&([o,a]=await vt(this.storage,this.storageKey)),await G(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((n=e?.options)===null||n===void 0)&&n.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:a}),headers:this.headers,xform:Ol})}catch(o){if(H(o))return{data:null,error:o};throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new qe;const{error:n}=await G(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:n}})}catch(e){if(H(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:n,options:o}=e,{error:a}=await G(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}},redirectTo:o?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:r,type:n,options:o}=e,{data:a,error:l}=await G(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:n,gotrue_meta_security:{captcha_token:o?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:l}}throw new rs("You must provide either an email or phone number and a type")}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),n=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await n}catch{}})()),n}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const n=[...this.pendingInLock];await Promise.all(n),this.pendingInLock.splice(0,n.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await et(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Rs:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const a=await et(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=zs()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(d,c,u)=>(!a&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(d,c,u))})}return{data:{session:e},error:null}}const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{session:null},error:o}:{data:{session:n},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await G(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ge}):await this._useSession(async t=>{var r,n,o;const{data:a,error:l}=t;if(l)throw l;return!(!((r=a.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new qe}:await G(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(n=a.session)===null||n===void 0?void 0:n.access_token)!==null&&o!==void 0?o:void 0,xform:Ge})})}catch(t){if(H(t))return al(t)&&(await this._removeSession(),await We(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:n,error:o}=r;if(o)throw o;if(!n.session)throw new qe;const a=n.session;let l=null,d=null;this.flowType==="pkce"&&e.email!=null&&([l,d]=await vt(this.storage,this.storageKey));const{data:c,error:u}=await G(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:d}),jwt:a.access_token,xform:Ge});if(u)throw u;return a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(r){if(H(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new qe;const t=Date.now()/1e3;let r=t,n=!0,o=null;const{payload:a}=Ls(e.access_token);if(a.exp&&(r=a.exp,n=r<=t),n){const{session:l,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return{data:{user:null,session:null},error:d};if(!l)return{data:{user:null,session:null},error:null};o=l}else{const{data:l,error:d}=await this._getUser(e.access_token);if(d)throw d;o={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return{data:{user:o.user,session:o},error:null}}catch(t){if(H(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:a,error:l}=t;if(l)throw l;e=(r=a.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new qe;const{session:n,error:o}=await this._callRefreshToken(e.refresh_token);return o?{data:{user:null,session:null},error:o}:n?{data:{user:n.user,session:n},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(H(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!ke())throw new is("No browser detected.");if(e.error||e.error_description||e.error_code)throw new is(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new ti("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new is("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new ti("No code detected.");const{data:b,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const k=new URL(window.location.href);return k.searchParams.delete("code"),window.history.replaceState(window.history.state,"",k.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:n,access_token:o,refresh_token:a,expires_in:l,expires_at:d,token_type:c}=e;if(!o||!l||!a||!c)throw new is("No session defined in URL");const u=Math.round(Date.now()/1e3),h=parseInt(l);let f=u+h;d&&(f=parseInt(d));const m=f-u;m*1e3<=_t&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${h}s`);const g=f-h;u-g>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",g,f,u):u-g<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",g,f,u);const{data:x,error:y}=await this._getUser(o);if(y)throw y;const v={provider_token:r,provider_refresh_token:n,access_token:o,expires_in:h,expires_at:f,refresh_token:a,token_type:c,user:x.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(r){if(H(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await et(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:n,error:o}=t;if(o)return{error:o};const a=(r=n.session)===null||r===void 0?void 0:r.access_token;if(a){const{error:l}=await this.admin.signOut(a,e);if(l&&!(ol(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await We(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=xl(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,n;try{const{data:{session:o},error:a}=t;if(a)throw a;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let r=null,n=null;this.flowType==="pkce"&&([r,n]=await vt(this.storage,this.storageKey,!0));try{return await G(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:n,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(H(o))return{data:null,error:o};throw o}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(H(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:n}=await this._useSession(async o=>{var a,l,d,c,u;const{data:h,error:f}=o;if(f)throw f;const m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await G(this.fetch,"GET",m,{headers:this.headers,jwt:(u=(c=h.session)===null||c===void 0?void 0:c.access_token)!==null&&u!==void 0?u:void 0})});if(n)throw n;return ke()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(H(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,n;const{data:o,error:a}=t;if(a)throw a;return await G(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(n=(r=o.session)===null||r===void 0?void 0:r.access_token)!==null&&n!==void 0?n:void 0})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await wl(async n=>(n>0&&await vl(200*Math.pow(2,n-1)),this._debug(t,"refreshing attempt",n),await G(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ze})),(n,o)=>{const a=200*Math.pow(2,n);return o&&Os(o)&&Date.now()+a-r<_t})}catch(r){if(this._debug(t,"error",r),H(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),ke()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const n=await et(this.storage,this.storageKey);if(n&&this.userStorage){let a=await et(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:n.user},await St(this.userStorage,this.storageKey+"-user",a)),n.user=(e=a?.user)!==null&&e!==void 0?e:zs()}else if(n&&!n.user&&!n.user){const a=await et(this.storage,this.storageKey+"-user");a&&a?.user?(n.user=a.user,await We(this.storage,this.storageKey+"-user"),await St(this.storage,this.storageKey,n)):n.user=zs()}if(this._debug(r,"session from storage",n),!this._isValidSession(n)){this._debug(r,"session is not valid"),n!==null&&await this._removeSession();return}const o=((t=n.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Rs;if(this._debug(r,`session has${o?"":" not"} expired with margin of ${Rs}s`),o){if(this.autoRefreshToken&&n.refresh_token){const{error:a}=await this._callRefreshToken(n.refresh_token);a&&(console.error(a),Os(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(n.user&&n.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:l}=await this._getUser(n.access_token);!l&&a?.user?(n.user=a.user,await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(r,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){this._debug(r,"error",n),console.error(n);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new qe;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const n=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{this.refreshingDeferred=new _s;const{data:o,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!o.session)throw new qe;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const l={session:o.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(o){if(this._debug(n,"error",o),H(o)){const a={session:null,error:o};return Os(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(o),o}finally{this.refreshingDeferred=null,this._debug(n,"end")}}async _notifyAllSubscribers(e,t,r=!0){const n=`#_notifyAllSubscribers(${e})`;this._debug(n,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(d){o.push(d)}});if(await Promise.all(a),o.length>0){for(let l=0;l<o.length;l+=1)console.error(o[l]);throw o[0]}}finally{this._debug(n,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await St(this.userStorage,this.storageKey+"-user",{user:t.user});const n=Object.assign({},t);delete n.user;const o=oi(n);await St(this.storage,this.storageKey,o)}else{const n=oi(t);await St(this.storage,this.storageKey,n)}}async _removeSession(){this._debug("#_removeSession()"),await We(this.storage,this.storageKey),await We(this.storage,this.storageKey+"-code-verifier"),await We(this.storage,this.storageKey+"-user"),this.userStorage&&await We(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ke()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),_t);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const n=Math.floor((r.expires_at*1e3-e)/_t);this._debug("#_autoRefreshTokenTick()",`access token expires in ${n} ticks, a tick lasts ${_t}ms, refresh threshold is ${tr} ticks`),n<=tr&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof cn)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ke()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const n=[`provider=${encodeURIComponent(t)}`];if(r?.redirectTo&&n.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&n.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[o,a]=await vt(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(a)}`});n.push(l.toString())}if(r?.queryParams){const o=new URLSearchParams(r.queryParams);n.push(o.toString())}return r?.skipBrowserRedirect&&n.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${n.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;return o?{data:null,error:o}:await G(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,n;const{data:o,error:a}=t;if(a)return{data:null,error:a};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:d,error:c}=await G(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((n=d?.totp)===null||n===void 0)&&n.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),{data:d,error:null})})}catch(t){if(H(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;if(o)return{data:null,error:o};const{data:a,error:l}=await G(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:n,error:o}=t;return o?{data:null,error:o}:await G(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=n?.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(H(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=e?.factors||[],n=r.filter(a=>a.factor_type==="totp"&&a.status==="verified"),o=r.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:r,totp:n,phone:o},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:n},error:o}=e;if(o)return{data:null,error:o};if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=Ls(n.access_token);let l=null;a.aal&&(l=a.aal);let d=l;((r=(t=n.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(d="aal2");const u=a.amr||[];return{data:{currentLevel:l,nextLevel:d,currentAuthenticationMethods:u},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(l=>l.kid===e);if(r)return r;const n=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+il>n)return r;const{data:o,error:a}=await G(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=n,r=o.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:m,error:g}=await this.getSession();if(g||!m.session)return{data:null,error:g};r=m.session.access_token}const{header:n,payload:o,signature:a,raw:{header:l,payload:d}}=Ls(r);t?.allowExpired||Pl(o.exp);const c=!n.alg||n.alg.startsWith("HS")||!n.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(n.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!c){const{error:m}=await this.getUser(r);if(m)throw m;return{data:{claims:o,header:n,signature:a},error:null}}const u=El(n.alg),h=await crypto.subtle.importKey("jwk",c,u,!0,["verify"]);if(!await crypto.subtle.verify(u,h,a,fl(`${l}.${d}`)))throw new ir("Invalid JWT signature");return{data:{claims:o,header:n,signature:a},error:null}}catch(r){if(H(r))return{data:null,error:r};throw r}}}Ft.nextInstanceID=0;const Vl=Ft;class ql extends Vl{constructor(e){super(e)}}var Gl=globalThis&&globalThis.__awaiter||function(i,e,t,r){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function l(u){try{c(r.next(u))}catch(h){a(h)}}function d(u){try{c(r.throw(u))}catch(h){a(h)}}function c(u){u.done?o(u.value):n(u.value).then(l,d)}c((r=r.apply(i,e||[])).next())})};class Jl{constructor(e,t,r){var n,o,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const l=Qa(e),d=new URL(l);this.realtimeUrl=new URL("realtime/v1",d),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",d),this.storageUrl=new URL("storage/v1",d),this.functionsUrl=new URL("functions/v1",d);const c=`sb-${d.hostname.split(".")[0]}-auth-token`,u={db:Ha,realtime:qa,auth:Object.assign(Object.assign({},Va),{storageKey:c}),global:Wa},h=Xa(r??{},u);this.storageKey=(n=h.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(o=h.global.headers)!==null&&o!==void 0?o:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(f,m)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(m)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=h.auth)!==null&&a!==void 0?a:{},this.headers,h.global.fetch),this.fetch=Ya(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new da(new URL("rest/v1",d).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new Ma(this.storageUrl.href,this.headers,this.fetch,r?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new Mo(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Gl(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,storageKey:o,flowType:a,lock:l,debug:d},c,u){const h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ql({url:this.authUrl.href,headers:Object.assign(Object.assign({},h),c),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:n,flowType:a,lock:l,debug:d,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Ca(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r?.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Kl=(i,e,t)=>new Jl(i,e,t);function Yl(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const e=i.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Yl()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Zl="https://ihtnsyhknvltgrksffun.supabase.co",Ql="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlodG5zeWhrbnZsdGdya3NmZnVuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM2NzA2MzYsImV4cCI6MjA2OTI0NjYzNn0.ZmoZ5cGVHfhDwTvkmaw9LSVHm_awoyMOTyQKewr7rYo";console.log("🔧 Supabase Config Check:");console.log("URL:","✅ Present");console.log("Anon Key:","✅ Present");const R=Kl(Zl,Ql,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},db:{schema:"public"},global:{headers:{"X-Client-Info":"fanclubz-web@1.0.0"}}}),Us={signUp:async(i,e,t={})=>{try{const{data:r,error:n}=await R.auth.signUp({email:i,password:e,options:{data:t,emailRedirectTo:"https://app.fanclubz.app/auth/callback"}});return n&&console.error("Auth signUp error:",n),{data:r,error:n}}catch(r){return console.error("Auth signUp exception:",r),{data:null,error:{message:r.message||"An unexpected error occurred"}}}},signIn:async(i,e)=>{try{const{data:t,error:r}=await R.auth.signInWithPassword({email:i,password:e});return r&&console.error("Auth signIn error:",r),{data:t,error:r}}catch(t){return console.error("Auth signIn exception:",t),{data:null,error:{message:t.message||"An unexpected error occurred"}}}},signOut:async()=>{try{const{error:i}=await R.auth.signOut();return i&&console.error("Auth signOut error:",i),{error:i}}catch(i){return console.error("Auth signOut exception:",i),{error:{message:i.message||"An unexpected error occurred"}}}},getCurrentUser:async()=>{try{const{data:{user:i},error:e}=await R.auth.getUser();return e&&console.error("Auth getCurrentUser error:",e),{user:i,error:e}}catch(i){return console.error("Auth getCurrentUser exception:",i),{user:null,error:{message:i.message||"An unexpected error occurred"}}}},onAuthStateChange:i=>R.auth.onAuthStateChange(i)},Yt=Ke()((i,e)=>({balances:[],transactions:[],isLoading:!1,error:null,get balance(){return e().balances.find(n=>n.currency==="USD")?.available||0},get totalBalance(){return e().balances.find(n=>n.currency==="USD")?.total||0},get reservedBalance(){return e().balances.find(n=>n.currency==="USD")?.reserved||0},initializeWallet:async()=>{console.log("🔄 Initializing wallet..."),i({isLoading:!0,error:null});try{const{data:{user:t}}=await R.auth.getUser();if(!t){console.log("⚠️ No authenticated user found"),i({balances:[],isLoading:!1,error:"User not authenticated"});return}console.log("👤 Fetching wallet for user:",t.id);const{data:r,error:n}=await R.from("wallets").select("*").eq("user_id",t.id);if(n&&n.code!=="PGRST116"){console.error("❌ Error fetching wallet data:",n),i({balances:[],isLoading:!1,error:"Failed to fetch wallet data"});return}const o=r?.map(c=>({currency:c.currency,available:Number(c.available_balance)||0,reserved:Number(c.reserved_balance)||0,total:Number(c.available_balance||0)+Number(c.reserved_balance||0)}))||[];if(o.length===0){console.log("🏦 Creating initial wallet in database");try{await R.from("wallets").insert({user_id:t.id,currency:"USD",available_balance:0,reserved_balance:0,total_deposited:0,total_withdrawn:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),o.push({currency:"USD",available:0,reserved:0,total:0}),console.log("✅ Initial wallet created in database")}catch(c){console.error("❌ Failed to create initial wallet:",c),i({balances:[],isLoading:!1,error:"Failed to create wallet"});return}}else console.log("✅ Using real wallet data from database:",o[0]);const{data:a,error:l}=await R.from("wallet_transactions").select("*").eq("user_id",t.id).order("created_at",{ascending:!1}).limit(50);l&&console.error("❌ Error fetching transaction history:",l);const d=(a||[]).map(c=>({id:c.id,type:c.type,amount:Number(c.amount),description:c.description,date:new Date(c.created_at),status:c.status,reference:c.reference,currency:c.currency,fee:c.fee?Number(c.fee):void 0,fromUser:c.from_user,toUser:c.to_user,predictionId:c.prediction_id}));i({balances:o,transactions:d,isLoading:!1,error:null}),console.log("✅ Wallet initialized successfully"),console.log("💰 Balance:",o[0]?.available||0),console.log("📊 Transactions:",d.length)}catch(t){console.error("❌ Error initializing wallet:",t),i({balances:[{currency:"USD",available:0,reserved:0,total:0}],isLoading:!1,error:"Failed to initialize wallet"})}},refreshWalletData:async()=>{await e().initializeWallet()},lockFunds:async(t,r="USD")=>{try{if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");const o=e().balances.find(c=>c.currency===r);if(!o||o.available<t)throw new Error("Insufficient funds");const a=o.available-t,l=o.reserved+t,d={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"bet_lock",amount:t,description:"Funds locked for prediction",date:new Date,status:"completed",reference:`LOCK_${Date.now()}`,currency:r,fee:0};i(c=>({balances:c.balances.map(u=>u.currency===r?{...u,available:a,reserved:l,total:a+l}:u),transactions:[d,...c.transactions],error:null})),console.log("✅ Funds locked successfully with transaction record:",t,r);try{const{data:{user:c}}=await R.auth.getUser();c&&(await R.from("wallets").upsert({user_id:c.id,currency:r,available_balance:a,reserved_balance:l,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:c.id,type:d.type,currency:d.currency,amount:d.amount,status:d.status,reference:d.reference,description:d.description,created_at:new Date().toISOString()}))}catch{console.log("⚠️ Could not update database, using local state only")}}catch(n){const o=n instanceof Error?n.message:"Failed to lock funds";throw i({error:o}),n}},addFunds:async(t,r="USD",n="Bank Transfer")=>{i({isLoading:!0,error:null});try{if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");const a=e().balances.find(u=>u.currency===r),l=(a?.available||0)+t,d=l+(a?.reserved||0),c={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"deposit",amount:t,description:`${n} Deposit`,date:new Date,status:"completed",reference:`DEP_${Date.now()}`,currency:r,fee:0};i(u=>({balances:u.balances.map(h=>h.currency===r?{...h,available:l,total:d}:h),transactions:[c,...u.transactions],isLoading:!1,error:null}));try{const{data:{user:u}}=await R.auth.getUser();u&&(await R.from("wallets").upsert({user_id:u.id,currency:r,available_balance:l,reserved_balance:a?.reserved||0,total_deposited:(a?.available||0)+t,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:u.id,type:c.type,currency:c.currency,amount:c.amount,status:c.status,reference:c.reference,description:c.description,created_at:new Date().toISOString()}),console.log("✅ Funds added and saved to database:",t,r))}catch(u){console.error("❌ Failed to save to database:",u)}return c}catch(o){const a=o instanceof Error?o.message:"Failed to add funds";throw i({isLoading:!1,error:a}),o}},withdraw:async(t,r="USD",n="Bank Account")=>{i({isLoading:!0,error:null});try{if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");const a=e().balances.find(u=>u.currency===r);if(!a||a.available<t)throw new Error("Insufficient funds");const l=a.available-t,d=l+a.reserved,c={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"withdraw",amount:t,description:`Withdrawal to ${n}`,date:new Date,status:"completed",reference:`WTH_${Date.now()}`,currency:r,fee:0};i(u=>({balances:u.balances.map(h=>h.currency===r?{...h,available:l,total:d}:h),transactions:[c,...u.transactions],isLoading:!1,error:null}));try{const{data:{user:u}}=await R.auth.getUser();u&&(await R.from("wallets").upsert({user_id:u.id,currency:r,available_balance:l,reserved_balance:a.reserved,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:u.id,type:c.type,currency:c.currency,amount:c.amount,status:c.status,reference:c.reference,description:c.description,created_at:new Date().toISOString()}))}catch(u){console.error("❌ Failed to persist withdrawal:",u)}return console.log("✅ Withdrawal successful:",t,r),c}catch(o){const a=o instanceof Error?o.message:"Failed to withdraw funds";throw i({isLoading:!1,error:a}),o}},makePrediction:async(t,r,n,o="USD")=>{i({isLoading:!0,error:null});try{if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");const l=e().balances.find(f=>f.currency===o);if(!l||l.available<t)throw new Error("Insufficient funds");const d=l.available-t,c=l.reserved+t,u=d+c,h={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"bet_lock",amount:t,description:r,date:new Date,status:"completed",reference:`PRED_${Date.now()}`,currency:o,fee:0,predictionId:n};i(f=>({balances:f.balances.map(m=>m.currency===o?{...m,available:d,reserved:c,total:u}:m),transactions:[h,...f.transactions],isLoading:!1,error:null}));try{const{data:{user:f}}=await R.auth.getUser();f&&(await R.from("wallets").upsert({user_id:f.id,currency:o,available_balance:d,reserved_balance:c,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:f.id,type:h.type,currency:h.currency,amount:h.amount,status:h.status,reference:h.reference,description:h.description,created_at:new Date().toISOString()}))}catch(f){console.error("❌ Failed to persist prediction lock:",f)}return console.log("✅ Prediction made successfully:",t,o),h}catch(a){const l=a instanceof Error?a.message:"Failed to make prediction";throw i({isLoading:!1,error:l}),a}},recordWin:async(t,r,n,o="USD")=>{i({isLoading:!0,error:null});try{const l=e().balances.find(f=>f.currency===o),d=(l?.available||0)+t,c=Math.max(0,(l?.reserved||0)-t),u=d+c,h={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"win",amount:t,description:r,date:new Date,status:"completed",reference:`WIN_${Date.now()}`,currency:o,fee:0,predictionId:n};i(f=>({balances:f.balances.map(m=>m.currency===o?{...m,available:d,reserved:c,total:u}:m),transactions:[h,...f.transactions],isLoading:!1,error:null}));try{const{data:{user:f}}=await R.auth.getUser();f&&(await R.from("wallets").upsert({user_id:f.id,currency:o,available_balance:d,reserved_balance:c,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:f.id,type:"bet_release",currency:h.currency,amount:h.amount,status:h.status,reference:h.reference,description:h.description,prediction_id:n,created_at:new Date().toISOString()}))}catch(f){console.error("❌ Failed to persist win:",f)}return console.log("✅ Win recorded successfully:",t,o),h}catch(a){const l=a instanceof Error?a.message:"Failed to record win";throw i({isLoading:!1,error:l}),a}},recordLoss:async(t,r,n,o="USD")=>{i({isLoading:!0,error:null});try{const l=e().balances.find(h=>h.currency===o),d=Math.max(0,(l?.reserved||0)-t),c=(l?.available||0)+d,u={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"loss",amount:t,description:r,date:new Date,status:"completed",reference:`LOSS_${Date.now()}`,currency:o,fee:0,predictionId:n};i(h=>({balances:h.balances.map(f=>f.currency===o?{...f,reserved:d,total:c}:f),transactions:[u,...h.transactions],isLoading:!1,error:null}));try{const{data:{user:h}}=await R.auth.getUser();h&&(await R.from("wallets").upsert({user_id:h.id,currency:o,available_balance:l?.available||0,reserved_balance:d,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:h.id,type:"loss",currency:u.currency,amount:u.amount,status:u.status,reference:u.reference,description:u.description,prediction_id:n,created_at:new Date().toISOString()}))}catch(h){console.error("❌ Failed to persist loss:",h)}return console.log("✅ Loss recorded successfully:",t,o),u}catch(a){const l=a instanceof Error?a.message:"Failed to record loss";throw i({isLoading:!1,error:l}),a}},transferFunds:async(t,r,n,o="USD")=>{i({isLoading:!0,error:null});try{if(isNaN(t)||t<=0)throw new Error("Please enter a valid amount");const l=e().balances.find(h=>h.currency===o);if(!l||l.available<t)throw new Error("Insufficient funds");const d=l.available-t,c=d+l.reserved,u={id:`tx_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"transfer_out",amount:t,description:n||`Transfer to ${r}`,date:new Date,status:"completed",reference:`TRF_${Date.now()}`,currency:o,fee:0,toUser:r};i(h=>({balances:h.balances.map(f=>f.currency===o?{...f,available:d,total:c}:f),transactions:[u,...h.transactions],isLoading:!1,error:null}));try{const{data:{user:h}}=await R.auth.getUser();h&&(await R.from("wallets").upsert({user_id:h.id,currency:o,available_balance:d,reserved_balance:l.reserved,updated_at:new Date().toISOString()},{onConflict:"user_id,currency"}),await R.from("wallet_transactions").insert({user_id:h.id,type:u.type,currency:u.currency,amount:u.amount,status:u.status,reference:u.reference,description:u.description,to_user:r,created_at:new Date().toISOString()}))}catch(h){console.error("❌ Failed to persist transfer:",h)}return console.log("✅ Transfer successful:",t,o),u}catch(a){const l=a instanceof Error?a.message:"Failed to transfer funds";throw i({isLoading:!1,error:l}),a}},getBalance:(t="USD")=>e().balances.find(o=>o.currency===t)?.available||0,getTransactionHistory:t=>{let n=[...e().transactions];return t?.type&&(n=n.filter(o=>o.type===t.type)),t?.currency&&(n=n.filter(o=>o.currency===t.currency)),t?.limit&&(n=n.slice(0,t.limit)),n},clearError:()=>{i({error:null})}})),Xl=Object.freeze(Object.defineProperty({__proto__:null,useWalletStore:Yt},Symbol.toStringTag,{value:"Module"})),nr=new Map,ns=i=>{const e=nr.get(i);return e?Object.fromEntries(Object.entries(e.stores).map(([t,r])=>[t,r.getState()])):{}},ec=(i,e,t)=>{if(i===void 0)return{type:"untracked",connection:e.connect(t)};const r=nr.get(t.name);if(r)return{type:"tracked",store:i,...r};const n={connection:e.connect(t),stores:{}};return nr.set(t.name,n),{type:"tracked",store:i,...n}},tc=(i,e={})=>(t,r,n)=>{const{enabled:o,anonymousActionType:a,store:l,...d}=e;let c;try{c=(o??!1)&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!c)return i(t,r,n);const{connection:u,...h}=ec(l,c,d);let f=!0;n.setState=(x,y,v)=>{const b=t(x,y);if(!f)return b;const w=v===void 0?{type:a||"anonymous"}:typeof v=="string"?{type:v}:v;return l===void 0?(u?.send(w,r()),b):(u?.send({...w,type:`${l}/${w.type}`},{...ns(d.name),[l]:n.getState()}),b)};const m=(...x)=>{const y=f;f=!1,t(...x),f=y},g=i(n.setState,r,n);if(h.type==="untracked"?u?.init(g):(h.stores[h.store]=n,u?.init(Object.fromEntries(Object.entries(h.stores).map(([x,y])=>[x,x===h.store?g:y.getState()])))),n.dispatchFromDevtools&&typeof n.dispatch=="function"){let x=!1;const y=n.dispatch;n.dispatch=(...v)=>{y(...v)}}return u.subscribe(x=>{var y;switch(x.type){case"ACTION":if(typeof x.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Ms(x.payload,v=>{if(v.type==="__setState"){if(l===void 0){m(v.state);return}Object.keys(v.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const b=v.state[l];if(b==null)return;JSON.stringify(n.getState())!==JSON.stringify(b)&&m(b);return}n.dispatchFromDevtools&&typeof n.dispatch=="function"&&n.dispatch(v)});case"DISPATCH":switch(x.payload.type){case"RESET":return m(g),l===void 0?u?.init(n.getState()):u?.init(ns(d.name));case"COMMIT":if(l===void 0){u?.init(n.getState());return}return u?.init(ns(d.name));case"ROLLBACK":return Ms(x.state,v=>{if(l===void 0){m(v),u?.init(n.getState());return}m(v[l]),u?.init(ns(d.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Ms(x.state,v=>{if(l===void 0){m(v);return}JSON.stringify(n.getState())!==JSON.stringify(v[l])&&m(v[l])});case"IMPORT_STATE":{const{nextLiftedState:v}=x.payload,b=(y=v.computedStates.slice(-1)[0])==null?void 0:y.state;if(!b)return;m(l===void 0?b:b[l]),u?.send(null,v);return}case"PAUSE_RECORDING":return f=!f}return}}),g},sc=tc,Ms=(i,e)=>{let t;try{t=JSON.parse(i)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}t!==void 0&&e(t)};function dn(i,e){let t;try{t=i()}catch{return}return{getItem:n=>{var o;const a=d=>d===null?null:JSON.parse(d,e?.reviver),l=(o=t.getItem(n))!=null?o:null;return l instanceof Promise?l.then(a):a(l)},setItem:(n,o)=>t.setItem(n,JSON.stringify(o,e?.replacer)),removeItem:n=>t.removeItem(n)}}const Bt=i=>e=>{try{const t=i(e);return t instanceof Promise?t:{then(r){return Bt(r)(t)},catch(r){return this}}}catch(t){return{then(r){return this},catch(r){return Bt(r)(t)}}}},rc=(i,e)=>(t,r,n)=>{let o={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:y=>y,version:0,merge:(y,v)=>({...v,...y}),...e},a=!1;const l=new Set,d=new Set;let c;try{c=o.getStorage()}catch{}if(!c)return i((...y)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...y)},r,n);const u=Bt(o.serialize),h=()=>{const y=o.partialize({...r()});let v;const b=u({state:y,version:o.version}).then(w=>c.setItem(o.name,w)).catch(w=>{v=w});if(v)throw v;return b},f=n.setState;n.setState=(y,v)=>{f(y,v),h()};const m=i((...y)=>{t(...y),h()},r,n);let g;const x=()=>{var y;if(!c)return;a=!1,l.forEach(b=>b(r()));const v=((y=o.onRehydrateStorage)==null?void 0:y.call(o,r()))||void 0;return Bt(c.getItem.bind(c))(o.name).then(b=>{if(b)return o.deserialize(b)}).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==o.version){if(o.migrate)return o.migrate(b.state,b.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return b.state}).then(b=>{var w;return g=o.merge(b,(w=r())!=null?w:m),t(g,!0),h()}).then(()=>{v?.(g,void 0),a=!0,d.forEach(b=>b(g))}).catch(b=>{v?.(void 0,b)})};return n.persist={setOptions:y=>{o={...o,...y},y.getStorage&&(c=y.getStorage())},clearStorage:()=>{c?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>x(),hasHydrated:()=>a,onHydrate:y=>(l.add(y),()=>{l.delete(y)}),onFinishHydration:y=>(d.add(y),()=>{d.delete(y)})},x(),g||m},ic=(i,e)=>(t,r,n)=>{let o={storage:dn(()=>localStorage),partialize:x=>x,version:0,merge:(x,y)=>({...y,...x}),...e},a=!1;const l=new Set,d=new Set;let c=o.storage;if(!c)return i((...x)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),t(...x)},r,n);const u=()=>{const x=o.partialize({...r()});return c.setItem(o.name,{state:x,version:o.version})},h=n.setState;n.setState=(x,y)=>{h(x,y),u()};const f=i((...x)=>{t(...x),u()},r,n);n.getInitialState=()=>f;let m;const g=()=>{var x,y;if(!c)return;a=!1,l.forEach(b=>{var w;return b((w=r())!=null?w:f)});const v=((y=o.onRehydrateStorage)==null?void 0:y.call(o,(x=r())!=null?x:f))||void 0;return Bt(c.getItem.bind(c))(o.name).then(b=>{if(b)if(typeof b.version=="number"&&b.version!==o.version){if(o.migrate)return[!0,o.migrate(b.state,b.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,b.state];return[!1,void 0]}).then(b=>{var w;const[k,I]=b;if(m=o.merge(I,(w=r())!=null?w:f),t(m,!0),k)return u()}).then(()=>{v?.(m,void 0),m=r(),a=!0,d.forEach(b=>b(m))}).catch(b=>{v?.(void 0,b)})};return n.persist={setOptions:x=>{o={...o,...x},x.storage&&(c=x.storage)},clearStorage:()=>{c?.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>g(),hasHydrated:()=>a,onHydrate:x=>(l.add(x),()=>{l.delete(x)}),onFinishHydration:x=>(d.add(x),()=>{d.delete(x)})},o.skipHydration||g(),m||f},nc=(i,e)=>"getStorage"in e||"serialize"in e||"deserialize"in e?rc(i,e):ic(i,e),un=nc,_r=Ke()(un((i,e)=>({notifications:[],unreadCount:0,toasts:[],settings:{predictionOutcomes:!0,comments:!0,marketClosing:!0,payouts:!0,pushNotifications:!0,emailNotifications:!1,frequency:"immediate"},addNotification:t=>{const r={...t,id:crypto.randomUUID(),createdAt:new Date().toISOString(),read:!1};i(n=>({notifications:[r,...n.notifications],unreadCount:n.unreadCount+1})),["prediction_outcome","payout"].includes(r.type)&&e().addToast({type:"success",title:r.title,message:r.message,duration:5e3}),e().settings.pushNotifications},markAsRead:t=>{i(r=>({notifications:r.notifications.map(n=>n.id===t?{...n,read:!0}:n),unreadCount:Math.max(0,r.unreadCount-1)}))},markAllAsRead:()=>{i(t=>({notifications:t.notifications.map(r=>({...r,read:!0})),unreadCount:0}))},deleteNotification:t=>{i(r=>{const n=r.notifications.find(a=>a.id===t),o=n&&!n.read;return{notifications:r.notifications.filter(a=>a.id!==t),unreadCount:o?Math.max(0,r.unreadCount-1):r.unreadCount}})},removeNotification:t=>{e().deleteNotification(t)},clearAllNotifications:()=>{i({notifications:[],unreadCount:0})},updateSettings:t=>{i(r=>({settings:{...r.settings,...t}}))},addToast:t=>{const r={...t,id:crypto.randomUUID()};i(n=>({toasts:[...n.toasts,r]}))},removeToast:t=>{i(r=>({toasts:r.toasts.filter(n=>n.id!==t)}))},clearToasts:()=>{i({toasts:[]})},requestPermission:async()=>"Notification"in window?Notification.permission==="granted"?!0:Notification.permission!=="denied"?await Notification.requestPermission()==="granted":!1:(console.warn("This browser does not support notifications"),!1),subscribeToPush:async()=>{if(!await e().requestPermission())throw new Error("Notification permission denied");console.log("Push notifications subscribed"),i(r=>({settings:{...r.settings,pushNotifications:!0}}))},unsubscribeFromPush:async()=>{console.log("Push notifications unsubscribed"),i(t=>({settings:{...t.settings,pushNotifications:!1}}))},sendPushNotification:t=>{if(!("Notification"in window)||Notification.permission!=="granted")return;const r=new Notification(t.title,{body:t.message,icon:"/icon-192x192.png",badge:"/icon-badge.png",tag:t.id});r.onclick=()=>{window.focus(),r.close(),t.data?.predictionId&&(window.location.href=`/predictions/${t.data.predictionId}`)},setTimeout(()=>{r.close()},5e3)},notifySettlementReady:(t,r)=>{const{addNotification:n,addToast:o}=e();n({type:"settlement_ready",title:"Settlement Required",message:`"${r}" needs your validation. Tap to review the outcome.`,data:{predictionId:t,action:"validate_settlement"}}),o({type:"info",title:"⚖️ Settlement Ready",message:`Tap to validate the outcome of "${r}"`,duration:8e3})},notifySettlementCompleted:(t,r,n,o)=>{const{addNotification:a,addToast:l}=e(),d=n==="won"?`You won ${o?`$${o}`:""} on "${r}"!`:`Settlement completed for "${r}". Better luck next time!`;a({type:"settlement_completed",title:n==="won"?"You Won!":"Settlement Complete",message:d,data:{predictionId:t,outcome:n,payout:o}}),l({type:n==="won"?"success":"info",title:n==="won"?"🎉 You Won!":"📋 Settlement Complete",message:d,duration:n==="won"?1e4:6e3})},showSuccess:(t,r)=>{e().addToast({type:"success",title:r||"Success",message:t,duration:3e3})},showError:(t,r)=>{e().addToast({type:"error",title:r||"Error",message:t,duration:5e3})}}),{name:"fanclubz-notifications",partialize:i=>({notifications:i.notifications,settings:i.settings})})),tt=(i,e)=>{_r.getState().addToast({type:"success",title:e||"Success",message:i,duration:3e3})},st=(i,e)=>{_r.getState().addToast({type:"error",title:e||"Error",message:i,duration:5e3})},it=i=>{if(!i)return null;const e=i.user_metadata||{};i.app_metadata;let t="",r="",n="";if(e.full_name){const o=e.full_name.split(" ");t=o[0]||"",r=o.slice(1).join(" ")||""}else t=e.firstName||e.first_name||e.given_name||"User",r=e.lastName||e.last_name||e.family_name||"";return e.avatar_url?n=e.avatar_url:e.picture?n=e.picture:e.photo&&(n=e.photo),{id:i.id,username:e.username||e.user_name||t.toLowerCase()||"user",full_name:e.full_name||`${t} ${r}`.trim(),avatar_url:n,email:i.email||"",created_at:i.created_at||new Date().toISOString(),updated_at:i.updated_at||new Date().toISOString(),is_verified:e.is_verified||!1,displayName:e.displayName||`${t} ${r}`.trim(),avatarUrl:n,reputation:e.reputation||0,walletCurrency:e.walletCurrency||"USD"}};let ui=!1,Fs=!1,hi="",pi=0;const oe=Ke()(un((i,e)=>({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!1,lastAuthCheck:0,initializeAuth:async()=>{const t=e(),r=Date.now();if(Fs){console.log("🔄 Auth initialization already in progress, waiting...");return}if(t.initialized&&r-t.lastAuthCheck<3e4){console.log("🔄 Auth recently checked, skipping initialization");return}if(t.isAuthenticated&&t.user&&t.token&&r-t.lastAuthCheck<3e5){t.initialized||console.log("✅ Using cached auth state for:",t.user.username),i({loading:!1,initialized:!0,lastAuthCheck:r});return}if(t.loading){console.log("🔄 Auth check already in progress...");return}Fs=!0,i({loading:!0,lastAuthCheck:r});try{console.log("🔐 Initializing authentication...");const{data:{session:n},error:o}=await R.auth.getSession();if(o){console.log("⚠️ Session check error:",o.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:r});return}if(n?.user){const a=it(n.user);t.initialized||console.log("✅ Found active session for:",a?.username),i({isAuthenticated:!0,user:a,token:n.access_token,loading:!1,initialized:!0,lastAuthCheck:r})}else t.initialized||console.log("ℹ️ No active session found"),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:r})}catch(n){console.error("❌ Auth initialization error:",n.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:r})}finally{Fs=!1}},login:async(t,r)=>{i({loading:!0});try{console.log("🔑 Logging in user:",t);const{data:n,error:o}=await Us.signIn(t,r);if(o){console.error("❌ Login error:",o.message);let a="Login failed. Please check your credentials.";throw o.message.includes("Invalid login credentials")?a="Invalid email or password. Please try again.":o.message.includes("Email not confirmed")&&(a="Please check your email and click the confirmation link."),i({loading:!1}),st(a),new Error(a)}if(n.user&&n.session){const a=it(n.user);console.log("✅ Login successful for:",a?.username),i({isAuthenticated:!0,user:a,token:n.session.access_token,loading:!1,initialized:!0,lastAuthCheck:Date.now()}),tt(`Welcome back, ${a?.username}!`)}}catch(n){throw console.error("❌ Login exception:",n.message),i({loading:!1}),n}},register:async(t,r,n,o)=>{i({loading:!0});try{if(console.log("📝 Registering user:",t),r.length<6)throw new Error("Password must be at least 6 characters long");const a={data:{firstName:n,lastName:o,first_name:n,last_name:o,full_name:`${n} ${o}`}},{data:l,error:d}=await Us.signUp(t,r,a);if(d){console.error("❌ Registration error:",d.message);let c="Registration failed. Please try again.";throw d.message.includes("User already registered")?c="An account with this email already exists. Please sign in instead.":d.message.includes("Password should be at least")&&(c="Password must be at least 6 characters long."),i({loading:!1}),st(c),new Error(c)}if(l.user){const c=it(l.user);console.log("✅ Registration successful for:",c?.username),l.session?(i({isAuthenticated:!0,user:c,token:l.session.access_token,loading:!1,initialized:!0,lastAuthCheck:Date.now()}),tt(`Welcome to Fan Club Z, ${c?.username}!`)):(i({isAuthenticated:!0,user:c,token:null,loading:!1,initialized:!0,lastAuthCheck:Date.now()}),tt(`Welcome to Fan Club Z, ${c?.username}! Please check your email to verify your account.`))}}catch(a){throw console.error("❌ Registration exception:",a.message),i({loading:!1}),a}},loginWithOAuth:async t=>{i({loading:!0});try{console.log(`🔑 Starting ${t} OAuth login...`);const r=window.location.origin,n=`${r}/auth/callback`;console.log("🔗 Current origin:",r),console.log("🔗 OAuth redirect URL:",n);const{data:o,error:a}=await R.auth.signInWithOAuth({provider:t,options:{redirectTo:n,queryParams:{access_type:"offline",prompt:"consent"}}});if(a)throw console.error(`❌ ${t} OAuth error:`,a.message),i({loading:!1}),st(`${t} sign-in failed. Please try again.`),new Error(a.message);console.log(`✅ ${t} OAuth initiated, redirecting...`)}catch(r){throw console.error(`❌ ${t} OAuth exception:`,r.message),i({loading:!1}),r}},handleOAuthCallback:async()=>{try{console.log("🔄 Handling OAuth callback...");const{data:t,error:r}=await R.auth.getSession();if(r)throw console.error("❌ OAuth callback error:",r.message),st("Authentication failed. Please try again."),new Error(r.message);if(t.session?.user){const n=it(t.session.user);console.log("✅ OAuth authentication successful for:",n?.username),i({isAuthenticated:!0,user:n,token:t.session.access_token,loading:!1,initialized:!0,lastAuthCheck:Date.now()});const o="OAuth";tt(`Welcome ${n?.username}! Signed in with ${o}.`);return}else throw new Error("No user session found after OAuth callback")}catch(t){throw console.error("❌ OAuth callback exception:",t.message),i({loading:!1}),t}},logout:async()=>{i({loading:!0});try{console.log("🚪 Logging out...");const{error:t}=await Us.signOut();t&&console.error("❌ Logout error:",t.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:0}),tt("Signed out successfully")}catch(t){console.error("❌ Logout exception:",t.message),i({isAuthenticated:!1,user:null,token:null,loading:!1,initialized:!0,lastAuthCheck:0})}},updateProfile:async t=>{i({loading:!0});try{const r=e().user;if(!r)throw new Error("No user logged in");console.log("📝 Updating profile...");const{data:n,error:o}=await R.auth.updateUser({data:{full_name:t.full_name||r.full_name,username:t.username||r.username}});if(o)throw new Error(o.message);if(n.user){const a=it(n.user);i({user:a,loading:!1,lastAuthCheck:Date.now()}),tt("Profile updated successfully!")}}catch(r){throw console.error("❌ Profile update error:",r.message),i({loading:!1}),st(r.message||"Failed to update profile"),r}},uploadAvatar:async t=>{const r=e();if(!r.user)throw new Error("No user logged in");const n=r.user.id,o=t.name.split(".").pop()?.toLowerCase()||"jpg",a=`${n}/${Date.now()}.${o}`,{data:l,error:d}=await R.storage.from("avatars").upload(a,t,{cacheControl:"3600",upsert:!0,contentType:t.type});if(d)throw st("Failed to upload image."),d;const{data:c}=R.storage.from("avatars").getPublicUrl(l.path),u=c.publicUrl,{data:h,error:f}=await R.auth.updateUser({data:{avatar_url:u}});if(f)throw st("Failed to save avatar to profile."),f;const m=it(h.user);return i({user:m,lastAuthCheck:Date.now()}),tt("Profile photo updated."),u}}),{name:"fanclubz-auth-storage",storage:dn(()=>localStorage),partialize:i=>({isAuthenticated:i.isAuthenticated,user:i.user,token:i.token,initialized:i.initialized,lastAuthCheck:i.lastAuthCheck}),version:5}));typeof window<"u"&&!ui&&(ui=!0,console.log("🔧 Setting up auth state listener..."),R.auth.onAuthStateChange((i,e)=>{const t=Date.now();if(!(hi===i&&t-pi<1e3)){if(hi=i,pi=t,console.log("🔄 Auth state change:",i),i==="SIGNED_OUT")console.log("🔓 User signed out"),oe.setState({isAuthenticated:!1,user:null,token:null,lastAuthCheck:0});else if(i==="TOKEN_REFRESHED"&&e?.user){console.log("🔄 Token refreshed");const r=it(e.user);oe.setState({user:r,token:e.access_token,lastAuthCheck:t})}}}));const Sr=Ke((i,e)=>({likedPredictions:new Set,likeCounts:{},loading:!1,error:null,initializeLikes:async()=>{try{const{data:{user:t}}=await R.auth.getUser();if(!t){console.log("❌ No authenticated user, skipping like initialization");return}console.log("🔄 Initializing like store for user:",t.id);const{data:r,error:n}=await R.from("prediction_likes").select("prediction_id").eq("user_id",t.id);n&&console.error("❌ Error fetching user likes:",n);const{data:o,error:a}=await R.from("predictions").select("id, likes_count");a&&console.error("❌ Error fetching like counts:",a);const l=new Set(r?.map(c=>c.prediction_id)||[]),d=Object.fromEntries(o?.map(c=>[c.id,c.likes_count||0])||[]);i({likedPredictions:l,likeCounts:d,error:null}),console.log("✅ Like store initialized successfully:",{likedCount:l.size,totalPredictions:Object.keys(d).length,userLikes:Array.from(l)})}catch(t){console.error("❌ Error initializing likes:",t),i({error:"Failed to load likes"})}},refreshLikeCounts:async()=>{try{const{data:t,error:r}=await R.from("predictions").select("id, likes_count");if(r){console.error("Error refreshing like counts:",r);return}const n=Object.fromEntries(t?.map(o=>[o.id,o.likes_count||0])||[]);i({likeCounts:n}),console.log("✅ Like counts refreshed:",Object.keys(n).length,"predictions")}catch(t){console.error("Error refreshing like counts:",t)}},toggleLike:async t=>{const{likedPredictions:r,likeCounts:n}=e(),o=r.has(t),a=n[t]||0,l=new Set(r),d={...n};o?(l.delete(t),d[t]=Math.max(0,a-1)):(l.add(t),d[t]=a+1),i({likedPredictions:l,likeCounts:d,loading:!0});try{const{data:{user:c}}=await R.auth.getUser();if(!c)throw new Error("User not authenticated");if(o){const{error:u}=await R.from("prediction_likes").delete().eq("prediction_id",t).eq("user_id",c.id);if(u)throw u;const{error:h}=await R.from("predictions").update({likes_count:Math.max(0,a-1),updated_at:new Date().toISOString()}).eq("id",t);h&&console.error("Error updating prediction likes count:",h)}else{const{error:u}=await R.from("prediction_likes").insert({prediction_id:t,user_id:c.id,created_at:new Date().toISOString()});if(u&&!u.message.includes("duplicate"))throw u;const{error:h}=await R.from("predictions").update({likes_count:a+1,updated_at:new Date().toISOString()}).eq("id",t);h&&console.error("Error updating prediction likes count:",h)}i({loading:!1,error:null}),console.log("✅ Like toggled successfully:",{predictionId:t,wasLiked:!o})}catch(c){throw console.error("Error toggling like:",c),i({likedPredictions:r,likeCounts:n,loading:!1,error:"Failed to update like"}),c}},checkIfLiked:t=>e().likedPredictions.has(t),getLikeCount:t=>{const n=e().likeCounts[t];return n!==void 0?n:0},clearError:()=>{i({error:null})},debugLikeState:t=>{const r=e();console.log(`🔍 Debug like state for prediction ${t}:`,{isLiked:r.likedPredictions.has(t),likeCount:r.likeCounts[t]||0,allLikedPredictions:Array.from(r.likedPredictions),allLikeCounts:r.likeCounts,loading:r.loading,error:r.error})}}));function mt(){const i=window.location.hostname,e=window.location.protocol;if(console.log("🌍 Environment Detection:"),console.log("  - Hostname:",i),console.log("  - Protocol:",e),console.log("  - VITE_API_URL:","https://fan-club-z.onrender.com"),console.log("  - MODE:","production"),i==="app.fanclubz.app"||i==="fanclubz.app"||i==="www.fanclubz.app"){const t={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"production",isDevelopment:!1,isProduction:!0};return console.log("🚀 Production environment detected (single service):",t),t}if(i==="dev.fanclubz.app"){const t={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"staging",isDevelopment:!1,isProduction:!1};return console.log("🧪 Development environment detected (single service):",t),t}if(i.includes("vercel.app")){const t={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"production",isDevelopment:!1,isProduction:!0};return console.log("🚀 Vercel deployment detected, using single service:",t),t}{const t={apiUrl:"https://fan-club-z.onrender.com",socketUrl:"https://fan-club-z.onrender.com",environment:"production",isDevelopment:!1,isProduction:!0};return console.log("🔧 Using VITE_API_URL:",t),t}}function oc(){return mt().apiUrl}function ac(){const i=mt();return console.log("🔧 Socket URL configuration:",{hostname:window.location.hostname,configuredUrl:i.socketUrl,environment:i.environment,isDevelopment:i.isDevelopment,isProduction:i.isProduction}),i.socketUrl}function lc(){return mt().isDevelopment}function cc(){return mt().isProduction}const dc=Object.freeze(Object.defineProperty({__proto__:null,getApiUrl:oc,getEnvironmentConfig:mt,getSocketUrl:ac,isDevelopment:lc,isProduction:cc},Symbol.toStringTag,{value:"Module"})),Rt=mt().apiUrl,Nr=Ke()(sc((i,e)=>({commentsByPrediction:{},commentCounts:{},loading:{},errors:{},submitting:{},fetchedPredictions:new Set,lastFetched:{},initialized:!1,initialize:()=>{e().initialized||(console.log("🔧 Initializing unified comment store"),i({initialized:!0}))},initializeCommentCounts:t=>{console.log("🔧 Initializing comment counts:",t),i(r=>({commentCounts:{...r.commentCounts,...t}}))},updateCommentCount:(t,r)=>{if(!t?.trim()){console.warn("⚠️ Cannot update comment count: invalid predictionId");return}console.log(`📊 Updating comment count for ${t}: ${r}`),i(n=>({commentCounts:{...n.commentCounts,[t]:r}}))},getCommentCount:t=>{if(!t?.trim())return 0;const r=e(),n=r.commentsByPrediction[t];return n&&Array.isArray(n)?n.length:r.commentCounts[t]!==void 0?r.commentCounts[t]:0},getComments:t=>t?.trim()?e().commentsByPrediction[t]||[]:[],clearError:t=>{t?.trim()&&i(r=>({errors:{...r.errors,[t]:null}}))},fetchComments:async t=>{if(!t?.trim()){console.warn("⚠️ Cannot fetch comments: invalid predictionId");return}const r=e(),n=r.lastFetched[t],o=Date.now()-60*1e3,a=r.commentsByPrediction[t],l=Array.isArray(a)?a.length:0;if(n&&n>o&&l>0){console.log(`⚡ Using cached comments for prediction ${t} (${l} comments)`);return}if(r.loading[t]){console.log(`⏳ Already loading comments for prediction ${t}`);return}console.log(`🔍 Fetching comments for prediction ${t}`),i(d=>({loading:{...d.loading,[t]:!0},errors:{...d.errors,[t]:null}}));try{const d=await fetch(`${Rt}/api/v2/social/predictions/${t}/comments`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!d.ok)throw new Error(`API responded with ${d.status}`);const u=(await d.json()).comments||[];console.log(`✅ Loaded ${u.length} comments for prediction ${t}`),i(h=>{const f=new Set(h.fetchedPredictions);return f.add(t),{commentsByPrediction:{...h.commentsByPrediction,[t]:u},commentCounts:{...h.commentCounts,[t]:u.length},fetchedPredictions:f,lastFetched:{...h.lastFetched,[t]:Date.now()},loading:{...h.loading,[t]:!1}}})}catch(d){console.error("❌ Failed to fetch comments:",d),i(c=>({commentsByPrediction:{...c.commentsByPrediction,[t]:[]},commentCounts:{...c.commentCounts,[t]:0},loading:{...c.loading,[t]:!1},errors:{...c.errors,[t]:"Failed to load comments. Please try again later."}}))}},addComment:async(t,r,n,o)=>{if(!t?.trim())throw new Error("Cannot add comment: invalid predictionId");if(!r?.trim())throw new Error("Comment content cannot be empty");console.log(`💬 Adding comment to prediction ${t}`),i(a=>({submitting:{...a.submitting,[t]:!0},errors:{...a.errors,[t]:null}}));try{const a=await fetch(`${Rt}/api/v2/social/predictions/${t}/comments`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:r.trim(),parent_comment_id:n||null,user:o||null})});if(!a.ok)throw new Error(`API responded with ${a.status}`);const l=await a.json();i(d=>{const c=d.commentsByPrediction[t]||[];let u,h;return n?(u=c.map(f=>f.id===n?{...f,replies:[l,...f.replies||[]],replies_count:(f.replies_count||0)+1}:f),h=d.commentCounts[t]||0):(u=[l,...c],h=(d.commentCounts[t]||0)+1),{commentsByPrediction:{...d.commentsByPrediction,[t]:u},commentCounts:{...d.commentCounts,[t]:h},submitting:{...d.submitting,[t]:!1}}}),console.log(`✅ Added comment to prediction ${t}`)}catch(a){throw console.error("❌ Failed to add comment:",a),i(l=>({submitting:{...l.submitting,[t]:!1},errors:{...l.errors,[t]:"Failed to post comment. Please try again."}})),a}},toggleCommentLike:async(t,r)=>{if(!t?.trim()||!r?.trim()){console.warn("⚠️ Cannot toggle comment like: invalid parameters");return}try{i(o=>{const a=o.commentsByPrediction[r]||[],l=d=>d.id===t?{...d,is_liked:!d.is_liked,likes_count:d.is_liked?Math.max(0,d.likes_count-1):d.likes_count+1}:d.replies?{...d,replies:d.replies.map(l)}:d;return{commentsByPrediction:{...o.commentsByPrediction,[r]:a.map(l)}}}),(await fetch(`${Rt}/api/v2/social/comments/${t}/like`,{method:"POST",headers:{"Content-Type":"application/json"}})).ok?console.log("✅ Like synced with server"):console.warn("❌ Failed to sync like with server, but UI updated optimistically")}catch(n){console.error("❌ Failed to toggle like:",n)}},editComment:async(t,r,n)=>{if(!t?.trim()||!r?.trim()){console.warn("⚠️ Cannot edit comment: invalid parameters");return}if(!n?.trim()){console.warn("⚠️ Cannot edit comment: empty content");return}try{const o=await fetch(`${Rt}/api/v2/social/comments/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:n.trim()})});if(!o.ok)throw new Error(`API responded with ${o.status}`);i(a=>{const l=d=>d.id===r?{...d,content:n.trim(),is_edited:!0,updated_at:new Date().toISOString()}:d.replies?{...d,replies:d.replies.map(l)}:d;return{commentsByPrediction:{...a.commentsByPrediction,[t]:(a.commentsByPrediction[t]||[]).map(l)}}})}catch(o){throw console.error("❌ Failed to edit comment:",o),o}},deleteComment:async(t,r)=>{if(!t?.trim()||!r?.trim()){console.warn("⚠️ Cannot delete comment: invalid parameters");return}try{const n=await fetch(`${Rt}/api/v2/social/comments/${r}`,{method:"DELETE"});if(!n.ok)throw new Error(`API responded with ${n.status}`);i(o=>{let a=!1;const l=u=>{const h=[];for(const f of u){if(f.id===r){a=!0;continue}if(f.replies&&f.replies.length>0){const m=f.replies.length,g=l(f.replies),x=g.length;if(x!==m){h.push({...f,replies:g,replies_count:Math.max(0,(f.replies_count||m)-(m-x))});continue}}h.push(f)}return h},d=o.commentsByPrediction[t]||[],c=l(d);return{commentsByPrediction:{...o.commentsByPrediction,[t]:c},commentCounts:{...o.commentCounts,[t]:Math.max(0,(o.commentCounts[t]||c.length)-(a?1:0))}}})}catch(n){throw console.error("❌ Failed to delete comment:",n),n}}}),{name:"unified-comment-store",partialize:i=>({commentCounts:i.commentCounts,initialized:i.initialized})})),Cr=i=>{const e=Nr(),t=p.useMemo(()=>i?.trim()||"",[i]),r=p.useCallback(()=>t?e.fetchComments(t):(console.warn("⚠️ Cannot fetch comments: no prediction ID provided"),Promise.resolve()),[e.fetchComments,t]),n=p.useCallback((c,u,h)=>t?e.addComment(t,c,u):(console.warn("⚠️ Cannot add comment: no prediction ID provided"),Promise.resolve()),[e.addComment,t]),o=p.useCallback(c=>t?e.toggleCommentLike(c,t):(console.warn("⚠️ Cannot toggle like: no prediction ID provided"),Promise.resolve()),[e.toggleCommentLike,t]),a=p.useCallback(()=>{t&&e.clearError(t)},[e.clearError,t]),l=p.useCallback((c,u)=>t?e.editComment(t,c,u):(console.warn("⚠️ Cannot edit comment: no prediction ID provided"),Promise.resolve()),[e.editComment,t]),d=p.useCallback(c=>t?e.deleteComment(t,c):(console.warn("⚠️ Cannot delete comment: no prediction ID provided"),Promise.resolve()),[e.deleteComment,t]);return p.useMemo(()=>t?{comments:e.getComments(t),commentCount:e.getCommentCount(t),isLoading:e.loading[t]||!1,error:e.errors[t]||null,isSubmitting:e.submitting[t]||!1,fetchComments:r,addComment:n,toggleCommentLike:o,editComment:l,deleteComment:d,clearError:a}:{comments:[],commentCount:0,isLoading:!1,error:null,isSubmitting:!1,fetchComments:r,addComment:n,toggleCommentLike:o,editComment:l,deleteComment:d,clearError:a},[t,e.commentsByPrediction[t],e.commentCounts[t],e.loading[t],e.errors[t],e.submitting[t],r,n,o,l,d,a])};let uc={data:""},hc=i=>typeof window=="object"?((i?i.querySelector("#_goober"):window._goober)||Object.assign((i||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:i||uc,pc=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,fc=/\/\*[^]*?\*\/|  +/g,fi=/\n+/g,Je=(i,e)=>{let t="",r="",n="";for(let o in i){let a=i[o];o[0]=="@"?o[1]=="i"?t=o+" "+a+";":r+=o[1]=="f"?Je(a,o):o+"{"+Je(a,o[1]=="k"?"":e)+"}":typeof a=="object"?r+=Je(a,e?e.replace(/([^,])+/g,l=>o.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,d=>/&/.test(d)?d.replace(/&/g,l):l?l+" "+d:d)):o):a!=null&&(o=/^--/.test(o)?o:o.replace(/[A-Z]/g,"-$&").toLowerCase(),n+=Je.p?Je.p(o,a):o+":"+a+";")}return t+(e&&n?e+"{"+n+"}":n)+r},Oe={},hn=i=>{if(typeof i=="object"){let e="";for(let t in i)e+=t+hn(i[t]);return e}return i},mc=(i,e,t,r,n)=>{let o=hn(i),a=Oe[o]||(Oe[o]=(d=>{let c=0,u=11;for(;c<d.length;)u=101*u+d.charCodeAt(c++)>>>0;return"go"+u})(o));if(!Oe[a]){let d=o!==i?i:(c=>{let u,h,f=[{}];for(;u=pc.exec(c.replace(fc,""));)u[4]?f.shift():u[3]?(h=u[3].replace(fi," ").trim(),f.unshift(f[0][h]=f[0][h]||{})):f[0][u[1]]=u[2].replace(fi," ").trim();return f[0]})(i);Oe[a]=Je(n?{["@keyframes "+a]:d}:d,t?"":"."+a)}let l=t&&Oe.g?Oe.g:null;return t&&(Oe.g=Oe[a]),((d,c,u,h)=>{h?c.data=c.data.replace(h,d):c.data.indexOf(d)===-1&&(c.data=u?d+c.data:c.data+d)})(Oe[a],e,r,l),a},gc=(i,e,t)=>i.reduce((r,n,o)=>{let a=e[o];if(a&&a.call){let l=a(t),d=l&&l.props&&l.props.className||/^go/.test(l)&&l;a=d?"."+d:l&&typeof l=="object"?l.props?"":Je(l,""):l===!1?"":l}return r+n+(a??"")},"");function Ss(i){let e=this||{},t=i.call?i(e.p):i;return mc(t.unshift?t.raw?gc(t,[].slice.call(arguments,1),e.p):t.reduce((r,n)=>Object.assign(r,n&&n.call?n(e.p):n),{}):t,hc(e.target),e.g,e.o,e.k)}let pn,or,ar;Ss.bind({g:1});let Ue=Ss.bind({k:1});function xc(i,e,t,r){Je.p=e,pn=i,or=t,ar=r}function Ze(i,e){let t=this||{};return function(){let r=arguments;function n(o,a){let l=Object.assign({},o),d=l.className||n.className;t.p=Object.assign({theme:or&&or()},l),t.o=/ *go\d+/.test(d),l.className=Ss.apply(t,r)+(d?" "+d:""),e&&(l.ref=a);let c=i;return i[0]&&(c=l.as||i,delete l.as),ar&&c[0]&&ar(l),pn(c,l)}return e?e(n):n}}var yc=i=>typeof i=="function",ps=(i,e)=>yc(i)?i(e):i,bc=(()=>{let i=0;return()=>(++i).toString()})(),fn=(()=>{let i;return()=>{if(i===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");i=!e||e.matches}return i}})(),vc=20,Pr="default",mn=(i,e)=>{let{toastLimit:t}=i.settings;switch(e.type){case 0:return{...i,toasts:[e.toast,...i.toasts].slice(0,t)};case 1:return{...i,toasts:i.toasts.map(a=>a.id===e.toast.id?{...a,...e.toast}:a)};case 2:let{toast:r}=e;return mn(i,{type:i.toasts.find(a=>a.id===r.id)?1:0,toast:r});case 3:let{toastId:n}=e;return{...i,toasts:i.toasts.map(a=>a.id===n||n===void 0?{...a,dismissed:!0,visible:!1}:a)};case 4:return e.toastId===void 0?{...i,toasts:[]}:{...i,toasts:i.toasts.filter(a=>a.id!==e.toastId)};case 5:return{...i,pausedAt:e.time};case 6:let o=e.time-(i.pausedAt||0);return{...i,pausedAt:void 0,toasts:i.toasts.map(a=>({...a,pauseDuration:a.pauseDuration+o}))}}},ds=[],gn={toasts:[],pausedAt:void 0,settings:{toastLimit:vc}},Ie={},xn=(i,e=Pr)=>{Ie[e]=mn(Ie[e]||gn,i),ds.forEach(([t,r])=>{t===e&&r(Ie[e])})},yn=i=>Object.keys(Ie).forEach(e=>xn(i,e)),wc=i=>Object.keys(Ie).find(e=>Ie[e].toasts.some(t=>t.id===i)),Ns=(i=Pr)=>e=>{xn(e,i)},jc={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},kc=(i={},e=Pr)=>{let[t,r]=p.useState(Ie[e]||gn),n=p.useRef(Ie[e]);p.useEffect(()=>(n.current!==Ie[e]&&r(Ie[e]),ds.push([e,r]),()=>{let a=ds.findIndex(([l])=>l===e);a>-1&&ds.splice(a,1)}),[e]);let o=t.toasts.map(a=>{var l,d,c;return{...i,...i[a.type],...a,removeDelay:a.removeDelay||((l=i[a.type])==null?void 0:l.removeDelay)||i?.removeDelay,duration:a.duration||((d=i[a.type])==null?void 0:d.duration)||i?.duration||jc[a.type],style:{...i.style,...(c=i[a.type])==null?void 0:c.style,...a.style}}});return{...t,toasts:o}},_c=(i,e="blank",t)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:i,pauseDuration:0,...t,id:t?.id||bc()}),Zt=i=>(e,t)=>{let r=_c(e,i,t);return Ns(r.toasterId||wc(r.id))({type:2,toast:r}),r.id},se=(i,e)=>Zt("blank")(i,e);se.error=Zt("error");se.success=Zt("success");se.loading=Zt("loading");se.custom=Zt("custom");se.dismiss=(i,e)=>{let t={type:3,toastId:i};e?Ns(e)(t):yn(t)};se.dismissAll=i=>se.dismiss(void 0,i);se.remove=(i,e)=>{let t={type:4,toastId:i};e?Ns(e)(t):yn(t)};se.removeAll=i=>se.remove(void 0,i);se.promise=(i,e,t)=>{let r=se.loading(e.loading,{...t,...t?.loading});return typeof i=="function"&&(i=i()),i.then(n=>{let o=e.success?ps(e.success,n):void 0;return o?se.success(o,{id:r,...t,...t?.success}):se.dismiss(r),n}).catch(n=>{let o=e.error?ps(e.error,n):void 0;o?se.error(o,{id:r,...t,...t?.error}):se.dismiss(r)}),i};var Sc=1e3,Nc=(i,e="default")=>{let{toasts:t,pausedAt:r}=kc(i,e),n=p.useRef(new Map).current,o=p.useCallback((h,f=Sc)=>{if(n.has(h))return;let m=setTimeout(()=>{n.delete(h),a({type:4,toastId:h})},f);n.set(h,m)},[]);p.useEffect(()=>{if(r)return;let h=Date.now(),f=t.map(m=>{if(m.duration===1/0)return;let g=(m.duration||0)+m.pauseDuration-(h-m.createdAt);if(g<0){m.visible&&se.dismiss(m.id);return}return setTimeout(()=>se.dismiss(m.id,e),g)});return()=>{f.forEach(m=>m&&clearTimeout(m))}},[t,r,e]);let a=p.useCallback(Ns(e),[e]),l=p.useCallback(()=>{a({type:5,time:Date.now()})},[a]),d=p.useCallback((h,f)=>{a({type:1,toast:{id:h,height:f}})},[a]),c=p.useCallback(()=>{r&&a({type:6,time:Date.now()})},[r,a]),u=p.useCallback((h,f)=>{let{reverseOrder:m=!1,gutter:g=8,defaultPosition:x}=f||{},y=t.filter(w=>(w.position||x)===(h.position||x)&&w.height),v=y.findIndex(w=>w.id===h.id),b=y.filter((w,k)=>k<v&&w.visible).length;return y.filter(w=>w.visible).slice(...m?[b+1]:[0,b]).reduce((w,k)=>w+(k.height||0)+g,0)},[t]);return p.useEffect(()=>{t.forEach(h=>{if(h.dismissed)o(h.id,h.removeDelay);else{let f=n.get(h.id);f&&(clearTimeout(f),n.delete(h.id))}})},[t,o]),{toasts:t,handlers:{updateHeight:d,startPause:l,endPause:c,calculateOffset:u}}},Cc=Ue`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,Pc=Ue`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Ec=Ue`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,Tc=Ze("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${Cc} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${Pc} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${i=>i.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${Ec} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,Ac=Ue`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,Ic=Ze("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${i=>i.secondary||"#e0e0e0"};
  border-right-color: ${i=>i.primary||"#616161"};
  animation: ${Ac} 1s linear infinite;
`,$c=Ue`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,Rc=Ue`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,Oc=Ze("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${i=>i.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${$c} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${Rc} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${i=>i.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,Lc=Ze("div")`
  position: absolute;
`,zc=Ze("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,Dc=Ue`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Uc=Ze("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${Dc} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,Mc=({toast:i})=>{let{icon:e,type:t,iconTheme:r}=i;return e!==void 0?typeof e=="string"?p.createElement(Uc,null,e):e:t==="blank"?null:p.createElement(zc,null,p.createElement(Ic,{...r}),t!=="loading"&&p.createElement(Lc,null,t==="error"?p.createElement(Tc,{...r}):p.createElement(Oc,{...r})))},Fc=i=>`
0% {transform: translate3d(0,${i*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Bc=i=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${i*-150}%,-1px) scale(.6); opacity:0;}
`,Wc="0%{opacity:0;} 100%{opacity:1;}",Hc="0%{opacity:1;} 100%{opacity:0;}",Vc=Ze("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,qc=Ze("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Gc=(i,e)=>{let t=i.includes("top")?1:-1,[r,n]=fn()?[Wc,Hc]:[Fc(t),Bc(t)];return{animation:e?`${Ue(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${Ue(n)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Jc=p.memo(({toast:i,position:e,style:t,children:r})=>{let n=i.height?Gc(i.position||e||"top-center",i.visible):{opacity:0},o=p.createElement(Mc,{toast:i}),a=p.createElement(qc,{...i.ariaProps},ps(i.message,i));return p.createElement(Vc,{className:i.className,style:{...n,...t,...i.style}},typeof r=="function"?r({icon:o,message:a}):p.createElement(p.Fragment,null,o,a))});xc(p.createElement);var Kc=({id:i,className:e,style:t,onHeightUpdate:r,children:n})=>{let o=p.useCallback(a=>{if(a){let l=()=>{let d=a.getBoundingClientRect().height;r(i,d)};l(),new MutationObserver(l).observe(a,{subtree:!0,childList:!0,characterData:!0})}},[i,r]);return p.createElement("div",{ref:o,className:e,style:t},n)},Yc=(i,e)=>{let t=i.includes("top"),r=t?{top:0}:{bottom:0},n=i.includes("center")?{justifyContent:"center"}:i.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:fn()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(t?1:-1)}px)`,...r,...n}},Zc=Ss`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,os=16,Qc=({reverseOrder:i,position:e="top-center",toastOptions:t,gutter:r,children:n,toasterId:o,containerStyle:a,containerClassName:l})=>{let{toasts:d,handlers:c}=Nc(t,o);return p.createElement("div",{"data-rht-toaster":o||"",style:{position:"fixed",zIndex:9999,top:os,left:os,right:os,bottom:os,pointerEvents:"none",...a},className:l,onMouseEnter:c.startPause,onMouseLeave:c.endPause},d.map(u=>{let h=u.position||e,f=c.calculateOffset(u,{reverseOrder:i,gutter:r,defaultPosition:e}),m=Yc(h,f);return p.createElement(Kc,{id:u.id,key:u.id,onHeightUpdate:c.updateHeight,className:u.visible?Zc:"",style:m},u.type==="custom"?ps(u.message,u):n?n(u):p.createElement(Jc,{toast:u,position:h}))}))},F=se;const ot=class ot{constructor(){re(this,"scrollPositions",new Map);re(this,"currentRoute","");re(this,"scrollTimeout",null);re(this,"isNavigating",!1);re(this,"restoreTimeout",null);typeof window<"u"&&(this.currentRoute=window.location.pathname,this.setupNavigationListeners())}static getInstance(){return ot.instance||(ot.instance=new ot),ot.instance}setupNavigationListeners(){let e=window.location.pathname;new MutationObserver(()=>{const r=window.location.pathname;r!==e&&(console.log(`🔄 Route change detected: ${e} → ${r}`),this.handleRouteChange(e,r),e=r)}).observe(document.documentElement,{subtree:!0,childList:!0}),window.addEventListener("popstate",()=>{console.log("⬅️ Browser navigation detected"),this.isNavigating=!0,setTimeout(()=>{this.restoreScrollPosition(window.location.pathname),this.isNavigating=!1},100)}),window.addEventListener("beforeunload",()=>{this.saveCurrentScrollPosition()})}handleRouteChange(e,t){e!==t&&(this.saveScrollPosition(e),this.currentRoute=t,this.scheduleScrollRestore(t))}scheduleScrollRestore(e){this.restoreTimeout&&clearTimeout(this.restoreTimeout),this.restoreTimeout=window.setTimeout(()=>{this.isNavigating||this.restoreScrollPosition(e)},150)}saveScrollPosition(e){const t=e||this.currentRoute,r=this.getCurrentScrollPosition();r>50&&(this.scrollPositions.set(t,{scrollY:r,timestamp:Date.now(),route:t}),console.log(`💾 Saved scroll position for ${t}: ${r}px`))}saveCurrentScrollPosition(){this.saveScrollPosition(this.currentRoute)}restoreScrollPosition(e){const t=this.scrollPositions.get(e);return t?Date.now()-t.timestamp<10*60*1e3?(console.log(`🔄 Restoring scroll position for ${e}: ${t.scrollY}px`),this.scrollToPosition(t.scrollY,"smooth"),!0):(console.log(`⏰ Scroll position for ${e} is too old, ignoring`),this.scrollPositions.delete(e),!1):(console.log(`📍 No saved scroll position for ${e}`),!1)}getCurrentScrollPosition(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0}scrollToPosition(e,t="smooth"){try{requestAnimationFrame(()=>{window.scrollTo({top:e,left:0,behavior:t}),t==="smooth"&&setTimeout(()=>{const r=this.getCurrentScrollPosition();Math.abs(r-e)>100&&window.scrollTo(0,e)},300)})}catch(r){console.warn("Scroll API failed, using fallback:",r),window.scrollTo(0,e),document.documentElement.scrollTop=e,document.body.scrollTop=e}}scrollToTop(e={}){const{behavior:t="smooth",delay:r=0}=e;this.scrollTimeout&&window.clearTimeout(this.scrollTimeout),this.scrollTimeout=window.setTimeout(()=>{this.scrollToPosition(0,t),this.scrollTimeout=null},r)}scrollToElement(e,t={}){const{behavior:r="smooth",offset:n=0}=t;this.scrollTimeout&&window.clearTimeout(this.scrollTimeout),this.scrollTimeout=window.setTimeout(()=>{const o=document.getElementById(e);if(o){const a=o.offsetTop-n;this.scrollToPosition(a,r)}this.scrollTimeout=null},50)}clearOldPositions(){const e=Date.now(),t=10*60*1e3;for(const[r,n]of this.scrollPositions.entries())e-n.timestamp>t&&(this.scrollPositions.delete(r),console.log(`🗑️ Cleared old scroll position for ${r}`))}markNavigationAsIntentional(){this.isNavigating=!0,setTimeout(()=>{this.isNavigating=!1},500)}getDebugInfo(){return{currentRoute:this.currentRoute,savedPositions:Array.from(this.scrollPositions.entries()).map(([e,t])=>({route:e,scrollY:t.scrollY,age:Date.now()-t.timestamp})),isNavigating:this.isNavigating}}destroy(){this.scrollTimeout&&window.clearTimeout(this.scrollTimeout),this.restoreTimeout&&window.clearTimeout(this.restoreTimeout),this.scrollPositions.clear()}};re(ot,"instance");let lr=ot;const Cs=lr.getInstance(),Nt=i=>{Cs.scrollToTop(i)},ut=i=>{Cs.saveScrollPosition(i)},Et=()=>{Cs.markNavigationAsIntentional()};setInterval(()=>{Cs.clearOldPositions()},5*60*1e3);const Xc=({type:i,message:e,duration:t=5e3,onClose:r,show:n=!0})=>{const[o,a]=p.useState(n);if(p.useEffect(()=>{a(n)},[n]),p.useEffect(()=>{if(o&&t>0){const c=setTimeout(()=>{a(!1),r?.()},t);return()=>clearTimeout(c)}},[o,t,r]),!o)return null;const l=()=>{switch(i){case"success":return s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})});case"error":return s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})});case"warning":return s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"info":return s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},d=()=>{const c={position:"fixed",top:"20px",right:"20px",zIndex:9999,padding:"16px 20px",borderRadius:"16px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",gap:"12px",maxWidth:"400px",minWidth:"300px",animation:"slideIn 0.3s ease-out",border:"1px solid",backdropFilter:"blur(10px)",fontSize:"14px",fontWeight:"600",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'};switch(i){case"success":return{...c,backgroundColor:"rgba(16, 185, 129, 0.95)",color:"white",borderColor:"rgba(16, 185, 129, 0.3)"};case"error":return{...c,backgroundColor:"rgba(239, 68, 68, 0.95)",color:"white",borderColor:"rgba(239, 68, 68, 0.3)"};case"warning":return{...c,backgroundColor:"rgba(245, 158, 11, 0.95)",color:"white",borderColor:"rgba(245, 158, 11, 0.3)"};case"info":return{...c,backgroundColor:"rgba(59, 130, 246, 0.95)",color:"white",borderColor:"rgba(59, 130, 246, 0.3)"}}};return s.jsxs(s.Fragment,{children:[s.jsx("style",{children:`
          @keyframes slideIn {
            from {
              transform: translateX(100%);
              opacity: 0;
            }
            to {
              transform: translateX(0);
              opacity: 1;
            }
          }
          
          @keyframes slideOut {
            from {
              transform: translateX(0);
              opacity: 1;
            }
            to {
              transform: translateX(100%);
              opacity: 0;
            }
          }
        `}),s.jsxs("div",{style:d(),children:[s.jsx("div",{style:{flexShrink:0},children:l()}),s.jsx("div",{style:{flex:1},children:e})]})]})},bn=()=>{const{notifications:i,removeNotification:e}=_r();return s.jsx(s.Fragment,{children:i.map((t,r)=>s.jsx(Xc,{type:"info",message:t.message,duration:5e3,onClose:()=>e(t.id),show:!0},t.id))})};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ed={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const td=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),O=(i,e)=>{const t=p.forwardRef(({color:r="currentColor",size:n=24,strokeWidth:o=2,absoluteStrokeWidth:a,className:l="",children:d,...c},u)=>p.createElement("svg",{ref:u,...ed,width:n,height:n,stroke:r,strokeWidth:a?Number(o)*24/Number(n):o,className:["lucide",`lucide-${td(i)}`,l].join(" "),...c},[...e.map(([h,f])=>p.createElement(h,f)),...Array.isArray(d)?d:[d]]));return t.displayName=`${i}`,t};/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sd=O("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Er=O("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=O("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rd=O("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=O("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const id=O("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=O("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mi=O("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nd=O("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=O("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=O("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const od=O("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ht=O("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Tr=O("Compass",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76",key:"m9r19z"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wt=O("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=O("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=O("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ad=O("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ld=O("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=O("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jn=O("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=O("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cd=O("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dd=O("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ud=O("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hd=O("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=O("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pd=O("MoreHorizontal",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fd=O("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z",key:"ymcmye"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const md=O("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gd=O("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qt=O("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=O("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xd=O("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yd=O("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=O("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bd=O("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=O("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vd=O("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cr=O("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ar=O("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=O("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=O("Sparkles",[["path",{d:"m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z",key:"17u4zn"}],["path",{d:"M5 3v4",key:"bklmnn"}],["path",{d:"M19 17v4",key:"iiml17"}],["path",{d:"M3 5h4",key:"nem4j1"}],["path",{d:"M17 19h4",key:"lbex7p"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wd=O("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jd=O("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kd=O("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _d=O("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=O("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gi=O("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sd=O("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ir=O("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=O("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vt=O("Wallet",[["path",{d:"M21 12V7H5a2 2 0 0 1 0-4h14v4",key:"195gfw"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h16v-5",key:"195n9w"}],["path",{d:"M18 12a2 2 0 0 0 0 4h4v-4Z",key:"vllfpd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=O("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=O("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),at=class at{constructor(){re(this,"deferredPrompt",null);re(this,"isInstalled",!1);this.init()}static getInstance(){return at.instance||(at.instance=new at),at.instance}init(){this.registerServiceWorker(),this.checkInstallStatus(),this.setupInstallPrompt()}async registerServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register("/sw.js");console.log("Service Worker registered successfully:",e),e.addEventListener("updatefound",()=>{const t=e.installing;t&&t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&this.showUpdateAvailable()})})}catch(e){console.error("Service Worker registration failed:",e)}}checkInstallStatus(){this.isInstalled=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.deferredPrompt=e,window.dispatchEvent(new CustomEvent("pwa-installable",{detail:{canInstall:!0}}))}),window.addEventListener("appinstalled",()=>{this.isInstalled=!0,this.deferredPrompt=null,this.trackInstallation(),window.dispatchEvent(new CustomEvent("pwa-installed"))})}async promptInstall(){if(!this.deferredPrompt)return!1;try{await this.deferredPrompt.prompt();const e=await this.deferredPrompt.userChoice;return this.deferredPrompt=null,e.outcome==="accepted"}catch(e){return console.error("Install prompt failed:",e),!1}}canInstall(){return!!this.deferredPrompt&&!this.isInstalled}isAppInstalled(){return this.isInstalled}isIOSDevice(){return/iPad|iPhone|iPod/.test(navigator.userAgent)}isAndroidDevice(){return/Android/.test(navigator.userAgent)}showUpdateAvailable(){const e=new CustomEvent("pwa-update-available",{detail:{message:"A new version of Fan Club Z is available. Refresh to update.",action:()=>window.location.reload()}});window.dispatchEvent(e)}trackInstallation(){typeof window.gtag<"u"&&window.gtag("event","pwa_install",{event_category:"engagement",event_label:"app_install"})}async requestNotificationPermission(){return"Notification"in window?Notification.permission==="granted"?!0:Notification.permission==="denied"?!1:await Notification.requestPermission()==="granted":!1}async subscribeToPushNotifications(){try{const e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();if(t)return t;const r=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array({}.VITE_VAPID_PUBLIC_KEY||"")});return await this.sendSubscriptionToServer(r),r}catch(e){return console.error("Push subscription failed:",e),null}}urlBase64ToUint8Array(e){const t="=".repeat((4-e.length%4)%4),r=(e+t).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(r),o=new Uint8Array(n.length);for(let a=0;a<n.length;++a)o[a]=n.charCodeAt(a);return o}async sendSubscriptionToServer(e){try{await fetch("/api/notifications/subscribe",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.error("Failed to send subscription to server:",t)}}};re(at,"instance");let dr=at;const be=dr.getInstance(),Nd=()=>{const[i,e]=p.useState(!1),[t,r]=p.useState(!1);p.useEffect(()=>{const l=()=>{if(be.isAppInstalled()){e(!1);return}const u=be.isIOSDevice(),h=localStorage.getItem(u?"ios-install-dismissed":"pwa-banner-dismissed"),f=h?parseInt(h):0,m=(Date.now()-f)/(24*60*60*1e3),x=!h||m>(u?3:1),y=sessionStorage.getItem("pwa-banner-session-dismissed");x&&!y&&(u?setTimeout(()=>e(!0),5e3):r(be.canInstall()))},d=()=>{r(!0),localStorage.getItem("pwa-banner-dismissed")||e(!0)},c=()=>{e(!1),r(!1)};return window.addEventListener("pwa-installable",d),window.addEventListener("pwa-installed",c),l(),()=>{window.removeEventListener("pwa-installable",d),window.removeEventListener("pwa-installed",c)}},[]);const n=async()=>{be.isIOSDevice()?(window.dispatchEvent(new CustomEvent("show-ios-install")),e(!1)):(await be.promptInstall()||localStorage.setItem("pwa-banner-dismissed",Date.now().toString()),e(!1))},o=()=>{e(!1);const l=be.isIOSDevice()?"ios-install-dismissed":"pwa-banner-dismissed";localStorage.setItem(l,Date.now().toString()),sessionStorage.setItem("pwa-banner-session-dismissed","true")};if(!i)return null;const a=be.isIOSDevice();return s.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-purple-500 to-teal-600 text-white shadow-lg animate-in slide-in-from-top duration-300",children:s.jsxs("div",{className:"flex items-center justify-between px-4 py-3 max-w-md mx-auto",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:s.jsx(Sn,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-semibold text-sm",children:a?"Add to Home Screen":"Install Fan Club Z"}),s.jsx("p",{className:"text-xs text-green-100",children:a?"Get quick access and offline features":"Faster loading • Offline access • Notifications"})]})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs("button",{onClick:n,className:"bg-white text-teal-600 px-3 py-1.5 rounded-md text-sm font-medium hover:bg-teal-50 active:bg-teal-100 transition-colors flex items-center space-x-1 shadow-sm",children:[s.jsx(fs,{className:"w-4 h-4"}),s.jsx("span",{children:a?"How To":"Install"})]}),s.jsx("button",{onClick:o,className:"text-green-100 hover:text-white transition-colors p-1 rounded","aria-label":"Dismiss install banner",children:s.jsx(Re,{className:"w-5 h-5"})})]})]})})},Cd=({isOpen:i,onClose:e})=>i?s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex flex-col ios-install-modal",onClick:e,style:{zIndex:1e4},children:s.jsx("div",{className:"flex-1 flex items-center justify-center p-4 pb-24",children:s.jsxs("div",{className:"bg-white rounded-2xl w-full max-w-md shadow-2xl animate-in zoom-in-95 duration-200 flex flex-col max-h-[calc(100vh-8rem)]",onClick:t=>t.stopPropagation(),style:{zIndex:10001},children:[s.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-emerald-600 p-4 text-center text-white relative rounded-t-2xl flex-shrink-0",children:[s.jsx("button",{onClick:e,className:"absolute top-3 right-3 text-white/80 hover:text-white transition-colors p-1 rounded-full hover:bg-white/20","aria-label":"Close modal",children:s.jsx(Re,{className:"w-5 h-5"})}),s.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-white/20 rounded-full mb-3",children:s.jsx(Sn,{className:"w-6 h-6"})}),s.jsx("h2",{className:"text-lg font-bold mb-1",children:"Install Fan Club Z"}),s.jsx("p",{className:"text-green-100 text-sm",children:"Get the full app experience with offline access and notifications"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto overscroll-contain",children:s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"1"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900 mb-2 text-base",children:"Tap the Share button"}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[s.jsx(cr,{className:"w-4 h-4"}),s.jsx("span",{children:"Usually found at the bottom of Safari"})]})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"2"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900 mb-2 text-base",children:'Select "Add to Home Screen"'}),s.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-600",children:[s.jsx(Qt,{className:"w-4 h-4"}),s.jsx("span",{children:"Scroll down in the share menu to find this option"})]})]})]}),s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-blue-600 font-bold text-sm",children:"3"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("p",{className:"font-medium text-gray-900 mb-2 text-base",children:'Tap "Add" to confirm'}),s.jsx("p",{className:"text-sm text-gray-600",children:"Fan Club Z will appear on your home screen like a native app"})]})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-3 text-base",children:"Why install?"}),s.jsxs("ul",{className:"text-sm text-gray-600 space-y-2",children:[s.jsx("li",{children:"• Faster loading and smoother experience"}),s.jsx("li",{children:"• Works offline for viewing your predictions"}),s.jsx("li",{children:"• Push notifications for important updates"}),s.jsx("li",{children:"• Easy access from your home screen"})]})]}),s.jsx("div",{className:"h-4"})]})}),s.jsx("div",{className:"border-t border-gray-100 p-4 flex-shrink-0 rounded-b-2xl",children:s.jsxs("div",{className:"flex space-x-3",children:[s.jsx("button",{onClick:e,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 rounded-lg font-medium hover:bg-gray-200 transition-colors text-base",children:"Maybe Later"}),s.jsx("button",{onClick:()=>{e(),localStorage.setItem("ios-install-dismissed",Date.now().toString())},className:"flex-1 px-4 py-3 bg-emerald-600 text-white rounded-lg font-medium hover:bg-green-700 transition-colors text-base",children:"Got It!"})]})})]})})}):null,Pd=({onInstall:i,onDismiss:e})=>{const[t,r]=p.useState(!1);p.useEffect(()=>{const a=setTimeout(()=>r(!0),100);return()=>clearTimeout(a)},[]);const n=()=>{r(!1),setTimeout(i,300)},o=()=>{r(!1),setTimeout(e,300)};return s.jsx("div",{className:`
      fixed inset-x-4 top-20 max-w-sm mx-auto transition-all duration-300 ease-out pwa-install-prompt
      ${t?"opacity-100 transform translate-y-0":"opacity-0 transform -translate-y-4"}
    `,style:{zIndex:1e4},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden",children:[s.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-teal-600 p-4 text-white",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-lg flex items-center justify-center",children:s.jsx(fs,{className:"w-4 h-4"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-sm",children:"Install Fan Club Z"}),s.jsx("p",{className:"text-xs text-green-100",children:"Get the full app experience"})]})]}),s.jsx("button",{onClick:o,className:"text-green-100 hover:text-white transition-colors p-1 rounded",children:s.jsx(Re,{className:"w-4 h-4"})})]})}),s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-purple-400 to-teal-500 rounded-lg flex items-center justify-center",children:s.jsx(Cn,{className:"w-4 h-4 text-teal-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Faster Performance"}),s.jsx("p",{className:"text-xs text-gray-600",children:"Lightning-fast loading and smooth animations"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(vn,{className:"w-4 h-4 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Push Notifications"}),s.jsx("p",{className:"text-xs text-gray-600",children:"Get notified about prediction results and updates"})]})]}),s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center",children:s.jsx(Es,{className:"w-4 h-4 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:"Offline Access"}),s.jsx("p",{className:"text-xs text-gray-600",children:"View your predictions even without internet"})]})]})]}),s.jsxs("div",{className:"p-4 pt-0 flex space-x-2",children:[s.jsx("button",{onClick:o,className:"flex-1 py-2.5 px-4 text-gray-700 bg-gray-100 rounded-lg font-medium text-sm hover:bg-gray-200 transition-colors",children:"Maybe Later"}),s.jsxs("button",{onClick:n,className:"flex-1 py-2.5 px-4 bg-teal-600 text-white rounded-lg font-medium text-sm hover:bg-green-700 transition-colors flex items-center justify-center space-x-1",children:[s.jsx(fs,{className:"w-4 h-4"}),s.jsx("span",{children:"Install"})]})]})]})})},Ed=()=>{const[i,e]=p.useState(!1),[t,r]=p.useState(0);p.useEffect(()=>{let l=0;const d=["click","scroll","touchstart","keydown"],c=()=>{l++,r(l),l>=5&&!localStorage.getItem("install-prompt-shown")&&n()};return d.forEach(u=>{document.addEventListener(u,c,{passive:!0})}),()=>{d.forEach(u=>{document.removeEventListener(u,c)})}},[]);const n=()=>{if(be.isAppInstalled())return;const l=localStorage.getItem("install-prompt-dismissed"),d=l?parseInt(l):0,c=24*60*60*1e3;if(!l||Date.now()-d>c){const u=Date.now()-parseInt(localStorage.getItem("session-start")||"0"),h=localStorage.getItem("has-created-prediction"),f=localStorage.getItem("has-placed-prediction");u>3e4&&(h||f)&&(e(!0),localStorage.setItem("install-prompt-shown","true"))}},o=async()=>{be.isIOSDevice()?window.dispatchEvent(new CustomEvent("show-ios-install")):await be.promptInstall()||localStorage.setItem("install-prompt-dismissed",Date.now().toString()),e(!1)},a=()=>{e(!1),localStorage.setItem("install-prompt-dismissed",Date.now().toString())};return i?s.jsx(Pd,{onInstall:o,onDismiss:a}):null},Td=({isVisible:i,onUpdate:e,onDismiss:t})=>{const[r,n]=p.useState(!1),o=()=>{n(!0),setTimeout(t,300)},a=()=>{n(!0),setTimeout(e,200)};return!i&&!r?null:s.jsxs(s.Fragment,{children:[s.jsx("div",{className:`
        fixed inset-0 bg-black/10 backdrop-blur-sm transition-opacity duration-300 update-notification
        ${i&&!r?"opacity-100":"opacity-0"}
      `,style:{zIndex:1e4}}),s.jsx("div",{className:`
        fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 update-notification
        w-[calc(100vw-32px)] max-w-sm max-h-[90vh] overflow-y-auto
        transition-all duration-300 ease-out
        ${i&&!r?"opacity-100 scale-100":"opacity-0 scale-95"}
      `,style:{zIndex:10001},children:s.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden",children:[s.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-teal-600 p-4 text-white relative",children:[s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("div",{className:"w-10 h-10 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:s.jsx(Ht,{className:"w-5 h-5"})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("h3",{className:"font-bold text-base flex items-center space-x-2",children:[s.jsx("span",{children:"Update Available!"}),s.jsx(Es,{className:"w-4 h-4"})]}),s.jsx("p",{className:"text-sm text-green-100",children:"New features and improvements ready"})]})]}),s.jsx("button",{onClick:o,className:"absolute top-3 right-3 text-green-100 hover:text-white transition-colors p-1 rounded-full hover:bg-white/10","aria-label":"Dismiss update notification",children:s.jsx(Re,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"p-4",children:[s.jsxs("div",{className:"mb-4",children:[s.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:["🚀 ",s.jsx("strong",{children:"What's New:"})]}),s.jsxs("ul",{className:"text-sm text-gray-600 space-y-1 ml-2",children:[s.jsx("li",{children:"• Improved performance and stability"}),s.jsx("li",{children:"• Enhanced user interface"}),s.jsx("li",{children:"• Bug fixes and optimizations"})]})]}),s.jsxs("div",{className:"flex space-x-3",children:[s.jsxs("button",{onClick:a,className:"flex-[2] bg-teal-600 text-white py-3 px-4 rounded-xl font-semibold text-sm hover:bg-green-700 active:bg-green-800 transition-colors flex items-center justify-center space-x-2 shadow-lg",children:[s.jsx(Ht,{className:"w-4 h-4"}),s.jsx("span",{children:"Update Now"})]}),s.jsx("button",{onClick:o,className:"flex-1 py-3 px-4 text-gray-600 hover:text-gray-800 transition-colors text-sm font-medium hover:bg-gray-50 rounded-xl border border-gray-200",children:"Later"})]})]})]})})]})},Ad=()=>{const[i,e]=p.useState(!1),[t,r]=p.useState(!1);p.useEffect(()=>{localStorage.getItem("session-start")||localStorage.setItem("session-start",Date.now().toString());const a=()=>{e(!0)},l=f=>{r(!0)},d=()=>{setTimeout(async()=>{const f=localStorage.getItem("user-has-interacted"),m=localStorage.getItem("notification-permission-requested");if(f&&!m){const g=await be.requestNotificationPermission();localStorage.setItem("notification-permission-requested","true"),g&&await be.subscribeToPushNotifications()}},15e3)};window.addEventListener("show-ios-install",a),window.addEventListener("pwa-update-available",l);const c=()=>{localStorage.setItem("user-has-interacted","true"),d()},u=["click","scroll","touchstart"];return u.forEach(f=>{document.addEventListener(f,c,{once:!0,passive:!0})}),(()=>{const f=parseInt(localStorage.getItem("visit-count")||"0")+1;localStorage.setItem("visit-count",f.toString()),localStorage.setItem("last-visit",Date.now().toString()),f>1&&localStorage.setItem("is-returning-user","true")})(),()=>{window.removeEventListener("show-ios-install",a),window.removeEventListener("pwa-update-available",l),u.forEach(f=>{document.removeEventListener(f,c)})}},[]);const n=()=>{typeof window.gtag<"u"&&window.gtag("event","pwa_update_accepted",{event_category:"engagement",event_label:"app_update"}),window.location.reload()},o=()=>{r(!1),typeof window.gtag<"u"&&window.gtag("event","pwa_update_dismissed",{event_category:"engagement",event_label:"app_update"})};return s.jsxs(s.Fragment,{children:[s.jsx(Nd,{}),s.jsx(Ed,{}),s.jsx(Cd,{isOpen:i,onClose:()=>e(!1)}),s.jsx(Td,{isVisible:t,onUpdate:n,onDismiss:o})]})};let Id=class extends p.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("PageWrapper Error Boundary caught an error:",e,t)}render(){return this.state.hasError?s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs("div",{className:"text-center max-w-md",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Something went wrong"}),s.jsx("p",{className:"text-gray-600 mb-4",children:this.state.error?.message||"An unexpected error occurred while loading this page."}),s.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:void 0}),this.props.onRetry()},className:"bg-teal-600 text-white px-4 py-2 rounded-lg font-medium hover:bg-green-700 transition-colors",children:"Try Again"})]})}):this.props.children}};const $d=({title:i="Loading..."})=>s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-teal-500 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:i})]})}),Fe=({children:i,title:e="Loading...",fallback:t})=>{const[r,n]=ne.useState(0),o=()=>{n(a=>a+1)};return s.jsx(Id,{onRetry:o,children:s.jsx(p.Suspense,{fallback:t||s.jsx($d,{title:e}),children:s.jsx("div",{children:i},r)})})},Rd=()=>{const[i,e]=p.useState(()=>{try{const u=localStorage.getItem("fcz_onboarding_state_v3");return u?JSON.parse(u):{isActive:!1,currentStep:0,completed:!1,skipped:!1,userPreferences:{hasSeenOnboarding:!1,preferredTourStyle:"full",completedSteps:[]}}}catch{return{isActive:!1,currentStep:0,completed:!1,skipped:!1,userPreferences:{hasSeenOnboarding:!1,preferredTourStyle:"full",completedSteps:[]}}}}),[t,r]=p.useState(null),n=p.useCallback(u=>{e(h=>{const f=typeof u=="function"?u(h):u,m={...h,...f};try{localStorage.setItem("fcz_onboarding_state_v3",JSON.stringify(m))}catch(g){console.warn("Failed to save onboarding state:",g)}return m})},[]),o=p.useCallback(u=>{r(u),n({isActive:!0,currentStep:0,completed:!1,skipped:!1})},[n]),a=p.useCallback(async()=>{if(!t)return;const u=t.steps[i.currentStep];if(u?.onNext)try{await u.onNext()}catch(h){console.warn("Step onNext handler failed:",h)}n(h=>{const f=h.currentStep>=(t?.steps.length||0)-1,m=u?.id?[...h.userPreferences.completedSteps,u.id]:h.userPreferences.completedSteps;return f?{isActive:!1,completed:!0,userPreferences:{...h.userPreferences,hasSeenOnboarding:!0,completedSteps:m}}:{currentStep:h.currentStep+1,userPreferences:{...h.userPreferences,completedSteps:m}}})},[t,i.currentStep,n]),l=p.useCallback(async()=>{const u=t?.steps[i.currentStep];if(u?.onPrev)try{await u.onPrev()}catch(h){console.warn("Step onPrev handler failed:",h)}i.currentStep>0&&n(h=>({currentStep:Math.max(0,h.currentStep-1)}))},[t,i.currentStep,n]),d=p.useCallback(()=>{n(u=>({isActive:!1,skipped:!0,userPreferences:{...u.userPreferences,hasSeenOnboarding:!0,preferredTourStyle:"minimal"}}))},[n]),c=p.useCallback(()=>{try{localStorage.removeItem("fcz_onboarding_state_v3"),e({isActive:!1,currentStep:0,completed:!1,skipped:!1,userPreferences:{hasSeenOnboarding:!1,preferredTourStyle:"full",completedSteps:[]}})}catch(u){console.warn("Failed to reset onboarding state:",u)}},[]);return{state:i,config:t,startOnboarding:o,nextStep:a,prevStep:l,skipOnboarding:d,resetOnboarding:c}},Od=(i,e,t="auto")=>{const r={width:window.innerWidth,height:window.innerHeight},n={top:44,bottom:100,left:16,right:16},o=16,a={top:{x:Math.max(n.left,Math.min(i.left+(i.width-e.width)/2,r.width-e.width-n.right)),y:Math.max(n.top,i.top-e.height-o)},bottom:{x:Math.max(n.left,Math.min(i.left+(i.width-e.width)/2,r.width-e.width-n.right)),y:Math.min(r.height-e.height-n.bottom,i.bottom+o)},left:{x:Math.max(n.left,i.left-e.width-o),y:Math.max(n.top,Math.min(i.top+(i.height-e.height)/2,r.height-e.height-n.bottom))},right:{x:Math.min(r.width-e.width-n.right,i.right+o),y:Math.max(n.top,Math.min(i.top+(i.height-e.height)/2,r.height-e.height-n.bottom))},center:{x:(r.width-e.width)/2,y:(r.height-e.height)/2}};if(t!=="auto")return a[t]||a.center;const l={top:i.top-n.top,bottom:r.height-i.bottom-n.bottom,left:i.left-n.left,right:r.width-i.right-n.right},d={top:l.top>=e.height+o,bottom:l.bottom>=e.height+o,left:l.left>=e.width+o,right:l.right>=e.width+o};return d.bottom?a.bottom:d.top?a.top:d.right&&e.width<300?a.right:d.left&&e.width<300?a.left:a.center},Ld=({step:i,position:e,onNext:t,onPrev:r,onSkip:n,isFirst:o,isLast:a,stepNumber:l,totalSteps:d,canSkip:c})=>{const u=p.useCallback(()=>{console.log("Next button clicked, calling onNext"),t()},[t]),h=p.useCallback(()=>{console.log("Previous button clicked, calling onPrev"),r()},[r]),f=p.useCallback(()=>{console.log("Skip button clicked, calling onSkip"),n()},[n]);return s.jsxs(N.div,{className:"fixed bg-white rounded-2xl shadow-2xl border border-gray-100 overflow-hidden max-w-sm z-[25000]",style:{left:e.x,top:e.y,width:"min(calc(100vw - 32px), 380px)"},initial:{scale:.8,opacity:0,y:10},animate:{scale:1,opacity:1,y:0},exit:{scale:.8,opacity:0,y:10},transition:{duration:.2,ease:"easeOut"},children:[s.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-teal-600 p-4 text-white",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[i.icon&&s.jsx("div",{className:"w-6 h-6 flex items-center justify-center",children:i.icon}),s.jsx("h3",{className:"font-semibold text-lg",children:i.title})]}),c&&s.jsx("button",{onClick:f,className:"p-1 rounded-lg hover:bg-white/10 transition-colors","aria-label":"Skip tour",children:s.jsx(Re,{className:"w-5 h-5"})})]}),s.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[s.jsx("div",{className:"flex-1 bg-white/20 rounded-full h-2",children:s.jsx("div",{className:"bg-white rounded-full h-2 transition-all duration-300",style:{width:`${(l+1)/d*100}%`}})}),s.jsxs("span",{className:"text-xs font-medium",children:[l+1," of ",d]})]})]}),s.jsxs("div",{className:"p-4",children:[s.jsx("p",{className:"text-gray-700 text-sm leading-relaxed mb-4",children:i.description}),s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsxs("button",{onClick:h,disabled:o,className:"flex items-center gap-1 px-3 py-2 rounded-xl bg-gray-100 text-gray-700 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-200 transition-colors text-sm font-medium min-w-[80px] justify-center",children:[s.jsx(gt,{className:"w-4 h-4"}),"Previous"]}),s.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:d},(m,g)=>s.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${g===l?"bg-teal-500":"bg-gray-200"}`},g))}),s.jsx("button",{onClick:u,className:"flex items-center gap-1 px-4 py-2 rounded-xl bg-teal-500 text-white hover:bg-teal-600 transition-colors text-sm font-medium min-w-[80px] justify-center",children:a?s.jsxs(s.Fragment,{children:[s.jsx(Ps,{className:"w-4 h-4"}),"Finish"]}):s.jsxs(s.Fragment,{children:["Next",s.jsx(ve,{className:"w-4 h-4"})]})})]})]})]})},zd=({targetRect:i})=>{const e=p.useMemo(()=>`spotlight-${Math.random().toString(36).substr(2,9)}`,[]);if(!i)return null;const t=Math.max(i.width,i.height)/2+20,r=i.left+i.width/2,n=i.top+i.height/2;return s.jsx("div",{className:"fixed inset-0 z-[24000] pointer-events-none",children:s.jsxs("svg",{width:"100%",height:"100%",className:"absolute inset-0",children:[s.jsx("defs",{children:s.jsxs("mask",{id:e,children:[s.jsx("rect",{width:"100%",height:"100%",fill:"white"}),s.jsx("circle",{cx:r,cy:n,r:t,fill:"black"})]})}),s.jsx("rect",{width:"100%",height:"100%",fill:"rgba(0,0,0,0.7)",mask:`url(#${e})`})]})})},Dd=({isActive:i,config:e,currentStep:t,onNext:r,onPrev:n,onSkip:o})=>{const[a,l]=p.useState(null),[d,c]=p.useState(null),[u,h]=p.useState({x:0,y:0}),f=p.useRef(null),m=p.useRef(null),g=p.useRef(null),x=e?.steps[t];if(p.useEffect(()=>{if(!i||!x?.target){l(null),c(null);return}const v=()=>{try{const k=document.querySelector(`[data-tour-id="${x.target}"]`);if(k){const I=k.getBoundingClientRect();l(k),c(I),k.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}else console.warn(`Onboarding target not found: ${x.target}`),l(null),c(null)}catch(k){console.warn("Error updating target position:",k)}};g.current&&clearTimeout(g.current),g.current=setTimeout(v,x.delay||100);const b=()=>v(),w=()=>v();return window.addEventListener("resize",b),window.addEventListener("scroll",w,!0),window.addEventListener("orientationchange",b),m.current&&m.current.disconnect(),m.current=new ResizeObserver(v),()=>{g.current&&clearTimeout(g.current),window.removeEventListener("resize",b),window.removeEventListener("scroll",w,!0),window.removeEventListener("orientationchange",b),m.current&&m.current.disconnect()}},[i,x,t]),p.useEffect(()=>{if(d&&f.current){const v=new DOMRect(0,0,380,200);let b=Od(d,v,x?.placement||"auto");x?.offset&&(b={x:b.x+(x.offset.x??0),y:b.y+(x.offset.y??0)}),h(b)}},[d,x?.placement]),p.useEffect(()=>{if(i){const v=setTimeout(()=>{const b=document.querySelector("[data-onboarding-tooltip]");b&&b.focus()},100);return()=>clearTimeout(v)}},[i,t]),!i||!e||!x)return null;const y=s.jsx(xe,{mode:"wait",children:s.jsxs(N.div,{className:"fixed inset-0 z-[23000]",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[x.action==="spotlight"&&d?s.jsx(zd,{targetRect:d}):s.jsx("div",{className:"absolute inset-0 bg-black/40"}),d&&x.target&&s.jsx(N.div,{className:"absolute border-4 border-teal-400 rounded-xl pointer-events-none shadow-lg",style:{left:Math.max(0,d.left-4),top:Math.max(0,d.top-4),width:Math.min(window.innerWidth,d.width+8),height:d.height+8},initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,delay:.1}}),s.jsx("div",{ref:f,"data-onboarding-tooltip":!0,tabIndex:-1,children:s.jsx(Ld,{step:x,position:u,onNext:r,onPrev:n,onSkip:o,isFirst:t===0,isLast:t===e.steps.length-1,stepNumber:t,totalSteps:e.steps.length,canSkip:e.allowSkip!==!1})})]},`onboarding-${t}`)});return Pi.createPortal(y,document.body)},Ud=({isOpen:i,onStartTour:e,onSkip:t,onMinimalTour:r})=>{const n=p.useCallback(()=>{console.log("Welcome modal: Start Tour clicked"),e()},[e]),o=p.useCallback(()=>{console.log("Welcome modal: Quick Overview clicked"),r()},[r]),a=p.useCallback(()=>{console.log("Welcome modal: Skip clicked"),t()},[t]);return s.jsx(xe,{children:i&&s.jsxs("div",{className:"fixed inset-0 z-[26000] flex items-center justify-center p-4",children:[s.jsx(N.div,{className:"absolute inset-0 bg-black/50",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0}}),s.jsxs(N.div,{className:"relative bg-white rounded-3xl shadow-2xl overflow-hidden w-full max-w-md",initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},transition:{duration:.3,ease:"easeOut"},children:[s.jsxs("div",{className:"bg-gradient-to-br from-purple-500 via-teal-600 to-teal-600 p-6 text-white text-center relative overflow-hidden",children:[s.jsx(N.div,{className:"absolute inset-0 bg-white/10",animate:{background:["radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 50%)","radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 0%, transparent 50%)","radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 0%, transparent 50%)"]},transition:{duration:4,repeat:1/0,ease:"linear"}}),s.jsxs("div",{className:"relative z-10",children:[s.jsx(N.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,duration:.3},className:"w-16 h-16 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-4",children:s.jsx(Es,{className:"w-8 h-8"})}),s.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Welcome to Fan Club Z!"}),s.jsx("p",{className:"text-teal-100 text-sm",children:"Ready to discover the future of social predictions?"})]})]}),s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"space-y-4 mb-6",children:[s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gradient-to-r from-purple-400 to-teal-500 rounded-xl flex items-center justify-center flex-shrink-0",children:s.jsx(Tr,{className:"w-5 h-5 text-teal-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Discover Predictions"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Explore trending markets and join the community"})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center flex-shrink-0",children:s.jsx(jd,{className:"w-5 h-5 text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Make Your Predictions"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Put your knowledge to the test and earn rewards"})]})]}),s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center flex-shrink-0",children:s.jsx(Vt,{className:"w-5 h-5 text-purple-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Manage Everything"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Track your performance and manage your wallet"})]})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("button",{onClick:n,className:"w-full bg-teal-500 hover:bg-teal-600 text-white py-3 px-4 rounded-xl font-semibold transition-colors flex items-center justify-center gap-2",children:[s.jsx(gd,{className:"w-4 h-4"}),"Take the Tour"]}),s.jsx("button",{onClick:o,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 px-4 rounded-xl font-medium transition-colors",children:"Quick Overview"}),s.jsxs("button",{onClick:a,className:"w-full text-gray-500 hover:text-gray-700 py-2 px-4 rounded-xl font-medium transition-colors flex items-center justify-center gap-1",children:[s.jsx(od,{className:"w-4 h-4"}),"Skip for now"]})]})]})]})]})})},Md=p.createContext(void 0),xi=[{id:"welcome-discover",title:"Welcome to Discover",description:"This is where you'll find trending predictions and explore new markets. Scroll through the list to see all available predictions.",target:"discover-list",placement:"bottom",offset:{y:24},icon:s.jsx(Tr,{className:"w-5 h-5"}),delay:500},{id:"search-feature",title:"Search Predictions",description:"Use the search bar to find specific topics, events, or types of predictions that interest you.",target:"search-bar",placement:"bottom",icon:s.jsx(_n,{className:"w-5 h-5"})},{id:"category-filters",title:"Browse by Category",description:"Filter predictions by category - Sports, Pop Culture, Tech, Finance, and more. Find what you're passionate about.",target:"category-filters",placement:"bottom",icon:s.jsx(ad,{className:"w-5 h-5"})},{id:"create-prediction",title:"Create Your Own",description:"Ready to share your insights? Tap the plus button to create your own prediction and invite others to participate.",target:"create-fab",placement:"left",offset:{y:-100},icon:s.jsx(Qt,{className:"w-5 h-5"})},{id:"my-bets-tab",title:"Track Your Predictions",description:"View all your active predictions, ones you've created, and your completed predictions with results.",target:"tab-bets",placement:"top",offset:{y:-60},icon:s.jsx(Me,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/predictions"),await new Promise(e=>setTimeout(e,300)))}},{id:"bets-management",title:"Organize Your Activity",description:"Switch between Active (ongoing), Created (your predictions), and Completed (finished) to stay organized.",target:"bets-tabs",placement:"bottom",icon:s.jsx(rd,{className:"w-5 h-5"})},{id:"wallet-tab",title:"Manage Your Wallet",description:"Keep track of your balance, view transaction history, and manage your funds securely.",target:"tab-wallet",placement:"top",offset:{y:-40},icon:s.jsx(Vt,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/wallet"),await new Promise(e=>setTimeout(e,300)))}},{id:"wallet-balance",title:"Your Balance",description:"Your current balance is displayed here. In demo mode, you can add test funds to try out predictions.",target:"wallet-balance-card",placement:"bottom",offset:{y:40},icon:s.jsx(Vt,{className:"w-5 h-5"})},{id:"profile-tab",title:"Your Profile",description:"Access your settings, view achievements, manage notifications, and track your performance stats.",target:"tab-profile",placement:"top",offset:{y:-40},icon:s.jsx(Ir,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/profile"),await new Promise(e=>setTimeout(e,300)))}},{id:"profile-completion",title:"Complete Your Profile",description:"Take a moment to complete your profile information and adjust your preferences for the best experience.",target:"profile-card",placement:"bottom",icon:s.jsx(ms,{className:"w-5 h-5"}),onNext:async()=>{const i=window.__router_navigate;i&&(i("/"),await new Promise(e=>setTimeout(e,200)))}}],Fd=[{id:"quick-discover",title:"Discover Predictions",description:"Browse and participate in predictions from the community.",target:"tab-discover",placement:"top",icon:s.jsx(Tr,{className:"w-5 h-5"})},{id:"quick-create",title:"Create Predictions",description:"Share your insights by creating your own predictions.",target:"create-fab",placement:"left",icon:s.jsx(Qt,{className:"w-5 h-5"})},{id:"quick-track",title:"Track Progress",description:"Monitor your active and completed predictions.",target:"tab-bets",placement:"top",icon:s.jsx(Me,{className:"w-5 h-5"})},{id:"quick-wallet",title:"Manage Funds",description:"View your balance and transaction history.",target:"tab-wallet",placement:"top",icon:s.jsx(Vt,{className:"w-5 h-5"})}],Bd=()=>{try{const i=localStorage.getItem("fcz_onboarding_state_v3");return i?!JSON.parse(i).userPreferences?.hasSeenOnboarding:!0}catch{return!0}},Wd=()=>new URLSearchParams(window.location.search).get("welcome")==="1"||Bd(),Hd=({children:i})=>{const[e,t]=pe(),{state:r,config:n,startOnboarding:o,nextStep:a,prevStep:l,skipOnboarding:d,resetOnboarding:c}=Rd(),[u,h]=p.useState(!1);p.useEffect(()=>(window.__router_navigate=t,()=>{delete window.__router_navigate}),[t]),p.useEffect(()=>{const v=setTimeout(()=>{Wd()&&h(!0)},1e3);return()=>clearTimeout(v)},[]),p.useEffect(()=>{const b=new URLSearchParams(window.location.search).get("tour");b==="full"?f():b==="quick"&&m()},[e]);const f=p.useCallback(()=>{h(!1),e!=="/"&&e!=="/discover"?(t("/"),setTimeout(()=>{o({steps:xi,allowSkip:!0,showProgress:!0,persistent:!0})},500)):o({steps:xi,allowSkip:!0,showProgress:!0,persistent:!0})},[e,t,o]),m=p.useCallback(()=>{h(!1),o({steps:Fd,allowSkip:!0,showProgress:!0,persistent:!1})},[o]),g=p.useCallback(()=>{h(!1),d()},[d]),x=p.useCallback(()=>{c(),h(!0)},[c]),y={isActive:r.isActive,showWelcome:u,startFullTour:f,startQuickTour:m,skipOnboarding:g,resetOnboarding:x,hasSeenOnboarding:r.userPreferences.hasSeenOnboarding,currentStep:r.currentStep,totalSteps:n?.steps.length||0};return s.jsxs(Md.Provider,{value:y,children:[i,s.jsx(Ud,{isOpen:u,onStartTour:f,onMinimalTour:m,onSkip:g}),s.jsx(Dd,{isActive:r.isActive,config:n,currentStep:r.currentStep,onNext:a,onPrev:l,onSkip:d})]})},Vd="@fanclubz/client",qd="2.0.77",Gd="Fan Club Z React Client Application",Jd="module",Kd={dev:"vite",build:"vite build","vercel-build":"vite build",preview:"vite preview",lint:"eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0","lint:fix":"eslint . --ext ts,tsx --fix","type-check":"tsc --noEmit","generate-icons":"bash ../generate-pwa-icons.sh","pwa-audit":"lighthouse --view --chrome-flags='--headless' --only-categories=pwa http://localhost:5173","check-manifest":`node -e "console.log('Checking manifest...'); fetch('http://localhost:5173/manifest.json').then(r=>r.json()).then(console.log).catch(console.error)"`},Yd={"@fanclubz/shared":"file:../shared",react:"^18.2.0","react-dom":"^18.2.0","@supabase/supabase-js":"^2.39.1",zustand:"^4.4.7","@tanstack/react-query":"^5.14.2",wouter:"^3.0.0","framer-motion":"^10.16.16",tailwindcss:"^3.4.0","@tailwindcss/forms":"^0.5.7","@tailwindcss/typography":"^0.5.10","lucide-react":"^0.303.0","react-hot-toast":"^2.4.1","react-hook-form":"^7.48.2","@hookform/resolvers":"^3.3.2",zod:"^3.22.4","date-fns":"^3.0.6",clsx:"^2.0.0","tailwind-merge":"^2.2.0","class-variance-authority":"^0.7.0","@radix-ui/react-slot":"^1.0.2","@radix-ui/react-dialog":"^1.0.5","@radix-ui/react-dropdown-menu":"^2.0.6","@radix-ui/react-tabs":"^1.0.4","@radix-ui/react-avatar":"^1.0.4","@radix-ui/react-select":"^2.0.0","@radix-ui/react-switch":"^1.0.3","@radix-ui/react-toast":"^1.1.5","react-intersection-observer":"^9.5.3","socket.io-client":"^4.7.4"},Zd={"@typescript-eslint/eslint-plugin":"^6.16.0","@typescript-eslint/parser":"^6.16.0","@types/react":"^18.2.45","@types/react-dom":"^18.2.18","@vitejs/plugin-react":"^4.1.1",autoprefixer:"^10.4.16",eslint:"^8.56.0","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-react-refresh":"^0.4.5",postcss:"^8.4.32",typescript:"^5.3.3",vite:"^4.4.9","vite-plugin-pwa":"^0.17.4"},Qd={node:">=18.0.0",npm:">=9.0.0"},Pn={name:Vd,version:qd,description:Gd,type:Jd,scripts:Kd,dependencies:Yd,devDependencies:Zd,engines:Qd},Xd=Pn.version,eu={version:Xd,name:"Fan Club Z",description:"Social Prediction Platform",api:{url:mt().apiUrl,timeout:15e3,retries:3},frontend:{url:{}.VITE_FRONTEND_URL||"https://app.fanclubz.app"},features:{realTimeUpdates:!0,socialEngagement:!0,walletIntegration:!0,settlementSystem:!0,clubSystem:!0},limits:{maxStakeAmount:1e4,minStakeAmount:1,maxDescriptionLength:500,maxCommentLength:280},ui:{theme:{primaryColor:"#22c55e",brandColors:{green:{50:"#f0fdf4",500:"#22c55e",600:"#16a34a",700:"#15803d"}}},animations:{duration:{fast:200,normal:300,slow:500}}}},ue=()=>eu.api.url,yi={maxRetries:3,initialDelay:1e3,maxDelay:1e4,backoffFactor:2},tu=i=>new Promise(e=>setTimeout(e,i)),su=(i,e,t)=>e>=t?!1:!!(i.name==="TypeError"&&i.message.includes("Failed to fetch")||i.name==="HTTPError"&&i.status>=500||i.name==="AbortError"||i.name==="TimeoutError"),ru=(i,e)=>{const t=e.initialDelay*Math.pow(e.backoffFactor,i-1);return Math.min(t,e.maxDelay)},as=async(i,e={})=>{const{timeout:t=15e3,retryOptions:r=yi,...n}=e,o={...yi,...r};let a;for(let l=1;l<=o.maxRetries+1;l++)try{console.log(`🌐 API Request (attempt ${l}/${o.maxRetries+1}): ${i}`);const d=new AbortController,c=setTimeout(()=>d.abort(),t),u=await fetch(i,{...n,signal:d.signal,headers:{"Content-Type":"application/json",Accept:"application/json",...n.headers}});if(clearTimeout(c),!u.ok){const h=new Error(`HTTP error! status: ${u.status} ${u.statusText}`);throw h.name="HTTPError",h.status=u.status,h.response=u,h}return console.log(`✅ API Success (attempt ${l}): ${u.status} ${u.statusText}`),u}catch(d){if(a=d,console.warn(`⚠️ API Error (attempt ${l}):`,d.message),su(d,l,o.maxRetries)){const c=ru(l,o);console.log(`🔄 Retrying in ${c}ms...`),await tu(c);continue}break}throw console.error(`❌ API Failed after ${o.maxRetries+1} attempts:`,a),a},ls={get:async(i,e={})=>{const t=`${ue()}${i}`;return(await as(t,{method:"GET",...e})).json()},post:async(i,e,t={})=>{const r=`${ue()}${i}`;return(await as(r,{method:"POST",body:e?JSON.stringify(e):void 0,...t})).json()},put:async(i,e,t={})=>{const r=`${ue()}${i}`;return(await as(r,{method:"PUT",body:e?JSON.stringify(e):void 0,...t})).json()},delete:async(i,e={})=>{const t=`${ue()}${i}`;return(await as(t,{method:"DELETE",...e})).json()}},cs={predictions:[],trendingPredictions:[],userPredictions:[],createdPredictions:[],completedPredictions:[],userPredictionEntries:[],userCreatedPredictions:[],loading:!1,loadingMore:!1,error:null,initialized:!1,lastFetchTime:0,platformStats:null,statsLoading:!1,pagination:{page:1,limit:20,total:0,hasNext:!1,hasPrev:!1},filters:{category:"all",search:""}},Xt=Ke((i,e)=>({...cs,fetchPredictions:async(t={})=>{const{page:r=1,category:n=e().filters.category,search:o=e().filters.search,append:a=!1}=t,l=Date.now(),{lastFetchTime:d,predictions:c}=e();if(!a&&r===1&&l-d<3e4&&c.length>0){console.log("📋 Using cached predictions");return}const u=a&&r>1;i({[u?"loadingMore":"loading"]:!0,error:null});try{console.log(`📡 Fetching predictions: page=${r}, category=${n}, search=${o}, append=${a}`);const h=new URLSearchParams({page:r.toString(),limit:"20",...n!=="all"&&{category:n},...o.trim()&&{search:o.trim()}}),f=await ls.get(`/api/v2/predictions?${h}`,{timeout:1e4,retryOptions:{maxRetries:3}}),m=f.data||[],g=f.pagination||{};console.log(`✅ Predictions fetched successfully: ${m.length} items (${g.total} total)`),i(x=>({predictions:a?[...x.predictions,...m]:m,loading:!1,loadingMore:!1,error:null,initialized:!0,lastFetchTime:l,pagination:{page:g.page||r,limit:g.limit||20,total:g.total||0,hasNext:g.hasNext||!1,hasPrev:g.hasPrev||!1},filters:{category:n,search:o}}))}catch(h){console.error("❌ Error fetching predictions:",h),i({loading:!1,loadingMore:!1,error:h instanceof Error?h.message:"Failed to fetch predictions"})}},loadMorePredictions:async()=>{const{pagination:t,loadingMore:r}=e();if(r||!t.hasNext){console.log("📋 Load more skipped:",{loadingMore:r,hasNext:t.hasNext});return}console.log(`📋 Loading more predictions: page ${t.page+1}`),await e().fetchPredictions({page:t.page+1,append:!0})},setFilters:t=>{const n={...e().filters,...t};console.log("🔍 Setting filters:",n),i(o=>({filters:n,pagination:{...o.pagination,page:1},predictions:[]})),e().fetchPredictions({category:n.category,search:n.search})},resetPagination:()=>{console.log("🔄 Resetting pagination"),i(t=>({pagination:{...cs.pagination},filters:{...cs.filters},predictions:[]}))},refreshPredictions:async(t=!1)=>{const{lastFetchTime:r}=e(),n=Date.now();if(!t&&n-r<1e4){console.log("📋 Using cached predictions (refresh)");return}i(o=>({lastFetchTime:0,pagination:{...o.pagination,page:1},predictions:[]}));try{await e().fetchPredictions(),console.log("🔄 Predictions refreshed successfully")}catch(o){throw console.error("❌ Error refreshing predictions:",o),o}},fetchTrendingPredictions:async()=>{i({loading:!0});try{const t=await fetch(`${ue()}/api/v2/predictions/trending`);if(!t.ok)throw new Error(`Failed to fetch trending predictions: ${t.statusText}`);const n=(await t.json()).data||[];i({trendingPredictions:n,loading:!1,error:null}),console.log("✅ Trending predictions fetched:",n.length)}catch(t){console.error("❌ Error fetching trending predictions:",t),i({loading:!1,error:t instanceof Error?t.message:"Failed to fetch trending predictions"})}},fetchUserPredictions:async t=>{i({loading:!0});try{const r=await fetch(`${ue()}/api/v2/predictions/user/${t}`);if(!r.ok)throw new Error(`Failed to fetch user predictions: ${r.statusText}`);const o=(await r.json()).data||[];i({userPredictions:o,loading:!1,error:null})}catch(r){console.error("❌ Error fetching user predictions:",r),i({loading:!1,error:r instanceof Error?r.message:"Failed to fetch user predictions"})}},fetchCreatedPredictions:async t=>{i({loading:!0});try{const r=await fetch(`${ue()}/api/v2/predictions/created/${t}`);if(!r.ok)throw new Error(`Failed to fetch created predictions: ${r.statusText}`);const o=(await r.json()).data||[];i({createdPredictions:o,loading:!1,error:null})}catch(r){console.error("❌ Error fetching created predictions:",r),i({loading:!1,error:r instanceof Error?r.message:"Failed to fetch created predictions"})}},fetchPredictionById:async t=>{try{console.log(`🔍 Fetching prediction by ID: ${t}`);const{predictions:r}=e(),n=r.find(d=>d.id===t);if(n&&n.options&&n.options.length>0)return console.log("✅ Found prediction in store with options:",n.title,n.options.length),n;console.log("🌐 Fetching prediction directly from API:",t);const o=await fetch(`${ue()}/api/v2/predictions/${t}`);if(!o.ok)return console.error(`❌ Failed to fetch prediction ${t}:`,o.status),null;const l=(await o.json()).data;return l?(console.log("✅ Fetched prediction from API:",l.title),console.log("🔍 Prediction options:",l.options?.length||0),i(d=>({predictions:d.predictions.some(c=>c.id===t)?d.predictions.map(c=>c.id===t?l:c):[...d.predictions,l]})),l):n?(console.log("⚠️ Using existing prediction without options:",n.title),n):(console.log("❌ Prediction not found:",t),null)}catch(r){return console.error("❌ Error fetching prediction by ID:",r),null}},createPrediction:async t=>{i({loading:!0,error:null});try{const r=await fetch(`${ue()}/api/v2/predictions`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw new Error(`Failed to create prediction: ${r.statusText}`);const n=await r.json();if(!n.data)throw new Error("Invalid response: no prediction data returned");const o=n.data;if(!o||!o.id)throw new Error("Invalid prediction data: missing required fields");i(a=>({predictions:[o,...a.predictions],loading:!1,error:null})),setTimeout(()=>{e().fetchPredictions()},100),i(a=>({userCreatedPredictions:[o,...a.userCreatedPredictions]}));try{const{user:a}=oe.getState();a?.id&&setTimeout(()=>{e().fetchUserCreatedPredictions(a.id)},1e3)}catch(a){console.warn("⚠️ Failed to refresh user created predictions:",a)}return console.log("✅ Prediction created successfully:",o.id),o}catch(r){throw console.error("❌ Error creating prediction:",r),i({loading:!1,error:r instanceof Error?r.message:"Failed to create prediction"}),r}},placePrediction:async(t,r,n,o)=>{i({loading:!0,error:null});try{const{useWalletStore:a}=await pt(()=>Promise.resolve().then(()=>Xl),void 0),l=a.getState(),d=e().predictions.find(m=>m.id===t),u=`Bet on "${d?.options.find(m=>m.id===r)?.label||"Unknown"}" in "${d?.title||"Unknown Prediction"}"`;console.log("🔄 Locking wallet funds before prediction placement..."),await l.makePrediction(n,u,t),console.log("✅ Wallet funds locked successfully");const h=await fetch(`${ue()}/api/v2/predictions/${t}/entries`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({option_id:r,amount:n,user_id:o})});if(!h.ok)throw new Error(`Failed to place prediction: ${h.statusText}`);const f=await h.json();f.prediction?(console.log("📊 Updating prediction with server data:",{id:f.prediction.id,pool_total:f.prediction.pool_total,participant_count:f.prediction.participant_count,options:f.prediction.options?.length||0}),i(m=>({predictions:m.predictions.map(g=>g.id===t?{...g,...f.prediction,user_entry:f.entry}:g),userPredictions:m.userPredictions.map(g=>g.id===t?{...g,...f.prediction,user_entry:f.entry}:g),createdPredictions:m.createdPredictions.map(g=>g.id===t?{...g,...f.prediction,user_entry:f.entry}:g),loading:!1,error:null}))):i(m=>({predictions:m.predictions.map(g=>g.id===t?{...g,pool_total:f.pool_total||g.pool_total,participant_count:f.participant_count||g.participant_count,user_entry:f.entry}:g),loading:!1,error:null})),console.log("✅ Prediction placed successfully with updated data"),console.log("🔄 Refreshing wallet data after prediction placement..."),await l.initializeWallet(),console.log("✅ Wallet refreshed")}catch(a){throw console.error("❌ Error placing prediction:",a),i({loading:!1,error:a instanceof Error?a.message:"Failed to place prediction"}),a}},fetchPlatformStats:async()=>{i({statsLoading:!0});try{console.log("📊 Fetching platform stats with retry logic...");const t=await ls.get("/api/v2/predictions/stats/platform",{timeout:8e3,retryOptions:{maxRetries:3}});if(t.success&&t.data)i({platformStats:t.data,statsLoading:!1}),console.log("✅ Platform stats fetched:",t.data);else throw new Error("Invalid stats response format")}catch(t){console.error("❌ Error fetching platform stats:",t);const{predictions:r}=e(),n={totalVolume:r.reduce((o,a)=>o+(a.pool_total||0),0).toFixed(2),activePredictions:r.filter(o=>o.status==="open").length,totalUsers:r.length>0?"5":"0",rawVolume:r.reduce((o,a)=>o+(a.pool_total||0),0),rawUsers:r.length>0?5:0};i({platformStats:n,statsLoading:!1}),console.log("📊 Using fallback stats:",n)}},getActivityForPrediction:t=>[],getParticipantsForPrediction:t=>[],clearError:()=>{i({error:null})},fetchUserPredictionEntries:async t=>{try{console.log("📋 Fetching user prediction entries with retry logic for:",t);const n=(await ls.get(`/api/v2/prediction-entries/user/${t}`,{timeout:1e4,retryOptions:{maxRetries:3}})).data||[];i({userPredictionEntries:n}),console.log("✅ User prediction entries fetched:",n.length)}catch(r){console.error("❌ Error fetching user prediction entries:",r)}},fetchUserCreatedPredictions:async t=>{try{console.log("📋 Fetching user created predictions with retry logic for:",t);const n=(await ls.get(`/api/v2/predictions/created/${t}`,{timeout:1e4,retryOptions:{maxRetries:3}})).data||[];i({userCreatedPredictions:n}),console.log("✅ User created predictions fetched:",n.length)}catch(r){console.error("❌ Error fetching user created predictions:",r)}},getUserPredictionEntries:t=>{const{userPredictionEntries:r}=e();return r.filter(n=>n.user_id===t)},getUserCreatedPredictions:t=>{const{userCreatedPredictions:r}=e();return r.filter(n=>n.creator_id===t)},updatePrediction:async(t,r)=>{try{console.log("🔄 Updating prediction:",t,r);const n=await fetch(`${ue()}/api/v2/predictions/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(r)});if(!n.ok)throw new Error(`Failed to update prediction: ${n.statusText}`);const a=(await n.json()).data;i(l=>({predictions:l.predictions.map(d=>d.id===t?{...d,...a}:d),userCreatedPredictions:l.userCreatedPredictions.map(d=>d.id===t?{...d,...a}:d)})),console.log("✅ Prediction updated successfully")}catch(n){throw console.error("❌ Error updating prediction:",n),n}},deletePrediction:async t=>{try{console.log("🗑️ Deleting prediction:",t);const r=await fetch(`${ue()}/api/v2/predictions/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!r.ok)throw new Error(`Failed to delete prediction: ${r.statusText}`);i(n=>({predictions:n.predictions.filter(o=>o.id!==t),createdPredictions:n.createdPredictions.filter(o=>o.id!==t),userCreatedPredictions:n.userCreatedPredictions.filter(o=>o.id!==t),trendingPredictions:n.trendingPredictions.filter(o=>o.id!==t),completedPredictions:n.completedPredictions.filter(o=>o.id!==t)}));try{const{user:n}=oe.getState();await e().refreshPredictions(!0),await e().fetchTrendingPredictions(),n?.id&&(await e().fetchUserCreatedPredictions(n.id),await e().fetchUserPredictionEntries(n.id))}catch(n){console.warn("⚠️ Post-delete refresh had an issue:",n)}console.log("✅ Prediction deleted successfully")}catch(r){throw console.error("❌ Error deleting prediction:",r),r}},closePrediction:async t=>{try{console.log("🔒 Closing prediction:",t);const r=await fetch(`${ue()}/api/v2/predictions/${t}/close`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!r.ok)throw new Error(`Failed to close prediction: ${r.statusText}`);const o=(await r.json()).data;i(a=>({predictions:a.predictions.map(l=>l.id===t?{...l,status:"closed",...o}:l),userCreatedPredictions:a.userCreatedPredictions.map(l=>l.id===t?{...l,status:"closed",...o}:l)})),console.log("✅ Prediction closed successfully")}catch(r){throw console.error("❌ Error closing prediction:",r),r}},fetchPredictionActivity:async t=>{try{console.log("📋 Fetching prediction activity:",t);const r=await fetch(`${ue()}/api/v2/predictions/${t}/activity`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});return r.ok?(await r.json()).data||[]:(console.warn(`Activity endpoint not available: ${r.statusText}`),[])}catch(r){return console.warn("Activity endpoint not implemented yet:",r),[]}},fetchPredictionParticipants:async t=>{try{console.log("📋 Fetching prediction participants:",t);const r=await fetch(`${ue()}/api/v2/predictions/${t}/participants`,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}});return r.ok?(await r.json()).data||[]:(console.warn(`Participants endpoint not available: ${r.statusText}`),[])}catch(r){return console.warn("Participants endpoint not implemented yet:",r),[]}},reset:()=>{i(cs)}})),qt=({username:i,userId:e,displayName:t,className:r="",showAt:n=!0,onClick:o})=>{const[,a]=pe(),l=c=>{if(c.stopPropagation(),console.log("👤 TappableUsername clicked:",{username:i,userId:e,displayName:t}),o){o();return}const u=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(e&&e.trim()!==""&&u.test(e.trim()))console.log("🔗 Navigating to profile with userId:",e),a(`/profile/${e.trim()}`);else if(i&&i.trim()!==""){e&&!u.test(e.trim())&&console.warn("⚠️ Invalid userId format, using username instead:",e);const h=i.replace("@","").trim();console.log("🔗 Navigating to profile with username:",h),a(`/profile/${h}`)}else{console.warn("⚠️ No valid userId or username provided for profile navigation");return}},d=t||(n?`@${i.replace("@","")}`:i.replace("@",""));return s.jsx(N.button,{className:`inline-flex items-center font-medium text-blue-600 hover:text-blue-700 hover:underline transition-all cursor-pointer rounded-md px-1 py-0.5 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 ${r}`,whileHover:{scale:1.02},whileTap:{scale:.98},onClick:l,type:"button","aria-label":`View profile for ${d}`,children:d})},bi=({children:i,onClose:e,error:t})=>t?s.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9000]",children:s.jsx("div",{className:"bg-white rounded-lg p-6 max-w-sm mx-4",children:s.jsxs("div",{className:"text-red-600 text-center",children:[s.jsx("h3",{className:"font-semibold mb-2",children:"⚠️ Error"}),s.jsx("p",{className:"text-sm",children:t}),s.jsx("button",{onClick:e,className:"mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})]})})}):s.jsx(s.Fragment,{children:i}),Bs=({prediction:i,isOpen:e,onClose:t})=>{const{user:r}=oe(),[n,o]=p.useState(""),[a,l]=p.useState(!1);p.useEffect(()=>{l(!0)},[]);const d=i&&i.id&&i.id.trim()!=="",c=e&&d&&a,{comments:u,commentCount:h,isLoading:f,error:m,isSubmitting:g,fetchComments:x,addComment:y,toggleCommentLike:v,clearError:b}=Cr(c?i.id:"");p.useEffect(()=>{c&&x()},[c,x]),p.useEffect(()=>{e||(o(""),d&&b())},[e,b,d]);const w=async()=>{if(!(!d||!n.trim()||!r))try{await y(n.trim()),o(""),F.success("Comment added successfully!")}catch(_){console.error("Failed to add comment:",_),F.error(_.message||"Failed to add comment")}},k=async _=>{if(d)try{await v(_)}catch(A){console.error("Failed to toggle comment like:",A),F.error("Failed to update like")}},I=_=>{try{const A=new Date,K=new Date(_),W=Math.floor((A.getTime()-K.getTime())/1e3);return W<60?"Just now":W<3600?`${Math.floor(W/60)}m ago`:W<86400?`${Math.floor(W/3600)}h ago`:`${Math.floor(W/86400)}d ago`}catch{return"Recently"}};return a?e&&!d?s.jsx(bi,{onClose:t,error:"Unable to load comments. Invalid prediction data.",children:s.jsx("div",{children:"Error loading comments"})}):!e||!i?null:s.jsx(xe,{children:s.jsx(bi,{onClose:t,children:s.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center sm:items-center sm:p-4 z-[9000]",children:s.jsxs(N.div,{initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},onClick:_=>_.stopPropagation(),className:"bg-white w-full max-w-lg rounded-t-3xl sm:rounded-3xl overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[80vh]",style:{zIndex:9001},children:[s.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx($e,{size:20,className:"text-blue-500"}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold text-gray-900",children:"Comments"}),s.jsxs("p",{className:"text-sm text-gray-600",children:[h," ",h===1?"comment":"comments"]})]})]}),s.jsx("button",{onClick:t,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors",children:s.jsx(Re,{size:18})})]}),s.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-100",children:[s.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:i.title}),s.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:i.description||"No description available"})]}),s.jsx("div",{className:"flex-1 overflow-y-auto",children:f&&u.length===0?s.jsx("div",{className:"p-4 text-center",children:s.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((_,A)=>s.jsxs("div",{className:"flex gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-1"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]},A))})}):m?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx($e,{size:48,className:"text-red-300 mx-auto mb-3"}),s.jsx("p",{className:"text-red-600 font-medium",children:"Failed to load comments"}),s.jsx("p",{className:"text-sm text-red-400 mb-4",children:m}),s.jsx("button",{onClick:()=>x(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]}):u.length===0?s.jsxs("div",{className:"p-8 text-center",children:[s.jsx($e,{size:48,className:"text-gray-300 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500 font-medium",children:"No comments yet"}),s.jsx("p",{className:"text-sm text-gray-400",children:"Be the first to share your thoughts!"})]}):s.jsx("div",{className:"p-4 space-y-4",children:u.map(_=>s.jsx(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex gap-3",children:s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"bg-gray-50 rounded-2xl px-4 py-3",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx(qt,{username:_.user?.username||"Anonymous",userId:_.user?.id||"anonymous",className:"font-semibold text-gray-900 text-sm hover:text-blue-600",showAt:!1}),s.jsx("span",{className:"text-xs text-gray-500",children:I(_.created_at)})]}),s.jsx("p",{className:"text-gray-800 text-sm leading-relaxed",children:_.content})]}),s.jsx("div",{className:"flex items-center gap-4 mt-2 ml-4",children:s.jsxs("button",{onClick:()=>k(_.id),className:`flex items-center gap-1 text-xs transition-colors ${_.is_liked?"text-red-500":"text-gray-500 hover:text-red-500"}`,children:[s.jsx(dt,{size:14,fill:_.is_liked?"currentColor":"none"}),_.likes_count>0&&s.jsx("span",{children:_.likes_count})]})})]})},_.id))})}),r?s.jsx("div",{className:"p-4 border-t border-gray-100 bg-white sticky bottom-0",children:s.jsx("div",{className:"flex gap-3",children:s.jsxs("div",{className:"flex-1 flex gap-2",children:[s.jsx("input",{type:"text",value:n,onChange:_=>o(_.target.value),onKeyPress:_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),w())},placeholder:"Write a comment...",className:"flex-1 px-4 py-2 bg-gray-100 rounded-full focus:ring-2 focus:ring-green-500 focus:bg-white focus:outline-none transition-all text-sm",disabled:g}),s.jsx("button",{onClick:w,disabled:!n.trim()||g,className:"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center hover:bg-teal-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:s.jsx(bd,{size:14})})]})})}):s.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50 text-center",children:s.jsx("p",{className:"text-gray-600 text-sm",children:"Please log in to join the conversation"})})]})})})}):null};class $r extends ne.Component{constructor(t){super(t);re(this,"resetError",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,r){console.error("ErrorBoundary caught an error:",t,r),this.setState({error:t,errorInfo:r}),this.props.onError?.(t,r)}render(){if(this.state.hasError){if(this.props.fallback){const t=this.props.fallback;return s.jsx(t,{error:this.state.error,resetError:this.resetError})}return s.jsx(iu,{error:this.state.error,resetError:this.resetError})}return this.props.children}}const iu=({error:i,resetError:e})=>{const t=()=>{e(),window.location.href="/"},r=()=>{e(),window.location.reload()};return s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(Er,{className:"w-8 h-8 text-red-600"})}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Something went wrong"}),s.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:"We encountered an unexpected error. This has been logged and our team will investigate."})]}),i&&!1,s.jsxs("div",{className:"flex flex-col gap-3",children:[s.jsxs(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:r,className:"flex items-center justify-center gap-2 w-full bg-teal-600 text-white py-3 px-4 rounded-xl font-semibold hover:bg-green-700 transition-colors",children:[s.jsx(Ht,{className:"w-4 h-4"}),"Try Again"]}),s.jsxs(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:t,className:"flex items-center justify-center gap-2 w-full bg-gray-100 text-gray-700 py-3 px-4 rounded-xl font-semibold hover:bg-gray-200 transition-colors",children:[s.jsx(kn,{className:"w-4 h-4"}),"Go to Home"]})]})]})})};function nu(){return Ei.useSyncExternalStore(ou,()=>!0,()=>!1)}function ou(){return()=>{}}var Rr="Avatar",[au,qh]=uo(Rr),[lu,En]=au(Rr),Tn=p.forwardRef((i,e)=>{const{__scopeAvatar:t,...r}=i,[n,o]=p.useState("idle");return s.jsx(lu,{scope:t,imageLoadingStatus:n,onImageLoadingStatusChange:o,children:s.jsx(gr.span,{...r,ref:e})})});Tn.displayName=Rr;var An="AvatarImage",In=p.forwardRef((i,e)=>{const{__scopeAvatar:t,src:r,onLoadingStatusChange:n=()=>{},...o}=i,a=En(An,t),l=cu(r,o),d=ho(c=>{n(c),a.onImageLoadingStatusChange(c)});return qs(()=>{l!=="idle"&&d(l)},[l,d]),l==="loaded"?s.jsx(gr.img,{...o,ref:e,src:r}):null});In.displayName=An;var $n="AvatarFallback",Rn=p.forwardRef((i,e)=>{const{__scopeAvatar:t,delayMs:r,...n}=i,o=En($n,t),[a,l]=p.useState(r===void 0);return p.useEffect(()=>{if(r!==void 0){const d=window.setTimeout(()=>l(!0),r);return()=>window.clearTimeout(d)}},[r]),a&&o.imageLoadingStatus!=="loaded"?s.jsx(gr.span,{...n,ref:e}):null});Rn.displayName=$n;function vi(i,e){return i?e?(i.src!==e&&(i.src=e),i.complete&&i.naturalWidth>0?"loaded":"loading"):"error":"idle"}function cu(i,{referrerPolicy:e,crossOrigin:t}){const r=nu(),n=p.useRef(null),o=(()=>r?(n.current||(n.current=new window.Image),n.current):null)(),[a,l]=p.useState(()=>vi(o,i));return qs(()=>{l(vi(o,i))},[o,i]),qs(()=>{const d=h=>()=>{l(h)};if(!o)return;const c=d("loaded"),u=d("error");return o.addEventListener("load",c),o.addEventListener("error",u),e&&(o.referrerPolicy=e),typeof t=="string"&&(o.crossOrigin=t),()=>{o.removeEventListener("load",c),o.removeEventListener("error",u)}},[o,t,e]),a}var On=Tn,Ln=In,zn=Rn;function Dn(i){var e,t,r="";if(typeof i=="string"||typeof i=="number")r+=i;else if(typeof i=="object")if(Array.isArray(i)){var n=i.length;for(e=0;e<n;e++)i[e]&&(t=Dn(i[e]))&&(r&&(r+=" "),r+=t)}else for(t in i)i[t]&&(r&&(r+=" "),r+=t);return r}function Un(){for(var i,e,t=0,r="",n=arguments.length;t<n;t++)(i=arguments[t])&&(e=Dn(i))&&(r&&(r+=" "),r+=e);return r}const Or="-",du=i=>{const e=hu(i),{conflictingClassGroups:t,conflictingClassGroupModifiers:r}=i;return{getClassGroupId:a=>{const l=a.split(Or);return l[0]===""&&l.length!==1&&l.shift(),Mn(l,e)||uu(a)},getConflictingClassGroupIds:(a,l)=>{const d=t[a]||[];return l&&r[a]?[...d,...r[a]]:d}}},Mn=(i,e)=>{if(i.length===0)return e.classGroupId;const t=i[0],r=e.nextPart.get(t),n=r?Mn(i.slice(1),r):void 0;if(n)return n;if(e.validators.length===0)return;const o=i.join(Or);return e.validators.find(({validator:a})=>a(o))?.classGroupId},wi=/^\[(.+)\]$/,uu=i=>{if(wi.test(i)){const e=wi.exec(i)[1],t=e?.substring(0,e.indexOf(":"));if(t)return"arbitrary.."+t}},hu=i=>{const{theme:e,prefix:t}=i,r={nextPart:new Map,validators:[]};return fu(Object.entries(i.classGroups),t).forEach(([o,a])=>{ur(a,r,o,e)}),r},ur=(i,e,t,r)=>{i.forEach(n=>{if(typeof n=="string"){const o=n===""?e:ji(e,n);o.classGroupId=t;return}if(typeof n=="function"){if(pu(n)){ur(n(r),e,t,r);return}e.validators.push({validator:n,classGroupId:t});return}Object.entries(n).forEach(([o,a])=>{ur(a,ji(e,o),t,r)})})},ji=(i,e)=>{let t=i;return e.split(Or).forEach(r=>{t.nextPart.has(r)||t.nextPart.set(r,{nextPart:new Map,validators:[]}),t=t.nextPart.get(r)}),t},pu=i=>i.isThemeGetter,fu=(i,e)=>e?i.map(([t,r])=>{const n=r.map(o=>typeof o=="string"?e+o:typeof o=="object"?Object.fromEntries(Object.entries(o).map(([a,l])=>[e+a,l])):o);return[t,n]}):i,mu=i=>{if(i<1)return{get:()=>{},set:()=>{}};let e=0,t=new Map,r=new Map;const n=(o,a)=>{t.set(o,a),e++,e>i&&(e=0,r=t,t=new Map)};return{get(o){let a=t.get(o);if(a!==void 0)return a;if((a=r.get(o))!==void 0)return n(o,a),a},set(o,a){t.has(o)?t.set(o,a):n(o,a)}}},Fn="!",gu=i=>{const{separator:e,experimentalParseClassName:t}=i,r=e.length===1,n=e[0],o=e.length,a=l=>{const d=[];let c=0,u=0,h;for(let y=0;y<l.length;y++){let v=l[y];if(c===0){if(v===n&&(r||l.slice(y,y+o)===e)){d.push(l.slice(u,y)),u=y+o;continue}if(v==="/"){h=y;continue}}v==="["?c++:v==="]"&&c--}const f=d.length===0?l:l.substring(u),m=f.startsWith(Fn),g=m?f.substring(1):f,x=h&&h>u?h-u:void 0;return{modifiers:d,hasImportantModifier:m,baseClassName:g,maybePostfixModifierPosition:x}};return t?l=>t({className:l,parseClassName:a}):a},xu=i=>{if(i.length<=1)return i;const e=[];let t=[];return i.forEach(r=>{r[0]==="["?(e.push(...t.sort(),r),t=[]):t.push(r)}),e.push(...t.sort()),e},yu=i=>({cache:mu(i.cacheSize),parseClassName:gu(i),...du(i)}),bu=/\s+/,vu=(i,e)=>{const{parseClassName:t,getClassGroupId:r,getConflictingClassGroupIds:n}=e,o=[],a=i.trim().split(bu);let l="";for(let d=a.length-1;d>=0;d-=1){const c=a[d],{modifiers:u,hasImportantModifier:h,baseClassName:f,maybePostfixModifierPosition:m}=t(c);let g=!!m,x=r(g?f.substring(0,m):f);if(!x){if(!g){l=c+(l.length>0?" "+l:l);continue}if(x=r(f),!x){l=c+(l.length>0?" "+l:l);continue}g=!1}const y=xu(u).join(":"),v=h?y+Fn:y,b=v+x;if(o.includes(b))continue;o.push(b);const w=n(x,g);for(let k=0;k<w.length;++k){const I=w[k];o.push(v+I)}l=c+(l.length>0?" "+l:l)}return l};function wu(){let i=0,e,t,r="";for(;i<arguments.length;)(e=arguments[i++])&&(t=Bn(e))&&(r&&(r+=" "),r+=t);return r}const Bn=i=>{if(typeof i=="string")return i;let e,t="";for(let r=0;r<i.length;r++)i[r]&&(e=Bn(i[r]))&&(t&&(t+=" "),t+=e);return t};function ju(i,...e){let t,r,n,o=a;function a(d){const c=e.reduce((u,h)=>h(u),i());return t=yu(c),r=t.cache.get,n=t.cache.set,o=l,l(d)}function l(d){const c=r(d);if(c)return c;const u=vu(d,t);return n(d,u),u}return function(){return o(wu.apply(null,arguments))}}const te=i=>{const e=t=>t[i]||[];return e.isThemeGetter=!0,e},Wn=/^\[(?:([a-z-]+):)?(.+)\]$/i,ku=/^\d+\/\d+$/,_u=new Set(["px","full","screen"]),Su=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Nu=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Cu=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,Pu=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Eu=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Le=i=>Ct(i)||_u.has(i)||ku.test(i),He=i=>It(i,"length",zu),Ct=i=>!!i&&!Number.isNaN(Number(i)),Ws=i=>It(i,"number",Ct),Ot=i=>!!i&&Number.isInteger(Number(i)),Tu=i=>i.endsWith("%")&&Ct(i.slice(0,-1)),V=i=>Wn.test(i),Ve=i=>Su.test(i),Au=new Set(["length","size","percentage"]),Iu=i=>It(i,Au,Hn),$u=i=>It(i,"position",Hn),Ru=new Set(["image","url"]),Ou=i=>It(i,Ru,Uu),Lu=i=>It(i,"",Du),Lt=()=>!0,It=(i,e,t)=>{const r=Wn.exec(i);return r?r[1]?typeof e=="string"?r[1]===e:e.has(r[1]):t(r[2]):!1},zu=i=>Nu.test(i)&&!Cu.test(i),Hn=()=>!1,Du=i=>Pu.test(i),Uu=i=>Eu.test(i),Mu=()=>{const i=te("colors"),e=te("spacing"),t=te("blur"),r=te("brightness"),n=te("borderColor"),o=te("borderRadius"),a=te("borderSpacing"),l=te("borderWidth"),d=te("contrast"),c=te("grayscale"),u=te("hueRotate"),h=te("invert"),f=te("gap"),m=te("gradientColorStops"),g=te("gradientColorStopPositions"),x=te("inset"),y=te("margin"),v=te("opacity"),b=te("padding"),w=te("saturate"),k=te("scale"),I=te("sepia"),_=te("skew"),A=te("space"),K=te("translate"),W=()=>["auto","contain","none"],Y=()=>["auto","hidden","clip","visible","scroll"],T=()=>["auto",V,e],L=()=>[V,e],ee=()=>["",Le,He],ie=()=>["auto",Ct,V],$=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],j=()=>["solid","dashed","dotted","double","none"],D=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],P=()=>["start","end","center","between","around","evenly","stretch"],M=()=>["","0",V],B=()=>["auto","avoid","all","avoid-page","page","left","right","column"],U=()=>[Ct,V];return{cacheSize:500,separator:":",theme:{colors:[Lt],spacing:[Le,He],blur:["none","",Ve,V],brightness:U(),borderColor:[i],borderRadius:["none","","full",Ve,V],borderSpacing:L(),borderWidth:ee(),contrast:U(),grayscale:M(),hueRotate:U(),invert:M(),gap:L(),gradientColorStops:[i],gradientColorStopPositions:[Tu,He],inset:T(),margin:T(),opacity:U(),padding:L(),saturate:U(),scale:U(),sepia:M(),skew:U(),space:L(),translate:L()},classGroups:{aspect:[{aspect:["auto","square","video",V]}],container:["container"],columns:[{columns:[Ve]}],"break-after":[{"break-after":B()}],"break-before":[{"break-before":B()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...$(),V]}],overflow:[{overflow:Y()}],"overflow-x":[{"overflow-x":Y()}],"overflow-y":[{"overflow-y":Y()}],overscroll:[{overscroll:W()}],"overscroll-x":[{"overscroll-x":W()}],"overscroll-y":[{"overscroll-y":W()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[x]}],"inset-x":[{"inset-x":[x]}],"inset-y":[{"inset-y":[x]}],start:[{start:[x]}],end:[{end:[x]}],top:[{top:[x]}],right:[{right:[x]}],bottom:[{bottom:[x]}],left:[{left:[x]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",Ot,V]}],basis:[{basis:T()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",V]}],grow:[{grow:M()}],shrink:[{shrink:M()}],order:[{order:["first","last","none",Ot,V]}],"grid-cols":[{"grid-cols":[Lt]}],"col-start-end":[{col:["auto",{span:["full",Ot,V]},V]}],"col-start":[{"col-start":ie()}],"col-end":[{"col-end":ie()}],"grid-rows":[{"grid-rows":[Lt]}],"row-start-end":[{row:["auto",{span:[Ot,V]},V]}],"row-start":[{"row-start":ie()}],"row-end":[{"row-end":ie()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",V]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",V]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...P()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...P(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...P(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[b]}],px:[{px:[b]}],py:[{py:[b]}],ps:[{ps:[b]}],pe:[{pe:[b]}],pt:[{pt:[b]}],pr:[{pr:[b]}],pb:[{pb:[b]}],pl:[{pl:[b]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[A]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[A]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",V,e]}],"min-w":[{"min-w":[V,e,"min","max","fit"]}],"max-w":[{"max-w":[V,e,"none","full","min","max","fit","prose",{screen:[Ve]},Ve]}],h:[{h:[V,e,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[V,e,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[V,e,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[V,e,"auto","min","max","fit"]}],"font-size":[{text:["base",Ve,He]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",Ws]}],"font-family":[{font:[Lt]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",V]}],"line-clamp":[{"line-clamp":["none",Ct,Ws]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Le,V]}],"list-image":[{"list-image":["none",V]}],"list-style-type":[{list:["none","disc","decimal",V]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[i]}],"placeholder-opacity":[{"placeholder-opacity":[v]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[i]}],"text-opacity":[{"text-opacity":[v]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...j(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Le,He]}],"underline-offset":[{"underline-offset":["auto",Le,V]}],"text-decoration-color":[{decoration:[i]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:L()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",V]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",V]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[v]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...$(),$u]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",Iu]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},Ou]}],"bg-color":[{bg:[i]}],"gradient-from-pos":[{from:[g]}],"gradient-via-pos":[{via:[g]}],"gradient-to-pos":[{to:[g]}],"gradient-from":[{from:[m]}],"gradient-via":[{via:[m]}],"gradient-to":[{to:[m]}],rounded:[{rounded:[o]}],"rounded-s":[{"rounded-s":[o]}],"rounded-e":[{"rounded-e":[o]}],"rounded-t":[{"rounded-t":[o]}],"rounded-r":[{"rounded-r":[o]}],"rounded-b":[{"rounded-b":[o]}],"rounded-l":[{"rounded-l":[o]}],"rounded-ss":[{"rounded-ss":[o]}],"rounded-se":[{"rounded-se":[o]}],"rounded-ee":[{"rounded-ee":[o]}],"rounded-es":[{"rounded-es":[o]}],"rounded-tl":[{"rounded-tl":[o]}],"rounded-tr":[{"rounded-tr":[o]}],"rounded-br":[{"rounded-br":[o]}],"rounded-bl":[{"rounded-bl":[o]}],"border-w":[{border:[l]}],"border-w-x":[{"border-x":[l]}],"border-w-y":[{"border-y":[l]}],"border-w-s":[{"border-s":[l]}],"border-w-e":[{"border-e":[l]}],"border-w-t":[{"border-t":[l]}],"border-w-r":[{"border-r":[l]}],"border-w-b":[{"border-b":[l]}],"border-w-l":[{"border-l":[l]}],"border-opacity":[{"border-opacity":[v]}],"border-style":[{border:[...j(),"hidden"]}],"divide-x":[{"divide-x":[l]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[l]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[v]}],"divide-style":[{divide:j()}],"border-color":[{border:[n]}],"border-color-x":[{"border-x":[n]}],"border-color-y":[{"border-y":[n]}],"border-color-s":[{"border-s":[n]}],"border-color-e":[{"border-e":[n]}],"border-color-t":[{"border-t":[n]}],"border-color-r":[{"border-r":[n]}],"border-color-b":[{"border-b":[n]}],"border-color-l":[{"border-l":[n]}],"divide-color":[{divide:[n]}],"outline-style":[{outline:["",...j()]}],"outline-offset":[{"outline-offset":[Le,V]}],"outline-w":[{outline:[Le,He]}],"outline-color":[{outline:[i]}],"ring-w":[{ring:ee()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[i]}],"ring-opacity":[{"ring-opacity":[v]}],"ring-offset-w":[{"ring-offset":[Le,He]}],"ring-offset-color":[{"ring-offset":[i]}],shadow:[{shadow:["","inner","none",Ve,Lu]}],"shadow-color":[{shadow:[Lt]}],opacity:[{opacity:[v]}],"mix-blend":[{"mix-blend":[...D(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":D()}],filter:[{filter:["","none"]}],blur:[{blur:[t]}],brightness:[{brightness:[r]}],contrast:[{contrast:[d]}],"drop-shadow":[{"drop-shadow":["","none",Ve,V]}],grayscale:[{grayscale:[c]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[h]}],saturate:[{saturate:[w]}],sepia:[{sepia:[I]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[t]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[d]}],"backdrop-grayscale":[{"backdrop-grayscale":[c]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[h]}],"backdrop-opacity":[{"backdrop-opacity":[v]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[I]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[a]}],"border-spacing-x":[{"border-spacing-x":[a]}],"border-spacing-y":[{"border-spacing-y":[a]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",V]}],duration:[{duration:U()}],ease:[{ease:["linear","in","out","in-out",V]}],delay:[{delay:U()}],animate:[{animate:["none","spin","ping","pulse","bounce",V]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[k]}],"scale-x":[{"scale-x":[k]}],"scale-y":[{"scale-y":[k]}],rotate:[{rotate:[Ot,V]}],"translate-x":[{"translate-x":[K]}],"translate-y":[{"translate-y":[K]}],"skew-x":[{"skew-x":[_]}],"skew-y":[{"skew-y":[_]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",V]}],accent:[{accent:["auto",i]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",V]}],"caret-color":[{caret:[i]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":L()}],"scroll-mx":[{"scroll-mx":L()}],"scroll-my":[{"scroll-my":L()}],"scroll-ms":[{"scroll-ms":L()}],"scroll-me":[{"scroll-me":L()}],"scroll-mt":[{"scroll-mt":L()}],"scroll-mr":[{"scroll-mr":L()}],"scroll-mb":[{"scroll-mb":L()}],"scroll-ml":[{"scroll-ml":L()}],"scroll-p":[{"scroll-p":L()}],"scroll-px":[{"scroll-px":L()}],"scroll-py":[{"scroll-py":L()}],"scroll-ps":[{"scroll-ps":L()}],"scroll-pe":[{"scroll-pe":L()}],"scroll-pt":[{"scroll-pt":L()}],"scroll-pr":[{"scroll-pr":L()}],"scroll-pb":[{"scroll-pb":L()}],"scroll-pl":[{"scroll-pl":L()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",V]}],fill:[{fill:[i,"none"]}],"stroke-w":[{stroke:[Le,He,Ws]}],stroke:[{stroke:[i,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},Fu=ju(Mu);function Se(...i){return Fu(Un(i))}const Bu=i=>{const e=new Date(i),t=new Date,r=e.getTime()-t.getTime();if(r<=0)return"Ended";const n=Math.floor(r/6e4),o=Math.floor(r/36e5),a=Math.floor(r/864e5),l=Math.floor(a/365);if(o>999)if(l>0){const d=a%365;return d>0?`${l}y ${d}d left`:`${l}y left`}else return`${a}d left`;return a>0?`${a}d ${o%24}h left`:o>0?`${o}h left`:n>0?`${n}m left`:"Ending soon"},Vn=p.forwardRef(({className:i,...e},t)=>s.jsx(On,{ref:t,className:Se("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full border border-border",i),...e}));Vn.displayName=On.displayName;const qn=p.forwardRef(({className:i,...e},t)=>s.jsx(Ln,{ref:t,className:Se("aspect-square h-full w-full object-cover",i),...e}));qn.displayName=Ln.displayName;const Gn=p.forwardRef(({className:i,...e},t)=>s.jsx(zn,{ref:t,className:Se("flex h-full w-full items-center justify-center rounded-full bg-muted text-sm font-medium text-muted-foreground",i),...e}));Gn.displayName=zn.displayName;const Wu={sm:"h-8 w-8 text-xs",md:"h-10 w-10 text-sm",lg:"h-16 w-16 text-xl",xl:"h-20 w-20 text-2xl"},gs=({email:i,username:e,avatarUrl:t,className:r,size:n="md"})=>{const o=`${Wu[n]} ${r||""}`.trim(),l=(()=>e&&e.trim()?e.trim().split(" ").map(d=>d.charAt(0)).join("").toUpperCase().slice(0,2):i&&i.trim()?i.trim().split("@")[0].slice(0,2).toUpperCase():"FC")();return s.jsxs(Vn,{className:o,children:[t&&t.trim()?s.jsx(qn,{src:t,alt:e||i||"User avatar"}):null,s.jsx(Gn,{className:"bg-gradient-to-r from-purple-400 to-purple-600 text-white font-bold",children:l})]})},Hu=({error:i})=>s.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-red-200 p-4 m-2",children:s.jsxs("div",{className:"text-red-600 text-sm",children:["⚠️ Error loading prediction",i&&s.jsx("div",{className:"text-xs mt-1 text-gray-500",children:i})]})}),Vu=({prediction:i,entry:e,variant:t="default",onLike:r,onComment:n,onShare:o,onPredict:a,className:l=""})=>{if(!i||!i.id)return console.warn("⚠️ PredictionCard: Invalid prediction data received:",i),s.jsx(Hu,{error:"Invalid prediction data"});const[,d]=pe(),[c,u]=p.useState(!1),[h,f]=p.useState(!1),[m,g]=p.useState(!1);p.useEffect(()=>{u(!0)},[]);const x=()=>{try{const{toggleLike:C,checkIfLiked:E,getLikeCount:S}=Sr();return{toggleLike:C,checkIfLiked:E,getLikeCount:S}}catch(C){return console.warn("Error accessing like store:",C),{toggleLike:async()=>{},checkIfLiked:()=>!1,getLikeCount:()=>0}}},y=()=>{try{const{getCommentCount:C}=Nr();return{getCommentCount:C}}catch(C){return console.warn("Error accessing comment store:",C),{getCommentCount:()=>0}}},{toggleLike:v,checkIfLiked:b,getLikeCount:w}=x(),{getCommentCount:k}=y();if(!c)return s.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 animate-pulse",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-1"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]})]}),s.jsx("div",{className:"h-6 bg-gray-200 rounded mb-2"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]});const I=b(i.id)||!1,_=w(i.id),A=_??(i.likes_count||i.likes||0),K=k(i.id),W=K??(i.comments_count||i.comments||0);console.log(`📊 PredictionCard ${i.id}: storeCount=${K}, predictionCount=${i.comments_count||i.comments||0}, finalCount=${W}`);const Y=i.entry_deadline||i.entryDeadline,T=Y?Math.max(0,new Date(Y).getTime()-Date.now()):0,L=Math.floor(T/(1e3*60*60)),ee=L<24&&L>0,ie=i.participant_count||i.entries?.length||0,$=i.options?.reduce((C,E)=>{const S=E.total_staked||E.totalStaked||0;return C+S},0)||i.pool_total||i.poolTotal||0,j=C=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(C),D=async()=>{if(!m){console.log("❤️ Like clicked:",i.id,"- Before:",{isLiked:I,likeCount:A});try{g(!0),await v(i.id),r&&r()}catch(C){console.error("❌ Error toggling like:",C),F.error("Failed to update like")}finally{g(!1)}}},P=()=>{f(!0),n&&n()},M=async()=>{try{const C={title:i.title,text:`Check out this prediction: ${i.title}`,url:`${window.location.origin}/prediction/${i.id}`};if(navigator.share&&navigator.canShare&&navigator.canShare(C))await navigator.share(C);else if(navigator.clipboard)await navigator.clipboard.writeText(C.url),F.success("Link copied to clipboard!");else{const E=document.createElement("textarea");E.value=C.url,document.body.appendChild(E),E.select(),document.execCommand("copy"),document.body.removeChild(E),F.success("Link copied to clipboard!")}o&&o()}catch(C){console.error("Error sharing:",C),F.error("Failed to share")}},B=C=>{const E=C.target;E.closest("button")||E.closest("a")||E.closest(".interactive")||E.closest(".options-clickable")||E.closest('[data-clickable="true"]')||E.closest(".predict-button")||C.defaultPrevented||d(`/prediction/${i.id}`)},U=()=>T<=0?"Ended":L>=24?`${Math.floor(L/24)}d left`:`${L}h left`;if(t==="compact")return s.jsxs(s.Fragment,{children:[s.jsxs(N.div,{className:`bg-white rounded-xl shadow-sm border border-gray-100 p-4 cursor-pointer ${l}`,whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},onClick:B,children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(gs,{email:i.creator?.email,username:i.creator?.username,avatarUrl:i.creator?.avatar_url,size:"sm"}),s.jsxs("div",{children:[s.jsx(qt,{username:i.creator?.username||i.creator?.full_name||"Anonymous",userId:i.creator?.id||"anonymous",className:"font-medium text-gray-900 text-sm hover:text-blue-600",showAt:!0}),s.jsx("div",{className:"text-xs text-gray-500",children:U()})]})]}),s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${i.category==="sports"?"bg-red-100 text-red-700":i.category==="pop_culture"?"bg-purple-100 text-purple-700":i.category==="esports"?"bg-yellow-100 text-yellow-700":i.category==="politics"?"bg-blue-100 text-blue-700":i.category==="celebrity_gossip"?"bg-pink-100 text-pink-700":"bg-emerald-100 text-emerald-700"}`,children:i.category?.replace("_"," ")||"General"})]}),s.jsx("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2 cursor-pointer options-clickable",onClick:C=>{C.stopPropagation(),a&&a()},children:i.title}),s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2 text-gray-600 cursor-pointer options-clickable",onClick:C=>{C.stopPropagation(),a&&a()},children:[s.jsx("span",{className:"font-medium",children:j($)}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:[Array.isArray(i.options)?i.options.length:0," options"]})]}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("button",{onClick:C=>{C.stopPropagation(),D()},className:`flex items-center gap-1 ${I?"text-red-500":"text-gray-400"} hover:text-red-500 transition-colors`,children:[s.jsx(dt,{className:`w-4 h-4 ${I?"fill-current":""}`}),s.jsx("span",{className:"text-gray-600",children:A})]}),s.jsxs("button",{onClick:C=>{C.stopPropagation(),P()},className:"flex items-center gap-1 text-gray-400 hover:text-blue-500 transition-colors",children:[s.jsx($e,{className:"w-4 h-4"}),s.jsx("span",{className:"text-gray-600",children:W})]})]})]})]}),s.jsx(Bs,{prediction:i,isOpen:h,onClose:()=>f(!1)})]});if(t==="user-entry"){const C=!!e,E=e?.option_id,S=e?.potential_payout||0,J=e?.actual_payout||0,Q=e?.status||i.status;return s.jsxs(s.Fragment,{children:[s.jsxs(N.div,{className:`bg-white rounded-xl shadow-sm border-l-4 ${Q==="won"?"border-emerald-500":Q==="lost"?"border-red-500":Q==="settled"?"border-gray-500":"border-blue-500"} p-4 cursor-pointer ${l}`,whileHover:{scale:1.01,y:-2},onClick:B,children:[s.jsx("div",{className:"flex items-center justify-between mb-3",children:s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900 text-base line-clamp-1",children:i.title}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-medium ${Q==="won"?"bg-emerald-100 text-emerald-700":Q==="lost"?"bg-red-100 text-red-700":Q==="settled"?"bg-gray-100 text-gray-700":"bg-blue-100 text-blue-700"}`,children:Q?.toUpperCase()}),s.jsx(ht,{className:"w-3 h-3 text-gray-400"}),s.jsx("span",{className:"text-xs text-gray-500",children:U()})]})]})}),C&&s.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:[s.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"Your Position"}),s.jsx("div",{className:"font-semibold text-gray-900",children:i.options?.find(Z=>Z.id===E)?.label||"Option selected"}),s.jsxs("div",{className:"text-sm text-gray-600 mt-1",children:["Stake: ",j(e?.amount||0)," •",Q==="won"?` Won: ${j(J)}`:Q==="lost"?" Lost":` Potential: ${j(S)}`]})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("button",{onClick:D,disabled:m,className:`flex items-center gap-1 ${I?"text-red-500":"text-gray-500"} hover:text-red-500 transition-colors`,children:[s.jsx(dt,{className:`w-4 h-4 ${I?"fill-current":""}`}),s.jsx("span",{className:"text-sm",children:A})]}),s.jsxs("button",{onClick:P,className:"flex items-center gap-1 text-gray-500 hover:text-blue-500 transition-colors",children:[s.jsx($e,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:W})]}),s.jsxs("button",{onClick:M,className:"flex items-center gap-1 text-gray-500 hover:text-emerald-500 transition-colors",children:[s.jsx(cr,{className:"w-4 h-4"}),s.jsx("span",{className:"text-sm",children:"Share"})]})]}),s.jsx("button",{onClick:a,className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 text-sm font-medium transition-colors",children:"View Details"})]})]}),s.jsx(Bs,{prediction:i,isOpen:h,onClose:()=>f(!1)})]})}return s.jsxs(s.Fragment,{children:[s.jsxs(N.div,{className:`bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer ${l}`,whileHover:{scale:1.01,y:-2},initial:{opacity:0,y:20},animate:{opacity:1,y:0},onClick:B,transition:{duration:.3},children:[s.jsxs("div",{className:"p-4 pb-0",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-400 to-purple-600 flex items-center justify-center text-white font-bold",children:i.creator?.username?.slice(0,2).toUpperCase()||"FC"}),s.jsxs("div",{children:[s.jsx(qt,{username:i.creator?.username||i.creator?.full_name||"Anonymous",userId:i.creator?.id||"anonymous",className:"font-medium text-gray-900 hover:text-blue-600",showAt:!0}),s.jsx("div",{className:"text-sm text-gray-500",children:i.created_at?new Date(i.created_at).toLocaleDateString():"Recently"})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${i.category==="sports"?"bg-red-100 text-red-700":i.category==="pop_culture"?"bg-purple-100 text-purple-700":i.category==="esports"?"bg-yellow-100 text-yellow-700":i.category==="politics"?"bg-blue-100 text-blue-700":i.category==="celebrity_gossip"?"bg-pink-100 text-pink-700":"bg-emerald-100 text-emerald-700"}`,children:i.category?.replace("_"," ")||"General"}),ee&&s.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-700",children:"Closing Soon"})]})]}),s.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2 leading-tight",children:i.title}),i.description&&s.jsx("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:i.description})]}),s.jsx("div",{className:"px-4 mb-4",children:s.jsxs("div",{className:"bg-gray-50 rounded-xl p-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-900",children:"Options"}),s.jsxs("span",{className:"text-xs text-gray-500",children:[Array.isArray(i.options)?i.options.length:0," choices"]})]}),s.jsxs("div",{className:"space-y-2",children:[(i.options||[]).slice(0,3).map((C,E)=>{const S=C.total_staked||C.totalStaked||0,J=Array.isArray(i.options)?i.options.length:0,Q=$>0?S/$*100:J>0?100/J:0,Z=C.current_odds||(S>0?Math.max($/S,1.01):J||2);return s.jsx(N.button,{className:"w-full p-3 rounded-lg border-2 border-gray-200 bg-white hover:border-emerald-300 hover:bg-emerald-50 transition-all group",whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>a&&a(),children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("div",{className:"font-medium text-gray-900 group-hover:text-emerald-700",children:C.label}),s.jsxs("div",{className:"text-sm text-gray-500",children:[Q.toFixed(0),"% • ",j(S)]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-lg font-bold text-emerald-600",children:[Z.toFixed(1),"x"]})})]})},C.id)}),(i.options?.length||0)>3&&s.jsxs("div",{className:"text-center text-sm text-gray-500",children:["+",(i.options?.length||0)-3," more options available"]})]})]})}),s.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-100",children:s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx("span",{className:"font-semibold text-gray-900",children:j($)}),s.jsx("span",{className:"text-gray-500",children:"pool"})]}),s.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[s.jsx(Nn,{className:"w-4 h-4"}),s.jsx("span",{children:ie})]}),s.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[s.jsx(ht,{className:"w-4 h-4"}),s.jsx("span",{className:ee?"text-amber-600 font-medium":"",children:U()})]})]}),ie>5&&s.jsxs("div",{className:"flex items-center gap-1 text-emerald-600",children:[s.jsx(Me,{className:"w-4 h-4"}),s.jsx("span",{className:"font-medium",children:"Trending"})]})]})}),s.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsxs(N.button,{onClick:D,disabled:m,className:`flex items-center gap-2 ${I?"text-red-500":"text-gray-600"} hover:text-red-500 transition-colors`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[s.jsx(dt,{className:`w-5 h-5 ${I?"fill-current":""}`}),s.jsx("span",{className:"text-sm font-medium",children:A})]}),s.jsxs(N.button,{onClick:P,className:"flex items-center gap-2 text-gray-600 hover:text-blue-500 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[s.jsx($e,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm font-medium",children:W})]}),s.jsxs(N.button,{onClick:M,className:"flex items-center gap-2 text-gray-600 hover:text-emerald-500 transition-colors",whileHover:{scale:1.05},whileTap:{scale:.95},children:[s.jsx(cr,{className:"w-5 h-5"}),s.jsx("span",{className:"text-sm font-medium",children:"Share"})]})]}),s.jsx(N.button,{onClick:a,className:"bg-gradient-to-r from-purple-600 to-emerald-600 text-white px-6 py-2 rounded-lg font-medium shadow-sm",whileHover:{scale:1.02,boxShadow:"0 8px 25px rgba(123, 47, 247, 0.25)"},whileTap:{scale:.98},children:"Predict Now"})]})})]}),s.jsx(Bs,{prediction:i,isOpen:h,onClose:()=>f(!1)})]})},qu=i=>s.jsx($r,{children:s.jsx(Vu,{...i})}),Gu=()=>s.jsxs("div",{className:"bg-white rounded-2xl p-4 mx-4 mb-3 shadow-sm border border-gray-100 animate-pulse",children:[s.jsxs("div",{className:"flex items-start justify-between mb-3",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4 mb-2"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-1"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}),s.jsx("div",{className:"ml-3 flex-shrink-0",children:s.jsx("div",{className:"w-16 h-6 bg-gray-200 rounded-full"})})]}),s.jsx("div",{className:"mb-4",children:s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{className:"p-3 border-2 border-gray-200 rounded-xl",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-8"})]}),s.jsxs("div",{className:"p-3 border-2 border-gray-200 rounded-xl",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),s.jsx("div",{className:"h-3 bg-gray-200 rounded w-8"})]})]})}),s.jsxs("div",{className:"flex items-center justify-between text-sm mb-4",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-10"})]}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})]}),s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-6"})]}),s.jsx("div",{className:"w-20 h-8 bg-gray-200 rounded-lg"})]})]}),ki=i=>typeof i=="boolean"?`${i}`:i===0?"0":i,_i=Un,Ju=(i,e)=>t=>{var r;if(e?.variants==null)return _i(i,t?.class,t?.className);const{variants:n,defaultVariants:o}=e,a=Object.keys(n).map(c=>{const u=t?.[c],h=o?.[c];if(u===null)return null;const f=ki(u)||ki(h);return n[c][f]}),l=t&&Object.entries(t).reduce((c,u)=>{let[h,f]=u;return f===void 0||(c[h]=f),c},{}),d=e==null||(r=e.compoundVariants)===null||r===void 0?void 0:r.reduce((c,u)=>{let{class:h,className:f,...m}=u;return Object.entries(m).every(g=>{let[x,y]=g;return Array.isArray(y)?y.includes({...o,...l}[x]):{...o,...l}[x]===y})?[...c,h,f]:c},[]);return _i(i,a,d,t?.class,t?.className)},Ku=Ju("inline-flex items-center justify-center rounded-lg text-sm font-semibold ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-[0.98]",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground shadow-sm",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-sm",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-12 px-6 py-3",sm:"h-9 px-4 py-2 text-xs",lg:"h-14 px-8 py-4",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),hr=p.forwardRef(({className:i,variant:e,size:t,asChild:r=!1,...n},o)=>{const a=r?po:"button";return s.jsx(a,{className:Se(Ku({variant:e,size:t,className:i})),ref:o,...n})});hr.displayName="Button";const Jn=p.forwardRef(({className:i,type:e,...t},r)=>s.jsx("input",{type:e,className:Se("flex h-12 w-full rounded-lg border border-input bg-background px-4 py-3 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),ref:r,...t}));Jn.displayName="Input";const pr=p.forwardRef(({className:i,...e},t)=>s.jsx("div",{ref:t,className:Se("rounded-xl border bg-card text-card-foreground shadow-sm",i),...e}));pr.displayName="Card";const Yu=p.forwardRef(({className:i,...e},t)=>s.jsx("div",{ref:t,className:Se("flex flex-col space-y-1.5 p-6",i),...e}));Yu.displayName="CardHeader";const Zu=p.forwardRef(({className:i,...e},t)=>s.jsx("h3",{ref:t,className:Se("font-semibold leading-none tracking-tight",i),...e}));Zu.displayName="CardTitle";const Qu=p.forwardRef(({className:i,...e},t)=>s.jsx("p",{ref:t,className:Se("text-sm text-muted-foreground",i),...e}));Qu.displayName="CardDescription";const fr=p.forwardRef(({className:i,...e},t)=>s.jsx("div",{ref:t,className:Se("p-6 pt-0",i),...e}));fr.displayName="CardContent";const Xu=p.forwardRef(({className:i,...e},t)=>s.jsx("div",{ref:t,className:Se("flex items-center p-6 pt-0",i),...e}));Xu.displayName="CardFooter";const Te=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(i),eh=(i,e)=>i*e,Si=(...i)=>i.filter(Boolean).join(" "),th=i=>{const e=i.entry_deadline||i.entryDeadline;if(!e)return"Time remaining unknown";const t=Math.max(0,new Date(e).getTime()-Date.now()),r=Math.floor(t/(1e3*60*60));return t<=0?"Ended":r>=24?`${Math.floor(r/24)}d left`:`${r}h left`},sh=({prediction:i,isOpen:e,onClose:t})=>{if(!i||!e)return null;const[r,n]=p.useState(""),[o,a]=p.useState(""),[l,d]=p.useState(!1),{user:c}=oe(),{getBalance:u,lockFunds:h}=Yt(),{placePrediction:f}=Xt(),m=u("USD")||0,g=parseFloat(o)||0,x=i?.options?.find(k=>k.id===r),y=x?.current_odds||(x?.total_staked?i?.pool_total/x.total_staked:2),v=x?eh(g,y):0,b=[5,10,25,50,100,250],w=async()=>{if(!r){F.error("Please select a prediction option (Yes or No)");return}if(!g){F.error("Please enter an amount to stake");return}if(g<i.stake_min){F.error(`Minimum stake is ${Te(i.stake_min)}. Please increase your amount.`);return}if(i.stake_max&&g>i.stake_max){F.error(`Maximum stake is ${Te(i.stake_max)}. Please reduce your amount.`);return}if(g>m){F.error(`Insufficient balance. You have ${Te(m)} available, but tried to stake ${Te(g)}.`);return}if(!c?.id){F.error("You must be logged in to place predictions");return}d(!0);try{await h(g,"USD"),await f(i.id,r,g,c.id),F.success(`Prediction placed successfully! You staked ${Te(g)} on ${x?.label}.`),t(),a(""),n("")}catch(k){const I=k?.message||"Unknown error occurred";F.error(`Failed to place prediction: ${I}. Please try again.`)}finally{d(!1)}};return s.jsx(xe,{mode:"wait",initial:!1,children:e&&s.jsxs(s.Fragment,{children:[s.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:t,style:{zIndex:8e3}},"prediction-modal-backdrop"),s.jsx("div",{className:"fixed inset-0 flex items-end justify-center p-4 pb-20",style:{zIndex:8500,pointerEvents:"none"},children:s.jsxs(N.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:"w-full max-w-md bg-white rounded-t-2xl shadow-2xl flex flex-col max-h-[75vh]",style:{pointerEvents:"auto"},onClick:k=>k.stopPropagation(),children:[s.jsx("div",{className:"flex-shrink-0 p-4 border-b border-gray-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Place Prediction"}),s.jsx("button",{onClick:t,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close modal",children:s.jsx(Re,{size:20})})]})}),s.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[s.jsxs("div",{className:"space-y-2",children:[s.jsx("h3",{className:"font-semibold text-gray-900 text-base",children:i.title}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[s.jsxs("span",{children:[Te(i.pool_total||0)," Pool"]}),s.jsx("span",{children:"•"}),s.jsxs("span",{children:[i.participant_count||0," Players"]}),s.jsx("span",{children:"•"}),s.jsx("span",{children:th(i)})]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Select your prediction:"}),s.jsx("div",{className:"space-y-2",children:(i.options||[]).map(k=>{const I=k.total_staked||0,_=i.pool_total||1,A=_>0?Math.min(I/_*100,100):50,K=k.current_odds||(I>0?_/I:2);return s.jsx(pr,{className:Si("cursor-pointer transition-all border-2",r===k.id?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-gray-300"),onClick:()=>n(k.id),children:s.jsx(fr,{className:"p-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"font-medium text-gray-900",children:k.label}),s.jsxs("div",{className:"text-sm text-gray-500",children:[A.toFixed(1),"%"]})]}),s.jsx("div",{className:"text-right",children:s.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[K.toFixed(2),"x"]})})]})})},k.id||Math.random())})})]}),s.jsx(xe,{mode:"wait",children:r&&s.jsxs(N.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stake amount"}),s.jsxs("div",{className:"relative",children:[s.jsx(Jn,{type:"number",placeholder:"0.00",value:o,onChange:k=>a(k.target.value),className:"pl-8 pr-4 h-12 text-lg font-medium",min:i.stake_min,max:i.stake_max||m}),s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"$"})]}),s.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[s.jsxs("span",{children:["Balance: ",Te(m)]}),s.jsx("button",{onClick:()=>a(m.toString()),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Max"})]})]}),s.jsx("div",{children:s.jsx("div",{className:"grid grid-cols-3 gap-2",children:b.map(k=>s.jsxs(hr,{variant:"outline",size:"sm",onClick:()=>a(k.toString()),disabled:k>m,className:"text-sm h-10",children:["$",k]},k))})}),g>0&&s.jsx(pr,{className:"bg-teal-50 border-teal-200",children:s.jsx(fr,{className:"p-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Potential return"}),s.jsx("div",{className:"text-lg font-bold text-teal-600",children:Te(v)})]}),s.jsxs("div",{className:"text-right",children:[s.jsx("div",{className:"text-sm text-gray-500",children:"Profit"}),s.jsx("div",{className:Si("font-semibold",v>g?"text-teal-600":"text-red-600"),children:Te(v-g)})]})]})})})]},`amount-input-${r}`)})]}),s.jsx("div",{className:"flex-shrink-0 p-4 border-t border-gray-200 bg-white",children:s.jsx(hr,{onClick:w,disabled:!r||!g||l||g>m,className:"w-full h-12 bg-teal-500 hover:bg-teal-600 disabled:bg-gray-400 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg flex items-center justify-center",children:l?s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),s.jsx("span",{children:"Placing..."})]}):s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(Cn,{size:16}),s.jsxs("span",{children:["Place Prediction (",Te(g),")"]})]})})})]},"prediction-modal-content")})]})})},rh=({hasNext:i,loading:e,onLoadMore:t,threshold:r=200,disabled:n=!1,container:o=null})=>{const a=p.useRef(!1),l=p.useCallback(()=>{if(n||e||!i||a.current)return;let c,u,h;o?(c=o.scrollTop,u=o.scrollHeight,h=o.clientHeight):(c=window.pageYOffset||document.documentElement.scrollTop,u=document.documentElement.scrollHeight,h=window.innerHeight||document.documentElement.clientHeight);const f=u-(c+h);f<=r&&(console.log("🔄 Infinite scroll triggered:",{distanceFromBottom:f,threshold:r,hasNext:i,loading:e,container:o?"container":"window"}),a.current=!0,t(),setTimeout(()=>{a.current=!1},1e3))},[n,e,i,r,t,o]);return p.useEffect(()=>{if(n)return;let c;const u=()=>{clearTimeout(c),c=setTimeout(l,100)},h=o||window,f="scroll",m="touchmove";return h.addEventListener(f,u,{passive:!0}),o||window.addEventListener(m,u,{passive:!0}),()=>{h.removeEventListener(f,u),o||window.removeEventListener(m,u),clearTimeout(c)}},[l,n,o]),{triggerLoadMore:p.useCallback(()=>{!n&&!e&&i&&!a.current&&(console.log("🔄 Manual infinite scroll trigger"),a.current=!0,t(),setTimeout(()=>{a.current=!1},1e3))},[n,e,i,t])}},Kn=({size:i="md",variant:e="full",className:t="",onClick:r})=>{const o={sm:"w-8 h-8",md:"w-12 h-12",lg:"w-16 h-16",xl:"w-24 h-24"}[i];return s.jsxs("div",{className:`${o} ${t} ${r?"cursor-pointer":""} flex items-center justify-center`,onClick:r,role:r?"button":void 0,tabIndex:r?0:void 0,children:[s.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[s.jsx("circle",{cx:"50",cy:"50",r:"48",fill:"#00F5D4",stroke:"#00F5D4",strokeWidth:"2"}),s.jsx("path",{d:"M 15 15 Q 15 15 35 15 Q 50 15 50 30 Q 50 50 35 50 L 15 50 Q 15 50 15 85 Q 15 85 35 85 Q 85 85 85 50 Q 85 15 50 15 L 35 15 Z",fill:"#7B2FF7"}),s.jsxs("g",{fill:"white",children:[s.jsx("rect",{x:"22",y:"25",width:"6",height:"28"}),s.jsx("rect",{x:"22",y:"25",width:"18",height:"5"}),s.jsx("rect",{x:"22",y:"36",width:"14",height:"4"})]}),s.jsx("g",{fill:"white",transform:"translate(45, 15)",children:s.jsx("path",{d:"M 15 10 Q 5 10 5 20 L 5 30 Q 5 40 15 40 L 25 40 L 25 35 L 15 35 Q 10 35 10 30 L 10 20 Q 10 15 15 15 L 25 15 L 25 10 Z"})})]}),e==="full"&&i!=="sm"&&s.jsx("span",{className:"ml-2 font-bold text-gray-900 text-lg",children:"Fan Club Z"})]})},ih=Ke((i,e)=>({positions:{},saveScrollPosition:(t,r)=>{i(n=>({positions:{...n.positions,[t]:{path:t,scrollY:r,timestamp:Date.now()}}}))},getScrollPosition:t=>{const r=e().positions[t];return r&&Date.now()-r.timestamp<10*60*1e3?r.scrollY:null},clearOldPositions:()=>{const t=Date.now(),r=10*60*1e3;i(n=>({positions:Object.fromEntries(Object.entries(n.positions).filter(([,o])=>t-o.timestamp<r))}))}})),nh=(i,e={})=>{const[t]=pe(),{saveScrollPosition:r,getScrollPosition:n}=ih(),o=p.useRef(""),{saveOnUnmount:a=!0,restoreOnMount:l=!0,preserveFor:d=10,threshold:c=50}=e,u=p.useCallback(()=>i?.current?i.current:document.querySelector("[data-scroll-container]")||document.documentElement,[i]),h=p.useCallback(()=>{const g=u(),x=g===document.documentElement?window.pageYOffset||document.documentElement.scrollTop:g.scrollTop;x>c&&(console.log(`💾 Saving scroll position for ${t}: ${x}px`),r(t,x))},[t,c,r,u]),f=p.useCallback(()=>{const g=u(),x=n(t);return x!==null&&x>0?(console.log(`🔄 Restoring scroll position for ${t}: ${x}px`),setTimeout(()=>{g===document.documentElement?window.scrollTo({top:x,behavior:"smooth"}):g.scrollTo({top:x,behavior:"smooth"})},100),!0):!1},[t,n,u]),m=p.useCallback(g=>{const x=u(),y=x===document.documentElement?window.pageYOffset||document.documentElement.scrollTop:x.scrollTop,v=g||t;y>c&&(console.log(`💾 Manually saving scroll for ${v}: ${y}px`),r(v,y))},[t,c,r,u]);return p.useEffect(()=>{let g;return l&&(g=setTimeout(()=>{f()},50)),()=>{g&&clearTimeout(g),a&&h()}},[l,a,f,h]),p.useEffect(()=>{o.current&&o.current!==t&&console.log(`🔄 Location changed from ${o.current} to ${t}`),o.current=t},[t]),{saveScroll:m,restoreScroll:f,saveCurrentScroll:h}},Yn=ne.memo(function({selectedCategory:e,onSelect:t}){const r=[{id:"all",label:"All",icon:"🌟"},{id:"sports",label:"Sports",icon:"⚽"},{id:"pop_culture",label:"Pop Culture",icon:"🎬"},{id:"custom",label:"Custom",icon:"✨"},{id:"politics",label:"Politics",icon:"🗳️"},{id:"crypto",label:"Crypto",icon:"₿"},{id:"tech",label:"Tech",icon:"💻"},{id:"finance",label:"Finance",icon:"📈"}];return s.jsx("div",{className:"category-filters bg-white border-b border-gray-100 px-4 py-3","data-tour-id":"category-filters",children:s.jsx("div",{className:"category-filters-container overflow-x-auto -mx-2 px-2",children:s.jsx("div",{className:"category-filters-flex flex gap-2 pb-1",children:r.map(n=>s.jsx(N.button,{onClick:()=>t(n.id),className:`
                category-pill flex-shrink-0 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium
                transition-all duration-200 whitespace-nowrap
                ${e===n.id?"active bg-purple-500 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
              `,whileTap:{scale:.96},children:s.jsx("span",{children:n.label})},n.id))})})})});Yn.displayName="CategoryFilters";const Zn=ne.memo(function({user:e,stats:t,searchQuery:r,onSearchChange:n,onNavigateToProfile:o}){return s.jsxs("div",{className:"bg-white border-b border-gray-100 sticky top-0 z-50",children:[s.jsx("div",{className:"h-11"}),s.jsxs("div",{className:"px-4 pb-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Kn,{size:"md",variant:"icon"}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Discover"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Find your next winning prediction"})]})]}),s.jsx("button",{onClick:o,className:"w-10 h-10 rounded-full bg-gradient-to-r from-purple-400 to-purple-500 flex items-center justify-center text-white font-semibold shadow-lg",children:e?.email?.[0]?.toUpperCase()||"U"})]}),s.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-purple-50 to-emerald-50 rounded-2xl p-4 mb-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full animate-pulse"}),s.jsx("span",{className:"text-sm font-medium text-gray-900",children:"LIVE MARKETS"})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["$",t?.totalVolume||"0"]}),s.jsx("div",{className:"text-xs text-gray-600",children:"Volume"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-gray-900",children:t?.activePredictions||"0"}),s.jsx("div",{className:"text-xs text-gray-600",children:"Live"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"text-lg font-bold text-gray-900",children:t?.totalUsers||"0"}),s.jsx("div",{className:"text-xs text-gray-600",children:"Players"})]})]})]}),s.jsxs("div",{className:"relative","data-tour-id":"search-bar",children:[s.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:s.jsx(_n,{className:"h-5 w-5 text-gray-400"})}),s.jsx("input",{type:"text",placeholder:"Search predictions...",value:r,onChange:a=>n(a.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:bg-white focus:ring-2 focus:ring-purple-500 focus:outline-none transition-all"})]})]})]})});Zn.displayName="MobileHeader";const Qn=ne.memo(function({onNavigateToProfile:e,onNavigateToPrediction:t}){const{user:r}=oe(),{predictions:n,loading:o,loadingMore:a,pagination:l,filters:d,refreshPredictions:c,loadMorePredictions:u,setFilters:h}=Xt(),[f,m]=p.useState(null),[g,x]=p.useState(!1),y=p.useRef(null),{saveScroll:v}=nh(y,{saveOnUnmount:!0,restoreOnMount:!0,preserveFor:15,threshold:100}),[b,w]=p.useState({totalVolume:"0",activePredictions:0,totalUsers:"0",rawVolume:0,rawUsers:0}),k=p.useCallback(async()=>{try{const{getApiUrl:$}=await pt(()=>Promise.resolve().then(()=>dc),void 0),j=await fetch(`${$()}/api/v2/predictions/stats/platform`);if(j.ok){const D=await j.json();D.success&&(w(D.data),console.log("✅ Platform stats fetched:",D.data))}else console.error("Failed to fetch platform stats:",j.status)}catch($){console.error("Error fetching platform stats:",$)}},[]);rh({hasNext:l.hasNext,loading:a,onLoadMore:()=>{console.log("🔄 Infinite scroll triggered in DiscoverPage:",{hasNext:l.hasNext,loading:a,currentPage:l.page,total:l.total}),u()},threshold:300,container:y.current}),p.useEffect(()=>{c(),k()},[c,k]);const I=p.useMemo(()=>({totalVolume:b.totalVolume,activePredictions:b.activePredictions,totalUsers:b.totalUsers}),[b]),_=p.useMemo(()=>!n||!Array.isArray(n)?(console.log("🔍 DiscoverPage Debug - No valid predictions array:",n),[]):(console.log(`🔍 DiscoverPage Debug - Displaying ${n.length} predictions`),n.filter($=>!$||!$.id||!$.title?(console.warn("⚠️ DiscoverPage: Invalid prediction object:",$),!1):!0)),[n]),A=p.useCallback($=>{m($),x(!0)},[]),K=p.useCallback($=>{v("/discover"),t?t($):window.location.href=`/prediction/${$}`},[t,v]),W=p.useCallback($=>{se.success("Prediction liked!")},[]),Y=p.useCallback($=>{v("/discover"),K($)},[K,v]),T=p.useCallback($=>{const j=`Check out this prediction: ${$.title}`,D=`${window.location.origin}/prediction/${$.id}`;navigator.share?navigator.share({title:$.title,text:j,url:D}).catch(console.error):navigator.clipboard.writeText(`${j}
${D}`).then(()=>se.success("Link copied to clipboard!")).catch(()=>se.error("Failed to copy link"))},[]),L=p.useCallback($=>{console.log("🔍 Search query changed:",$),h({search:$})},[h]),ee=p.useCallback($=>{console.log("📂 Category changed:",$),h({category:$})},[h]),ie=p.useCallback(()=>{x(!1),m(null)},[]);return o&&(!n||n.length===0)?s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsxs("div",{className:"bg-white border-b border-gray-100",children:[s.jsx("div",{className:"h-11"}),s.jsxs("div",{className:"px-4 pb-4",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-24 mb-2 loading-skeleton"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 loading-skeleton"})]}),s.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full loading-skeleton"})]}),s.jsxs("div",{className:"bg-gray-200 rounded-2xl p-4 mb-4 loading-skeleton",children:[s.jsx("div",{className:"h-4 bg-gray-300 rounded w-20 mb-3 loading-skeleton"}),s.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),s.jsx("div",{className:"h-3 bg-gray-300 rounded w-16 mx-auto loading-skeleton"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),s.jsx("div",{className:"h-3 bg-gray-300 rounded w-12 mx-auto loading-skeleton"})]}),s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),s.jsx("div",{className:"h-3 bg-gray-300 rounded w-14 mx-auto loading-skeleton"})]})]})]}),s.jsx("div",{className:"h-12 bg-gray-200 rounded-xl loading-skeleton"})]})]}),s.jsx("div",{className:"px-4 py-3 bg-white border-b border-gray-100",children:s.jsx("div",{className:"flex gap-2 overflow-x-auto",children:[1,2,3,4,5,6].map($=>s.jsx("div",{className:"h-8 bg-gray-200 rounded-full w-20 flex-shrink-0 loading-skeleton"},$))})}),s.jsxs("div",{className:"py-4",children:[s.jsxs("div",{className:"px-4 mb-6",children:[s.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mb-2 loading-skeleton"}),s.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 loading-skeleton"})]}),s.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map($=>s.jsx(Gu,{},$))})]})]}):s.jsxs("div",{ref:y,className:"discover-page content-with-bottom-nav","data-scroll-container":!0,style:{position:"relative",zIndex:1,overflowY:"auto",height:"100vh"},children:[s.jsx("div",{className:"discover-header",children:s.jsx("div",{className:"header-content",children:s.jsx(Zn,{user:r,stats:I,searchQuery:d.search,onSearchChange:L,onNavigateToProfile:e||(()=>{})})})}),s.jsx("div",{className:"category-filters-wrapper",style:{position:"relative",zIndex:45},children:s.jsx(Yn,{selectedCategory:d.category,onSelect:ee})}),s.jsxs("div",{className:"prediction-cards-container",children:[s.jsxs(N.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"px-4 mb-4",children:[s.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-1","data-tour-id":"discover-list",children:[d.category==="all"?"All Predictions":`${d.category} Predictions`,d.search&&` - "${d.search}"`]}),l.total>0&&s.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",_.length," of ",l.total," predictions",l.hasNext&&" • Scroll for more"]})]}),s.jsx("div",{className:"space-y-2",children:s.jsx(xe,{mode:"wait",children:_.length>0?s.jsxs(s.Fragment,{children:[_.map(($,j)=>!$||!$.id?(console.warn("⚠️ DiscoverPage: Skipping invalid prediction at index",j),null):s.jsx(qu,{prediction:$,variant:"compact",onPredict:()=>A($),onLike:()=>W($.id),onComment:()=>Y($.id),onShare:()=>T($)},`${$.id}-${j}`)),a&&s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:[s.jsx(cd,{className:"w-6 h-6 animate-spin text-purple-500 mr-3"}),s.jsx("span",{className:"text-gray-600",children:"Loading more predictions..."})]}),l.hasNext&&!a&&s.jsxs(N.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-6",children:[s.jsxs("button",{onClick:()=>{console.log("🔄 Manual load more triggered"),u()},className:"bg-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors",children:["Load More (",l.total-_.length," remaining)"]}),s.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Page ",l.page," • ",_.length,"/",l.total]})]}),!l.hasNext&&!a&&_.length>10&&s.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:s.jsx("p",{className:"text-gray-500 text-sm",children:"🎉 You've seen all predictions!"})})]}):s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center py-12 px-4",children:[s.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:s.jsx(Me,{size:24,className:"text-gray-400"})}),s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No predictions found"}),s.jsx("p",{className:"text-gray-600",children:d.search?`No predictions match "${d.search}"`:o?"Loading predictions...":"Try adjusting your filters or check back later"}),!o&&!d.search&&s.jsx("button",{onClick:()=>c(!0),className:"mt-4 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:"Refresh Predictions"})]})})})]}),s.jsx(sh,{prediction:f,isOpen:g,onClose:ie})]})});Qn.displayName="DiscoverPage";const Xn=Ke((i,e)=>({approvedSources:[],settlementConfigs:{},settlements:{},playerAcceptances:{},disputes:{},auditTimeline:{},loading:!1,error:null,selectedSource:null,settlementModalOpen:!1,disputeModalOpen:!1,fetchApprovedSources:async t=>{i({loading:!0,error:null});try{let r=R.from("approved_sources").select("*").eq("status","approved").order("name");t&&(r=r.eq("category",t));const{data:n,error:o}=await r;if(o)throw o;i({approvedSources:n||[]})}catch(r){console.error("Error fetching approved sources:",r),i({error:"Failed to fetch approved sources"})}finally{i({loading:!1})}},createSettlementConfig:async(t,r)=>{i({loading:!0,error:null});try{const{data:n,error:o}=await R.from("settlement_configs").insert({prediction_id:t,method:r.method||"manual",primary_source_id:r.primary_source_id,backup_source_id:r.backup_source_id,rule_text:r.rule_text||"",timezone:r.timezone||"Africa/Lagos",contingencies:r.contingencies||{},risk_flags:r.risk_flags||[],badges:r.badges||[]}).select().single();if(o)throw o;i(a=>({settlementConfigs:{...a.settlementConfigs,[t]:n}}))}catch(n){console.error("Error creating settlement config:",n),i({error:"Failed to create settlement configuration"})}finally{i({loading:!1})}},fetchSettlement:async t=>{i({loading:!0,error:null});try{const{data:r,error:n}=await R.from("settlements").select("*").eq("prediction_id",t).single();if(n&&n.code!=="PGRST116")throw n;r&&i(o=>({settlements:{...o.settlements,[t]:r}}))}catch(r){console.error("Error fetching settlement:",r),i({error:"Failed to fetch settlement data"})}finally{i({loading:!1})}},updateSettlementState:async(t,r,n,o)=>{i({loading:!0,error:null});try{const{data:a,error:l}=await R.rpc("update_settlement_state",{prediction_uuid:t,new_state:r,outcome_val:n,proof_data:o||{}});if(l)throw l;await e().fetchSettlement(t)}catch(a){console.error("Error updating settlement state:",a),i({error:"Failed to update settlement state"})}finally{i({loading:!1})}},acceptOutcome:async t=>{i({loading:!0,error:null});try{const{data:{user:r}}=await R.auth.getUser();if(!r)throw new Error("User not authenticated");const{error:n}=await R.rpc("record_player_acceptance",{prediction_uuid:t,user_uuid:r.id,action_val:"accepted"});if(n)throw n;await e().fetchPlayerAcceptances(t)}catch(r){console.error("Error accepting outcome:",r),i({error:"Failed to accept outcome"})}finally{i({loading:!1})}},createDispute:async(t,r,n)=>{i({loading:!0,error:null});try{const{data:{user:o}}=await R.auth.getUser();if(!o)throw new Error("User not authenticated");const{error:a}=await R.rpc("create_dispute",{prediction_uuid:t,user_uuid:o.id,reason_val:r,evidence_data:n||[]});if(a)throw a;await e().fetchDisputes(t)}catch(o){console.error("Error creating dispute:",o),i({error:"Failed to create dispute"})}finally{i({loading:!1})}},fetchPlayerAcceptances:async t=>{try{const{data:r,error:n}=await R.from("player_acceptances").select("*").eq("prediction_id",t).order("timestamp",{ascending:!1});if(n)throw n;i(o=>({playerAcceptances:{...o.playerAcceptances,[t]:r||[]}}))}catch(r){console.error("Error fetching player acceptances:",r)}},fetchDisputes:async t=>{try{const{data:r,error:n}=await R.from("disputes").select("*").eq("prediction_id",t).order("opened_at",{ascending:!1});if(n)throw n;i(o=>({disputes:{...o.disputes,[t]:r||[]}}))}catch(r){console.error("Error fetching disputes:",r)}},fetchAuditTimeline:async t=>{try{const{data:r,error:n}=await R.from("audit_timeline").select("*").eq("prediction_id",t).order("timestamp",{ascending:!1});if(n)throw n;i(o=>({auditTimeline:{...o.auditTimeline,[t]:r||[]}}))}catch(r){console.error("Error fetching audit timeline:",r)}},setSelectedSource:t=>i({selectedSource:t}),setSettlementModalOpen:t=>i({settlementModalOpen:t}),setDisputeModalOpen:t=>i({disputeModalOpen:t}),clearError:()=>i({error:null})})),oh=({onNavigateBack:i})=>{const[e,t]=p.useState(1),[r,n]=p.useState(!1),[o,a]=p.useState(!1),{createPrediction:l}=Xt(),{user:d,isAuthenticated:c}=oe(),[,u]=pe();p.useEffect(()=>{Nt({delay:200})},[]);const[h,f]=p.useState(""),[m,g]=p.useState(""),[x,y]=p.useState(""),[v,b]=p.useState("binary"),[w,k]=p.useState([{id:"1",label:"Yes"},{id:"2",label:"No"}]),[I,_]=p.useState(""),[A,K]=p.useState("1"),[W,Y]=p.useState("1000"),[T,L]=p.useState("manual"),[ee,ie]=p.useState(!1),[$,j]=p.useState(null),[D,P]=p.useState(null),[M,B]=p.useState(""),[U,C]=p.useState("Africa/Lagos"),[E,S]=p.useState({postponed:"auto_void",source_down:"use_backup"}),J=[{id:"sports",label:"Sports",icon:"⚽",gradient:"from-orange-500 to-red-500"},{id:"politics",label:"Politics",icon:"🏛️",gradient:"from-blue-500 to-indigo-500"},{id:"entertainment",label:"Entertainment",icon:"🎬",gradient:"from-purple-500 to-pink-500"},{id:"crypto",label:"Crypto",icon:"₿",gradient:"from-yellow-500 to-orange-500"},{id:"tech",label:"Technology",icon:"💻",gradient:"from-purple-500 to-teal-500"},{id:"custom",label:"Custom",icon:"⚡",gradient:"from-gray-500 to-gray-600"}],Q=[{id:"binary",label:"Yes/No",description:"Simple binary outcome prediction",icon:"🎯"},{id:"multiple",label:"Multiple Choice",description:"Multiple possible outcomes",icon:"🎲"}],Z=p.useCallback(()=>{const z=(w.length+1).toString();k(le=>[...le,{id:z,label:""}])},[w.length]),Be=p.useCallback(z=>{k(le=>le.filter(je=>je.id!==z))},[]),Ne=p.useCallback((z,le)=>{k(je=>je.map(me=>me.id===z?{...me,label:le}:me))},[]),he=p.useCallback(z=>{switch(z){case 1:return!!(h.trim()&&x);case 2:return!!(v&&w.every(le=>le.label.trim()));case 3:return!!(I&&A);case 4:return!0;default:return!0}},[h,x,v,w,I,A]),xt=p.useCallback(()=>{he(e)&&e<4&&(t(e+1),Nt({delay:150}))},[e,he]),Ce=p.useCallback(()=>{e>1?(t(e-1),Nt({delay:150})):i&&i()},[e,i]),Pe=p.useCallback(async()=>{if(!he(4)){F.error("Please fill in all required fields");return}n(!0);try{if(!h.trim())throw new Error("Title is required");if(!x)throw new Error("Category is required");if(!I)throw new Error("Entry deadline is required");const z=new Date(I);if(z<=new Date)throw new Error("Entry deadline must be in the future");if(!c||!d?.id)throw new Error("You must be logged in to create predictions");const le={title:h.trim(),description:m.trim()||void 0,category:x,type:v,options:w.filter(me=>me.label.trim()).map(me=>({id:me.id,label:me.label.trim(),totalStaked:0,currentOdds:2})),entryDeadline:z,stakeMin:Math.max(1,parseFloat(A)||100),stakeMax:W?Math.max(parseFloat(A)||100,parseFloat(W)):void 0,settlementMethod:T,isPrivate:ee,creatorId:d.id};if(le.options.length<2)throw new Error("At least 2 prediction options are required");console.log("Creating prediction with data:",le);const je=await l(le);if(console.log("Prediction created successfully!",je),T==="auto"&&je)try{const{createSettlementConfig:me}=Xn.getState();await me(je.id,{method:"web",primary_source_id:$?.id,backup_source_id:D?.id,rule_text:M||`Check if ${h} by ${I}`,timezone:U,contingencies:E}),console.log("Settlement configuration created successfully!")}catch(me){console.error("Failed to create settlement configuration:",me)}F.success("🎉 Prediction created successfully!"),a(!0),setTimeout(()=>{t(1),f(""),g(""),y(""),b("binary"),k([{id:"1",label:"Yes"},{id:"2",label:"No"}]),_(""),K("100"),Y("10000"),L("manual"),ie(!1),a(!1),n(!1),i&&(i(),setTimeout(()=>{u("/predictions")},100))},2e3)}catch(z){console.error("Failed to create prediction:",z);const le=z instanceof Error?z.message:"Failed to create prediction. Please try again.";F.error(le),n(!1)}},[he,h,x,I,m,v,w,A,W,T,ee,l,i,u]);return o?s.jsx("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-white to-teal-100 flex items-center justify-center px-6",children:s.jsxs(N.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.5},className:"bg-white rounded-3xl p-8 text-center shadow-2xl border border-teal-200",children:[s.jsx(N.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.2,type:"spring",stiffness:200,damping:10},className:"w-16 h-16 bg-teal-500 rounded-full flex items-center justify-center mx-auto mb-6",children:s.jsx(mi,{size:32,className:"text-white"})}),s.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Prediction Created!"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"Your prediction has been successfully created and is now live."}),s.jsx("div",{className:"text-sm text-teal-600 font-medium",children:"Redirecting to My Predictions..."})]})}):s.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 pb-20 create-prediction-page",children:[s.jsxs("div",{className:"relative overflow-hidden",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-purple-600 via-green-700 to-teal-600"}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 via-transparent to-purple-600/10"}),s.jsx("div",{className:"absolute top-0 right-1/3 w-72 h-72 bg-white/10 rounded-full blur-3xl animate-pulse"}),s.jsx("div",{className:"absolute bottom-0 left-1/3 w-72 h-72 bg-white/10 rounded-full blur-3xl animate-pulse",style:{animationDelay:"1s"}}),s.jsxs("div",{className:"relative z-10 px-6 pt-14 pb-8",children:[s.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx(N.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:Ce,className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white",children:s.jsx(gt,{size:20})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-3xl font-bold text-white",children:"Create Prediction"}),s.jsxs("p",{className:"text-green-100",children:["Step ",e," of 4"]})]})]}),s.jsx("div",{className:"bg-white/20 rounded-full h-2 mb-6",children:s.jsx(N.div,{initial:{width:0},animate:{width:`${e/4*100}%`},transition:{duration:.5},className:"h-full bg-white rounded-full"})})]})]}),s.jsx("div",{className:"px-6 -mt-4 pb-8 relative z-20",children:s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/90 backdrop-blur-xl rounded-3xl border border-gray-200/50 shadow-2xl p-6",children:[s.jsxs(xe,{mode:"wait",initial:!1,children:[e===1&&s.jsxs(N.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-teal-600 rounded-2xl flex items-center justify-center",children:s.jsx(Es,{size:24,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Basic Information"}),s.jsx("p",{className:"text-gray-600",children:"Tell us about your prediction"})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"input-container",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Prediction Title *"}),s.jsx("input",{type:"text",value:h,onChange:z=>f(z.target.value),placeholder:"Will Bitcoin reach $100,000 by end of 2024?",className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200 text-gray-900 placeholder-gray-500"})]}),s.jsxs("div",{className:"textarea-container",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Description (Optional)"}),s.jsx("textarea",{value:m,onChange:z=>g(z.target.value),placeholder:"Provide additional context and rules for your prediction...",rows:4,className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200 text-gray-900 placeholder-gray-500 resize-none"})]}),s.jsxs("div",{className:"form-section",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Category *"}),s.jsx("div",{className:"flex flex-wrap gap-3",children:J.map(z=>s.jsxs(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>y(z.id),className:`motion-button pill-category px-4 py-2.5 rounded-full text-sm font-semibold transition-all flex items-center gap-2 min-h-[40px] ${x===z.id?`bg-gradient-to-r ${z.gradient} text-white shadow-lg`:"bg-gray-100 text-gray-700 hover:bg-gray-200 border border-gray-200"}`,children:[s.jsx("span",{className:"text-base",children:z.icon}),s.jsx("span",{children:z.label})]},z.id))})]})]})]},"step1"),e===2&&s.jsxs(N.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center",children:s.jsx(ms,{size:24,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Prediction Setup"}),s.jsx("p",{className:"text-gray-600",children:"Configure your prediction options"})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Prediction Type *"}),s.jsx("div",{className:"space-y-3",children:Q.map(z=>s.jsx(N.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>{b(z.id),z.id==="binary"?k([{id:"1",label:"Yes"},{id:"2",label:"No"}]):z.id==="multiple"&&k([{id:"1",label:""},{id:"2",label:""},{id:"3",label:""}])},className:`motion-button w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${v===z.id?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-blue-300"}`,children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"text-2xl",children:z.icon}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:z.label}),s.jsx("p",{className:"text-sm text-gray-600",children:z.description})]})]})},z.id))})]}),(v==="binary"||v==="multiple")&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Prediction Options *"}),s.jsxs("div",{className:"space-y-3",children:[w.map((z,le)=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"input-container flex-1",children:s.jsx("input",{type:"text",value:z.label,onChange:je=>Ne(z.id,je.target.value),placeholder:`Option ${le+1}`,className:"w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all duration-200"})}),v==="multiple"&&w.length>2&&s.jsx(N.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>Be(z.id),className:"motion-button w-10 h-10 bg-red-100 text-red-600 rounded-xl flex items-center justify-center hover:bg-red-200 transition-colors",children:s.jsx(Re,{size:18})})]},z.id)),v==="multiple"&&w.length<6&&s.jsxs(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:Z,className:"motion-button w-full p-3 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 hover:border-blue-400 hover:text-blue-600 transition-all duration-200 flex items-center justify-center gap-2",children:[s.jsx(Qt,{size:18}),s.jsx("span",{children:"Add Option"})]})]})]})]})]},"step2"),e===3&&s.jsxs(N.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center",children:s.jsx(Wt,{size:24,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Settings & Launch"}),s.jsx("p",{className:"text-gray-600",children:"Final configuration details"})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"input-container",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Entry Deadline *"}),s.jsx("input",{type:"datetime-local",value:I,onChange:z=>_(z.target.value),min:new Date().toISOString().slice(0,16),className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200"})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"input-container",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Minimum Stake ($)"}),s.jsx("input",{type:"number",value:A,onChange:z=>K(z.target.value),placeholder:"100",min:"1",className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200"})]}),s.jsxs("div",{className:"input-container",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Maximum Stake ($)"}),s.jsx("input",{type:"number",value:W,onChange:z=>Y(z.target.value),placeholder:"100000",min:A||"1",className:"w-full p-4 border-2 border-gray-200 rounded-2xl focus:border-teal-500 focus:outline-none transition-all duration-200"})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Settlement Method"}),s.jsxs("div",{className:"space-y-3",children:[s.jsx(N.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>L("manual"),className:`w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${T==="manual"?"border-teal-500 bg-teal-50":"border-gray-200 bg-white hover:border-teal-300"}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-teal-100 rounded-lg flex items-center justify-center",children:s.jsx(Nn,{size:16,className:"text-teal-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Manual Settlement"}),s.jsx("p",{className:"text-sm text-gray-600",children:"You resolve the prediction manually"})]})]})}),s.jsx(N.button,{whileHover:{scale:1.01},whileTap:{scale:.99},onClick:()=>L("auto"),className:`w-full p-4 rounded-2xl border-2 text-left transition-all duration-200 ${T==="auto"?"border-teal-500 bg-teal-50":"border-gray-200 bg-white hover:border-teal-300"}`,children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center",children:s.jsx(ms,{size:16,className:"text-blue-600"})}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Automatic Settlement"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Resolved automatically when possible"})]})]})})]})]}),s.jsx("div",{className:"bg-gray-50 rounded-2xl p-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-semibold text-gray-900",children:"Private Prediction"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Only people with link can participate"})]}),s.jsx(N.button,{whileTap:{scale:.95},onClick:()=>ie(!ee),className:`relative w-12 h-6 rounded-full transition-all duration-200 ${ee?"bg-teal-500":"bg-gray-300"}`,children:s.jsx(N.div,{animate:{x:ee?24:2},transition:{type:"spring",stiffness:500,damping:30},className:"absolute top-1 w-4 h-4 bg-white rounded-full shadow"})})]})})]})]},"step3"),e===4&&s.jsxs(N.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},transition:{duration:.3},children:[s.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center",children:s.jsx(mi,{size:24,className:"text-white"})}),s.jsxs("div",{children:[s.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Preview & Confirm"}),s.jsx("p",{className:"text-gray-600",children:"Review your prediction before publishing"})]})]}),s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6 shadow-sm",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Prediction Preview"}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Title"}),s.jsx("p",{className:"text-lg font-semibold text-gray-900",children:h})]}),m&&s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Description"}),s.jsx("p",{className:"text-gray-700",children:m})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Category"}),s.jsx("span",{className:"inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:J.find(z=>z.id===x)?.label||x})]}),s.jsxs("div",{className:"mb-4",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-2",children:"Options"}),s.jsx("div",{className:"space-y-2",children:w.map((z,le)=>s.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg",children:[s.jsxs("span",{className:"text-sm font-medium text-gray-600",children:["Option ",le+1,":"]}),s.jsx("span",{className:"font-semibold text-gray-900",children:z.label})]},z.id))})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Stake Limits"}),s.jsxs("p",{className:"text-gray-900",children:["$",A," - $",W]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Deadline"}),s.jsx("p",{className:"text-gray-900",children:new Date(I).toLocaleString()})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Settlement"}),s.jsx("p",{className:"text-gray-900 capitalize",children:T})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-600 mb-1",children:"Privacy"}),s.jsx("p",{className:"text-gray-900",children:ee?"Private":"Public"})]})]})]}),s.jsx("div",{className:"bg-teal-50 border border-teal-200 rounded-2xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(Ps,{size:20,className:"text-teal-600"}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-semibold text-teal-800",children:"Ready to Publish"}),s.jsx("p",{className:"text-sm text-teal-700",children:'Your prediction looks good! Click "Create Prediction" to publish it.'})]})]})})]})]},"step4")]}),s.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-200",children:[s.jsx(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Ce,className:"px-6 py-3 bg-gray-100 text-gray-700 font-semibold rounded-xl hover:bg-gray-200 transition-all duration-200",children:e===1?"Cancel":"Back"}),e<4?s.jsx(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:xt,disabled:!he(e),className:`px-8 py-3 font-semibold rounded-xl shadow-lg transition-all duration-200 ${he(e)?"bg-gradient-to-r from-purple-500 to-teal-600 text-white shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:e===3?"Preview":"Continue"}):s.jsx(N.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:Pe,disabled:!he(4)||r,className:`px-8 py-3 font-semibold rounded-xl shadow-lg transition-all duration-200 flex items-center gap-2 ${he(4)&&!r?"bg-gradient-to-r from-purple-500 to-teal-600 text-white shadow-purple-500/25 hover:shadow-xl hover:shadow-purple-500/30":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:r?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating..."]}):"Create Prediction"})]})]})})]})},ah=()=>s.jsxs("div",{className:"p-4",style:{minHeight:"100vh",paddingBottom:"calc(5rem + env(safe-area-inset-bottom))"},children:[s.jsx("h1",{className:"text-2xl font-bold text-foreground mb-6",children:"My Predictions"}),s.jsxs("div",{className:"text-center py-12",children:[s.jsx("div",{className:"text-6xl mb-4",children:"📊"}),s.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"No predictions yet"}),s.jsx("p",{className:"text-muted-foreground mb-6",children:"Start making predictions to see them here"}),s.jsx("a",{href:"/discover",className:"inline-block bg-primary text-white px-6 py-2 rounded-lg font-semibold hover:bg-primary/90 transition-colors",children:"Explore Predictions"})]})]});class lh{constructor(e){re(this,"options");re(this,"element");re(this,"startY",0);re(this,"currentY",0);re(this,"pullDistance",0);re(this,"isRefreshing",!1);re(this,"isPulling",!1);re(this,"rafId",null);re(this,"indicatorElement",null);re(this,"disabled",!1);this.options={threshold:80,element:document.body,disabled:!1,...e},this.element=this.options.element,this.disabled=this.options.disabled,this.init()}init(){this.createIndicator(),this.bindEvents()}createIndicator(){this.indicatorElement=document.createElement("div"),this.indicatorElement.className="pull-to-refresh-indicator",this.indicatorElement.innerHTML=`
      <div class="pull-to-refresh-content">
        <div class="pull-to-refresh-icon">
          <svg class="pull-to-refresh-arrow" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12l7-7 7 7"/>
          </svg>
          <svg class="pull-to-refresh-spinner" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12a9 9 0 11-6.219-8.56"/>
          </svg>
        </div>
        <span class="pull-to-refresh-text">Pull to refresh</span>
      </div>
    `;const e=document.createElement("style");e.textContent=`
      .pull-to-refresh-indicator {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 80px;
        background: linear-gradient(135deg, #10b981, #059669);
        display: flex;
        align-items: center;
        justify-content: center;
        transform: translateY(-80px);
        transition: transform 0.2s ease;
        z-index: 9999;
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      
      .pull-to-refresh-indicator.visible {
        transform: translateY(0);
      }
      
      .pull-to-refresh-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
      }
      
      .pull-to-refresh-icon {
        position: relative;
        width: 24px;
        height: 24px;
      }
      
      .pull-to-refresh-arrow,
      .pull-to-refresh-spinner {
        position: absolute;
        top: 0;
        left: 0;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }
      
      .pull-to-refresh-arrow {
        opacity: 1;
        transform: rotate(180deg);
      }
      
      .pull-to-refresh-spinner {
        opacity: 0;
        animation: spin 1s linear infinite;
      }
      
      .pull-to-refresh-indicator.refreshing .pull-to-refresh-arrow {
        opacity: 0;
      }
      
      .pull-to-refresh-indicator.refreshing .pull-to-refresh-spinner {
        opacity: 1;
      }
      
      .pull-to-refresh-indicator.ready .pull-to-refresh-arrow {
        transform: rotate(0deg);
      }
      
      .pull-to-refresh-text {
        font-size: 14px;
        font-weight: 500;
      }
      
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    `,document.head.querySelector("#pull-to-refresh-styles")||(e.id="pull-to-refresh-styles",document.head.appendChild(e)),document.body.appendChild(this.indicatorElement)}bindEvents(){this.element.addEventListener("touchstart",this.onTouchStart.bind(this),{passive:!0}),this.element.addEventListener("touchmove",this.onTouchMove.bind(this),{passive:!1}),this.element.addEventListener("touchend",this.onTouchEnd.bind(this))}unbindEvents(){this.element.removeEventListener("touchstart",this.onTouchStart.bind(this)),this.element.removeEventListener("touchmove",this.onTouchMove.bind(this)),this.element.removeEventListener("touchend",this.onTouchEnd.bind(this))}findScrollableParent(e){let t=e.parentElement;for(;t;){const n=window.getComputedStyle(t).overflowY;if(n==="auto"||n==="scroll"||t.scrollHeight>t.clientHeight)return t;t=t.parentElement}return null}onTouchStart(e){if(this.disabled||this.isRefreshing||window.scrollY>5)return;const t=e.target,r=this.findScrollableParent(t);r&&r.scrollTop>5||(this.startY=e.touches[0].clientY,this.isPulling=!1)}onTouchMove(e){if(this.disabled||this.isRefreshing)return;this.currentY=e.touches[0].clientY,this.pullDistance=Math.max(0,this.currentY-this.startY);const t=window.scrollY<=5,r=e.target,n=this.findScrollableParent(r),o=!n||n.scrollTop<=5;this.pullDistance>50&&t&&o&&(e.preventDefault(),this.isPulling=!0,this.updateIndicator())}onTouchEnd(){this.disabled||this.isRefreshing||!this.isPulling||(this.pullDistance>=this.options.threshold?this.refresh():this.resetIndicator(),this.isPulling=!1,this.pullDistance=0)}updateIndicator(){if(!this.indicatorElement)return;const e=Math.min(1,this.pullDistance/this.options.threshold),t=Math.min(0,e*80-80);this.indicatorElement.style.transform=`translateY(${t}px)`,this.pullDistance>=this.options.threshold?(this.indicatorElement.classList.add("ready"),this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Release to refresh"):(this.indicatorElement.classList.remove("ready"),this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Pull to refresh")}async refresh(){if(this.indicatorElement){this.isRefreshing=!0,this.indicatorElement.classList.add("refreshing","visible"),this.indicatorElement.style.transform="translateY(0)",this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Refreshing...";try{await this.options.onRefresh()}catch(e){console.error("Pull to refresh error:",e)}await new Promise(e=>setTimeout(e,1e3)),this.resetIndicator()}}resetIndicator(){this.indicatorElement&&(this.isRefreshing=!1,this.indicatorElement.classList.remove("refreshing","ready","visible"),this.indicatorElement.style.transform="translateY(-80px)",this.indicatorElement.querySelector(".pull-to-refresh-text").textContent="Pull to refresh")}setDisabled(e){this.disabled=e}destroy(){this.unbindEvents(),this.indicatorElement&&this.indicatorElement.remove(),this.rafId&&cancelAnimationFrame(this.rafId)}}const ch=(i,e={})=>{const t=ne.useRef(null);return ne.useEffect(()=>(t.current=new lh({...e,onRefresh:i}),()=>{t.current?.destroy()}),[i]),{setDisabled:r=>t.current?.setDisabled(r),destroy:()=>t.current?.destroy()}},dh=Pn.version,uh=dh,lt=class lt{constructor(){re(this,"currentVersion");this.currentVersion=uh}static getInstance(){return lt.instance||(lt.instance=new lt),lt.instance}getVersion(){return this.currentVersion}incrementPatch(){const[e,t,r]=this.currentVersion.split(".").map(Number);return this.currentVersion=`${e}.${t}.${r+1}`,this.currentVersion}incrementMinor(){const[e,t]=this.currentVersion.split(".").map(Number);return this.currentVersion=`${e}.${t+1}.0`,this.currentVersion}incrementMajor(){const[e]=this.currentVersion.split(".").map(Number);return this.currentVersion=`${e+1}.0.0`,this.currentVersion}setVersion(e){this.currentVersion=e}getVersionInfo(){return{version:this.currentVersion,buildTime:new Date().toISOString(),cacheBuster:`v${this.currentVersion}-${new Date().toISOString().split("T")[0]}-auto`,environment:"production",isProduction:!0}}};re(lt,"instance");let mr=lt;const hh=mr.getInstance(),Ts=hh.getVersion(),ph=new Date().toISOString();`${Ts}${new Date().toISOString().split("T")[0]}`;const fh=({onBack:i})=>{oe();const[e,t]=p.useState({twoFactorEnabled:!1,emailNotifications:!0,pushNotifications:!0,marketingEmails:!1,publicProfile:!0,showEarnings:!1}),[r,n]=p.useState(!1),[o,a]=p.useState(""),[l,d]=p.useState(!1);p.useState(!1),p.useState({currentPassword:"",newPassword:"",confirmPassword:""});const[c,u]=p.useState({lastPasswordChange:"3 months ago",loginSessions:1,suspiciousActivity:0}),h=async()=>{o.toLowerCase()==="delete my account"?(d(!0),setTimeout(()=>{alert("Account deletion request submitted. You will receive a confirmation email."),n(!1),a(""),d(!1)},2e3)):alert('Please type "delete my account" to confirm.')},f=async m=>{d(!0),setTimeout(()=>{t({...e,[m]:!e[m]}),d(!1);const g=document.createElement("div");g.style.cssText=`
        position: fixed;
        top: 20px;
        right: 20px;
        background: #059669;
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        z-index: 10000;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      `,g.textContent="Setting updated successfully!",document.body.appendChild(g),setTimeout(()=>{document.body.removeChild(g)},3e3)},500)};return s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:s.jsx(gt,{size:24,style:{color:"#374151"}})}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Account Settings"})]})}),s.jsxs("div",{style:{padding:"24px"},children:[s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Profile Visibility"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Public Profile"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Allow others to see your profile"})]}),s.jsx("button",{onClick:()=>f("publicProfile"),disabled:l,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.publicProfile?"#059669":"#e5e7eb",position:"relative",cursor:l?"not-allowed":"pointer",transition:"background 0.2s",opacity:l?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.publicProfile?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Show Earnings"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Display your earnings on profile"})]}),s.jsx("button",{onClick:()=>f("showEarnings"),disabled:l,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.showEarnings?"#059669":"#e5e7eb",position:"relative",cursor:l?"not-allowed":"pointer",transition:"background 0.2s",opacity:l?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.showEarnings?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Security Status"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Last Password Change"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:c.lastPasswordChange})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Active Sessions"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:c.loginSessions})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Suspicious Activity"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:c.suspiciousActivity>0?"#dc2626":"#059669"},children:c.suspiciousActivity===0?"None detected":`${c.suspiciousActivity} incidents`})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Account Security"}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Two-Factor Authentication"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Add extra security to your account"})]}),s.jsx("button",{onClick:()=>f("twoFactorEnabled"),disabled:l,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.twoFactorEnabled?"#059669":"#e5e7eb",position:"relative",cursor:l?"not-allowed":"pointer",transition:"background 0.2s",opacity:l?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.twoFactorEnabled?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Danger Zone"}),s.jsx("div",{style:{marginBottom:"12px"},children:s.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 12px 0"},children:"Once you delete your account, there is no going back. Please be certain."})}),r?s.jsxs("div",{style:{border:"2px solid #ef4444",borderRadius:"8px",padding:"16px"},children:[s.jsx("h4",{style:{fontSize:"16px",fontWeight:"600",color:"#dc2626",margin:"0 0 12px 0"},children:"⚠️ Confirm Account Deletion"}),s.jsx("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 16px 0"},children:"This action cannot be undone. This will permanently delete your account and all associated data."}),s.jsxs("p",{style:{fontSize:"14px",color:"#6b7280",margin:"0 0 16px 0"},children:["Type ",s.jsx("strong",{children:'"delete my account"'})," to confirm:"]}),s.jsx("input",{type:"text",value:o,onChange:m=>a(m.target.value),placeholder:"Type: delete my account",style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",marginBottom:"16px",boxSizing:"border-box"}}),s.jsxs("div",{style:{display:"flex",gap:"8px"},children:[s.jsx("button",{onClick:()=>{n(!1),a("")},style:{flex:1,padding:"10px",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500"},children:"Cancel"}),s.jsx("button",{onClick:h,disabled:l||o.toLowerCase()!=="delete my account",style:{flex:1,padding:"10px",background:o.toLowerCase()==="delete my account"?"#dc2626":"#9ca3af",color:"white",border:"none",borderRadius:"6px",cursor:o.toLowerCase()==="delete my account"&&!l?"pointer":"not-allowed",fontWeight:"500"},children:l?"Processing...":"Delete Account"})]})]}):s.jsx("button",{style:{width:"100%",padding:"12px",background:"rgba(239, 68, 68, 0.1)",color:"#dc2626",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",cursor:"pointer",fontWeight:"500"},onClick:()=>n(!0),children:"Delete Account"})]})]})]})},mh=({onBack:i})=>{const[e,t]=p.useState({pushEnabled:!0,emailEnabled:!0,predictionUpdates:!0,winLossAlerts:!0,clubActivity:!0,socialInteractions:!1,marketingEmails:!1,weeklyDigest:!0}),[r,n]=p.useState(!1),[o,a]=p.useState("default");ne.useEffect(()=>{"Notification"in window&&a(Notification.permission)},[]);const l=async()=>{if("Notification"in window){const u=await Notification.requestPermission();a(u),d(u==="granted"?"Notifications enabled successfully!":"You can enable notifications in your browser settings later.")}},d=u=>{const h=document.createElement("div");h.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      background: #059669;
      color: white;
      padding: 12px 16px;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    `,h.textContent=u,document.body.appendChild(h),setTimeout(()=>{document.body.contains(h)&&document.body.removeChild(h)},3e3)},c=async u=>{u==="pushEnabled"&&!e.pushEnabled&&o!=="granted"&&(await l(),o!=="granted")||(n(!0),setTimeout(()=>{t({...e,[u]:!e[u]}),n(!1),d("Notification setting updated!")},500))};return s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:s.jsx(gt,{size:24,style:{color:"#374151"}})}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Notifications"})]})}),s.jsxs("div",{style:{padding:"24px"},children:[o!=="granted"&&s.jsx("div",{style:{background:"rgba(255, 176, 32, 0.1)",border:"1px solid rgba(255, 176, 32, 0.3)",borderRadius:"12px",padding:"16px",marginBottom:"16px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"24px",height:"24px",background:"#ffb020",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"14px",fontWeight:"bold"},children:"!"}),s.jsxs("div",{style:{flex:1},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:"600",color:"#b45309",margin:"0 0 4px 0"},children:"Enable Browser Notifications"}),s.jsx("p",{style:{fontSize:"12px",color:"#b45309",margin:0},children:o==="denied"?"Notifications are blocked. You can enable them in your browser settings.":"Click to enable push notifications for real-time updates."})]}),o==="default"&&s.jsx("button",{onClick:l,style:{padding:"6px 12px",background:"#ffb020",color:"white",border:"none",borderRadius:"6px",fontSize:"12px",fontWeight:"600",cursor:"pointer"},children:"Enable"})]})}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"General"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Push Notifications"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Receive notifications on your device"})]}),s.jsx("button",{onClick:()=>c("pushEnabled"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.pushEnabled?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.pushEnabled?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Email Notifications"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Receive notifications via email"})]}),s.jsx("button",{onClick:()=>c("emailEnabled"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.emailEnabled?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.emailEnabled?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Prediction Alerts"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Win/Loss Alerts"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Get notified when predictions resolve"})]}),s.jsx("button",{onClick:()=>c("winLossAlerts"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.winLossAlerts?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.winLossAlerts?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{fontWeight:"500",fontSize:"14px"},children:"Club Activity"}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Activity from clubs you've joined"})]}),s.jsx("button",{onClick:()=>c("clubActivity"),disabled:r,style:{width:"44px",height:"24px",borderRadius:"12px",border:"none",background:e.clubActivity?"#059669":"#e5e7eb",position:"relative",cursor:r?"not-allowed":"pointer",opacity:r?.6:1},children:s.jsx("div",{style:{width:"20px",height:"20px",borderRadius:"50%",background:"white",position:"absolute",top:"2px",left:e.clubActivity?"22px":"2px",transition:"left 0.2s",boxShadow:"0 1px 3px rgba(0, 0, 0, 0.1)"}})})]})]})]})]})]})},gh=({onBack:i})=>{const[e,t]=p.useState(!1),[r,n]=p.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[o,a]=p.useState(!1),[l,d]=p.useState({lastPasswordChange:"3 months ago",loginSessions:1,suspiciousActivity:0}),c=async()=>{if(r.newPassword!==r.confirmPassword){alert("New passwords do not match!");return}if(r.newPassword.length<8){alert("Password must be at least 8 characters long!");return}a(!0),setTimeout(()=>{alert("Password changed successfully!"),n({currentPassword:"",newPassword:"",confirmPassword:""}),t(!1),a(!1),d({...l,lastPasswordChange:"Just now"})},2e3)};return s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:s.jsx(gt,{size:24,style:{color:"#374151"}})}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Security & Privacy"})]})}),s.jsxs("div",{style:{padding:"24px"},children:[s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Password & Authentication"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>t(!e),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(dd,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Change Password"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]}),e&&s.jsxs("div",{style:{marginTop:"16px",padding:"16px",background:"#f8f9fa",borderRadius:"8px",border:"1px solid #e5e7eb"},children:[s.jsx("h4",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"12px",margin:"0 0 12px 0"},children:"Change Password"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsx("input",{type:"password",placeholder:"Current Password",value:r.currentPassword,onChange:u=>n({...r,currentPassword:u.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}}),s.jsx("input",{type:"password",placeholder:"New Password (min 8 characters)",value:r.newPassword,onChange:u=>n({...r,newPassword:u.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}}),s.jsx("input",{type:"password",placeholder:"Confirm New Password",value:r.confirmPassword,onChange:u=>n({...r,confirmPassword:u.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"6px",fontSize:"14px",boxSizing:"border-box"}}),s.jsxs("div",{style:{display:"flex",gap:"8px",marginTop:"8px"},children:[s.jsx("button",{onClick:()=>{t(!1),n({currentPassword:"",newPassword:"",confirmPassword:""})},style:{flex:1,padding:"8px",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"6px",cursor:"pointer",fontWeight:"500",fontSize:"14px"},children:"Cancel"}),s.jsx("button",{onClick:c,disabled:o||!r.currentPassword||!r.newPassword||!r.confirmPassword,style:{flex:1,padding:"8px",background:o||!r.currentPassword||!r.newPassword||!r.confirmPassword?"#9ca3af":"#059669",color:"white",border:"none",borderRadius:"6px",cursor:o||!r.currentPassword||!r.newPassword||!r.confirmPassword?"not-allowed":"pointer",fontWeight:"500",fontSize:"14px"},children:o?"Updating...":"Update Password"})]})]})]}),s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Two-factor authentication setup will be available in the next update!"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(Ar,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Two-Factor Authentication"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Privacy Controls"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Privacy settings will be available soon"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(Ir,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Profile Privacy"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]}),s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Data management features coming soon"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(wn,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Data & Privacy"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Login Activity"}),s.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginBottom:"12px"},children:"Recent login activity and device management"}),s.jsxs("div",{style:{padding:"12px",background:"#f9fafb",borderRadius:"8px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"4px"},children:[s.jsx("span",{style:{fontWeight:"500",fontSize:"14px"},children:"Current Device"}),s.jsx("span",{style:{fontSize:"12px",color:"#059669"},children:"Active Now"})]}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"MacBook Pro • Chrome • Gainesville, GA"})]})]})]})]})},xh=({onBack:i})=>{const[e,t]=p.useState("predictions"),[r,n]=p.useState([]),[o,a]=p.useState(!0),[l,d]=p.useState(null),c=async g=>{try{a(!0),d(null);const x=ue(),y=await fetch(`${x}/api/v2/users/leaderboard?type=${g==="winrate"?"accuracy":g}&limit=50`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!y.ok)throw new Error(`Failed to fetch leaderboard: ${y.status}`);const v=await y.json();if(v.error)throw new Error(v.message||"Failed to fetch leaderboard");const b=(v.data||[]).map((w,k)=>({...w,rank:k+1,won_entries:Math.round(w.win_rate/100*w.total_entries)}));n(b)}catch(x){console.error("Error fetching leaderboard:",x),d(x instanceof Error?x.message:"Failed to load leaderboard"),n([])}finally{a(!1)}};p.useEffect(()=>{c(e)},[e]);const u=[{id:"sample-1",username:"PredictionMaster",predictions_count:15,total_profit:2450.75,total_invested:1200,win_rate:78,total_entries:23,won_entries:18,rank:1},{id:"sample-2",username:"SportsSage",predictions_count:12,total_profit:1890.25,total_invested:950,win_rate:75,total_entries:16,won_entries:12,rank:2},{id:"sample-3",username:"TrendSpotter",predictions_count:18,total_profit:1650.5,total_invested:800,win_rate:72,total_entries:25,won_entries:18,rank:3},{id:"sample-4",username:"AnalyticsAce",predictions_count:8,total_profit:1200,total_invested:600,win_rate:70,total_entries:10,won_entries:7,rank:4},{id:"sample-5",username:"DataDriven",predictions_count:6,total_profit:980.75,total_invested:500,win_rate:68,total_entries:9,won_entries:6,rank:5}],h=()=>{const g=r.length>0?r:u;return e==="winrate"?g.filter(x=>x.total_entries>=3):g},f=g=>{switch(g){case 1:return{emoji:"🏆",color:"#ffd700"};case 2:return{emoji:"🥈",color:"#c0c0c0"};case 3:return{emoji:"🥉",color:"#cd7f32"};default:return{emoji:`#${g}`,color:"#6b7280"}}},m=(g,x)=>{switch(x){case"predictions":return{primary:g.predictions_count.toString(),secondary:"predictions created",accent:g.total_entries>0?`${g.total_entries} entries`:"No entries"};case"profit":return{primary:`${g.total_profit.toLocaleString()}`,secondary:"net profit",accent:`${g.total_invested.toLocaleString()} invested`};case"winrate":return{primary:`${g.win_rate}%`,secondary:"win rate",accent:`${g.won_entries}/${g.total_entries} won`}}};return s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:s.jsx(gt,{size:24,style:{color:"#374151"}})}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Leaderboard"})]})}),s.jsx("div",{style:{padding:"16px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:s.jsx("div",{style:{display:"flex",gap:"4px",background:"#f3f4f6",borderRadius:"12px",padding:"4px"},children:[{key:"predictions",label:"Predictions"},{key:"profit",label:"Profit"},{key:"winrate",label:"Win Rate"}].map(g=>s.jsx("button",{onClick:()=>t(g.key),style:{flex:1,padding:"12px 16px",borderRadius:"8px",border:"none",background:e===g.key?"white":"transparent",color:e===g.key?"#111827":"#6b7280",fontWeight:e===g.key?"600":"500",fontSize:"14px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",transition:"all 0.2s ease",boxShadow:e===g.key?"0 1px 3px rgba(0, 0, 0, 0.1)":"none"},children:g.label},g.key))})}),s.jsx("div",{style:{padding:"0 24px 100px 24px"},children:s.jsx("div",{style:{paddingTop:"16px"},children:o?s.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"40px"},children:s.jsx("div",{style:{width:"32px",height:"32px",border:"3px solid #e5e7eb",borderTop:"3px solid #059669",borderRadius:"50%",animation:"spin 1s linear infinite"}})}):l?s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"24px",textAlign:"center",border:"1px solid #fecaca"},children:[s.jsx("p",{style:{color:"#dc2626",margin:"0 0 12px 0"},children:"Failed to load leaderboard"}),s.jsx("p",{style:{color:"#6b7280",fontSize:"14px",margin:"0 0 16px 0"},children:l}),s.jsx("button",{onClick:()=>c(e),style:{background:"#059669",color:"white",border:"none",borderRadius:"8px",padding:"8px 16px",cursor:"pointer"},children:"Retry"})]}):s.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:h().map((g,x)=>{const y=f(g.rank),v=m(g,e),b=g.rank<=3;return s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:x*.05},style:{background:b?"linear-gradient(135deg, rgba(5, 150, 105, 0.05), rgba(123, 47, 247, 0.05))":"white",border:b?"2px solid rgba(5, 150, 105, 0.2)":"1px solid #e5e7eb",borderRadius:"16px",padding:"20px",display:"flex",alignItems:"center",gap:"16px",boxShadow:b?"0 8px 24px rgba(5, 150, 105, 0.15)":"0 2px 8px rgba(0, 0, 0, 0.05)",transition:"all 0.2s ease",cursor:"pointer"},whileHover:{scale:1.02,y:-2},children:[s.jsx("div",{style:{width:"48px",height:"48px",borderRadius:"50%",background:b?y.color:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",fontSize:b?"20px":"16px",fontWeight:"700",color:b?"white":"#6b7280",boxShadow:b?"0 4px 12px rgba(0, 0, 0, 0.2)":"none",flexShrink:0},children:g.rank<=3?y.emoji:g.rank}),s.jsx(gs,{email:g.username,username:g.username,avatarUrl:g.avatar_url,size:"md",className:"ring-2 ring-white"}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[s.jsx("h4",{style:{fontSize:"16px",fontWeight:"700",color:"#111827",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:g.full_name||g.username}),b&&s.jsx("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",color:"white",fontSize:"10px",fontWeight:"700",padding:"2px 6px",borderRadius:"4px",textTransform:"uppercase"},children:g.rank===1?"Champion":g.rank===2?"Elite":"Pro"})]}),s.jsxs("p",{style:{color:"#6b7280",fontSize:"13px",margin:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["@",g.username," • ",v.accent]})]}),s.jsxs("div",{style:{textAlign:"right",flexShrink:0},children:[s.jsx("div",{style:{fontSize:"20px",fontWeight:"700",color:b?"#059669":"#111827",marginBottom:"2px"},children:v.primary}),s.jsx("div",{style:{fontSize:"11px",color:"#6b7280",textTransform:"uppercase",letterSpacing:"0.5px"},children:v.secondary})]})]},`${e}-${g.id}`)})})})})]})},yh=({onBack:i})=>s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsx("div",{style:{padding:"20px 24px",background:"white",borderBottom:"1px solid #e5e7eb"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[s.jsx("button",{onClick:i,style:{background:"none",border:"none",cursor:"pointer"},children:s.jsx(gt,{size:24,style:{color:"#374151"}})}),s.jsx("h1",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",margin:0},children:"Help & Support"})]})}),s.jsxs("div",{style:{padding:"24px"},children:[s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Get Help"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("https://help.fanclubz.com/faq","_blank")||alert("FAQ section will open in a new window"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(jn,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Frequently Asked Questions"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]}),s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("mailto:support@fanclubz.com"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(hd,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Contact Support"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]}),s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>alert("Live chat will be available 24/7 starting next week!"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx($e,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Live Chat"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"Resources"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/terms","_blank")||alert("Terms of Service will open in a new window"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(wn,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Terms of Service"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]}),s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/privacy","_blank")||alert("Privacy Policy will open in a new window"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(Ar,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Privacy Policy"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]}),s.jsxs("button",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",padding:"12px",background:"none",border:"1px solid #e5e7eb",borderRadius:"8px",cursor:"pointer",textAlign:"left"},onClick:()=>window.open("/community-guidelines","_blank")||alert("Community Guidelines will open in a new window"),children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx(dt,{size:20,style:{color:"#6b7280"}}),s.jsx("span",{style:{fontWeight:"500"},children:"Community Guidelines"})]}),s.jsx(ve,{size:16,style:{color:"#9ca3af"}})]})]})]}),s.jsxs("div",{style:{background:"white",borderRadius:"12px",padding:"20px"},children:[s.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",marginBottom:"16px",margin:"0 0 16px 0"},children:"App Information"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"App Version"}),s.jsxs("span",{style:{fontSize:"14px",fontWeight:"500"},children:["v",Ts]})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Build Number"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:"2024.07.30"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Last Updated"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:"July 30, 2025"})]})]})]})]})]}),eo=({onNavigateBack:i,userId:e})=>{const{user:t,updateProfile:r,logout:n}=oe(),{getUserPredictionEntries:o,getUserCreatedPredictions:a,fetchUserPredictionEntries:l,fetchUserCreatedPredictions:d}=Xt(),[c,u]=p.useState("overview"),[h,f]=p.useState(!1),[m,g]=p.useState(!1),[x,y]=p.useState(null),[v,b]=p.useState(!1),[w,k]=p.useState({full_name:t?.full_name||"",username:t?.username||"",email:t?.email||""}),I=!e||e===t?.id,A=!I&&!(I||!!x&&!v);ne.useEffect(()=>{if(!t){console.log("⏳ Waiting for currentUser to load...");return}try{if(console.log("🔎 ProfilePage useEffect triggered with:",{userId:e,currentUserId:t?.id}),!e||typeof e!="string"||e.trim()===""){console.log("ℹ️ No valid userId provided, viewing own profile"),m||g(!1),x!==t&&y(t);return}const j=e!==t?.id;console.log("🔄 Profile viewing decision:",{userId:e,currentUserId:t?.id,isViewingOther:j}),m!==j&&g(j),j?(console.log("👥 Viewing other user profile:",e),(!x||x.id!==e)&&K(e)):(console.log("👤 Viewing own profile"),x!==t&&y(t))}catch(j){console.error("❌ Error in profile useEffect:",j),m&&g(!1),x!==t&&y(t)}},[e,t?.id]);const K=ne.useCallback(async j=>{if(v){console.log("🔄 Already loading profile, skipping request");return}b(!0);try{console.log("🔍 Fetching profile for user ID:",j),/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(j)||console.warn("⚠️ Invalid userId format, but attempting API call anyway:",j);const M=`${ue()}/api/v2/users/${j}`;console.log("🌐 Making API request to:",M);const B=await fetch(M,{method:"GET",headers:{"Content-Type":"application/json"},signal:AbortSignal.timeout(1e4)});if(console.log("📝 API Response status:",B.status,B.statusText),!B.ok){if(B.status===404){console.warn("⚠️ User not found:",j),g(!1),y(t),b(!1);return}throw new Error(`HTTP error! status: ${B.status} ${B.statusText}`)}const U=await B.json();if(console.log("📦 Raw API response:",U),U.error)throw new Error(U.message||"Failed to fetch user profile");const C=U.data;if(!C)throw new Error("No user data in API response");const E={id:C.id,firstName:C.full_name?.split(" ")[0]||C.username||"Unknown",lastName:C.full_name?.split(" ").slice(1).join(" ")||"",email:C.email||"",bio:C.bio||"No bio available",avatar:C.avatar_url||null,totalEarnings:C.stats?.totalEarnings||0,totalInvested:C.stats?.totalInvested||0,winRate:C.stats?.winRate||0,activePredictions:C.stats?.predictionsCreated||0,totalPredictions:C.stats?.predictionsParticipated||0,rank:0,level:C.reputation_score>1e3?"Advanced Predictor":C.reputation_score>500?"Intermediate Predictor":"New Predictor",createdAt:C.created_at,username:C.username||C.full_name||"unknown_user",isVerified:C.is_verified||!1};console.log("✅ User profile transformed successfully:",E),y(E)}catch(D){console.error("❌ Error fetching user profile:",D),D.name==="AbortError"?console.log("⏱️ Request timed out"):D.message.includes("ERR_BLOCKED_BY_CLIENT")&&console.log("🚫 Request blocked by client (likely ad blocker)");const P={id:j,firstName:"Unknown",lastName:"User",email:"",bio:D instanceof Error?"Profile temporarily unavailable":"Profile not available",avatar:null,totalEarnings:0,totalInvested:0,winRate:0,activePredictions:0,totalPredictions:0,rank:0,level:"Unknown",createdAt:new Date().toISOString(),username:"unknown_user",isVerified:!1};console.log("🎆 Setting fallback user:",P),y(P)}finally{b(!1)}},[v]);ne.useEffect(()=>{Nt({behavior:"instant"})},[]);const W=ne.useCallback(async()=>{console.log("Pull to refresh triggered on Profile page"),await new Promise(j=>setTimeout(j,500))},[]);ch(W,{threshold:60,disabled:!1}),ne.useEffect(()=>{const j=e||t?.id;if(!j||!t)return;let D=!0,P=!1;const M=()=>{if(!(!D||P))try{console.log("📊 ProfilePage: Fetching data for user:",j),l(j),d(j),P=!0}catch(C){console.error("Error fetching user prediction data:",C)}},{isAuthenticated:B,initialized:U}=oe.getState();if(U&&B)M();else{const C=oe.subscribe(E=>{E.initialized&&E.isAuthenticated&&!P&&(M(),C())});return()=>{D=!1,C()}}return()=>{D=!1}},[e,t?.id]);const Y=ne.useMemo(()=>{const j=x||t,D=e||t?.id;if(!j||!D)return{totalEarnings:0,totalInvested:0,winRate:0,activePredictions:0,totalPredictions:0,rank:0,joinedDate:"Recently",level:"New Predictor"};try{const P=o(D)||[],M=a(D)||[],B=P.filter(Q=>Q?.status==="active").length,U=P.filter(Q=>Q?.status==="won"||Q?.status==="lost"),C=P.filter(Q=>Q?.status==="won"),E=P.reduce((Q,Z)=>Q+(Z?.amount||0),0),S=C.reduce((Q,Z)=>Q+(Z?.actual_payout||0),0),J=U.length>0?Math.round(C.length/U.length*100):0;return{totalEarnings:S,totalInvested:E,winRate:J,activePredictions:B,totalPredictions:P.length+M.length,rank:j.rank||0,joinedDate:j.createdAt?new Date(j.createdAt).toLocaleDateString("en-US",{year:"numeric",month:"long"}):"Recently",level:B>5?"Expert Predictor":B>0?"Active Predictor":"New Predictor"}}catch(P){return console.error("Error calculating user stats:",P),{totalEarnings:0,totalInvested:0,winRate:0,activePredictions:0,totalPredictions:0,rank:0,joinedDate:"Recently",level:"New Predictor"}}},[x?.id,e,t?.id]),T=ne.useMemo(()=>[{id:"account",label:"Account Settings",icon:ms,description:"Manage your account preferences",action:()=>u("account")},{id:"notifications",label:"Notifications",icon:vn,description:"Control your notification settings",action:()=>u("notifications")},{id:"security",label:"Security & Privacy",icon:Ar,description:"Manage security settings",action:()=>u("security")},{id:"help",label:"Help & Support",icon:jn,description:"Get help and contact support",action:()=>u("help")}],[u]),L=ne.useMemo(()=>{const j=e||t?.id;if(!j)return[];try{const D=o(j)||[],P=a(j)||[],M=D.length,B=P.length,U=D.filter(E=>E?.status==="won").length,C=D.filter(E=>E?.status==="won").reduce((E,S)=>E+(S?.actual_payout||0),0);return[{id:1,title:"First Prediction",icon:"🎯",unlocked:M>0,description:"Make your first prediction"},{id:2,title:"Active Predictor",icon:"🔥",unlocked:M>=3,description:`Make 3 predictions (${M}/3)`},{id:3,title:"Top Predictor",icon:"👑",unlocked:U>=5,description:`Win 5 predictions (${U}/5)`},{id:4,title:"Community Leader",icon:"⭐",unlocked:B>=2,description:`Create 2 predictions (${B}/2)`}]}catch(D){return console.error("Error calculating achievements:",D),[]}},[e,t?.id]),ee=()=>{r({...t,full_name:w.full_name,username:w.username,email:w.email}),f(!1)},ie=()=>{k({full_name:t?.full_name||"",username:t?.username||"",email:t?.email||""}),f(!1)},$=()=>{const j=()=>{n(),i&&i()},D=document.createElement("div");D.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    `,D.innerHTML=`
      <div style="
        background: white;
        border-radius: 16px;
        padding: 24px;
        max-width: 320px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      ">
        <div style="
          width: 48px;
          height: 48px;
          background: #fef3c7;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          margin: 0 auto 16px;
        ">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
            <path d="M9 12l2 2 4-4"/>
            <path d="M21 12c0 4.97-4.03 9-9 9s-9-4.03-9-9 4.03-9 9-9 9 4.03 9 9z"/>
          </svg>
        </div>
        <h3 style="
          font-size: 18px;
          font-weight: 700;
          color: #111827;
          margin: 0 0 8px 0;
        ">Sign Out</h3>
        <p style="
          font-size: 14px;
          color: #6b7280;
          margin: 0 0 24px 0;
          line-height: 1.5;
        ">Are you sure you want to sign out of your account?</p>
        <div style="
          display: flex;
          gap: 12px;
          justify-content: center;
        ">
          <button onclick="dialog.remove()" style="
            padding: 10px 20px;
            background: #f3f4f6;
            color: #374151;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
          " onmouseover="this.style.backgroundColor='#e5e7eb'" onmouseout="this.style.backgroundColor='#f3f4f6'">
            Cancel
          </button>
          <button onclick="window.confirmLogout()" style="
            padding: 10px 20px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s;
          " onmouseover="this.style.backgroundColor='#dc2626'" onmouseout="this.style.backgroundColor='#ef4444'">
            Sign Out
          </button>
        </div>
      </div>
    `,window.confirmLogout=()=>{D.remove(),j()},document.body.appendChild(D)};return ne.useEffect(()=>{m&&c!=="overview"&&u("overview")},[m,c]),!m&&c==="account"?s.jsx(fh,{onBack:()=>u("overview")}):!m&&c==="notifications"?s.jsx(mh,{onBack:()=>u("overview")}):!m&&c==="security"?s.jsx(gh,{onBack:()=>u("overview")}):!m&&c==="help"?s.jsx(yh,{onBack:()=>u("overview")}):!m&&c==="leaderboard"?s.jsx(xh,{onBack:()=>u("overview")}):m&&v?s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsxs("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",minHeight:"300px"},children:[s.jsx("div",{style:{height:"44px"}}),s.jsx("div",{style:{padding:"20px 16px",position:"relative",zIndex:10},children:s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"40px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i&&s.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:s.jsx(ct,{size:20,style:{color:"white"}})}),s.jsx("h1",{style:{color:"white",fontSize:"24px",fontWeight:"700",margin:0},children:"Profile"})]})})})]}),s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{width:"40px",height:"40px",border:"3px solid #059669",borderTop:"3px solid transparent",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 16px"}}),s.jsx("p",{style:{color:"#6b7280",fontSize:"16px"},children:"Loading profile..."})]})})]}):m&&!v&&!x?s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[s.jsxs("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",minHeight:"300px"},children:[s.jsx("div",{style:{height:"44px"}}),s.jsx("div",{style:{padding:"20px 16px",position:"relative",zIndex:10},children:s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"40px"},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i&&s.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:s.jsx(ct,{size:20,style:{color:"white"}})}),s.jsx("h1",{style:{color:"white",fontSize:"24px",fontWeight:"700",margin:0},children:"Profile"})]})})})]}),s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"40px"},children:s.jsxs("div",{style:{textAlign:"center"},children:[s.jsx("div",{style:{width:"48px",height:"48px",background:"#fef3c7",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:s.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#f59e0b",strokeWidth:"2",children:s.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),s.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",margin:"0 0 8px 0"},children:"Profile Not Found"}),s.jsx("p",{style:{color:"#6b7280",fontSize:"16px",margin:"0 0 24px 0"},children:"The user profile you're looking for doesn't exist or is not available."}),i&&s.jsx("button",{onClick:i,style:{background:"#059669",color:"white",border:"none",borderRadius:"12px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer"},children:"Go Back"})]})})]}):s.jsxs("div",{style:{minHeight:"100vh",backgroundColor:"#f9fafb"},children:[A&&s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-gradient-to-r from-purple-500 to-emerald-600 pt-12 pb-6",children:s.jsx("div",{className:"px-6",children:s.jsxs("div",{className:"flex items-center gap-4",children:[i&&s.jsx("button",{onClick:i,className:"bg-white/20 p-2 rounded-lg backdrop-blur-sm",children:s.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),s.jsx("h1",{className:"text-white text-2xl font-bold",children:"Profile"})]})})}),s.jsx("div",{className:"p-6",children:s.jsxs("div",{className:"animate-pulse",children:[s.jsx("div",{className:"h-24 bg-white rounded-2xl shadow mb-4"}),s.jsx("div",{className:"h-32 bg-white rounded-2xl shadow"})]})})]}),s.jsxs("div",{style:{background:"linear-gradient(135deg, #059669, #7B2FF7)",minHeight:"300px"},"data-tour-id":"profile-header",children:[s.jsx("div",{style:{position:"absolute",top:"20px",right:"20px",width:"100px",height:"100px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%",filter:"blur(20px)"}}),s.jsx("div",{style:{position:"absolute",bottom:"20px",left:"30px",width:"80px",height:"80px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"50%",filter:"blur(15px)"}}),s.jsx("div",{style:{height:"44px"}}),s.jsx("div",{style:{padding:"20px 16px",position:"relative",zIndex:10},children:s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"40px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[i&&s.jsx("button",{onClick:i,style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:s.jsx(ct,{size:20,style:{color:"white"}})}),s.jsx("h1",{style:{color:"white",fontSize:"24px",fontWeight:"700",margin:0},children:m?"User Profile":"Profile"})]}),!m&&s.jsx("button",{onClick:()=>f(!h),style:{background:"rgba(255, 255, 255, 0.2)",border:"none",borderRadius:"12px",padding:"10px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(10px)"},children:h?s.jsx(Re,{size:20,style:{color:"white"}}):s.jsx(fd,{size:20,style:{color:"white"}})})]})}),s.jsx("div",{"data-tour-id":"profile-card",style:{margin:"16px",background:"white",borderRadius:"16px",padding:"24px",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1)",minHeight:"180px"},children:s.jsx(xe,{mode:"wait",children:!m&&h?s.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px",marginBottom:"16px"},children:[s.jsxs("div",{style:{position:"relative",flexShrink:0},children:[s.jsx(gs,{email:w.email,avatarUrl:t?.avatar_url,size:"xl",className:"ring-4 ring-white"}),s.jsx("button",{style:{position:"absolute",bottom:"0",right:"0",width:"28px",height:"28px",background:"#059669",border:"2px solid white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"},onClick:()=>{const j=document.createElement("input");j.type="file",j.accept="image/*",j.onchange=async D=>{const P=D.target.files?.[0];if(P)try{const M=await oe.getState().uploadAvatar(P);console.log("Avatar uploaded:",M)}catch(M){console.error("Avatar upload failed",M),alert("Failed to upload image. Please try again.")}},j.click()},children:s.jsx(id,{size:12,style:{color:"white"}})})]}),s.jsxs("div",{style:{flex:1,minWidth:0,paddingTop:"4px"},children:[s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"10px"},children:[s.jsx("input",{type:"text",placeholder:"First Name",value:w.full_name,onChange:j=>k({...w,full_name:j.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontWeight:"600",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:j=>j.target.style.borderColor="#059669",onBlur:j=>j.target.style.borderColor="#e5e7eb"}),s.jsx("input",{type:"text",placeholder:"Last Name",value:w.username,onChange:j=>k({...w,username:j.target.value}),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"14px",fontWeight:"600",outline:"none",transition:"border-color 0.2s",boxSizing:"border-box"},onFocus:j=>j.target.style.borderColor="#059669",onBlur:j=>j.target.style.borderColor="#e5e7eb"})]}),s.jsx("input",{type:"email",placeholder:"Email",value:w.email,onChange:j=>k({...w,email:j.target.value}),style:{width:"100%",padding:"8px 10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"13px",marginBottom:"6px",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:j=>j.target.style.borderColor="#059669",onBlur:j=>j.target.style.borderColor="#e5e7eb"}),s.jsx("textarea",{placeholder:"Bio (optional)",value:w.email,onChange:j=>k({...w,email:j.target.value}),style:{width:"100%",padding:"8px 10px",border:"1px solid #e5e7eb",borderRadius:"8px",fontSize:"13px",resize:"none",height:"50px",outline:"none",boxSizing:"border-box",transition:"border-color 0.2s"},onFocus:j=>j.target.style.borderColor="#059669",onBlur:j=>j.target.style.borderColor="#e5e7eb"})]})]}),s.jsxs("div",{style:{display:"flex",gap:"10px",justifyContent:"flex-end",marginTop:"16px"},children:[s.jsx("button",{onClick:ie,style:{padding:"8px 16px",background:"#f3f4f6",color:"#374151",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"14px",transition:"background-color 0.2s"},onMouseEnter:j=>j.currentTarget.style.backgroundColor="#e5e7eb",onMouseLeave:j=>j.currentTarget.style.backgroundColor="#f3f4f6",children:"Cancel"}),s.jsxs("button",{onClick:ee,style:{padding:"8px 16px",background:"#059669",color:"white",border:"none",borderRadius:"8px",cursor:"pointer",fontWeight:"600",fontSize:"14px",display:"flex",alignItems:"center",gap:"4px",transition:"background-color 0.2s"},onMouseEnter:j=>j.currentTarget.style.backgroundColor="#7B2FF7",onMouseLeave:j=>j.currentTarget.style.backgroundColor="#059669",children:[s.jsx(yd,{size:16}),"Save"]})]})]},"editing"):s.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},transition:{duration:.2},children:[s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"16px",marginBottom:"16px"},children:[s.jsx("div",{style:{position:"relative",flexShrink:0},children:s.jsx(gs,{email:x?.email,username:x?.username,avatarUrl:x?.avatar,size:"lg",className:"ring-4 ring-white"})}),s.jsxs("div",{style:{flex:1,minWidth:0,paddingTop:"4px"},children:[s.jsx("h2",{style:{fontSize:"20px",fontWeight:"700",color:"#111827",marginBottom:"4px",margin:0,lineHeight:"1.2"},children:x?.firstName&&x?.lastName?`${x.firstName} ${x.lastName}`:x?.email?.split("@")[0]||"User"}),s.jsx("p",{style:{color:"#6b7280",fontSize:"14px",marginBottom:"4px",margin:"4px 0",lineHeight:"1.3"},children:m?"":x?.email||"No email provided"}),x?.bio&&s.jsx("p",{style:{color:"#6b7280",fontSize:"13px",margin:"4px 0",lineHeight:"1.3"},children:x.bio}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"6px",marginTop:"6px"},children:[s.jsx(wd,{size:14,style:{color:"#fbbf24"}}),s.jsxs("span",{style:{fontSize:"12px",color:"#6b7280",fontWeight:"500"},children:["Rank #",Y.rank," • ",Y.level]})]})]})]}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"12px",marginTop:"12px"},children:[s.jsxs("div",{style:{textAlign:"center",padding:"6px"},children:[s.jsx("div",{style:{fontSize:"18px",fontWeight:"700",color:"#111827"},children:Y.totalPredictions}),s.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:"Predictions"})]}),s.jsxs("div",{style:{textAlign:"center",padding:"6px"},children:[s.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#059669"},children:[Y.winRate,"%"]}),s.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:"Win Rate"})]}),s.jsxs("div",{style:{textAlign:"center",padding:"6px"},children:[s.jsxs("div",{style:{fontSize:"18px",fontWeight:"700",color:"#111827"},children:["$",(Y.totalEarnings-Y.totalInvested).toLocaleString()]}),s.jsx("div",{style:{fontSize:"11px",color:"#6b7280"},children:"Net Profit"})]})]})]},"viewing")})})]}),s.jsxs("div",{style:{padding:"0 24px 100px 24px"},children:[s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",marginBottom:"16px",margin:"0 0 16px 0"},children:"Performance Overview"}),s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px"},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",background:"rgba(5, 150, 105, 0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(Wt,{size:20,style:{color:"#059669"}})}),s.jsxs("div",{style:{minWidth:0},children:[s.jsxs("div",{style:{fontSize:"16px",fontWeight:"700",color:"#111827"},children:["$",Y.totalEarnings.toLocaleString()]}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Total Earnings"})]})]}),s.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px"},children:[s.jsx("div",{style:{width:"40px",height:"40px",background:"rgba(59, 130, 246, 0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(Me,{size:20,style:{color:"#3b82f6"}})}),s.jsxs("div",{style:{minWidth:0},children:[s.jsx("div",{style:{fontSize:"16px",fontWeight:"700",color:"#111827"},children:Y.activePredictions}),s.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:"Active"})]})]})]})]}),s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",margin:0},children:"Achievements"}),!m&&s.jsxs("button",{onClick:()=>u("leaderboard"),style:{background:"rgba(5, 150, 105, 0.1)",border:"1px solid rgba(5, 150, 105, 0.3)",borderRadius:"8px",padding:"6px 12px",fontSize:"12px",fontWeight:"600",color:"#059669",cursor:"pointer",display:"flex",alignItems:"center",gap:"4px",transition:"all 0.2s ease"},onMouseEnter:j=>{j.currentTarget.style.background="rgba(5, 150, 105, 0.15)"},onMouseLeave:j=>{j.currentTarget.style.background="rgba(5, 150, 105, 0.1)"},children:[s.jsx(gi,{size:14}),"Leaderboard"]})]}),s.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"12px",padding:"0 4px"},children:L.map(j=>s.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"8px",padding:"12px 10px",borderRadius:"10px",backgroundColor:j.unlocked?"rgba(5, 150, 105, 0.05)":"#f9fafb",border:j.unlocked?"1px solid rgba(5, 150, 105, 0.2)":"1px solid #e5e7eb",opacity:j.unlocked?1:.7,minWidth:0,minHeight:"70px",transition:"all 0.2s ease"},children:[s.jsx("div",{style:{fontSize:"20px",flexShrink:0,paddingTop:"2px"},children:j.icon}),s.jsxs("div",{style:{flex:1,minWidth:0,overflow:"hidden"},children:[s.jsx("div",{style:{fontSize:"13px",fontWeight:"600",color:"#111827",lineHeight:"1.3",marginBottom:"2px",wordBreak:"break-word",hyphens:"auto"},children:j.title}),s.jsx("div",{style:{fontSize:"11px",color:"#6b7280",lineHeight:"1.3",wordBreak:"break-word",hyphens:"auto",display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:j.description})]}),j.unlocked&&s.jsx("div",{style:{flexShrink:0,paddingTop:"2px"},children:s.jsx(gi,{size:14,style:{color:"#059669"}})})]},j.id))})]}),!m&&s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",marginBottom:"16px",margin:"0 0 16px 0"},children:"Settings"}),s.jsx("div",{style:{display:"flex",flexDirection:"column"},children:T.map((j,D)=>{const P=j.icon;return s.jsxs("button",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"16px 12px",background:"none",border:"none",borderRadius:"8px",cursor:"pointer",textAlign:"left",width:"100%",transition:"background-color 0.2s",borderBottom:D<T.length-1?"1px solid #f3f4f6":"none"},onMouseEnter:M=>{M.currentTarget.style.backgroundColor="#f9fafb"},onMouseLeave:M=>{M.currentTarget.style.backgroundColor="transparent"},onClick:j.action,children:[s.jsx("div",{style:{width:"40px",height:"40px",background:"rgba(107, 114, 128, 0.1)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:s.jsx(P,{size:20,style:{color:"#6b7280"}})}),s.jsxs("div",{style:{flex:1,minWidth:0},children:[s.jsx("div",{style:{fontSize:"16px",fontWeight:"600",color:"#111827"},children:j.label}),s.jsx("div",{style:{fontSize:"14px",color:"#6b7280",marginTop:"2px"},children:j.description})]}),s.jsx(ve,{size:20,style:{color:"#9ca3af",flexShrink:0}})]},j.id)})})]}),!m&&s.jsxs(s.Fragment,{children:[s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},style:{background:"white",borderRadius:"12px",padding:"20px",marginBottom:"16px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.05)"},children:[s.jsx("h3",{style:{fontSize:"18px",fontWeight:"700",color:"#111827",marginBottom:"16px",margin:"0 0 16px 0"},children:"Account Information"}),s.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:[s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Email"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:t?.email||"Not provided"})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Member Since"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#111827"},children:Y.joinedDate})]}),s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx("span",{style:{fontSize:"14px",color:"#6b7280"},children:"Account Status"}),s.jsx("span",{style:{fontSize:"14px",fontWeight:"500",color:"#059669"},children:"Active"})]})]})]}),s.jsxs(N.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"16px",background:"rgba(239, 68, 68, 0.1)",color:"#dc2626",border:"none",borderRadius:"12px",cursor:"pointer",fontSize:"16px",fontWeight:"600",marginBottom:"20px",transition:"background-color 0.2s"},onClick:$,onMouseEnter:j=>j.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.15)",onMouseLeave:j=>j.currentTarget.style.backgroundColor="rgba(239, 68, 68, 0.1)",whileHover:{scale:1.02},whileTap:{scale:.98},children:[s.jsx(ud,{size:20}),s.jsx("span",{children:"Sign Out"})]})]})]})]})},bh=({onNavigateBack:i})=>{const[e,t]=p.useState("overview"),[r,n]=p.useState(!1),[o,a]=p.useState(!1),[l,d]=p.useState(null),[c,u]=p.useState(""),{getBalance:h,getTransactionHistory:f,addFunds:m,initializeWallet:g}=Yt(),{user:x}=oe(),[,y]=pe();p.useEffect(()=>{Nt({delay:200}),x?.id&&g()},[x?.id,g]);const v=h("USD")||0,b=f({currency:"USD"})||[],w=[10,25,50,100],k=async T=>{if(T<=0){F.error("Please enter a valid amount");return}n(!0);try{await m(T,"USD","Demo funds added"),F.success(`Successfully added $${T.toLocaleString()} to your wallet!`),d(null),u("")}catch{F.error("Failed to add funds. Please try again.")}finally{n(!1)}},I=async()=>{a(!0);try{F.success("Demo balance reset successfully!")}catch{F.error("Failed to reset demo balance. Please try again.")}finally{a(!1)}},_=()=>{i?i():y("/")},A=T=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(T),K=T=>T.toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),W=T=>{switch(T){case"deposit":return s.jsx(fs,{size:16,className:"text-emerald-500"});case"withdrawal":return s.jsx(Sd,{size:16,className:"text-red-500"});case"prediction":return s.jsx(Me,{size:16,className:"text-blue-500"});case"win":return s.jsx(Ps,{size:16,className:"text-emerald-500"});default:return s.jsx(Wt,{size:16,className:"text-gray-500"})}},Y=T=>{switch(T){case"deposit":case"win":return"text-emerald-600";case"withdrawal":case"prediction":return"text-red-600";default:return"text-gray-600"}};return s.jsxs("div",{className:"min-h-screen bg-gray-50 wallet-page",children:[s.jsxs("div",{className:"bg-white border-b border-gray-100",children:[s.jsx("div",{className:"h-11"}),s.jsx("div",{className:"px-4 py-4",children:s.jsxs("div",{className:"flex items-center justify-between","data-tour-id":"wallet-balance",children:[s.jsx("button",{onClick:_,className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors",children:s.jsx(ct,{size:20,className:"text-gray-700"})}),s.jsxs("div",{className:"text-center",children:[s.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Wallet"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Demo Mode"})]}),s.jsx("div",{className:"w-10"})," "]})})]}),s.jsx(N.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mx-4 mt-4 bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(sd,{size:20,className:"text-white"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-white font-semibold text-sm",children:"Demo Funds"}),s.jsx("p",{className:"text-blue-100 text-xs",children:"This is a demo wallet. All transactions are simulated."})]})]})}),s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mx-4 mt-4 bg-gradient-to-br from-purple-500 to-emerald-600 rounded-2xl p-6 text-white","data-tour-id":"wallet-balance-card",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"text-sm font-medium text-green-100 uppercase tracking-wide",children:"Available Balance"}),s.jsx("div",{className:"text-3xl font-bold mt-1",children:A(v)})]}),s.jsx("div",{className:"w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center",children:s.jsx(Wt,{size:24,className:"text-white"})})]}),s.jsxs("div",{className:"flex gap-2","data-tour-id":"wallet-actions",children:[s.jsx("button",{onClick:()=>d(25),className:"flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-2 px-3 text-sm font-medium transition-all",children:"Add Funds"}),s.jsx("button",{onClick:I,disabled:o,className:"flex-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg py-2 px-3 text-sm font-medium transition-all disabled:opacity-50",children:o?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(Ht,{size:14,className:"animate-spin"}),"Resetting..."]}):"Reset Demo"})]})]}),s.jsx("div",{className:"mx-4 mt-6",children:s.jsxs("div",{className:"bg-white rounded-xl p-1 flex",children:[s.jsx("button",{onClick:()=>t("overview"),className:`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${e==="overview"?"bg-emerald-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Overview"}),s.jsx("button",{onClick:()=>t("transactions"),className:`flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all ${e==="transactions"?"bg-emerald-500 text-white":"text-gray-600 hover:text-gray-900"}`,children:"Transactions"})]})}),s.jsx("div",{className:"mx-4 mt-4",children:s.jsx(xe,{mode:"wait",children:e==="overview"?s.jsxs(N.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(Me,{size:16,className:"text-emerald-500"}),s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Won"})]}),s.jsx("div",{className:"text-lg font-bold text-gray-900",children:A(b.filter(T=>T.type==="win").reduce((T,L)=>T+L.amount,0))})]}),s.jsxs("div",{className:"bg-white rounded-xl p-4 border border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(_d,{size:16,className:"text-red-500"}),s.jsx("span",{className:"text-xs text-gray-500 uppercase tracking-wide",children:"Total Lost"})]}),s.jsx("div",{className:"text-lg font-bold text-gray-900",children:A(Math.abs(b.filter(T=>T.type==="prediction").reduce((T,L)=>T+L.amount,0)))})]})]}),s.jsxs("div",{className:"bg-white rounded-xl border border-gray-100",children:[s.jsx("div",{className:"p-4 border-b border-gray-100",children:s.jsx("h3",{className:"font-semibold text-gray-900",children:"Recent Activity"})}),s.jsx("div",{className:"p-4",children:b.slice(0,3).length>0?s.jsx("div",{className:"space-y-3",children:b.slice(0,3).map((T,L)=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:W(T.type)}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.description}),s.jsx("div",{className:"text-xs text-gray-500",children:K(T.date)})]}),s.jsxs("div",{className:`text-sm font-semibold ${Y(T.type)}`,children:[T.amount>0?"+":"",A(T.amount)]})]},L))}):s.jsxs("div",{className:"text-center py-6",children:[s.jsx(ht,{size:24,className:"text-gray-400 mx-auto mb-2"}),s.jsx("p",{className:"text-gray-500 text-sm",children:"No transactions yet"})]})})]})]},"overview"):s.jsx(N.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},className:"space-y-4",children:s.jsxs("div",{className:"bg-white rounded-xl border border-gray-100",children:[s.jsx("div",{className:"p-4 border-b border-gray-100",children:s.jsx("h3",{className:"font-semibold text-gray-900",children:"All Transactions"})}),s.jsx("div",{className:"divide-y divide-gray-100",children:b.length>0?b.map((T,L)=>s.jsx("div",{className:"p-4",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:W(T.type)}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium text-gray-900",children:T.description}),s.jsx("div",{className:"text-xs text-gray-500",children:K(T.date)})]}),s.jsxs("div",{className:`text-sm font-semibold ${Y(T.type)}`,children:[T.amount>0?"+":"",A(T.amount)]})]})},L)):s.jsxs("div",{className:"text-center py-12",children:[s.jsx(ht,{size:32,className:"text-gray-400 mx-auto mb-3"}),s.jsx("p",{className:"text-gray-500",children:"No transactions yet"}),s.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Start making predictions to see your activity"})]})})]})},"transactions")})}),s.jsx(xe,{children:l!==null&&s.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",onClick:()=>d(null),children:s.jsxs(N.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white rounded-2xl w-full max-w-sm p-6",onClick:T=>T.stopPropagation(),children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Add Demo Funds"}),s.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:w.map(T=>s.jsxs("button",{onClick:()=>u(T.toString()),className:`py-3 px-4 rounded-lg border-2 text-sm font-medium transition-all ${c===T.toString()?"border-emerald-500 bg-emerald-50 text-emerald-700":"border-gray-200 text-gray-700 hover:border-gray-300"}`,children:["$",T]},T))}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Amount"}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),s.jsx("input",{type:"number",placeholder:"0",value:c,onChange:T=>u(T.target.value),className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",min:"1",max:"10000"})]})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>d(null),className:"flex-1 py-3 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200 transition-colors",children:"Cancel"}),s.jsx("button",{onClick:()=>k(parseFloat(c)||0),disabled:!c||parseFloat(c)<=0||r,className:`flex-1 py-3 rounded-lg font-medium transition-colors ${!c||parseFloat(c)<=0||r?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-emerald-600 text-white hover:bg-green-700"}`,children:r?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx(Ht,{size:16,className:"animate-spin"}),"Adding..."]}):"Add Funds"})]})]})})})]})},vh=()=>{const{login:i,register:e,loginWithOAuth:t,loading:r}=oe(),[n,o]=p.useState(""),[a,l]=p.useState(""),[d,c]=p.useState(""),[u,h]=p.useState(""),[f,m]=p.useState(""),[g,x]=p.useState(!1),[y,v]=p.useState(!1),[b,w]=p.useState(!0),[k,I]=p.useState(!1),[_,A]=p.useState({}),[K,W]=p.useState(null);p.useEffect(()=>{window.scrollTo({top:0,behavior:"instant"})},[]);const Y=P=>{if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(P))return!1;const B=P.split("@"),U=B[0],C=B[1];if(U.length<1||U.length>64||C.length<3||C.length>255)return!1;const E=C.split(".");return E.length<2?!1:E.every(S=>S.length>0&&S.length<=63)},T=()=>{const P={};return n?Y(n)||(P.email="Please enter a valid email address (e.g., user@example.com)"):P.email="Email is required",a?a.length<6&&(P.password="Password must be at least 6 characters"):P.password="Password is required",b||(d.trim()||(P.firstName="First name is required"),u.trim()||(P.lastName="Last name is required"),f?a!==f&&(P.confirmPassword="Passwords do not match"):P.confirmPassword="Please confirm your password"),A(P),Object.keys(P).length===0},L=async P=>{if(P.preventDefault(),!(!T()||r)){A({}),W(null);try{b?await i(n,a):await e(n,a,d,u)}catch(M){console.error("Auth error:",M);let B="Authentication failed. Please try again.";if(M.message){const U=M.message.toLowerCase();U.includes("invalid")&&U.includes("credentials")?B="Invalid email or password. Please check your credentials and try again.":U.includes("user already registered")||U.includes("already exists")?(B="An account with this email already exists. Please try signing in instead.",setTimeout(()=>w(!0),2e3)):U.includes("email not confirmed")?B="Please check your email and confirm your account before signing in.":U.includes("too many requests")||U.includes("rate limit")?B="Too many attempts. Please wait a moment and try again.":U.includes("user not found")?(B="No account found with this email. Please register first.",b&&setTimeout(()=>w(!1),2e3)):B="Something went wrong. Please try again or contact support if the issue continues."}W(B)}}},ee=async(P,M,B,U)=>{try{o(P),l(M),B&&c(B),U&&h(U),m(M),W(null),b?await i(P,M):await e(P,M,B||"Test",U||"User")}catch(C){console.error("Test auth error:",C),W(C.message||"Test authentication failed")}},ie=async P=>{try{W(null),await t(P)}catch(M){console.error(`${P} auth error:`,M),W(`${P} sign-in failed. Please try again.`)}},$=()=>{w(!b),A({}),W(null),o(""),l(""),c(""),h(""),m(""),window.scrollTo({top:0,behavior:"smooth"})},j=()=>x(!g),D=()=>v(!y);return s.jsxs("div",{style:{minHeight:"100vh",width:"100%",maxWidth:"100vw",background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 30%, #ecfdf5 70%, #f0fdfa 100%)",display:"flex",alignItems:"flex-start",justifyContent:"center",padding:"8px",position:"relative",overflow:"hidden",boxSizing:"border-box"},children:[s.jsxs("div",{children:[s.jsx("div",{style:{position:"fixed",top:"10px",left:"10px",zIndex:1001},children:s.jsx("button",{onClick:()=>I(!k),style:{padding:"8px 12px",background:"#374151",color:"white",border:"none",borderRadius:"6px",fontSize:"12px",cursor:"pointer"},children:"🧪 Test Mode"})}),k&&s.jsxs("div",{style:{position:"fixed",top:"20px",right:"20px",background:"rgba(0, 0, 0, 0.9)",color:"white",padding:"16px",borderRadius:"8px",fontSize:"12px",zIndex:1e3,maxWidth:"280px"},children:[s.jsx("div",{style:{marginBottom:"12px",fontWeight:"bold",color:"#00ff88"},children:"🚀 FIXED AUTHENTICATION"}),s.jsx("div",{style:{marginBottom:"8px",fontSize:"10px",color:"#ccc"},children:"✅ Business domains now supported:"}),s.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#00F5D4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>ee("userten@fcz.app","test123","User","Ten"),children:b?"🔑 Login userten@fcz.app":"📝 Register userten@fcz.app"}),s.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#00F5D4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>ee("demo@example.com","demo123","Demo","User"),children:b?"🔑 Login demo@example.com":"📝 Register demo@example.com"}),s.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#00F5D4",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>ee("user@gmail.com","test123","Test","Person"),children:b?"🔑 Login user@gmail.com":"📝 Register user@gmail.com"}),s.jsx("div",{style:{margin:"12px 0 8px 0",fontSize:"10px",color:"#00ff88"},children:"✅ ALL email formats now work!"}),s.jsx("button",{style:{margin:"4px 0",padding:"6px 12px",background:"#dc2626",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"11px",width:"100%"},onClick:()=>I(!1),children:"❌ Close"})]})]}),s.jsx("style",{children:`
          @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
          }
          
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
          
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
          }
          
          @media (max-width: 768px) {
            .auth-card {
              padding: 16px !important;
              margin: 8px !important;
              max-width: calc(100vw - 16px) !important;
              width: calc(100vw - 16px) !important;
              min-height: calc(100vh - 16px) !important;
              border-radius: 16px !important;
              box-sizing: border-box !important;
              overflow: hidden !important;
            }
            
            .auth-card h1 {
              font-size: 28px !important;
            }
            
            .auth-card p {
              font-size: 14px !important;
            }
          }
          
          .auth-error {
            animation: shake 0.5s ease-in-out;
          }
        `}),s.jsx("div",{style:{position:"absolute",top:"-160px",right:"-160px",width:"320px",height:"320px",background:"radial-gradient(circle, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 50%, transparent 100%)",borderRadius:"50%",filter:"blur(40px)",animation:"float 8s ease-in-out infinite"}}),s.jsx("div",{style:{position:"absolute",bottom:"-160px",left:"-160px",width:"320px",height:"320px",background:"radial-gradient(circle, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.03) 50%, transparent 100%)",borderRadius:"50%",filter:"blur(40px)",animation:"float 10s ease-in-out infinite reverse"}}),s.jsxs("div",{className:"auth-card",style:{width:"100%",maxWidth:"calc(100vw - 16px)",minHeight:"calc(100vh - 16px)",backgroundColor:"rgba(255, 255, 255, 0.95)",backdropFilter:"blur(20px)",borderRadius:"24px",padding:"24px",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.2)",border:"1px solid rgba(255, 255, 255, 0.3)",position:"relative",zIndex:10,margin:"8px",marginTop:"8px",display:"flex",flexDirection:"column",justifyContent:"flex-start",boxSizing:"border-box",overflow:"hidden"},children:[s.jsxs("div",{style:{textAlign:"center",marginBottom:"20px"},children:[s.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"16px",filter:"drop-shadow(0 12px 24px rgba(123, 47, 247, 0.3))"},children:s.jsx(Kn,{size:"xl",variant:"icon"})}),s.jsx("h1",{style:{fontSize:"32px",fontWeight:"bold",color:"#111827",marginBottom:"8px",margin:"0 0 8px 0",background:"linear-gradient(135deg, #111827 0%, #374151 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",lineHeight:"1.2"},children:b?"Welcome Back":"Join Fan Club Z"}),s.jsx("p",{style:{fontSize:"16px",color:"#6b7280",margin:"0",lineHeight:"1.5"},children:b?"Sign in to continue your prediction journey":"Create your account and start making predictions"})]}),K&&s.jsxs("div",{className:"auth-error",style:{marginBottom:"20px",padding:"16px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"12px",color:"#dc2626",fontSize:"14px",display:"flex",alignItems:"flex-start",gap:"12px"},children:[s.jsx("svg",{width:"20",height:"20",fill:"currentColor",viewBox:"0 0 24 24",style:{flexShrink:0,marginTop:"2px"},children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),s.jsxs("div",{style:{flex:1},children:[s.jsx("div",{style:{fontWeight:"600",marginBottom:"4px"},children:b?"Sign In Failed":"Registration Failed"}),s.jsx("div",{style:{lineHeight:"1.4"},children:K}),K.includes("valid email")&&s.jsx("div",{style:{marginTop:"8px",fontSize:"12px",color:"#7c2d12",background:"rgba(34, 197, 94, 0.1)",padding:"8px",borderRadius:"6px"},children:"✅ Business domains like @fcz.app, @company.com are now fully supported!"})]})]}),s.jsxs("div",{style:{marginBottom:"32px"},children:[s.jsxs("p",{style:{fontSize:"15px",color:"#6b7280",textAlign:"center",marginBottom:"16px",fontWeight:"500"},children:["Recommended: Quick ",b?"sign in":"sign up"," with Google"]}),s.jsxs("button",{type:"button",onClick:()=>ie("google"),disabled:r,style:{width:"100%",height:"56px",backgroundColor:"#4285F4",border:"none",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"12px",fontSize:"16px",fontWeight:"600",color:"white",cursor:r?"not-allowed":"pointer",opacity:r?"0.7":"1",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 8px 16px rgba(66, 133, 244, 0.3)",transform:"translateY(0)",position:"relative",overflow:"hidden"},onMouseEnter:P=>{P.currentTarget.style.transform="translateY(-2px)",P.currentTarget.style.boxShadow="0 12px 24px rgba(66, 133, 244, 0.4)"},onMouseLeave:P=>{P.currentTarget.style.transform="translateY(0)",P.currentTarget.style.boxShadow="0 8px 16px rgba(66, 133, 244, 0.3)"},children:[r?s.jsx("div",{style:{width:"24px",height:"24px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}):s.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",children:[s.jsx("path",{fill:"white",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),s.jsx("path",{fill:"white",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),s.jsx("path",{fill:"white",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),s.jsx("path",{fill:"white",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})]}),s.jsxs("div",{style:{position:"relative",textAlign:"center",margin:"24px 0",fontSize:"14px",color:"#6b7280"},children:[s.jsx("div",{style:{position:"absolute",top:"50%",left:"0",right:"0",height:"1px",backgroundColor:"#e5e7eb"}}),s.jsxs("span",{style:{backgroundColor:"white",padding:"0 16px",position:"relative",zIndex:1},children:["Or ",b?"sign in":"sign up"," with email"]})]}),s.jsxs("form",{onSubmit:L,style:{marginBottom:"20px",flex:1},children:[!b&&s.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"16px",marginBottom:"18px"},children:[s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"First Name"}),s.jsx("input",{type:"text",value:d,onChange:P=>c(P.target.value),placeholder:"Enter first name",style:{width:"100%",padding:"14px 16px",border:`2px solid ${_.firstName?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!b}),_.firstName&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),_.firstName]})]}),s.jsxs("div",{children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Last Name"}),s.jsx("input",{type:"text",value:u,onChange:P=>h(P.target.value),placeholder:"Enter last name",style:{width:"100%",padding:"14px 16px",border:`2px solid ${_.lastName?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!b}),_.lastName&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),_.lastName]})]})]}),s.jsxs("div",{style:{marginBottom:"18px",position:"relative"},children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Email Address"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("input",{type:"email",value:n,onChange:P=>o(P.target.value),placeholder:"Enter your email address",style:{width:"100%",padding:"14px 16px",paddingRight:"52px",border:`2px solid ${_.email?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!0}),s.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"20px",color:"#9ca3af",pointerEvents:"none",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})})]}),_.email&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),_.email]})]}),s.jsxs("div",{style:{marginBottom:"18px",position:"relative"},children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Password"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("input",{type:g?"text":"password",value:a,onChange:P=>l(P.target.value),placeholder:"Enter your password",style:{width:"100%",padding:"14px 16px",paddingRight:"52px",border:`2px solid ${_.password?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!0}),s.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"20px",color:"#9ca3af",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"all 0.2s"},onClick:j,children:g?s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):s.jsxs("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),_.password&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),_.password]})]}),!b&&s.jsxs("div",{style:{marginBottom:"18px",position:"relative"},children:[s.jsx("label",{style:{display:"block",fontSize:"14px",fontWeight:"600",color:"#374151",marginBottom:"8px"},children:"Confirm Password"}),s.jsxs("div",{style:{position:"relative"},children:[s.jsx("input",{type:y?"text":"password",value:f,onChange:P=>m(P.target.value),placeholder:"Confirm your password",style:{width:"100%",padding:"14px 16px",paddingRight:"52px",border:`2px solid ${_.confirmPassword?"#ef4444":"#e5e7eb"}`,borderRadius:"12px",fontSize:"16px",outline:"none",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxSizing:"border-box",backgroundColor:"#ffffff",fontFamily:"inherit",minHeight:"52px"},disabled:r,required:!b}),s.jsx("div",{style:{position:"absolute",right:"16px",top:"50%",transform:"translateY(-50%)",width:"20px",height:"20px",color:"#9ca3af",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"6px",transition:"all 0.2s"},onClick:D,children:y?s.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"})}):s.jsxs("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]}),_.confirmPassword&&s.jsxs("div",{style:{marginTop:"6px",fontSize:"12px",color:"#ef4444",display:"flex",alignItems:"center",gap:"6px"},children:[s.jsx("svg",{width:"12",height:"12",fill:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})}),_.confirmPassword]})]}),b&&s.jsx("div",{style:{textAlign:"right",marginBottom:"20px"},children:s.jsx("a",{href:"#",onClick:P=>{P.preventDefault(),alert("Password reset functionality will be available soon!")},style:{color:"#00F5D4",textDecoration:"none",fontSize:"14px",fontWeight:"500",padding:"4px 8px",borderRadius:"6px",transition:"all 0.2s"},children:"Forgot your password?"})}),s.jsx("button",{type:"submit",disabled:r,style:{width:"100%",height:"56px",background:"linear-gradient(135deg, #00F5D4 0%, #7B2FF7 100%)",color:"white",border:"none",borderRadius:"16px",fontSize:"16px",fontWeight:"600",cursor:r?"not-allowed":"pointer",opacity:r?"0.8":"1",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",boxShadow:"0 8px 16px rgba(16, 185, 129, 0.3)",position:"relative",overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:r?s.jsxs(s.Fragment,{children:[s.jsx("div",{style:{width:"20px",height:"20px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTop:"2px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"}}),b?"Signing in...":"Creating account..."]}):b?"Sign In":"Create Account"})]}),s.jsx("div",{style:{textAlign:"center",paddingTop:"20px",paddingBottom:"16px",borderTop:"1px solid #f3f4f6"},children:s.jsxs("p",{style:{color:"#6b7280",fontSize:"15px",margin:"0"},children:[b?"Don't have an account?":"Already have an account?"," ",s.jsx("a",{href:"#",onClick:P=>{P.preventDefault(),$()},style:{color:"#00F5D4",textDecoration:"none",fontWeight:"600",padding:"8px 12px",borderRadius:"6px",transition:"all 0.2s",display:"inline-block",marginTop:"8px"},children:b?"Create one now":"Sign in"})]})})]}),s.jsx(bn,{})]})},wh=()=>{const{handleOAuthCallback:i,isAuthenticated:e,loading:t}=oe(),[,r]=pe(),[n,o]=p.useState(!1),[a,l]=p.useState(null);return p.useEffect(()=>{let d=!0;const u=setTimeout(async()=>{if(!n)try{console.log("🔄 Processing OAuth callback..."),o(!0),await i(),setTimeout(()=>{d&&(console.log("✅ OAuth callback processed, redirecting to app..."),r("/"))},1e3)}catch(h){console.error("❌ OAuth callback processing failed:",h),d&&(l(h.message||"Authentication failed"),setTimeout(()=>{window.location.href="/auth?error=oauth_failed"},3e3))}},100);return()=>{d=!1,clearTimeout(u)}},[i,n,r]),p.useEffect(()=>{e&&!t&&(console.log("✅ User already authenticated, redirecting..."),r("/"))},[e,t,r]),a?s.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 30%, #ecfdf5 70%, #f0fdfa 100%)"},children:s.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15)",textAlign:"center",maxWidth:"400px",width:"90%",border:"1px solid #fee2e2"},children:[s.jsx("div",{style:{width:"60px",height:"60px",background:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",borderRadius:"50%",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx("svg",{width:"24",height:"24",fill:"white",viewBox:"0 0 24 24",children:s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})})}),s.jsx("h2",{style:{margin:"0 0 12px 0",color:"#111827",fontSize:"24px",fontWeight:"bold"},children:"Authentication Failed"}),s.jsx("p",{style:{margin:"0 0 24px 0",color:"#6b7280",fontSize:"16px"},children:a}),s.jsx("p",{style:{margin:"0",color:"#9ca3af",fontSize:"14px"},children:"Redirecting to login page in a few seconds..."})]})}):s.jsxs("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #f8fafc 0%, #ffffff 30%, #ecfdf5 70%, #f0fdfa 100%)"},children:[s.jsxs("div",{style:{background:"white",borderRadius:"16px",padding:"32px",boxShadow:"0 25px 50px rgba(0, 0, 0, 0.15)",textAlign:"center",maxWidth:"400px",width:"90%"},children:[s.jsx("div",{style:{width:"60px",height:"60px",background:"linear-gradient(135deg, #00F5D4 0%, #7B2FF7 100%)",borderRadius:"50%",margin:"0 auto 20px",display:"flex",alignItems:"center",justifyContent:"center",animation:"spin 2s linear infinite"},children:s.jsx("span",{style:{fontSize:"24px",color:"white"},children:"Z"})}),s.jsx("h2",{style:{margin:"0 0 12px 0",color:"#111827",fontSize:"24px",fontWeight:"bold"},children:"Completing Sign In..."}),s.jsx("p",{style:{margin:"0 0 24px 0",color:"#6b7280",fontSize:"16px"},children:"Please wait while we finish setting up your account."}),s.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"4px"},children:[0,1,2].map(d=>s.jsx("div",{style:{width:"8px",height:"8px",background:"#00F5D4",borderRadius:"50%",animation:`bounce 1.4s ease-in-out ${d*.16}s infinite both`}},d))}),s.jsxs("div",{style:{marginTop:"20px",fontSize:"12px",color:"#9ca3af"},children:["Processed: ",n?"Yes":"No"," | Authenticated: ",e?"Yes":"No"," | Loading: ",t?"Yes":"No"]})]}),s.jsx("style",{children:`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
          
          @keyframes bounce {
            0%, 80%, 100% {
              transform: scale(0);
            }
            40% {
              transform: scale(1);
            }
          }
        `})]})},jh=({isOpen:i,onClose:e,predictionId:t,predictionTitle:r})=>{const[n,o]=p.useState(null),[a,l]=p.useState(!0),[d,c]=p.useState(!1),[u,h]=p.useState(""),[f,m]=p.useState(!1),{user:g}=oe();p.useEffect(()=>{i&&g?.id&&x()},[i,g?.id,t]);const x=async()=>{try{l(!0);const v=await fetch(`${ue()}/api/v2/settlement/${t}/status?userId=${g?.id}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!v.ok)throw new Error("Failed to fetch settlement status");const b=await v.json();o(b.data)}catch(v){console.error("Error fetching settlement status:",v),se.error("Failed to load settlement information")}finally{l(!1)}},y=async v=>{try{if(c(!0),!(await fetch(`${ue()}/api/v2/settlement/${t}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:g?.id,action:v,reason:v==="dispute"?u:void 0})})).ok)throw new Error(`Failed to ${v} settlement`);se.success(v==="accept"?"Settlement accepted successfully!":"Dispute submitted successfully!"),e()}catch(b){console.error(`Error ${v}ing settlement:`,b),se.error(`Failed to ${v} settlement`)}finally{c(!1)}};return i?s.jsx(xe,{children:s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:s.jsxs(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:[s.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Settlement Validation"}),s.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:s.jsx(Re,{className:"w-5 h-5"})})]}),s.jsx("div",{className:"p-6",children:a?s.jsx("div",{className:"flex items-center justify-center py-8",children:s.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"})}):n?s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:r}),s.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[s.jsxs("div",{className:"flex items-center gap-1",children:[s.jsx(Wt,{className:"w-4 h-4"}),s.jsxs("span",{children:["Pool: $",n.prediction.pool_total.toLocaleString()]})]}),s.jsx("div",{className:"flex items-center gap-1",children:s.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${n.prediction.status==="settled"?"bg-emerald-100 text-emerald-800":n.prediction.status==="disputed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:n.prediction.status})})]})]}),s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Your Entry"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Amount Staked:"}),s.jsxs("span",{className:"font-medium",children:["$",n.userEntry.amount.toLocaleString()]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Status:"}),s.jsx("span",{className:`font-medium ${n.userEntry.status==="won"?"text-emerald-600":n.userEntry.status==="lost"?"text-red-600":n.userEntry.status==="refunded"?"text-blue-600":"text-yellow-600"}`,children:n.userEntry.status})]}),n.userEntry.actual_payout>0&&s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Payout:"}),s.jsxs("span",{className:"font-medium text-emerald-600",children:["$",n.userEntry.actual_payout.toLocaleString()]})]})]})]}),n.settlement?s.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[s.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Settlement Details"}),s.jsxs("div",{className:"space-y-2 text-sm",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Total Payout:"}),s.jsxs("span",{className:"font-medium",children:["$",n.settlement.total_payout.toLocaleString()]})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-gray-600",children:"Settled At:"}),s.jsx("span",{className:"font-medium",children:new Date(n.settlement.settlement_time).toLocaleDateString()})]})]})]}):n.needsSettlement?s.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[s.jsx(ht,{className:"w-4 h-4 text-yellow-600"}),s.jsx("h4",{className:"font-medium text-yellow-900",children:"Awaiting Settlement"})]}),s.jsx("p",{className:"text-sm text-yellow-800",children:"This prediction is waiting for the creator to provide settlement details."})]}):null,n.canValidate&&n.settlement&&!f&&s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Validate Settlement"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Do you agree with this settlement outcome?"}),s.jsxs("div",{className:"flex gap-3",children:[s.jsxs("button",{onClick:()=>y("accept"),disabled:d,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[s.jsx(Ps,{className:"w-4 h-4"}),"Accept"]}),s.jsxs("button",{onClick:()=>m(!0),disabled:d,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[s.jsx(Er,{className:"w-4 h-4"}),"Dispute"]})]})]}),f&&s.jsxs("div",{className:"space-y-4",children:[s.jsx("h4",{className:"font-medium text-gray-900",children:"Dispute Settlement"}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Dispute"}),s.jsx("textarea",{value:u,onChange:v=>h(v.target.value),placeholder:"Please explain why you disagree with this settlement...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",rows:4})]}),s.jsxs("div",{className:"flex gap-3",children:[s.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),s.jsx("button",{onClick:()=>y("dispute"),disabled:d||!u.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:"Submit Dispute"})]})]})]}):s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-600",children:"Failed to load settlement information"})})})]})})}):null},Hs=({id:i,value:e,onValueChange:t,placeholder:r,rows:n=3,maxLength:o=500,autoFocus:a=!1,className:l="",disabled:d=!1})=>{const c=p.useCallback(u=>{t(u.target.value)},[t]);return s.jsx("textarea",{id:i,value:e,onChange:c,className:`w-full p-3 border border-gray-300 rounded-lg resize-none focus:ring-2 focus:ring-green-500 focus:border-transparent transition-colors ${l}`,rows:n,placeholder:r,maxLength:o,disabled:d,autoFocus:a,spellCheck:!1,autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",style:{minHeight:`${n*1.5}rem`,fontFamily:"inherit"}})},kh=({predictionId:i})=>{const{user:e}=oe(),{comments:t,commentCount:r,isLoading:n,error:o,isSubmitting:a,fetchComments:l,addComment:d,toggleCommentLike:c,editComment:u,deleteComment:h,clearError:f}=Cr(i),[m,g]=p.useState(""),[x,y]=p.useState({}),[v,b]=p.useState({}),[w,k]=p.useState(null),[I,_]=p.useState(null),[A,K]=p.useState(!1),W=p.useRef(i);p.useEffect(()=>{W.current!==i&&(W.current=i,K(!1))},[i]),p.useEffect(()=>{i&&i.trim()&&!A&&!n&&(console.log(`🔄 Fetching comments for prediction ${i}`),K(!0),l().catch(E=>{console.error("❌ Failed to fetch comments:",E),K(!1)}))},[i,A,n,l]),p.useEffect(()=>{console.log(`📊 CommentSystem for ${i}: count=${r}, comments.length=${t.length}`)},[i,r,t.length]);const[Y,T]=p.useState(10);p.useEffect(()=>{T(Math.min(10,t.length||0))},[t.length]);const L=p.useCallback(async E=>{const S=E?x[E]||"":m;if(S.trim()){if(!e){console.error("User not authenticated");return}try{await d(S.trim(),E,{id:e.id,username:e.username||e.email?.split("@")[0]||"Anonymous",full_name:e.full_name||e.email?.split("@")[0]||"Anonymous User",avatar_url:e.avatar_url,is_verified:!1}),E?(y(J=>({...J,[E]:""})),k(null)):g("")}catch(J){console.error("Failed to add comment:",J)}}},[e,m,x,d]),ee=p.useCallback(async E=>{if(e)try{await c(E)}catch(S){console.error("Failed to toggle like:",S)}},[e,c]),ie=p.useCallback((E,S)=>{y(J=>({...J,[E]:S}))},[]),$=p.useCallback((E,S)=>{b(J=>({...J,[E]:S}))},[]),j=p.useCallback((E,S)=>{_(E),b(J=>({...J,[E]:S}))},[]),D=p.useCallback(E=>{_(null),b(S=>{const J={...S};return delete J[E],J})},[]),P=p.useCallback(async E=>{const S=(v[E]||"").trim();if(S)try{await u(E,S),_(null),F.success("Comment updated")}catch(J){console.error("Failed to edit comment:",J),F.error("Failed to update comment")}},[v,u]),M=p.useCallback(async E=>{try{const S={...E};await h(E.id),F(J=>s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("span",{children:"Comment deleted"}),s.jsx("button",{onClick:async()=>{F.dismiss(J.id);try{await d(S.content,S.parent_comment_id||void 0,e?{id:e.id,username:e.username||e.email?.split("@")[0]||"Anonymous",full_name:e.full_name||e.email?.split("@")[0]||"Anonymous User",avatar_url:e.avatar_url,is_verified:!1}:void 0),F.success("Comment restored")}catch{F.error("Unable to restore comment")}},className:"px-2 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded",children:"Undo"})]}),{duration:5e3})}catch(S){console.error("Failed to delete comment:",S),F.error("Failed to delete comment")}},[h,d,e]),B=p.useCallback(E=>{k(E),y(S=>({...S,[E]:""}))},[]),U=p.useCallback(E=>{k(null),y(S=>{const J={...S};return delete J[E],J})},[]),C=ne.memo(function E({comment:S,isReply:J=!1}){const[Q,Z]=p.useState(!1),Be=I===S.id,Ne=w===S.id,[he,xt]=p.useState(!0),Ce=(S.replies_count??(S.replies?.length||0))||0;return s.jsx("div",{className:`comment-item ${J?"ml-8 pl-4 border-l-2 border-gray-100":""} p-4 bg-white rounded-lg border border-gray-100 shadow-sm hover:shadow-md transition-shadow`,children:s.jsxs("div",{className:"flex space-x-3",children:[S.user?.avatar_url&&s.jsx("div",{className:"flex-shrink-0",children:s.jsx("img",{src:S.user.avatar_url,alt:S.user.username,className:"w-8 h-8 rounded-full object-cover"})}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[s.jsx(qt,{username:S.user?.username||S.username||"Anonymous",userId:S.user?.id,className:"font-semibold text-sm text-gray-900 hover:text-teal-600 transition-colors"}),(S.user?.is_verified||S.is_verified)&&s.jsx("span",{className:"text-blue-500 text-xs",children:"✓"}),s.jsx("span",{className:"text-xs text-gray-500",children:S.created_at?go(new Date(S.created_at),{addSuffix:!0}):"Recently"}),S.is_edited&&s.jsx("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),s.jsx("div",{className:"mb-2",children:Be?s.jsxs("div",{className:"space-y-2",children:[s.jsx(Hs,{id:`edit-textarea-${S.id}`,value:v[S.id]||S.content,onValueChange:Pe=>$(S.id,Pe),placeholder:"Edit your comment...",rows:2,maxLength:500,autoFocus:!0}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-xs text-gray-500",children:[(v[S.id]||"").length,"/500"]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>P(S.id),disabled:!(v[S.id]||"").trim(),className:"px-3 py-1 bg-teal-600 text-white text-xs rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Save"}),s.jsx("button",{onClick:()=>D(S.id),className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]})]}):s.jsx("p",{className:"text-sm text-gray-900 whitespace-pre-wrap leading-relaxed",children:S.content})}),s.jsxs("div",{className:"flex items-center space-x-4 text-xs",children:[s.jsxs("button",{onClick:()=>ee(S.id),className:`flex items-center space-x-1 hover:text-red-500 transition-colors ${S.is_liked?"text-red-500":"text-gray-500"}`,children:[s.jsx(dt,{size:14,className:S.is_liked?"fill-current":""}),s.jsx("span",{children:S.likes_count||0})]}),!J&&s.jsxs("button",{onClick:()=>Ne?U(S.id):B(S.id),className:"flex items-center space-x-1 text-gray-500 hover:text-blue-500 transition-colors",children:[s.jsx(xd,{size:14}),s.jsx("span",{children:Ne?"Cancel":"Reply"})]}),!J&&Ce>0&&s.jsx("button",{onClick:()=>xt(!he),className:"text-gray-500 hover:text-gray-700",children:he?`Hide replies (${Ce})`:`Show replies (${Ce})`}),s.jsxs("div",{className:"relative",children:[s.jsx("button",{onClick:()=>Z(!Q),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:s.jsx(pd,{size:14})}),Q&&s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>Z(!1)}),s.jsx("div",{className:"absolute right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg z-20 min-w-[120px]",children:S.is_own?s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:()=>{j(S.id,S.content),Z(!1)},className:"flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[s.jsx(md,{size:14,className:"mr-2"}),"Edit"]}),s.jsxs("button",{onClick:()=>{Z(!1),M(S)},className:"flex items-center w-full px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[s.jsx(kd,{size:14,className:"mr-2"}),"Delete"]})]}):s.jsxs("button",{onClick:()=>{Z(!1)},className:"flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[s.jsx(ld,{size:14,className:"mr-2"}),"Report"]})})]})]})]}),Ne&&s.jsxs("div",{className:"mt-3 space-y-2",children:[s.jsx(Hs,{id:`reply-textarea-${S.id}`,value:x[S.id]||"",onValueChange:Pe=>ie(S.id,Pe),placeholder:`Reply to ${S.user?.username||S.username}...`,rows:2,maxLength:500,autoFocus:!0}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("span",{className:"text-xs text-gray-500",children:[(x[S.id]||"").length,"/500"]}),s.jsxs("div",{className:"flex space-x-2",children:[s.jsx("button",{onClick:()=>L(S.id),disabled:!(x[S.id]||"").trim()||a,className:"px-3 py-1 bg-teal-600 text-white text-xs rounded hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed",children:a?"Replying...":"Reply"}),s.jsx("button",{onClick:()=>U(S.id),className:"px-3 py-1 bg-gray-300 text-gray-700 text-xs rounded hover:bg-gray-400",children:"Cancel"})]})]})]}),he&&S.replies&&S.replies.length>0&&s.jsx("div",{className:"mt-3",children:S.replies.map((Pe,z)=>s.jsx(E,{comment:Pe,isReply:!0},Pe.id||`${i}-reply-${z}`))})]})]})})});return s.jsxs("div",{className:"comment-system bg-white",children:[s.jsx("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:s.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[s.jsx($e,{size:20,className:"mr-2"}),"Comments (",r,")"]})}),o&&s.jsx("div",{className:"p-4 bg-red-50 border-b border-red-200",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"text-red-800 text-sm",children:o}),s.jsx("button",{onClick:f,className:"text-red-600 hover:text-red-800 text-sm",children:"Dismiss"})]})}),e&&s.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("div",{className:"w-full",children:[s.jsx(Hs,{id:"main-textarea",value:m,onValueChange:g,placeholder:"Share your thoughts...",rows:3,maxLength:500}),s.jsxs("div",{className:"flex justify-between items-center mt-3",children:[s.jsxs("span",{className:"text-xs text-gray-500",children:[m.length,"/500"]}),s.jsx("button",{onClick:()=>L(),disabled:!m.trim()||a,className:"px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium",children:a?"Posting...":"Comment"})]})]})}),!e&&s.jsx("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:s.jsxs("p",{className:"text-gray-600 text-center",children:["Please ",s.jsx("span",{className:"text-teal-600 font-medium",children:"sign in"})," to join the conversation"]})}),n&&s.jsxs("div",{className:"p-8 text-center",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-teal-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading comments..."})]}),!n&&s.jsx("div",{className:"divide-y divide-gray-100",children:t.map((E,S)=>s.jsx(C,{comment:E},E.id||`${i}-comment-${S}`))}),!n&&t.length===0&&!o&&s.jsxs("div",{className:"p-8 text-center text-gray-500",children:[s.jsx($e,{size:48,className:"mx-auto mb-4 text-gray-300"}),s.jsx("h4",{className:"text-lg font-medium mb-2",children:"No comments yet"}),s.jsx("p",{children:"Be the first to share your thoughts!"})]})]})},_h=({predictionId:i,onNavigateBack:e})=>{const[,t]=pe(),[r,n]=p.useState(null),[o,a]=p.useState(""),[l,d]=p.useState(!1),[c,u]=p.useState(null),[h,f]=p.useState(!0),[m,g]=p.useState(!1),[x,y]=p.useState(!1),[v,b]=p.useState(!1),[w,k]=p.useState(!1),[I,_]=p.useState(!1),A=p.useRef(null),K=p.useRef(null),{predictions:W,fetchPredictions:Y,fetchPredictionById:T,placePrediction:L}=Xt(),{isAuthenticated:ee,user:ie}=oe(),{getBalance:$}=Yt(),{checkIfLiked:j,getLikeCount:D,toggleLike:P}=Sr(),{settlements:M,disputes:B,auditTimeline:U,fetchSettlement:C,fetchDisputes:E,fetchAuditTimeline:S,disputeModalOpen:J,setDisputeModalOpen:Q}=Xn(),Z=p.useMemo(()=>{if(i)return i;const ae=window.location.pathname.match(/\/prediction\/([^\/]+)/);return ae?ae[1]:null},[i]),Be=p.useMemo(()=>Z||"",[Z]),Ne=p.useMemo(()=>Z&&W.find(q=>q.id===Z)||null,[W,Z]),{commentCount:he,fetchComments:xt}=Cr(Be);p.useEffect(()=>{console.log(`📊 PredictionDetailsPage commentCount for ${Be}: ${he}`)},[Be,he]),p.useEffect(()=>{(async()=>{if(!Z){console.log("❌ No prediction ID found"),t("/discover");return}console.log("🔍 Loading prediction with ID:",Z),f(!0);try{const ae=await T(Z);ae?(console.log("✅ Found prediction:",ae.title),u(ae),console.log("🔄 Force fetching comments for prediction details page"),await xt(),["locked","settling","settled","voided","disputed","resolved"].includes(ae.status)&&(await C(Z),await E(Z),await S(Z))):(console.log("❌ Prediction not found:",Z),u(null))}catch(ae){console.error("❌ Error loading prediction:",ae),u(null)}finally{f(!1)}})()},[Z,T,t,C,E,S,xt]),p.useEffect(()=>{Ne&&c?.id===Ne.id&&(console.log("🔄 Updating prediction with latest data from store"),u(Ne))},[Ne,c?.id]);const Ce=()=>{if(console.log("🔙 Navigating back"),e)e();else try{window.history.length>1?window.history.back():t("/discover")}catch(q){console.error("Navigation error:",q),t("/discover")}},Pe=q=>{console.log("🎯 Option selected:",q),n(q)},z=q=>{const ae=q.target.value;(ae===""||/^\d+(\.\d{0,2})?$/.test(ae))&&a(ae)},le=async()=>{if(!ee){F.error("Please sign in to place a prediction");return}if(!r){F.error("Please select an option");return}const q=parseFloat(o);if(!q||q<c.stake_min){F.error(`Minimum stake is $${c.stake_min}`);return}if(c.stake_max&&q>c.stake_max){F.error(`Maximum stake is $${c.stake_max}`);return}const ae=$("USD");if(q>ae){F.error("Insufficient wallet balance");return}d(!0);try{console.log("🎲 Placing prediction:",{predictionId:c.id,optionId:r,amount:q}),await L(c.id,r,q,ie?.id||""),F.success("Prediction placed successfully!"),a(""),n(null),setTimeout(()=>{Y()},1e3)}catch(Qe){console.error("❌ Failed to place prediction:",Qe);const Ee=Qe instanceof Error?Qe.message:"Failed to place prediction";F.error(Ee)}finally{d(!1)}},je=async()=>{if(!c){F.error("No prediction to share");return}const q=`${window.location.origin}/predictions/${c.id}`,ae=`${c.title}

Make your prediction on Fan Club Z!`;if(navigator.share&&navigator.canShare)try{await navigator.share({title:c.title,text:ae,url:q});return}catch(Qe){console.log("Native sharing cancelled or failed:",Qe)}try{await navigator.clipboard.writeText(`${ae}
${q}`),F.success("Link copied to clipboard!")}catch(Qe){console.error("Clipboard API failed:",Qe);const Ee=document.createElement("textarea");Ee.value=`${ae}
${q}`,Ee.style.position="fixed",Ee.style.left="-999999px",Ee.style.top="-999999px",document.body.appendChild(Ee),Ee.focus(),Ee.select();try{document.execCommand("copy"),F.success("Link copied to clipboard!")}catch(ao){F.error("Failed to copy link"),console.error("execCommand failed:",ao)}finally{document.body.removeChild(Ee)}}},me=async()=>{if(!ee){F.error("Please sign in to like this prediction");return}try{await P(c.id),F.success(j(c.id)?"Liked prediction!":"Removed like")}catch{F.error("Failed to update like")}},ro=()=>{console.log("💬 Toggling comments from:",m,"to:",!m);const q=!m;g(q),q?setTimeout(()=>{A.current&&A.current.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})},300):K.current&&K.current.scrollIntoView({behavior:"smooth",block:"center"})},io=()=>c?.creator?{id:c.creator.id||c.creator_id,username:c.creator.username||c.creator.full_name||"creator",displayName:c.creator.full_name||c.creator.username,avatar_url:c.creator.avatar_url}:c?.creator_id?{id:c.creator_id,username:"creator",displayName:"Creator"}:{id:"unknown",username:"Fan Club Z",displayName:"Fan Club Z"},no=c?.user_entry||c?.entries?.some(q=>q.user_id===ie?.id),yt=M[c?.id],zr=B[c?.id]||[],oo=U[c?.id]||[];if(h)return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:s.jsx("div",{className:"px-4 py-4",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[s.jsx(ct,{size:20}),s.jsx("span",{className:"font-medium",children:"Back"})]})})})}),s.jsx("div",{className:"flex items-center justify-center py-20",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),s.jsx("p",{className:"text-gray-600",children:"Loading prediction..."})]})})]});if(!c)return s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:s.jsx("div",{className:"px-4 py-4",children:s.jsx("div",{className:"flex items-center justify-between",children:s.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[s.jsx(ct,{size:20}),s.jsx("span",{className:"font-medium",children:"Back"})]})})})}),s.jsx("div",{className:"flex items-center justify-center py-20",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Prediction Not Found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"The prediction you're looking for doesn't exist or has been removed."}),s.jsx("button",{onClick:()=>t("/discover"),className:"bg-emerald-500 text-white px-6 py-2 rounded-lg hover:bg-emerald-600 transition-colors",children:"Browse Predictions"})]})})]});const Dr=c.options?.find(q=>q.id===r),Ur=Dr&&o?parseFloat(o)*Dr.current_odds:0,As=c.status==="open"&&new Date(c.entry_deadline)>new Date,es=io();return s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"min-h-screen bg-gray-50",children:[s.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:s.jsx("div",{className:"px-4 py-4",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[s.jsx(ct,{size:20}),s.jsx("span",{className:"font-medium",children:"Back"})]}),s.jsx("button",{onClick:je,className:"p-2 text-gray-600 hover:text-gray-900 transition-colors rounded-lg hover:bg-gray-100",children:s.jsx(vd,{size:20})})]})})}),s.jsxs("div",{className:"px-4 py-6 max-w-2xl mx-auto pb-24",children:[s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-400 to-emerald-600 rounded-full flex items-center justify-center",children:s.jsx("span",{className:"text-white font-bold text-lg",children:es.username?.charAt(0)?.toUpperCase()||"FC"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"flex items-center gap-2",children:s.jsx(qt,{username:es.username,userId:es.id,displayName:es.displayName,className:"font-semibold text-gray-900 text-lg hover:text-emerald-600 transition-colors",showAt:!1})}),s.jsx("div",{className:"text-sm text-gray-500",children:new Date(c.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4 leading-tight",children:c.title}),c.description&&s.jsx("p",{className:"text-gray-600 mb-6 leading-relaxed text-base",children:c.description}),c.settlement&&s.jsxs("div",{className:"mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Settlement Rule:"}),s.jsx("button",{onClick:()=>y(!0),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"View full rule"})]}),s.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:c.settlement.rule_text})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[s.jsxs("div",{className:"text-center p-4 bg-emerald-50 rounded-xl",children:[s.jsxs("div",{className:"text-2xl font-bold text-emerald-600",children:["$",(c.pool_total||0).toLocaleString()]}),s.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Total Pool"})]}),s.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-xl",children:[s.jsx("div",{className:"text-2xl font-bold text-blue-600",children:c.participant_count||0}),s.jsx("div",{className:"text-sm text-gray-600 font-medium whitespace-nowrap text-center",children:"Participants"})]}),s.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-xl",children:[s.jsx("div",{className:"text-2xl font-bold text-purple-600",children:c.options?.length||0}),s.jsx("div",{className:"text-sm text-gray-600 font-medium",children:"Options"})]})]}),c.status==="open"&&s.jsxs("div",{className:"flex items-center gap-3 text-orange-600 bg-orange-50 px-4 py-3 rounded-xl",children:[s.jsx(ht,{size:20}),s.jsxs("div",{children:[s.jsxs("div",{className:"font-semibold",children:[Bu(c.entry_deadline)," remaining"]}),s.jsx("div",{className:"text-sm text-orange-500"})]})]}),c.lock_time&&c.status!=="open"&&s.jsxs("div",{className:"flex items-center gap-3 text-gray-600 bg-gray-50 px-4 py-3 rounded-xl",children:[s.jsx(ht,{size:20}),s.jsxs("div",{children:[s.jsx("div",{className:"font-semibold",children:"Locked at"}),s.jsx("div",{className:"text-sm"})]})]})]}),["settling","settled","voided","disputed","resolved"].includes(c.status)&&s.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05},className:"mb-6"}),c.status==="settled"&&yt?.proof&&s.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"mb-6",children:s.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Settlement Proof"}),s.jsx("button",{onClick:()=>b(!v),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:v?"Hide details":"Show details"})]}),v&&s.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-100",children:[s.jsx("h4",{className:"text-sm font-semibold text-gray-900 mb-2",children:"Technical Details"}),s.jsxs("div",{className:"space-y-2 text-sm text-gray-600",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Content Hash:"})," ",yt.proof.content_hash]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Fetched At:"})," ",new Date(yt.proof.fetched_at).toLocaleString()]}),yt.proof.parser_note&&s.jsxs("div",{children:[s.jsx("strong",{children:"Parser Note:"})," ",yt.proof.parser_note]})]})]})]})}),zr.length>0&&s.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.15},className:"mb-6",children:s.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Disputes"}),s.jsx("div",{className:"space-y-4",children:zr.map(q=>s.jsx("div",{},q.id))})]})}),oo.length>0&&s.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"mb-6",children:s.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100",children:[s.jsxs("div",{className:"flex items-center justify-between mb-4",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Audit Timeline"}),s.jsx("button",{onClick:()=>k(!w),className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:w?"Hide timeline":"Show timeline"})]}),w&&s.jsx("div",{})]})}),!As&&c?.user_entry&&c?.status==="awaiting_settlement"&&s.jsx(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-200 rounded-2xl p-6 mb-6 shadow-lg",children:s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("div",{className:"flex-shrink-0",children:s.jsx("div",{className:"w-12 h-12 bg-amber-500 rounded-full flex items-center justify-center",children:s.jsx(Er,{className:"w-6 h-6 text-white"})})}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"text-lg font-bold text-amber-900 mb-1",children:"⚖️ Settlement Ready for Validation"}),s.jsx("p",{className:"text-amber-800 mb-3",children:"The creator has settled this prediction. Please review and validate the outcome."}),s.jsx(N.button,{onClick:()=>_(!0),className:"px-6 py-3 bg-amber-500 hover:bg-amber-600 text-white font-semibold rounded-xl transition-colors shadow-md",whileHover:{scale:1.02},whileTap:{scale:.98},children:"🔍 Review Settlement"})]})]})}),!As&&c?.user_entry&&(c?.status==="closed"||c?.status==="awaiting_settlement"||c?.status==="settled")&&s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border border-gray-100",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Settlement Status"}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Your Position:"}),s.jsx("span",{className:"font-medium",children:c.user_entry.option?.label||"Unknown"})]}),s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Amount Staked:"}),s.jsxs("span",{className:"font-medium",children:["$",c.user_entry.amount?.toLocaleString()||0]})]}),s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsx("span",{className:"text-sm text-gray-600",children:"Status:"}),s.jsx("span",{className:`font-medium px-2 py-1 rounded-full text-xs ${c.user_entry.status==="won"?"bg-emerald-100 text-emerald-800":c.user_entry.status==="lost"?"bg-red-100 text-red-800":c.user_entry.status==="refunded"?"bg-blue-100 text-blue-800":"bg-yellow-100 text-yellow-800"}`,children:c.user_entry.status||"pending"})]})]}),c?.status!=="settled"&&s.jsx(N.button,{onClick:()=>_(!0),className:"w-full py-3 rounded-xl font-semibold text-white transition-all text-lg bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-600 hover:to-emerald-700 shadow-lg",whileHover:{scale:1.02},whileTap:{scale:.98},children:"View Settlement Details"})]})]}),As&&s.jsxs(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-2xl p-6 mb-6 shadow-sm border border-gray-100",children:[s.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Place Your Prediction"}),s.jsx("div",{className:"space-y-3 mb-6",children:c.options?.map((q,ae)=>s.jsx(N.button,{onClick:()=>Pe(q.id),className:`w-full p-4 rounded-xl border-2 transition-all ${r===q.id?"border-emerald-500 bg-emerald-50 shadow-lg":"border-gray-200 hover:border-gray-300 hover:bg-gray-50"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"text-left flex-1",children:[s.jsx("div",{className:"font-semibold text-gray-900 text-lg mb-1",children:q.label}),s.jsxs("div",{className:"text-sm text-gray-500",children:[c.pool_total>0?`${(q.total_staked/c.pool_total*100).toFixed(1)}% of pool`:"0% of pool"," • $",(q.total_staked||0).toLocaleString()," staked"]})]}),s.jsxs("div",{className:"text-right ml-4",children:[s.jsxs("div",{className:"text-2xl font-bold text-emerald-600",children:[(q.current_odds||1).toFixed(2),"x"]}),s.jsx("div",{className:"text-xs text-gray-500",children:"odds"})]})]})},q.id))}),s.jsxs("div",{className:"mb-6",children:[s.jsx("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:"Stake Amount (USD)"}),s.jsxs("div",{className:"relative",children:[s.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"$"}),s.jsx("input",{type:"text",value:o,onChange:z,placeholder:"0.00",className:"w-full pl-10 pr-4 py-4 border-2 border-gray-200 rounded-xl focus:border-emerald-500 focus:outline-none transition-colors text-lg"})]}),s.jsxs("div",{className:"flex justify-between text-sm text-gray-500 mt-2",children:[s.jsxs("span",{children:["Min: $",c.stake_min]}),s.jsxs("span",{children:["Max: $",c.stake_max||"No limit"]})]})]}),s.jsx(xe,{children:r&&o&&s.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-emerald-50 border-2 border-emerald-200 rounded-xl p-4 mb-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsx("span",{className:"text-emerald-800 font-semibold",children:"Potential Payout:"}),s.jsxs("span",{className:"text-emerald-800 font-bold text-xl",children:["$",Ur.toFixed(2)]})]}),s.jsxs("div",{className:"text-emerald-700 text-sm",children:["Profit: $",Math.max(0,Ur-parseFloat(o)).toFixed(2)]})]})}),s.jsx(N.button,{onClick:le,disabled:!r||!o||l,className:`w-full py-4 rounded-xl font-semibold text-white transition-all text-lg ${r&&o&&!l?"bg-emerald-500 hover:bg-emerald-600 active:bg-emerald-700 shadow-lg":"bg-gray-300 cursor-not-allowed"}`,whileHover:r&&o&&!l?{scale:1.02}:{},whileTap:r&&o&&!l?{scale:.98}:{},children:l?s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Placing Prediction..."]}):"Place Prediction"})]}),s.jsxs(N.div,{ref:K,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900 mb-4",children:"Community Engagement"}),s.jsxs("div",{className:"flex items-center gap-6",children:[s.jsxs(N.button,{onClick:me,className:`flex items-center gap-2 transition-colors ${j(c.id)?"text-red-500":"text-gray-600 hover:text-red-500"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[s.jsx(dt,{size:20,fill:j(c.id)?"currentColor":"none"}),s.jsxs("span",{className:"font-medium",children:[D(c.id)," likes"]})]}),s.jsxs(N.button,{onClick:ro,className:`flex items-center gap-2 transition-colors ${m?"text-blue-500":"text-gray-600 hover:text-blue-500"}`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[s.jsx($e,{size:20}),s.jsxs("span",{className:"font-medium",children:[he," comments"]}),s.jsx(nd,{size:16,className:`transition-transform ml-1 ${m?"rotate-180":""}`})]}),s.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[s.jsx(Me,{size:20}),s.jsxs("span",{className:"font-medium",children:[c.participant_count||0," participants"]})]})]})]}),s.jsx(xe,{children:m&&s.jsxs(N.div,{ref:A,initial:{opacity:0,y:-20,height:0},animate:{opacity:1,y:0,height:"auto"},exit:{opacity:0,y:-20,height:0},transition:{duration:.4,ease:"easeInOut"},className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6",children:[s.jsxs("div",{className:"px-6 py-4 border-b border-gray-100 bg-gradient-to-r from-blue-50 to-indigo-50",children:[s.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Comments"}),s.jsx("p",{className:"text-sm text-gray-600",children:"Join the conversation about this prediction"})]}),s.jsx("div",{className:"min-h-[300px] max-h-[600px] overflow-y-auto",children:s.jsx(kh,{predictionId:Be})})]})})]})]}),c.status==="settled"&&no&&yt&&{},I&&s.jsx(jh,{isOpen:I,onClose:()=>_(!1),predictionId:c.id,predictionTitle:c.title})]})},Sh=({activeTab:i="discover",onTabChange:e,showFAB:t=!1,onFABClick:r})=>{const n=[{id:"discover",label:"Discover",icon:kn},{id:"bets",label:"My Bets",icon:Me},{id:"wallet",label:"Wallet",icon:Vt},{id:"profile",label:"Profile",icon:Ir}],o=a=>{typeof window<"u"&&window.scrollTo({top:0,behavior:"smooth"}),e&&e(a)};return s.jsx("div",{style:{position:"fixed",bottom:"0",left:"0",right:"0",zIndex:"1000",backgroundColor:"white",borderTop:"1px solid #e5e7eb",paddingBottom:"max(env(safe-area-inset-bottom), 0.5rem)",paddingTop:"0.5rem",boxShadow:"0 -4px 20px rgba(0, 0, 0, 0.1)"},children:s.jsxs("nav",{style:{padding:"0 1rem",position:"relative"},children:[s.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-around",maxWidth:"400px",margin:"0 auto",position:"relative"},children:n.map(a=>{const l=a.icon,d=i===a.id;return s.jsxs(N.button,{onClick:()=>o(a.id),whileHover:{scale:1.05},whileTap:{scale:.95},style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"8px 4px",minWidth:"0",flex:"1",position:"relative",background:"none",border:"none",cursor:"pointer",borderRadius:"12px",transition:"all 0.2s ease"},onMouseEnter:c=>{d||(c.currentTarget.style.backgroundColor="#f9fafb")},onMouseLeave:c=>{d||(c.currentTarget.style.backgroundColor="transparent")},"data-tour-id":`tab-${a.id}`,children:[s.jsxs("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"6px",marginTop:"2px",width:"24px",height:"24px"},children:[s.jsx("div",{style:{transition:"all 0.2s ease",color:d?"#7B2FF7":"#6b7280",transform:d?"scale(1.1)":"scale(1)",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(l,{size:20})}),d&&s.jsx(N.div,{layoutId:"activeTab",style:{position:"absolute",top:"-6px",left:"50%",transform:"translateX(-50%)",width:"4px",height:"4px",backgroundColor:"#7B2FF7",borderRadius:"50%",boxShadow:"0 0 6px rgba(34, 197, 94, 0.6)"},initial:!1,transition:{type:"spring",stiffness:400,damping:30}})]}),s.jsx("span",{style:{fontSize:"11px",fontWeight:d?"600":"500",transition:"all 0.2s ease",color:d?"#7B2FF7":"#6b7280",textAlign:"center",lineHeight:"1.2"},children:a.label})]},a.id)})}),t&&s.jsx(N.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:r,"data-tour-id":"create-fab",style:{position:"fixed",bottom:"calc(80px + env(safe-area-inset-bottom, 0px))",right:"16px",width:"56px",height:"56px",borderRadius:"50%",background:"linear-gradient(135deg, #7B2FF7, #00F5D4)",border:"none",boxShadow:"0 8px 24px rgba(34, 197, 94, 0.4)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001},children:s.jsx(Qt,{size:24,style:{color:"white"}})})]})})},Lr=({message:i="Loading..."})=>s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500 mx-auto"}),s.jsx("p",{className:"mt-2 text-gray-600",children:i})]})}),to=p.memo(({children:i})=>{const{isAuthenticated:e,loading:t,initialized:r,initializeAuth:n}=oe();return p.useEffect(()=>{!r&&!t&&n()},[r,t,n]),!r||t&&!e?s.jsx(Lr,{message:"Authenticating..."}):e?s.jsx(s.Fragment,{children:i}):s.jsx(vh,{})});to.displayName="AuthGuard";const so=p.memo(({children:i})=>{const[e,t]=pe(),r=p.useCallback(()=>{const l=e.toLowerCase();return l==="/"||l==="/discover"?"discover":l==="/bets"||l==="/predictions"?"bets":l==="/profile"?"profile":l==="/wallet"?"wallet":"discover"},[e]),n=p.useCallback(l=>{if(r()!==l){switch(ut(e),Et(),l){case"discover":t("/");break;case"bets":t("/predictions");break;case"profile":t("/profile");break;case"wallet":t("/wallet");break;default:t("/")}setTimeout(()=>{Nt({behavior:"instant"})},50)}},[t,r,e]),o=p.useCallback(()=>{ut(e),Et(),t("/create")},[t,e]),a=r()==="discover";return s.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col","data-scroll-container":!0,children:[s.jsx("main",{className:"flex-1 pb-20",children:s.jsx(p.Suspense,{fallback:s.jsx(Lr,{message:"Loading page..."}),children:i})}),s.jsx(Sh,{activeTab:r(),onTabChange:n,showFAB:a,onFABClick:o}),s.jsx(bn,{}),s.jsx(Ad,{}),s.jsx(Qc,{position:"top-center",toastOptions:{duration:4e3,style:{background:"#363636",color:"#fff"}}})]})});so.displayName="MainLayout";const Vs=()=>{const[i,e]=pe(),t=p.useCallback(()=>{ut(i),e("/profile")},[e,i]),r=p.useCallback(n=>{ut(i),e(`/prediction/${n}`)},[e,i]);return s.jsx(Fe,{title:"Discover",children:s.jsx(Qn,{onNavigateToProfile:t,onNavigateToPrediction:r})})},Ni=()=>{const[i,e]=pe();return p.useCallback(()=>{ut(i),e("/")},[e,i]),s.jsx(Fe,{title:"My Predictions",children:s.jsx(ah,{})})},Nh=()=>{const[i,e]=pe(),t=p.useCallback(()=>{Et(),e("/")},[e]);return s.jsx(Fe,{title:"Create Prediction",children:s.jsx(oh,{onNavigateBack:t})})},Ch=({params:i})=>{const[e,t]=pe(),r=p.useCallback(()=>{window.history.length>1?window.history.back():(Et(),t("/"))},[t]),n=ne.useMemo(()=>{const o=i?.userId;if(!o){console.warn("⚠️ No userId provided in profile route");return}const a=o.trim();if(!a){console.warn("⚠️ Empty userId in profile route");return}if(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(a))return console.log("✅ Valid UUID userId:",a),a;if(a.length>2)return console.log("⚠️ Non-UUID userId (might be username):",a),a;console.warn("⚠️ Invalid userId format:",a)},[i?.userId]);return n?(console.log("🔍 UserProfilePageWrapper rendering with userId:",n),s.jsx(Fe,{title:"User Profile",children:s.jsx(eo,{onNavigateBack:r,userId:n})})):(ne.useEffect(()=>{console.warn("⚠️ Invalid userId in profile route, redirecting to own profile"),Et(),t("/profile")},[t]),s.jsx(Lr,{message:"Redirecting..."}))},Ph=()=>{const[i,e]=pe(),t=p.useCallback(()=>{ut(i),e("/")},[e,i]);return s.jsx(Fe,{title:"My Profile",children:s.jsx(eo,{onNavigateBack:t})})},Eh=()=>{const[i,e]=pe(),t=p.useCallback(()=>{ut(i),e("/")},[e,i]);return s.jsx(Fe,{title:"Wallet",children:s.jsx(bh,{onNavigateBack:t})})},Ci=({params:i})=>{const[e,t]=pe(),r=p.useCallback(()=>{console.log("🔙 Navigating back from prediction details"),window.history.length>1?window.history.back():(Et(),t("/"))},[t]);return i?.id?s.jsx(Fe,{title:"Prediction Details",children:s.jsx(_h,{predictionId:i.id,onNavigateBack:r})}):s.jsx(Fe,{title:"Error",children:s.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Prediction Not Found"}),s.jsx("p",{className:"text-gray-600 mb-4",children:"The prediction you're looking for doesn't exist."}),s.jsx("button",{onClick:r,className:"px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600",children:"Go Back"})]})})})};function Th(){const{initializeWallet:i}=Yt(),{initializeAuth:e,isAuthenticated:t,loading:r,initialized:n}=oe(),{initializeLikes:o}=Sr(),{initialize:a}=Nr();return p.useEffect(()=>{if(!n&&!r)try{console.log("App: Initializing auth..."),e()}catch(l){console.error("Auth initialization failed:",l)}},[e,n,r]),p.useEffect(()=>{if(t&&!r&&n)try{console.log("App: Initializing wallet and social features..."),i(),o(),a(),console.log("✅ All stores initialized successfully")}catch(l){console.error("Store initialization failed:",l)}},[t,r,n,i,o,a]),s.jsx($r,{children:s.jsx(Di,{children:s.jsxs(qr,{children:[s.jsx(ye,{path:"/auth/callback",children:s.jsx(Fe,{title:"Authentication",children:s.jsx(wh,{})})}),s.jsx(to,{children:s.jsx(Hd,{children:s.jsx(so,{children:s.jsxs(qr,{children:[s.jsx(ye,{path:"/",component:Vs}),s.jsx(ye,{path:"/discover",component:Vs}),s.jsx(ye,{path:"/predictions",component:Ni}),s.jsx(ye,{path:"/predictions/:id",component:Ci}),s.jsx(ye,{path:"/bets",component:Ni}),s.jsx(ye,{path:"/create",component:Nh}),s.jsx(ye,{path:"/profile",component:Ph}),s.jsx(ye,{path:"/profile/:userId",component:Ch}),s.jsx(ye,{path:"/wallet",component:Eh}),s.jsx(ye,{path:"/prediction/:id",component:Ci}),s.jsx(ye,{component:Vs})]})})})})]})})})}console.log(`🚀 Fan Club Z ${Ts} - CONSOLIDATED ARCHITECTURE - SINGLE SOURCE OF TRUTH`);window.addEventListener("unhandledrejection",i=>{console.error("Unhandled promise rejection:",i.reason)});window.addEventListener("error",i=>{console.error("Global error:",i.error)});Gs.createRoot(document.getElementById("root")).render(s.jsx(ne.StrictMode,{children:s.jsx($r,{onError:(i,e)=>{console.error("React Error Boundary triggered:",i,e)},children:s.jsx(Th,{})})}));console.log(`✅ Fan Club Z ${Ts} - Application started successfully`);console.log("🚀 Build timestamp:",ph);
