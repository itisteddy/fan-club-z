var A=Object.defineProperty;var R=(e,r,t)=>r in e?A(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var E=(e,r,t)=>(R(e,typeof r!="symbol"?r+"":r,t),t);import{r as d}from"./vendor-c36eaa8e.js";import{l as T,a6 as g,aa as B}from"./index-78beacc5.js";import{j as C}from"./ui-c369d1f3.js";const L=new Set(["the","a","an","of","is","are","to","in","by","on","for","with","will","be","have","has","had","do","does","did","can","could","should","would","may","might","must","shall","this","that","these","those","i","you","he","she","it","we","they","me","him","her","us","them","my","your","his","her","its","our","their","mine","yours","hers","ours","theirs"]),z=8;function N(e,r=4){return e?e.toLowerCase().replace(/[^\p{L}\p{N}\s]/gu,"").split(/\s+/).filter(t=>t&&!L.has(t)).slice(0,r):[]}const j={tech:"technology gadgets computer",technology:"technology gadgets computer",sports:"sports stadium athlete",crypto:"cryptocurrency blockchain digital",cryptocurrency:"cryptocurrency blockchain digital",politics:"government parliament politics",business:"business office corporate",entertainment:"entertainment media celebrity",science:"science laboratory research",health:"health medical wellness",finance:"finance money investment",education:"education learning school",travel:"travel destination landscape",food:"food cooking restaurant",fashion:"fashion style clothing",art:"art creative design",music:"music concert performance",gaming:"gaming esports technology",automotive:"car automotive vehicle",real_estate:"house building architecture"},F=[{keywords:["taylor swift"],query:"taylor swift singer portrait pop star"},{keywords:["beyonce"],query:"beyonce singer concert stage lights"},{keywords:["super bowl"],query:"super bowl american football crowd stadium"},{keywords:["nba","lakers","celtics","warriors"],query:"nba basketball arena game action"},{keywords:["bitcoin"],query:"bitcoin cryptocurrency coin digital gold"},{keywords:["ethereum"],query:"ethereum blockchain technology crypto"},{keywords:["tesla"],query:"tesla electric car futuristic automotive"},{keywords:["apple","iphone","macbook"],query:"apple product render minimalist tech"},{keywords:["marvel","avengers"],query:"marvel movie cinematic superhero film poster"},{keywords:["fanclubz","fan club z"],query:"mobile app interface prediction cards clean ui analytics dashboard soft gradient"}],K=[{pattern:/\b(playstation|xbox|nintendo|switch|console|gaming|esports|ps[45]|fc\d+|fifa|call of duty|madden)\b/i,enrichment:"gaming console controller neon lights"},{pattern:/\b(soccer|football|premier league|champions league|world cup|uefa|goal|striker|super eagles|laliga|serie a)\b/i,enrichment:"soccer football stadium crowd energy"},{pattern:/\b(super eagles|nigeria national football team|nigerian national team)\b/i,enrichment:"nigeria football super eagles national team stadium match night lights crowd"},{pattern:/\b(nba|basketball|wnba|lebron|curry|lakers|warriors|celtics|bucks|slam dunk)\b/i,enrichment:"basketball court arena spotlight action"},{pattern:/\b(baseball|mlb|yankees|mets|dodgers|home run)\b/i,enrichment:"baseball stadium diamond night lights"},{pattern:/\b(crypto|bitcoin|ethereum|blockchain|token|defi|web3|nft)\b/i,enrichment:"cryptocurrency blockchain digital finance"},{pattern:/\b(stock|market|nasdaq|dow|s&p|economy|inflation|interest rate|fed|earnings)\b/i,enrichment:"finance stock market trading screens"},{pattern:/\b(election|vote|president|senate|congress|ballot|campaign|debate|primary)\b/i,enrichment:"politics debate stage voters flag"},{pattern:/\b(ai|artificial intelligence|machine learning|automation|robot|chatgpt|openai)\b/i,enrichment:"artificial intelligence neon interface"},{pattern:/\b(weather|storm|hurricane|rain|snow|heatwave|forecast|climate|temperature)\b/i,enrichment:"weather radar satellite dramatic sky"},{pattern:/\b(health|medical|hospital|doctor|vaccine|covid|virus|pharma|therapy)\b/i,enrichment:"healthcare medical laboratory professional"},{pattern:/\b(movie|film|netflix|disney|hollywood|oscars|series|streaming|celebrity|album|music)\b/i,enrichment:"entertainment cinematic lights audience"},{pattern:/\b(travel|flight|airline|airport|tourism|hotel|vacation|cruise|passport)\b/i,enrichment:"travel adventure airplane tropical destination"},{pattern:/\b(oil|gas|energy|petroleum|solar|wind|renewable|power grid|battery)\b/i,enrichment:"energy industry infrastructure power"},{pattern:/\b(education|school|university|college|students|teacher|campus|graduation)\b/i,enrichment:"education classroom lecture modern campus"},{pattern:/\b(military|war|defense|army|navy|missile|conflict|ukraine|gaza|troops)\b/i,enrichment:"military strategy defense technology"}];function U(e){const r=[e.identity?.creator,e.identity?.community,...e.identity?.personas??[]],t=[e.popularity?.players?`${e.popularity.players} participants`:"",e.popularity?.pool?`${e.popularity.pool} stake`:"",e.popularity?.totalVolume?`${e.popularity.totalVolume} volume`:""];return[e.title,e.description,e.question,...e.options?.map(a=>a?.label??"")??[],...e.tags??[],...e.keywords??[],...e.attributes??[],...r,...t].filter(Boolean).join(" ").toLowerCase()}function O(e){const r=U(e);for(const t of F)if(t.keywords.some(a=>r.includes(a)))return t.query;return null}function M(e){const r=U(e),t=new Set;for(const a of K)a.pattern.test(r)&&t.add(a.enrichment);return Array.from(t)}function V(e){const r=[e.title,e.description,e.entry_deadline].filter(Boolean);for(const t of r){const a=t.match(/20\d{2}/);if(a)return a[0]}return null}function c(e,r=[]){for(const t of r)t&&(t.length<=2&&!/^\d+$/.test(t)||e.add(t))}function $(e){if(typeof e=="number"&&!Number.isNaN(e))return e;if(typeof e=="string"){const r=parseFloat(e.replace(/[^\d.]/g,""));return Number.isNaN(r)?null:r}return null}function G(e){if(!e)return[];const r=[],t=$(e.pool??e.totalVolume),a=$(e.players),s=$(e.score),n=$(e.comments),i=$(e.likes);return t&&t>=1e4?r.push("high stakes spotlight premium"):t&&t>=2e3&&r.push("high stakes trending excitement"),a&&a>=100?r.push("massive crowd fans community buzz"):a&&a>=20&&r.push("community challenge social energy"),s&&s>=70&&r.push("viral trend spotlight momentum"),n&&n>=25&&r.push("heated debate discussion panel"),i&&i>=50&&r.push("fan favorite popular culture"),r}function H(e){const r=O(e);if(r)return r;const t=new Set;c(t,N(e.title,5)),c(t,N(e.description,3)),c(t,N(e.question??"",3)),c(t,e.tags??[]),c(t,e.options?.map(o=>N(o?.label??"",2)).flat().filter(Boolean)??[]),c(t,e.keywords??[]),c(t,e.attributes??[]),c(t,e.identity?.personas??[]),c(t,N(e.identity?.creator??"",2)),c(t,N(e.identity?.community??"",2)),c(t,G(e.popularity));const a=V(e);if(a&&t.add(a),e.category){const o=e.category.replace("_"," ").toLowerCase();t.add(o);const u=j[o];u&&c(t,u.split(" "))}M(e).forEach(o=>c(t,o.split(" ")));const n=Array.from(t).slice(0,z);if(n.length>=2)return n.join(" ");const i=e.category?j[e.category.toLowerCase()]??e.category.toLowerCase():null;return i||"abstract business technology"}function Q(e){return e.id||e.slug||e.title.trim().toLowerCase()}function Y(e){const r=["explicit","nsfw","adult","nude","naked","sex","porn","violence","blood","gore","weapon","gun","knife","hate","racist","offensive"];let t=e.toLowerCase();for(const a of r)t=t.replace(new RegExp(`\\b${a}\\b`,"gi"),"");return t=t.replace(/\s+/g," ").trim(),t||(t="abstract business"),t}class W{constructor(){E(this,"memoryCache",new Map);E(this,"dbName","auto-images");E(this,"storeName","images");E(this,"db",null);E(this,"initPromise",null)}async initDB(){return this.initPromise?this.initPromise:(this.initPromise=new Promise((r,t)=>{const a=indexedDB.open(this.dbName,1);a.onerror=()=>t(a.error),a.onsuccess=()=>{this.db=a.result,r()},a.onupgradeneeded=s=>{const n=s.target.result;if(!n.objectStoreNames.contains(this.storeName)){const i=n.createObjectStore(this.storeName,{keyPath:"key"});i.createIndex("predictionId","predictionId",{unique:!1}),i.createIndex("timestamp","timestamp",{unique:!1})}}}),this.initPromise)}generateKey(r,t,a){return`${r}@${t}@${a}`}async get(r,t,a){const s=this.generateKey(r,t,a),n=this.memoryCache.get(s);if(n){if(Date.now()-n.timestamp<60*60*1e3)return n.image;this.memoryCache.delete(s)}try{return await this.initDB(),this.db?Promise.race([new Promise(i=>{const l=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(s);l.onsuccess=()=>{const y=l.result;y&&Date.now()-y.timestamp<24*60*60*1e3?(this.memoryCache.set(s,y),i(y.image)):i(null)},l.onerror=()=>i(null)}),new Promise(i=>setTimeout(()=>i(null),500))]):null}catch{return null}}async set(r,t,a,s){const n=this.generateKey(r,t,a),i={predictionId:r,provider:t,seed:a,image:s,timestamp:Date.now()};this.memoryCache.set(n,i);try{return await this.initDB(),this.db?new Promise(o=>{const y=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).put({key:n,...i});y.onsuccess=()=>o(),y.onerror=()=>{o()}}):void 0}catch{}}async clear(){this.memoryCache.clear();try{return await this.initDB(),this.db?new Promise(r=>{const s=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).clear();s.onsuccess=()=>r(),s.onerror=()=>{r()}}):void 0}catch{}}async cleanup(){const r=Date.now()-6048e5;for(const[t,a]of this.memoryCache.entries())a.timestamp<r&&this.memoryCache.delete(t);try{return await this.initDB(),this.db?new Promise(t=>{const i=this.db.transaction([this.storeName],"readwrite").objectStore(this.storeName).index("timestamp").openCursor(IDBKeyRange.upperBound(r));i.onsuccess=o=>{const u=o.target.result;u?(u.delete(),u.continue()):t()},i.onerror=()=>{t()}}):void 0}catch{}}}const S=new W;typeof window<"u"&&(setInterval(()=>{S.cleanup()},60*60*1e3),window.__clearImageCache=async()=>{await S.clear()});const D=`${T()}/api`;async function P(e,r){if(!(!e||e.trim()===""))try{(await fetch(`${D}/v2/predictions/${e}/image`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:r})})).ok&&g(`[stable-image] Saved image to database for ${e}`)}catch{}}function J({prediction:e,enabled:r=!0}){const[t,a]=d.useState(null),[s,n]=d.useState(!1),[i,o]=d.useState(null),[u,l]=d.useState(!1),[y,p]=d.useState("pexels"),h=d.useRef(!1),q=d.useRef(!1);d.useEffect(()=>{h.current=!1,q.current=!1},[e.id]);const _=d.useCallback(async()=>{if(h.current||q.current||!r)return;if(!({}.VITE_IMAGES_FEATURE_FLAG!=="false")){l(!0),p("none"),h.current=!0;return}q.current=!0;let w=!1;try{n(!0),o(null);const k=Y(H(e)),m=Q(e);if(g(`[stable-image] Fetching for prediction ${e.id}:`,{query:k,seed:m,title:e.title,category:e.category,dbImageUrl:e.image_url}),e.image_url&&!w){g(`[stable-image] Using database image for ${e.id}: ${e.image_url.slice(0,50)}...`),a({url:e.image_url,previewUrl:e.image_url,width:800,height:600,photographer:"",provider:"pexels"}),p("pexels"),h.current=!0,n(!1);return}const x=await S.get(e.id,"pexels",m);if(x&&!w){g(`[stable-image] Using cached Pexels image for ${e.id}`),a(x),p("pexels"),h.current=!0,n(!1),x.url&&P(e.id,x.url);return}const v=await S.get(e.id,"unsplash",m);if(v&&!w){g(`[stable-image] Using cached Unsplash image for ${e.id}`),a(v),p("unsplash"),l(!0),h.current=!0,n(!1),v.url&&P(e.id,v.url);return}const b=await I("pexels",k,m);if(b&&!w){g(`[stable-image] Got Pexels image for ${e.id}`),a(b),p("pexels"),await S.set(e.id,"pexels",m,b),h.current=!0,n(!1),b.url&&P(e.id,b.url);return}g(`[stable-image] Pexels failed, trying Unsplash for ${e.id}`);const f=await I("unsplash",k,m);if(f&&!w){g(`[stable-image] Got Unsplash image for ${e.id}`),a(f),p("unsplash"),l(!0),await S.set(e.id,"unsplash",m,f),h.current=!0,n(!1),f.url&&P(e.id,f.url);return}g(`[stable-image] All providers failed for ${e.id}`),l(!0),p("none"),h.current=!0}catch(k){if(!w){const m=k instanceof Error?k.message:"Unknown error";g(`[stable-image] Error for ${e.id}:`,m),o(m),l(!0),p("none"),h.current=!0}}finally{w||n(!1)}async function I(k,m,x){try{const v=new URLSearchParams({q:m,seed:x,provider:k,take:"1"}),b=await fetch(`${D}/images?${v}`,{signal:AbortSignal.timeout(5e3)});if(!b.ok)throw new Error(`HTTP ${b.status}`);const f=await b.json();return f.success&&f.images&&f.images.length>0?f.images[0]:null}catch{return null}}return()=>{w=!0}},[e,r]);return d.useEffect(()=>{_()},[_]),{image:t,loading:s,error:i,usedFallback:u,provider:y}}function se(e,r){const t=r??{id:e||"",title:"",category:void 0},a={id:t.id,title:t.title||t.question||"Prediction",category:t.category,description:t.description??t.question??""},{image:s,loading:n,error:i,usedFallback:o}=J({prediction:a,enabled:!0}),u={id:a.id,url:s?.url??"",alt:s?`Image related to: ${a.title}`:a.title,provider:s?.provider??(o?"fallback":"none")};let l;return n&&!s?l="loading":s?l="ready":i?l="error":l="idle",{media:u,status:l}}const X=e=>e?e.full_name&&e.full_name.trim()?e.full_name.trim():e.displayName&&e.displayName.trim()?e.displayName.trim():e.username&&e.username.trim()?`@${e.username.trim()}`:e.handle&&e.handle.trim()?`@${e.handle.trim()}`:"Anonymous":"Anonymous";function ne({creator:e,className:r=""}){const t=e?.avatar_url||e?.avatarUrl,a=X(e);return C.jsxs("div",{className:`flex items-center gap-2 text-sm text-muted-foreground ${r}`,children:[t&&C.jsx("img",{src:t,alt:"",className:"size-5 rounded-full object-cover bg-muted",loading:"lazy",referrerPolicy:"no-referrer",onError:s=>{s.target.style.display="none"}}),C.jsx("span",{children:"Created by"}),C.jsxs("span",{className:"font-medium text-foreground flex items-center gap-1",children:[a,e?.is_verified&&C.jsx(B,{className:"size-4 text-primary","aria-label":"Verified"})]})]})}export{ne as C,se as u};
