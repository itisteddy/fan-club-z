import{m as Pe,j as $e,_ as De}from"./wagmi-c444efa6.js";import{j as e,A as te,m as E,R as Ee,P as Fe,O as Me,C as _e,T as Ae,b as Le}from"./ui-c369d1f3.js";import{r as l,R as le}from"./vendor-c36eaa8e.js";import{u as Te,L as Ie,g as Re,a as ue,b as xe,c as Ue,d as He,e as oe,z as j,f as ze,W as Be,X as he,h as de,Z as Oe,i as Ge,Q as ce,C as We,S as Ye,j as Qe,n as ee,k as Ve,T as qe}from"./index-78beacc5.js";import{u as Ke,C as Ze}from"./CreatorByline-9bede90f.js";import{f as Je,a as Xe}from"./format-14414da9.js";import{I as es,B as me}from"./input-0cc3cd56.js";import{c as $,f as ss}from"./utils-ae6b997d.js";import{u as ts}from"./useUnifiedBalance-69bdcc40.js";import{D as as}from"./DepositUSDCModal-4620608e.js";import{b as rs}from"./utils-617af415.js";import{s as ls}from"./cooldowns-a5c743e7.js";import{u as is,a as ns,B as os}from"./useFiatWallet-4b2d48ae.js";import{A as se}from"./arrow-up-right-87b90fb4.js";import{A as ds}from"./AppHeader-5f619f9e.js";import{u as cs}from"./useCategories-dd2ff1dd.js";import"./index-cca8fa81.js";import"./useEscrowBalance-5c6e362b.js";import"./useWalletConnectSession-1627a74c.js";import"./useNotifications-29ac0910.js";function ms({prediction:s}){if(!s)return null;const t=Te(),o=`${t.pathname}${t.search}${t.hash}`,u=[s.category,s.creator?.username??void 0,s.creator?.full_name??void 0].filter(i=>!!i),f=[s.creator?.is_verified?"verified creator":void 0].filter(i=>!!i),m={id:s.id,title:s.title,description:s.description??"",category:s.category,options:s.options?.map(i=>({label:i?.label??i?.title??i?.text??""})),keywords:u,attributes:f,tags:u,identity:{creator:s.creator?.full_name||s.creator?.username||null,community:s.category?`${s.category} community`:null,personas:f},popularity:{pool:typeof s.pool=="number"?s.pool:null,players:typeof s.players=="number"?s.players:null}},{media:c}=Ke(s.id,m),[v,g]=l.useState(!1);l.useEffect(()=>{g(!1)},[c.url]);const r=s.endsAt?Je(Math.max(0,new Date(s.endsAt).getTime()-Date.now())):null;return e.jsx(Ie,{to:`/prediction/${s.id}`,state:{from:o},className:"block rounded-2xl border border-black/5 bg-white hover:shadow-sm focus-visible:ring-2 focus-visible:ring-indigo-500 transition",children:e.jsxs("div",{className:"flex items-stretch gap-3 p-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(()=>{const i=Re(s);return i?e.jsx("span",{className:"rounded-full bg-gray-100 px-2 py-0.5 font-medium",children:i}):null})(),r&&e.jsxs("span",{className:"rounded-full bg-gray-100 px-2 py-0.5",children:["ends in ",r]})]}),e.jsx("h3",{className:"mt-1 line-clamp-2 text-[15px] font-semibold text-gray-900",children:s.title}),s.creator&&e.jsx(Ze,{creator:s.creator,className:"mt-1.5 text-xs"}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-xs text-gray-500",children:[typeof s.pool=="number"&&e.jsxs("span",{children:["$",Xe(s.pool)," pool"]}),typeof s.players=="number"&&e.jsxs("span",{children:[s.players," players"]}),s.options?.length?e.jsx("div",{className:"flex items-center gap-1",children:s.options.slice(0,2).map((i,d)=>{const N=i.label??i.title??i.text??`Option ${d+1}`;return e.jsxs("span",{className:"rounded-md border border-gray-200 px-1.5 py-0.5 text-[11px] font-medium text-gray-700",children:[N,i.odds?e.jsxs("span",{className:"ml-1 text-gray-500",children:[i.odds.toFixed(2),"x"]}):null]},`${N}-${d}`)})}):null]})]}),e.jsx("div",{className:"relative h-[72px] w-[96px] shrink-0 overflow-hidden rounded-xl bg-gray-100",children:c.url?e.jsxs(e.Fragment,{children:[!v&&e.jsx("div",{className:"absolute inset-0 animate-pulse bg-gray-200"}),e.jsx("img",{src:c.url,alt:c.alt||s.title,className:"h-full w-full object-cover transition-opacity duration-300",loading:"lazy",onLoad:()=>g(!0),onError:()=>g(!1),style:{opacity:v?1:0,transition:"opacity 200ms ease"}})]}):e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-gray-200 via-gray-100 to-gray-300"})})]})})}function us(){return e.jsx("div",{className:"rounded-2xl border border-black/5 bg-white p-3",children:e.jsxs("div",{className:"flex items-stretch gap-3",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"h-4 w-12 bg-gray-200 rounded-full animate-pulse"}),e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded-full animate-pulse"})]}),e.jsx("div",{className:"h-4 w-full bg-gray-200 rounded animate-pulse mb-1"}),e.jsx("div",{className:"h-4 w-3/4 bg-gray-200 rounded animate-pulse mb-2"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-3 w-16 bg-gray-200 rounded animate-pulse"}),e.jsx("div",{className:"h-3 w-12 bg-gray-200 rounded animate-pulse"})]})]}),e.jsx("div",{className:"h-[72px] w-[96px] bg-gray-200 rounded-xl animate-pulse"})]})})}const ae=l.forwardRef(({className:s,...t},o)=>e.jsx("div",{ref:o,className:$("rounded-xl border bg-card text-card-foreground shadow-sm",s),...t}));ae.displayName="Card";const xs=l.forwardRef(({className:s,...t},o)=>e.jsx("div",{ref:o,className:$("flex flex-col space-y-1.5 p-6",s),...t}));xs.displayName="CardHeader";const hs=l.forwardRef(({className:s,...t},o)=>e.jsx("h3",{ref:o,className:$("font-semibold leading-none tracking-tight",s),...t}));hs.displayName="CardTitle";const fs=l.forwardRef(({className:s,...t},o)=>e.jsx("p",{ref:o,className:$("text-sm text-muted-foreground",s),...t}));fs.displayName="CardDescription";const re=l.forwardRef(({className:s,...t},o)=>e.jsx("div",{ref:o,className:$("p-6 pt-0",s),...t}));re.displayName="CardContent";const gs=l.forwardRef(({className:s,...t},o)=>e.jsx("div",{ref:o,className:$("flex items-center p-6 pt-0",s),...t}));gs.displayName="CardFooter";const b=(s,t="USD")=>new Intl.NumberFormat(t==="NGN"?"en-NG":"en-US",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:t==="NGN"?0:2}).format(s),ps=(s,t)=>s*t,bs=({prediction:s,isOpen:t,onClose:o})=>{if(!s||!t)return null;const[u,f]=l.useState(""),[m,c]=l.useState(""),[v,g]=l.useState(!1),[r,i]=l.useState(!1),{user:d}=ue(),{placePrediction:N,placeFiatPrediction:F}=xe(),S=rs(),{address:M,chainId:I,isConnected:H}=Pe(),{sessionHealthy:z}=Ue(),_=M?.toLowerCase()??null,{wallet:q,available:D,refetch:B}=ts(),{mode:P,setMode:A,isDemoEnabled:R,isFiatEnabled:U,setFiatEnabled:O}=He(),{data:a}=is(),{data:k,refetch:h}=ns(d?.id);l.useEffect(()=>{a?.enabled!==void 0&&O(a.enabled)},[a?.enabled,O]);const p=U&&P==="fiat",C=R&&P==="demo",w=!C&&!p,[pe,K]=l.useState(null),[be,G]=l.useState(!1),[ie,W]=l.useState(null),Z=l.useCallback(async()=>{if(d?.id)try{G(!0),W(null);const n=await fetch(`${oe()}/api/demo-wallet/summary?userId=${d.id}`),y=await n.json().catch(()=>null);if(!n.ok)throw new Error(y?.message||"Failed to load demo credits");K(y?.summary??null)}catch(n){W(n?.message||"Failed to load demo credits"),K(null)}finally{G(!1)}},[d?.id]),ye=l.useCallback(async()=>{if(d?.id)try{G(!0),W(null);const n=await fetch(`${oe()}/api/demo-wallet/faucet`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:d.id})}),y=await n.json().catch(()=>null);if(!n.ok)throw new Error(y?.message||"Failed to get demo credits");K(y?.summary??null),y?.nextEligibleAt&&ls(`fcz_demo_credits_next_at:${d.id}`,String(y.nextEligibleAt)),y?.alreadyGranted?j.error("Demo credits not yet available. Please try again later."):j.success("Demo credits added.")}catch(n){W(n?.message||"Failed to get demo credits")}finally{G(!1)}},[d?.id]);l.useEffect(()=>{C&&Z()},[C,Z]);const x=parseFloat(m)||0,L=s?.options?.find(n=>n.id===u),je=L?.current_odds||(L?.total_staked?s?.pool_total/L.total_staked:2),J=L?ps(x,je):0,Y=pe?.available??0,Q=k?.summary?.availableNgn??0,T=p?Q:w?D:Y,V=p?"NGN":"USD",ve=w&&x>D,Ne=x>T,ne=l.useCallback(()=>{if(!w)return!0;try{return ze({address:M,chainId:I,expectedChainId:$e.id,isConnected:H,sessionHealthy:z}),!0}catch(n){const y=n instanceof Be?n.message:"Wallet is not ready. Please reconnect and switch to Base Sepolia.";return j.error(y),!1}},[M,I,H,w,z]),we=p?[500,1e3,2500,5e3,1e4,25e3]:[5,10,25,50,100,250],ke=async()=>{if(!u){j.error("Please select a prediction option (Yes or No)");return}if(!x){j.error("Please enter an amount to stake");return}if(p){if(x<100){j.error(`Minimum stake is ${b(100,"NGN")}. Please increase your amount.`);return}}else{if(x<s.stake_min){j.error(`Minimum stake is ${b(s.stake_min)}. Please increase your amount.`);return}if(s.stake_max&&x>s.stake_max){j.error(`Maximum stake is ${b(s.stake_max)}. Please reduce your amount.`);return}}if(!d?.id){j.error("You must be logged in to place predictions");return}if(ve){j.error(`Insufficient escrow balance. You have ${b(D)}, but tried to stake ${b(x)}.`),i(!0);return}if(C&&x>Y){j.error(`Insufficient balance. You have ${b(Y)} available, but tried to stake ${b(x)}.`);return}if(p&&x>Q){j.error(`Insufficient fiat balance. You have ${b(Q,"NGN")} available, but tried to stake ${b(x,"NGN")}.`);return}if(!(w&&!ne())){g(!0);try{p?(await F(s.id,u,x,d.id),j.success(`Prediction placed successfully! You staked ${b(x,"NGN")} on ${L?.label}.`)):(await N(s.id,u,x,d.id,w?M??void 0:void 0),j.success(`Prediction placed successfully! You staked ${b(x)} on ${L?.label}.`)),o(),c(""),f(""),Ge(S,{userId:d.id,predictionId:s.id}),await Promise.all([S.invalidateQueries({queryKey:ce.walletSummary(d.id,_)}),S.invalidateQueries({queryKey:ce.walletActivity(d.id)}),S.invalidateQueries({queryKey:["readContract"]}),S.invalidateQueries({queryKey:["fiat"]})]),await B(),C&&await Z(),p&&await h(),window.dispatchEvent(new CustomEvent("fcz:balance:refresh"))}catch(n){const y=n?.message||"Unknown error occurred";j.error(`Failed to place prediction: ${y}. Please try again.`)}finally{g(!1)}}};return e.jsx(te,{mode:"wait",initial:!1,children:t&&e.jsxs(e.Fragment,{children:[e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:o,style:{zIndex:8e3}},"prediction-modal-backdrop"),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center p-4 pb-20",style:{zIndex:8500,pointerEvents:"none"},children:e.jsxs(E.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:"w-full max-w-md bg-white rounded-t-2xl shadow-2xl flex flex-col max-h-[75vh]",style:{pointerEvents:"auto"},onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"flex-shrink-0 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Place Prediction"}),e.jsx("button",{onClick:o,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close modal",children:e.jsx(he,{size:20})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[(R||U)&&e.jsxs("div",{className:"inline-flex rounded-lg bg-gray-100 p-1 flex-wrap gap-1",children:[e.jsx("button",{onClick:()=>A("crypto"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${w?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Crypto (USDC)"}),R&&e.jsx("button",{onClick:()=>A("demo"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${C?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Demo Credits"}),U&&e.jsx("button",{onClick:()=>A("fiat"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${p?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Fiat (NGN)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:[b(s.pool_total||0)," Pool"]}),e.jsx("span",{children:"â€¢"}),e.jsxs("span",{children:[s.participant_count||0," Players"]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:(()=>{const n=ss(s.entry_deadline||s.entryDeadline||"");return n?n==="Ended"?"Closed":`Ends in ${n}`:""})()})]})]}),w&&e.jsxs("div",{className:"flex items-center justify-between bg-purple-50 border border-purple-100 rounded-xl px-3 py-2 text-xs text-purple-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Available to stake"}),e.jsxs("p",{className:"text-purple-700",children:["$",D.toFixed(2)," USDC"]})]})]}),e.jsxs("button",{className:"inline-flex items-center gap-1 text-xs font-semibold text-purple-800 hover:text-purple-900",onClick:()=>{if(!d?.id){j.error("Sign in to deposit funds.");return}ne()&&i(!0)},children:[e.jsx(se,{className:"w-3 h-3"}),"Add funds"]})]}),C&&e.jsxs("div",{className:"flex items-center justify-between bg-emerald-50 border border-emerald-100 rounded-xl px-3 py-2 text-xs text-emerald-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Demo available"}),e.jsxs("p",{className:"text-emerald-700",children:["$",Y.toFixed(2)]})]})]}),e.jsxs("button",{className:"inline-flex items-center gap-1 text-xs font-semibold text-emerald-800 hover:text-emerald-900 disabled:opacity-60",onClick:()=>void ye(),disabled:!d?.id||be,children:[e.jsx(se,{className:"w-3 h-3"}),"Get credits"]})]}),p&&e.jsxs("div",{className:"flex items-center justify-between bg-amber-50 border border-amber-100 rounded-xl px-3 py-2 text-xs text-amber-900",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(os,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:"Fiat available"}),e.jsx("p",{className:"text-amber-700",children:b(Q,"NGN")})]})]}),e.jsxs("a",{href:"/wallet",className:"inline-flex items-center gap-1 text-xs font-semibold text-amber-800 hover:text-amber-900",children:[e.jsx(se,{className:"w-3 h-3"}),"Deposit NGN"]})]}),!w&&ie&&e.jsx("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded-xl px-3 py-2",children:ie}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Select your prediction:"}),e.jsx("div",{className:"space-y-2",children:(s.options||[]).map(n=>{const y=n.total_staked||0,X=s.pool_total||1,Ce=X>0?Math.min(y/X*100,100):50,Se=n.current_odds||(y>0?X/y:2);return e.jsx(ae,{className:$("cursor-pointer transition-all border-2",u===n.id?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-gray-300"),onClick:()=>f(n.id),children:e.jsx(re,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:n.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[Ce.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[Se.toFixed(2),"x"]})})]})})},n.id||Math.random())})})]}),e.jsx(te,{mode:"wait",children:u&&e.jsxs(E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Stake amount ",p?"(NGN)":"(USD)"]}),e.jsxs("div",{className:"relative",children:[e.jsx(es,{type:"number",placeholder:"0.00",value:m,onChange:n=>c(n.target.value),className:"pl-8 pr-4 h-12 text-lg font-medium",min:p?100:s.stake_min,max:p?T:s.stake_max||T}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:p?"â‚¦":"$"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:["Balance: ",b(T,V)]}),e.jsx("button",{onClick:()=>c(Math.floor(T).toString()),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Max"})]})]}),e.jsx("div",{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:we.map(n=>e.jsx(me,{variant:"outline",size:"sm",onClick:()=>c(n.toString()),disabled:n>T,className:"text-sm h-10",children:p?`â‚¦${n.toLocaleString()}`:`$${n}`},n))})}),x>0&&e.jsx(ae,{className:"bg-teal-50 border-teal-200",children:e.jsx(re,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Potential return"}),e.jsx("div",{className:"text-lg font-bold text-teal-600",children:b(J,V)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Profit"}),e.jsx("div",{className:$("font-semibold",J>x?"text-teal-600":"text-red-600"),children:b(J-x,V)})]})]})})})]},`amount-input-${u}`)})]}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-gray-200 bg-white",children:e.jsx(me,{onClick:ke,disabled:!u||!x||v||Ne,className:"w-full h-12 bg-teal-500 hover:bg-teal-600 disabled:bg-gray-400 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg flex items-center justify-center",children:v?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Placing..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Oe,{size:16}),e.jsxs("span",{children:["Place Prediction (",b(x,V),")"]})]})})})]},"prediction-modal-content")}),r&&d?.id&&e.jsx(as,{open:r,onClose:()=>i(!1),onSuccess:()=>{i(!1),B()},availableUSDC:q,userId:d.id})]})})},ys=({hasNext:s,loading:t,onLoadMore:o,threshold:u=200,disabled:f=!1,container:m=null})=>{const c=l.useRef(!1),v=l.useCallback(()=>{if(f||t||!s||c.current)return;let r,i,d;m?(r=m.scrollTop,i=m.scrollHeight,d=m.clientHeight):(r=window.pageYOffset||document.documentElement.scrollTop,i=document.documentElement.scrollHeight,d=window.innerHeight||document.documentElement.clientHeight),i-(r+d)<=u&&(c.current=!0,o(),setTimeout(()=>{c.current=!1},1e3))},[f,t,s,u,o,m]);return l.useEffect(()=>{if(f)return;let r;const i=()=>{clearTimeout(r),r=setTimeout(v,100)},d=m||window,N="scroll",F="touchmove";return d.addEventListener(N,i,{passive:!0}),m||window.addEventListener(F,i,{passive:!0}),()=>{d.removeEventListener(N,i),m||window.removeEventListener(F,i),clearTimeout(r)}},[v,f,m]),{triggerLoadMore:l.useCallback(()=>{!f&&!t&&s&&!c.current&&(c.current=!0,o(),setTimeout(()=>{c.current=!1},1e3))},[f,t,s,o])}},fe=le.memo(function({selectedCategoryId:t,onSelect:o,categories:u,isLoading:f}){const[m,c]=l.useState(!1),v=u.slice(0,8),g=u.slice(8);return f?e.jsx("div",{className:"category-filters bg-white border-b border-gray-100 px-4 py-3",children:e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5,6].map(r=>e.jsx("div",{className:"h-7 w-20 bg-gray-200 rounded-full animate-pulse"},r))})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"category-filters bg-white border-b border-gray-100 px-4 py-3","data-tour":"category-filters","data-tour-id":"category-filters",children:e.jsx("div",{className:"overflow-x-auto overflow-y-hidden scrollbar-hide",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>o(null),style:{height:"28px",minHeight:"28px",padding:"0 12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:500,lineHeight:1,borderRadius:"14px",border:"none",cursor:"pointer",whiteSpace:"nowrap",flexShrink:0,transition:"all 0.2s",backgroundColor:t===null?"#7B2FF7":"#f1f5f9",color:t===null?"#ffffff":"#475569"},onMouseEnter:r=>{t!==null&&(r.currentTarget.style.backgroundColor="#e2e8f0")},onMouseLeave:r=>{t!==null&&(r.currentTarget.style.backgroundColor="#f1f5f9")},"data-tour":"category-chips-item",children:"All"}),v.map(r=>e.jsx("button",{onClick:()=>o(r.id),style:{height:"28px",minHeight:"28px",padding:"0 12px",display:"inline-flex",alignItems:"center",justifyContent:"center",fontSize:"13px",fontWeight:500,lineHeight:1,borderRadius:"14px",border:"none",cursor:"pointer",whiteSpace:"nowrap",flexShrink:0,transition:"all 0.2s",backgroundColor:t===r.id?"#7B2FF7":"#f1f5f9",color:t===r.id?"#ffffff":"#475569"},onMouseEnter:i=>{t!==r.id&&(i.currentTarget.style.backgroundColor="#e2e8f0")},onMouseLeave:i=>{t!==r.id&&(i.currentTarget.style.backgroundColor="#f1f5f9")},"data-tour":"category-chips-item",children:r.label},r.id)),g.length>0&&e.jsxs("button",{onClick:()=>c(!0),style:{height:"28px",minHeight:"28px",padding:"0 12px",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"4px",fontSize:"13px",fontWeight:500,lineHeight:1,borderRadius:"14px",border:"none",cursor:"pointer",whiteSpace:"nowrap",flexShrink:0,transition:"all 0.2s",backgroundColor:"#f1f5f9",color:"#475569"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="#e2e8f0"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="#f1f5f9"},children:["More",e.jsx(We,{className:"w-3 h-3"})]})]})})}),g.length>0&&e.jsx(Ee,{open:m,onOpenChange:c,children:e.jsxs(Fe,{children:[e.jsx(Me,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[12000]"}),e.jsxs(_e,{className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl z-[12001] max-h-[calc(100vh-5rem-env(safe-area-inset-bottom))] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10",children:[e.jsx(Ae,{className:"text-lg font-semibold text-gray-900",children:"All Categories"}),e.jsx(Le,{className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(he,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"px-4 py-4 space-y-2",children:[e.jsx("button",{onClick:()=>{o(null),c(!1)},className:`w-full text-left px-4 py-3 rounded-xl transition-colors ${t===null?"bg-purple-600 text-white":"bg-gray-50 text-gray-900 hover:bg-gray-100"}`,children:"All"}),g.map(r=>e.jsx("button",{onClick:()=>{o(r.id),c(!1)},className:`w-full text-left px-4 py-3 rounded-xl transition-colors ${t===r.id?"bg-purple-600 text-white":"bg-gray-50 text-gray-900 hover:bg-gray-100"}`,children:r.label},r.id))]})]})]})})]})});fe.displayName="CategoryFilters";const ge=le.memo(function({stats:t,searchQuery:o,onSearchChange:u}){return e.jsx("div",{className:"px-4 pt-4 pb-4 bg-white","data-tour":"discover-header","data-tour-id":"discover-header",children:e.jsxs("div",{className:"relative","data-tour":"search-bar","data-tour-id":"search-bar",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ye,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search predictions...",value:o,onChange:f=>u(f.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:bg-white focus:ring-2 focus:ring-emerald-500 focus:outline-none transition-all"})]})})});ge.displayName="DiscoverHeaderContent";const js=le.memo(function({onNavigateToProfile:t,onNavigateToPrediction:o}){ue(),Qe();const{categories:u,isLoading:f}=cs(),{predictions:m,loading:c,loadingMore:v,pagination:g,filters:r,refreshPredictions:i,loadMorePredictions:d,setFilters:N}=xe(),[F,S]=l.useState(null),[M,I]=l.useState(!1),[H,z]=l.useState(null),[_,q]=l.useState({totalVolume:"0",activePredictions:0,totalUsers:"0",rawVolume:0,rawUsers:0}),D=l.useCallback(async()=>{try{const{getApiUrl:a}=await De(()=>import("./index-78beacc5.js").then(h=>h.aG),["assets/index-78beacc5.js","assets/ui-c369d1f3.js","assets/vendor-c36eaa8e.js","assets/wagmi-c444efa6.js","assets/utils-617af415.js","assets/index-6064ebef.css"]),k=await fetch(`${a()}/api/v2/predictions/stats/platform`);if(k.ok){const h=await k.json();h.success&&q(h.data)}}catch{}},[]);ys({hasNext:g.hasNext,loading:v,onLoadMore:()=>{d()},threshold:300}),l.useEffect(()=>{i(),D()},[i,D]);const B=l.useMemo(()=>({totalVolume:_.totalVolume,activePredictions:_.activePredictions,totalUsers:_.totalUsers}),[_]),P=l.useMemo(()=>{if(!Array.isArray(m))return[];const a=Date.now();return m.filter(h=>{if(!h||!h.id||!h.title)return!1;const p=(h.status??"open")==="open",C=h.entry_deadline?new Date(h.entry_deadline).getTime():Number.POSITIVE_INFINITY,w=Number.isFinite(C)&&C<=a;return p&&!w})},[m]);l.useCallback(a=>{S(a),I(!0)},[]);const A=l.useCallback(a=>{o?o(a):window.location.href=`/prediction/${a}`},[o]);l.useCallback(a=>{ee.success("Prediction liked!")},[]),l.useCallback(a=>{A(a)},[A]),l.useCallback(a=>{const k=`Check out this prediction: ${a.title}`,h=`${window.location.origin}/prediction/${a.id}`;navigator.share?navigator.share({title:a.title,text:k,url:h}).catch(console.error):navigator.clipboard.writeText(`${k}
${h}`).then(()=>ee.success("Link copied to clipboard!")).catch(()=>ee.error("Failed to copy link"))},[]);const R=l.useCallback(a=>{N({search:a})},[N]),U=l.useCallback(a=>{z(a),N(a?{category:a}:{category:"all"})},[N]),O=l.useCallback(()=>{I(!1),S(null)},[]);return c&&(!m||m.length===0)?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-100",children:[e.jsx("div",{className:"h-11"}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24 mb-2 loading-skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 loading-skeleton"})]}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full loading-skeleton"})]}),e.jsxs("div",{className:"bg-gray-200 rounded-2xl p-4 mb-4 loading-skeleton",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-20 mb-3 loading-skeleton"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-16 mx-auto loading-skeleton"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-12 mx-auto loading-skeleton"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-14 mx-auto loading-skeleton"})]})]})]}),e.jsx("div",{className:"h-12 bg-gray-200 rounded-xl loading-skeleton"})]})]}),e.jsx("div",{className:"px-4 py-3 bg-white border-b border-gray-100",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:[1,2,3,4,5,6].map(a=>e.jsx("div",{className:"h-8 bg-gray-200 rounded-full w-20 flex-shrink-0 loading-skeleton"},a))})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"px-4 mb-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mb-2 loading-skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 loading-skeleton"})]}),e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(a=>e.jsx(us,{},a))})]})]}):e.jsxs("div",{className:"discover-page content-with-bottom-nav",children:[e.jsx(ds,{title:"Discover",showNotifications:!0}),e.jsx(ge,{stats:B,searchQuery:r.search,onSearchChange:R}),e.jsx("div",{className:"category-filters-wrapper",style:{position:"relative",zIndex:45},children:e.jsx(fe,{selectedCategoryId:H,onSelect:U,categories:u,isLoading:f})}),e.jsx("div",{className:"prediction-cards-container",children:e.jsx("div",{className:"space-y-2",children:e.jsx(te,{mode:"wait",children:P.length>0?e.jsxs(e.Fragment,{children:[P.map((a,k)=>!a||!a.id?null:e.jsx(ms,{prediction:{id:a.id,title:a.title,category:a.category,endsAt:a.entry_deadline,pool:a.pool_total,players:a.participant_count,options:a.options?.slice(0,2).map(h=>({label:h.label,odds:h.current_odds})),description:a.description}},`${a.id}-${k}`)),v&&e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:[e.jsx(Ve,{className:"w-6 h-6 animate-spin text-purple-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading more predictions..."})]}),g.hasNext&&!v&&e.jsxs(E.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-6",children:[e.jsxs("button",{onClick:()=>{d()},className:"bg-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors",children:["Load More (",g.total-P.length," remaining)"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Page ",g.page," â€¢ ",P.length,"/",g.total]})]}),!g.hasNext&&!v&&P.length>10&&e.jsx(E.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"ðŸŽ‰ You've seen all predictions!"})})]}):e.jsxs(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center py-12 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(qe,{size:24,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No predictions found"}),e.jsx("p",{className:"text-gray-600",children:r.search?`No predictions match "${r.search}"`:c?"Loading predictions...":"Try adjusting your filters or check back later"}),!c&&!r.search&&e.jsx("button",{onClick:()=>i(!0),className:"mt-4 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:"Refresh Predictions"})]})})})}),e.jsx(bs,{prediction:F,isOpen:M,onClose:O})]})});js.displayName="DiscoverPage";export{js as default};
