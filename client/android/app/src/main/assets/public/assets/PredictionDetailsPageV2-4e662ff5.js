import{j as e,m as Y,A as Re,R as rt,P as it,O as nt,C as lt,T as ot,b as ct}from"./ui-c369d1f3.js";import{r as h}from"./vendor-c36eaa8e.js";import{c as Tt,f as zt,u as Mt,b as Ot}from"./utils-617af415.js";import{a4 as dt,a5 as Ut,a6 as de,a as qe,M as Ie,E as mt,$ as Bt,I as He,o as ve,H as Se,z as E,k as Ne,B as ut,a1 as xt,X as ke,K as M,_ as Rt,D as X,T as Ue,e as le,n as ne,A as Be,y as et,a7 as qt,P as Ht,a8 as Kt,N as ht,l as Ke,Q as H,j as Gt,u as Vt,a9 as Qt,b as Wt,d as Jt,R as we,g as Yt,U as Zt}from"./index-78beacc5.js";import{b as Q,u as Xt,a as It,B as es}from"./useFiatWallet-4b2d48ae.js";import{u as ts}from"./useUnifiedBalance-69bdcc40.js";import{D as ss}from"./DepositUSDCModal-4620608e.js";import{R as as}from"./runtime-1fefd008.js";import{M as yt}from"./message-circle-051707de.js";import{C as rs,u as is}from"./CreatorByline-9bede90f.js";import{S as ns,u as ls,a as os}from"./useActivityFeed-afbe2e9d.js";import{c as cs,b as I}from"./format-14414da9.js";import{M as ds,T as ms}from"./trash-2-b77d99dc.js";import{u as us}from"./useMerkleClaim-2ef83797.js";import{m as xs}from"./wagmi-c444efa6.js";import{S as hs}from"./share-2-f58723c5.js";import"./useEscrowBalance-5c6e362b.js";import"./useWalletConnectSession-1627a74c.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=dt("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=dt("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]),W=s=>({id:s.id,predictionId:s.prediction_id,user:{id:s.user?.id||s.user_id,username:s.user?.username||"Anonymous",full_name:s.user?.full_name,avatarUrl:s.user?.avatar_url,avatar_url:s.user?.avatar_url,is_verified:s.user?.is_verified||!1},text:s.content||s.text||"",content:s.content,createdAt:s.created_at||s.createdAt||new Date().toISOString(),created_at:s.created_at,updatedAt:s.updated_at||s.updatedAt||new Date().toISOString(),updated_at:s.updated_at,edited:s.is_edited||s.edited||!1,is_edited:s.is_edited,isDeleted:s.is_deleted||!1,likeCount:s.likes_count||s.likeCount||0,likes_count:s.likes_count,likedByMe:s.is_liked||s.likedByMe||!1,is_liked:s.is_liked});function tt(s){return!s||s.name==="TypeError"||s.message?.includes("Failed to fetch")?"network_error":s.status>=500?"server_error":s.status>=400&&s.status<500?"client_error":s.name==="SyntaxError"||s.message?.includes("JSON")?"parse_error":"network_error"}const pt=Tt()(Ut((s,c)=>({byPrediction:{},getComments:t=>c().byPrediction[t]?.items||[],getCommentCount:t=>c().byPrediction[t]?.items?.length||0,getStatus:t=>c().byPrediction[t]?.status||"idle",getDraft:t=>c().byPrediction[t]?.draft||"",isPosting:t=>c().byPrediction[t]?.posting||!1,hasMore:t=>c().byPrediction[t]?.nextCursor!==null,fetchComments:async t=>{if(!(!t?.trim()||c().byPrediction[t]?.status==="loading")){s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],status:"loading"}}}));try{let i;try{i=await Q.get(`/social/predictions/${t}/comments?page=1&limit=20`)}catch(n){de("Social endpoint failed, trying comments endpoint:",n),i=await Q.get(`/comments/predictions/${t}/comments?page=1&limit=20`)}let a=[],d=null;i.data&&Array.isArray(i.data)?(a=i.data.map(W),d=i.pagination?.hasNext?"next":null):i.comments&&Array.isArray(i.comments)?(a=i.comments.map(W),d=i.hasMore?"next":null):Array.isArray(i)&&(a=i.map(W)),de(`Fetched ${a.length} comments for ${t}`),s(n=>({byPrediction:{...n.byPrediction,[t]:{...n.byPrediction[t],items:a,nextCursor:d,status:"loaded"}}}))}catch(i){if(i.status===404){s(d=>({byPrediction:{...d.byPrediction,[t]:{...d.byPrediction[t],items:[],nextCursor:null,status:"loaded"}}}));return}const a=tt(i);s(d=>({byPrediction:{...d.byPrediction,[t]:{...d.byPrediction[t],items:d.byPrediction[t]?.items||[],status:a}}}))}}},loadMore:async t=>{if(!t?.trim())return;const r=c().byPrediction[t];if(!(!r?.nextCursor||r?.status==="paginating")){s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],status:"paginating"}}}));try{const i=Math.ceil((r.items?.length||0)/20)+1;let a;try{a=await Q.get(`/social/predictions/${t}/comments?page=${i}&limit=20`)}catch{a=await Q.get(`/comments/predictions/${t}/comments?page=${i}&limit=20`)}let d=[],n=null;a.data&&Array.isArray(a.data)?(d=a.data.map(W),n=a.pagination?.hasNext?"next":null):a.comments&&Array.isArray(a.comments)&&(d=a.comments.map(W),n=a.hasMore?"next":null),de(`Loaded ${d.length} more comments for ${t}`),s(l=>({byPrediction:{...l.byPrediction,[t]:{...l.byPrediction[t],items:[...l.byPrediction[t]?.items||[],...d],nextCursor:n,status:"loaded"}}}))}catch(i){const a=tt(i);s(d=>({byPrediction:{...d.byPrediction,[t]:{...d.byPrediction[t],status:a}}}))}}},addComment:async(t,r)=>{if(!t?.trim()||!r?.trim())throw new Error("Invalid input");const i=r.trim();if(i.length>280)throw new Error("Comment too long");s(l=>({byPrediction:{...l.byPrediction,[t]:{...l.byPrediction[t],posting:!0}}}));const{user:a}=qe.getState(),d=`temp_${Date.now()}`,n={id:d,predictionId:t,user:{id:a?.id||"demo-user",username:a?.username||"You",full_name:a?.full_name,avatarUrl:a?.avatar_url,is_verified:a?.is_verified||!1},text:i,content:i,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),edited:!1,isDeleted:!1,likeCount:0,likedByMe:!1};s(l=>{const x=l.byPrediction[t]?.items||[];return{byPrediction:{...l.byPrediction,[t]:{...l.byPrediction[t],items:[n,...x]}}}});try{let l;try{l=await Q.post(`/social/predictions/${t}/comments`,{content:i,userId:a?.id||"demo-user",user:a})}catch(y){de("Social endpoint failed, trying comments endpoint:",y),l=await Q.post(`/comments/predictions/${t}/comments`,{content:i,user:a})}let x;l.data||l.success&&l.data?x=W(l.data):x=W(l),de(`Comment added successfully for ${t}`),s(y=>({byPrediction:{...y.byPrediction,[t]:{...y.byPrediction[t],items:(y.byPrediction[t]?.items??[]).map(g=>g.id===d?x:g)||[x],posting:!1,draft:""}}}));try{sessionStorage.removeItem(`fcz_comment_draft_${t}`)}catch{}}catch(l){throw s(x=>({byPrediction:{...x.byPrediction,[t]:{...x.byPrediction[t],items:(x.byPrediction[t]?.items??[]).filter(y=>y.id!==d),posting:!1}}})),l}},editComment:async(t,r,i)=>{if(!t?.trim()||!r?.trim()||!i?.trim())throw new Error("Invalid input");const a=i.trim();if(a.length>280)throw new Error("Comment too long");const d=c().byPrediction[t]?.items?.find(n=>n.id===r);if(!d)throw new Error("Comment not found");s(n=>({byPrediction:{...n.byPrediction,[t]:{...n.byPrediction[t],items:(n.byPrediction[t]?.items??[]).map(l=>l.id===r?{...l,text:a,edited:!0,updatedAt:new Date().toISOString()}:l)||[]}}}));try{let n;try{n=await Q.put(`/social/comments/${r}`,{content:a})}catch{n=await Q.put(`/comments/${r}`,{content:a})}let l;n.data?l=W(n.data):l=W(n),s(x=>({byPrediction:{...x.byPrediction,[t]:{...x.byPrediction[t],items:(x.byPrediction[t]?.items??[]).map(y=>y.id===r?l:y)||[]}}}))}catch(n){throw s(l=>({byPrediction:{...l.byPrediction,[t]:{...l.byPrediction[t],items:(l.byPrediction[t]?.items??[]).map(x=>x.id===r?d:x)||[]}}})),n}},deleteComment:async(t,r)=>{if(!t?.trim()||!r?.trim())throw new Error("Invalid input");const i=c().byPrediction[t]?.items??[];if(!i.find(d=>d.id===r))throw new Error("Comment not found");s(d=>({byPrediction:{...d.byPrediction,[t]:{...d.byPrediction[t],items:(d.byPrediction[t]?.items??[]).filter(n=>n.id!==r)}}}));try{try{await Q.delete(`/social/comments/${r}`)}catch{await Q.delete(`/comments/${r}`)}de(`Comment ${r} deleted successfully`)}catch(d){throw s(n=>({byPrediction:{...n.byPrediction,[t]:{...n.byPrediction[t],items:i}}})),d}},setDraft:(t,r)=>{s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],draft:r}}}));try{r.trim()?sessionStorage.setItem(`fcz_comment_draft_${t}`,r):sessionStorage.removeItem(`fcz_comment_draft_${t}`)}catch{}},clearDraft:t=>{s(r=>({byPrediction:{...r.byPrediction,[t]:{...r.byPrediction[t],draft:""}}}));try{sessionStorage.removeItem(`fcz_comment_draft_${t}`)}catch{}},setHighlighted:(t,r)=>{s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],highlightedId:r}}})),r&&setTimeout(()=>{s(i=>({byPrediction:{...i.byPrediction,[t]:{...i.byPrediction[t],highlightedId:void 0}}}))},1500)}}),{name:"fcz-unified-comments",partialize:s=>({})})),gs=({activeTab:s,onTabChange:c,commentCount:t=0,activityCount:r=0,participantCount:i=0,children:a})=>{const n=[{id:"overview",label:"Overview",count:0,icon:mt},{id:"comments",label:"Comments",count:t,icon:yt},{id:"activity",label:"Activity",count:r||i||0,icon:Bt}];return e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:n.map((l,x)=>{const y=l.icon;return e.jsxs("button",{onClick:()=>c(l.id),className:Ie("px-3 py-1 rounded-lg text-sm font-medium transition-colors",s===l.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:l.label}),e.jsx("span",{className:"sm:hidden",children:l.id==="overview"?"Overview":l.id==="comments"?"Comments":"Activity"})]}),l.count>0&&e.jsx("span",{className:Ie("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold",s===l.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:l.count>99?"99+":l.count})]},l.id)})})})}),e.jsx("div",{children:a})]})},ps=gs,fs=({onSubmit:s,isPosting:c,placeholder:t="Share your thoughts..."})=>{const[r,i]=h.useState(""),{user:a}=He(),d=async n=>{if(n.preventDefault(),!(!r.trim()||c)){if(!a){ve({intent:"comment_prediction"});return}try{await s(r.trim()),i("")}catch{}}};return a?e.jsxs("form",{onSubmit:d,className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:r,onChange:n=>i(n.target.value),placeholder:t,disabled:c,rows:3,className:"w-full p-3 border rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",maxLength:1e3}),e.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-500",children:[r.length,"/1000"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Commenting as ",a.user_metadata?.username||a.email]}),e.jsxs("button",{type:"submit",disabled:!r.trim()||c,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx(ns,{className:"w-4 h-4"}),c?"Posting...":"Post"]})]})]}):e.jsx("div",{className:"p-4 border rounded-lg bg-gray-50",children:e.jsx("button",{onClick:()=>ve({intent:"comment_prediction"}),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Sign in to comment"})})},bs=({comment:s,onToggleLike:c})=>{const t=()=>{c&&c(s.id)},r=s.likes_count||s.likeCount||0,i=s.is_liked||s.likedByMe||!1,a=s.created_at||s.createdAt,d=s.content||s.text,n=s.user?.username||"Anonymous",l=s.user?.avatar_url||s.user?.avatarUrl;return e.jsx("div",{className:"border-b border-gray-100 pb-4 last:border-b-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:l?e.jsx("img",{src:l,alt:n,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-600",children:n.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:n}),s.user?.is_verified&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(Se,{className:"w-3 h-3"}),zt(new Date(a),{addSuffix:!0})]})]}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed mb-2",children:d}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:t,className:`flex items-center gap-1 text-xs transition-colors ${i?"text-red-600 hover:text-red-700":"text-gray-500 hover:text-red-600"}`,children:[e.jsx(gt,{className:`w-4 h-4 ${i?"fill-current":""}`}),r>0&&e.jsx("span",{children:r})]})})]})]})})},js=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:s}).map((c,t)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]})]})},t))}),ws=({comments:s,isLoading:c,hasMore:t,onLoadMore:r,onToggleLike:i})=>c&&s.length===0?e.jsx(js,{count:3}):s.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-lg mb-2",children:"No comments yet"}),e.jsx("div",{className:"text-sm",children:"Be the first to share your thoughts!"})]}):e.jsxs("div",{className:"space-y-4",children:[s.map(a=>e.jsx(bs,{comment:a,onToggleLike:i},a.id)),t&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:r,disabled:c,className:"px-6 py-2 text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Loading...":"Load more comments"})})]}),vs=({predictionId:s,className:c=""})=>{const{getComments:t,getCommentCount:r,getStatus:i,isPosting:a,hasMore:d,fetchComments:n,loadMore:l,addComment:x}=pt(),y=t(s),g=i(s),O=a(s),F=d(s);h.useEffect(()=>{g==="idle"&&n(s).catch(b=>{b?.status>=500&&E.error("Failed to load comments. Please try again.")})},[s,g,n]);const _=async b=>{try{await x(s,b)}catch(D){const ee=D?.message||"Failed to post comment";throw E.error(ee),D}},U=async b=>{try{E.success("Like feature coming soon!")}catch(D){D?.status>=500&&E.error("Failed to update like. Please try again.")}},k=async()=>{try{await l(s)}catch(b){b?.status>=500&&E.error("Failed to load more comments. Please try again.")}},w=g==="loading"||g==="paginating",L=r(s);return e.jsxs("div",{className:`bg-white rounded-lg ${c}`,children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-gray-100",children:[e.jsx(ds,{className:"w-5 h-5 text-gray-600"}),e.jsxs("h3",{className:"font-medium text-gray-900",children:["Comments ",L>0&&`(${L})`]})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(fs,{onSubmit:_,isPosting:O}),e.jsx(ws,{comments:y,isLoading:w,hasMore:F,onLoadMore:k,onToggleLike:U})]})]})},Ns=({message:s="Loading...",size:c="md",className:t="",fullScreen:r=!1})=>{const a=(()=>{switch(c){case"sm":return{spinner:"h-4 w-4",text:"text-sm",container:"py-4"};case"lg":return{spinner:"h-8 w-8",text:"text-lg",container:"py-8"};case"md":default:return{spinner:"h-6 w-6",text:"text-base",container:"py-6"}}})(),d=e.jsxs("div",{className:`flex flex-col items-center justify-center ${a.container} ${t}`,children:[e.jsx(Y.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:`${a.spinner} text-emerald-500`,children:e.jsx(Ne,{className:"h-full w-full"})}),s&&e.jsx("p",{className:`mt-3 text-gray-600 ${a.text}`,children:s})]});return r?e.jsx("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50",children:d}):d},Ss=Ns,ks=({error:s,onRetry:c,onDismiss:t,type:r="error",showRetry:i=!0,showDismiss:a=!1,className:d=""})=>{const l=(()=>{switch(r){case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:"text-yellow-600"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"};case"error":default:return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"}}})();return e.jsx(Re,{children:e.jsx(Y.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:`rounded-lg border p-4 ${l.bg} ${l.border} ${d}`,role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(ut,{className:`h-5 w-5 ${l.icon}`})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsx("p",{className:`text-sm font-medium ${l.text}`,children:s})}),e.jsxs("div",{className:"ml-3 flex space-x-2",children:[i&&c&&e.jsxs("button",{onClick:c,className:`inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors ${l.text} hover:bg-white/50`,"aria-label":"Retry",children:[e.jsx(xt,{className:"h-3 w-3"}),"Retry"]}),a&&t&&e.jsx("button",{onClick:t,className:`inline-flex items-center rounded-md p-1 transition-colors ${l.text} hover:bg-white/50`,"aria-label":"Dismiss",children:e.jsx(ke,{className:"h-4 w-4"})})]})]})})})},Cs=ks,Ps=({icon:s,title:c,description:t,action:r,className:i=""})=>e.jsxs(Y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex flex-col items-center justify-center py-12 px-6 text-center ${i}`,children:[s&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(s,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:c}),t&&e.jsx("p",{className:"text-gray-600 mb-6 max-w-sm",children:t}),r&&e.jsx(Y.button,{className:"bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",onClick:r.onClick,whileHover:{scale:1.02},whileTap:{scale:.98},children:r.label})]}),$s=Ps;function _s({item:s}){const t=(i=>{const{type:a,actor:d,data:n}=i,l=d?.full_name||d?.username||"Anonymous";switch(a){case"comment":return{message:`${l} commented`,details:n.content?n.content.substring(0,100)+(n.content.length>100?"...":""):"",icon:yt};case"entry.create":return{message:`${l} locked a ${M("bet")}`,details:`${I(n.amount,{compact:!0})}${n.option_label?` on ${n.option_label}`:""}`,icon:X};case"reaction.like":return{message:`${l} liked this prediction`,details:"",icon:gt};case"prediction.open":return{message:`Prediction is now open for ${M("betting")}`,details:"",icon:Ue};case"prediction.settled":return{message:"Prediction has been settled",details:n.settled_outcome_id?"Outcome determined":"",icon:Ue};case"wallet.unlock":return{message:"Escrow funds released",details:n.amount?I(n.amount,{compact:!0}):"",icon:X};case"wallet.payout":return{message:"Settlement payout received",details:n.amount?`${I(n.amount,{compact:!0})}${n.prediction_title?` · ${n.prediction_title}`:""}`:n.prediction_title??"",icon:X};case"wallet.platform_fee":return{message:"Platform fee credited",details:n.amount?I(n.amount,{compact:!0}):"",icon:X};case"wallet.creator_fee":return{message:"Creator earnings received",details:n.amount?`${I(n.amount,{compact:!0})}${n.prediction_title?` · ${n.prediction_title}`:""}`:n.prediction_title??"",icon:X};default:return{message:"Activity occurred",details:"",icon:Se}}})(s),r=t.icon;return e.jsxs(Y.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[e.jsx("div",{className:"flex-shrink-0",children:s.actor?.avatar_url?e.jsx("img",{src:s.actor.avatar_url,alt:s.actor.full_name||s.actor.username||"User",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx(Rt,{className:"w-4 h-4 text-gray-500"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:t.message})]}),t.details&&e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:t.details}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-gray-500",children:cs(s.timestamp)}),s.actor?.is_verified&&e.jsx("span",{className:"text-xs text-emerald-600 font-medium",children:"✓ Verified"})]})]})]})}function As({predictionId:s,className:c=""}){const{items:t,loading:r,error:i,hasMore:a,loadMore:d,refresh:n}=ls({predictionId:s,limit:25,autoLoad:!0});return i?e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border ${c}`,children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-red-500 mb-2",children:"⚠️"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Failed to load activity feed"}),e.jsx("button",{onClick:n,className:"text-sm text-emerald-600 hover:text-emerald-700 font-medium",children:"Try again"})]})}):r&&t.length===0?e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border ${c}`,children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Ne,{className:"w-6 h-6 animate-spin mx-auto mb-2 text-gray-400"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading activity..."})]})}):t.length===0?e.jsx("div",{className:`bg-white rounded-2xl p-4 shadow-sm border ${c}`,children:e.jsxs("div",{className:"text-center py-6",children:[e.jsx(Se,{className:"w-8 h-8 mx-auto mb-2 text-gray-300"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No activity yet"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Be the first to comment or lock a ",M("bet"),"!"]})]})}):e.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border ${c}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-100",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Recent Activity"}),e.jsx("button",{onClick:n,disabled:r,className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",title:"Refresh",children:e.jsx(xt,{className:`w-4 h-4 ${r?"animate-spin":""}`})})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:t.map(l=>e.jsx(_s,{item:l},l.id))}),a&&e.jsx("div",{className:"p-4 border-t border-gray-100",children:e.jsx("button",{onClick:d,disabled:r,className:"w-full py-2 text-sm text-emerald-600 hover:text-emerald-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:r?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-4 h-4 animate-spin"}),"Loading more..."]}):"Load more activity"})})]})}function Es({onSignIn:s,title:c=`Sign in to ${M("betVerb").toLowerCase()}`,description:t=`Create an account or sign in to ${M("bet")}.`}){return e.jsxs("div",{className:"rounded-2xl border shadow-sm bg-white p-4 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-start gap-3 flex-1 min-w-0",children:[e.jsx("div",{className:"shrink-0 rounded-xl bg-emerald-50 p-2",children:e.jsx(ys,{className:"h-5 w-5 text-emerald-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:c}),e.jsx("p",{className:"text-sm text-gray-600 mt-0.5",children:t})]})]}),e.jsx("button",{onClick:s,className:"shrink-0 rounded-xl h-10 px-4 bg-emerald-600 text-white font-medium shadow hover:bg-emerald-700 active:bg-emerald-800 transition-colors",children:"Sign In"})]})}function Fs({title:s,creator:c,className:t=""}){return e.jsxs("header",{className:`space-y-2 ${t}`,children:[e.jsx("h1",{className:"text-2xl font-bold leading-snug text-gray-900",children:s}),e.jsx(rs,{creator:c})]})}function Ds({options:s,selectedId:c,onSelect:t,disabled:r=!1,winningOptionId:i,showWinningIndicator:a=!1}){return e.jsx("section",{className:"rounded-2xl bg-white border shadow-sm overflow-hidden",children:e.jsx("ul",{className:"divide-y divide-gray-100",children:s.map(d=>{const n=d.current_odds??d.odds??1,l=c===d.id,x=d.percentage??0,y=a&&i&&d.id===i;return e.jsx("li",{children:e.jsxs("button",{onClick:()=>!r&&t(d.id),disabled:r,className:`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${l?"bg-emerald-50 border-l-2 border-l-emerald-600":y?"bg-emerald-50/40 hover:bg-emerald-50/60":"hover:bg-gray-50"} disabled:opacity-50 disabled:cursor-not-allowed`,children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d.label}),y&&e.jsx("span",{className:"inline-flex items-center rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] font-semibold text-emerald-800",children:"Winner"})]}),x>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-1 text-xs text-gray-500",children:[e.jsx(Ue,{className:"h-3 w-3"}),e.jsxs("span",{children:[x.toFixed(0),"% of pool"]})]})]}),e.jsxs("span",{className:"text-emerald-600 font-semibold ml-3",children:[n.toFixed(2),"x"]})]})},d.id)})})})}function Ls({canBet:s,onPlace:c,loading:t=!1,label:r=M("betVerb")}){return e.jsx("div",{className:"fixed inset-x-0 z-50 px-4 pb-[calc(env(safe-area-inset-bottom))] pointer-events-none",style:{bottom:"calc(var(--bottom-nav-h, 64px) + 16px)"},children:e.jsx("div",{className:"pointer-events-auto mx-auto max-w-screen-sm",children:e.jsxs("button",{disabled:!s||t,onClick:c,className:"w-full h-12 rounded-2xl bg-emerald-600 text-white font-semibold shadow-lg hover:bg-emerald-700 active:bg-emerald-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2",children:[t&&e.jsx(Ne,{className:"h-5 w-5 animate-spin"}),e.jsx("span",{children:t?`${M("betVerb")}…`:r})]})})})}const Ts=({isOpen:s,onClose:c,predictionId:t,predictionTitle:r,onValidated:i})=>{const[a,d]=h.useState(null),[n,l]=h.useState(!0),[x,y]=h.useState(!1),[g,O]=h.useState(""),[F,_]=h.useState(!1),[U,k]=h.useState(null),[w,L]=h.useState(null),[b,D]=h.useState(!1),[ee,B]=h.useState(null),[K,te]=h.useState(null),[se,p]=h.useState(!1),[N,S]=h.useState(!1),{user:T}=qe(),{user:Z}=He(),A=Z?.id||T?.id,ae=async(m,f)=>{if((m.headers.get("content-type")||"").includes("application/json")){const R=await m.json().catch(()=>null);return R&&typeof R=="object"&&R.message&&String(R.message)||R&&typeof R=="object"&&R.error&&String(R.error)||null||f}const me=await m.text().catch(()=>"");return me.trim().startsWith("{")&&me.trim().endsWith("}")?f:me||f};h.useEffect(()=>{s&&A&&(G(),re(),V())},[s,A,t]);const G=async()=>{try{l(!0),k(null);const m=await fetch(`${le()}/api/v2/settlement/${t}/status?userId=${A}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(m.status===403){d(null),k("You are not a participant in this prediction, so you cannot validate this settlement.");return}if(!m.ok){const v=await ae(m,"Failed to load settlement status.");throw new Error(v)}const f=await m.json();d(f.data)}catch(m){const f=m instanceof Error?m.message:"Failed to load settlement information";d(null),k(f),ne.error(f)}finally{l(!1)}},re=async()=>{try{D(!0),B(null);const m=await fetch(`${le()}/api/v2/settlement/${t}/history?userId=${A}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(m.status===403){L(null),B("Only participants can view settlement history.");return}if(!m.ok){const v=await ae(m,"We couldn’t load settlement history right now. Please try again.");throw new Error(v)}const f=await m.json();L(f.data||null)}catch(m){const f=m instanceof Error?m.message:"We couldn’t load settlement history right now. Please try again.";L(null),B(f)}finally{D(!1)}},V=async()=>{if(A)try{p(!0);const m=await fetch(`${le()}/api/v2/settlement/${t}/finalize/status?userId=${A}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!m.ok){const v=await m.text().catch(()=>"");throw new Error(v||"Failed to load finalization status")}const f=await m.json();te(f.data)}catch{te(null)}finally{p(!1)}},oe=async()=>{if(A)try{S(!0);const m=await fetch(`${le()}/api/v2/settlement/${t}/request-finalize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:A})});if(!m.ok){const f=await m.text().catch(()=>"");throw new Error(f||"Failed to request finalization")}ne.success("Submitted. Admin will finalize on-chain."),await V()}catch(m){ne.error(m?.message||"Failed to submit for finalization")}finally{S(!1)}},ce=async()=>{if(A)try{S(!0);let m=localStorage.getItem("fcz_admin_key")||"";if(!m){const f=window.prompt("Enter admin key");if(!f){S(!1);return}m=f.trim(),localStorage.setItem("fcz_admin_key",m)}await qt(`/api/v2/admin/settlement/${t}/finalize`,A,{adminKey:m}),ne.success("Finalized on-chain."),await Promise.all([V(),G()]),i?.()}catch(m){ne.error(m?.message||"Finalization failed, admin retry required."),await V()}finally{S(!1)}},xe=async m=>{try{y(!0);const f=await fetch(`${le()}/api/v2/settlement/${t}/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:A,action:m,reason:m==="dispute"?g:void 0})});if(!f.ok){const v=await f.text().catch(()=>"");throw new Error(v||`Failed to ${m} settlement`)}ne.success(m==="accept"?"Settlement accepted successfully!":"Dispute submitted successfully!"),await Promise.all([G(),re()]),i?.(),c()}catch(f){const v=f instanceof Error?f.message:`Failed to ${m} settlement`;ne.error(v)}finally{y(!1)}};return s?e.jsx(Re,{children:e.jsxs("div",{className:"fixed inset-0 z-[9000]","aria-modal":"true",role:"dialog",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:c,"aria-hidden":"true"}),e.jsxs(Y.div,{initial:{opacity:0,scale:.98,y:8},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.98,y:8},transition:{duration:.15},onClick:m=>m.stopPropagation(),className:["fixed left-4 right-4 top-4","bottom-[calc(4rem+env(safe-area-inset-bottom)+1rem)]","md:left-1/2 md:right-auto md:top-1/2 md:bottom-auto md:w-full md:max-w-md md:-translate-x-1/2 md:-translate-y-1/2","bg-white rounded-2xl border border-black/[0.06] shadow-2xl overflow-hidden"].join(" "),children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-black/[0.06] px-4 py-3 flex items-center justify-between",children:[e.jsx("h2",{className:"text-base font-semibold text-gray-900 truncate",children:"Settlement review"}),e.jsx("button",{type:"button",onClick:c,className:"p-2 -mr-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Close",children:e.jsx(ke,{className:"w-5 h-5 text-gray-600"})})]}),e.jsx("div",{className:"px-4 py-4 overflow-y-auto h-full pb-[calc(1rem+env(safe-area-inset-bottom))]",children:n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"})}):U&&!a?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsx("p",{className:"text-sm text-yellow-900",children:U})}),e.jsx("button",{onClick:c,className:"w-full px-4 py-2.5 rounded-xl border border-black/[0.06] bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors",children:"Close"})]}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2",children:r}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(X,{className:"w-4 h-4"}),e.jsxs("span",{children:["Pool: $",a.prediction.pool_total.toLocaleString()]})]}),e.jsx("div",{className:"flex items-center gap-1",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.prediction.status==="settled"?"bg-emerald-100 text-emerald-800":a.prediction.status==="disputed"?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:a.prediction.status})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Your Entry"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount Staked:"}),e.jsxs("span",{className:"font-medium",children:["$",a.userEntry.amount.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:`font-medium ${a.userEntry.status==="won"?"text-emerald-600":a.userEntry.status==="lost"?"text-red-600":a.userEntry.status==="refunded"?"text-blue-600":"text-yellow-600"}`,children:a.userEntry.status})]}),a.userEntry.actual_payout>0&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Payout:"}),e.jsxs("span",{className:"font-medium text-emerald-600",children:["$",a.userEntry.actual_payout.toLocaleString()]})]})]})]}),a.settlement?e.jsxs("div",{className:"bg-emerald-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Settlement Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Payout:"}),e.jsxs("span",{className:"font-medium",children:["$",a.settlement.total_payout.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Settled At:"}),e.jsx("span",{className:"font-medium",children:new Date(a.settlement.settlement_time).toLocaleDateString()})]})]})]}):a.needsSettlement?e.jsxs("div",{className:"bg-yellow-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Se,{className:"w-4 h-4 text-yellow-600"}),e.jsx("h4",{className:"font-medium text-yellow-900",children:"Awaiting Settlement"})]}),e.jsx("p",{className:"text-sm text-yellow-800",children:"This prediction is waiting for the creator to provide settlement details."})]}):null,e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-100",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Finalization Status"}),se?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading finalization status…"}):e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Status:"}),e.jsx("span",{className:"font-medium text-gray-900",children:K?.status??"—"})]}),!!K?.txHash&&e.jsxs("div",{className:"flex justify-between gap-3",children:[e.jsx("span",{className:"text-gray-600",children:"Tx Hash:"}),e.jsx("span",{className:"font-medium text-gray-900 truncate",children:K.txHash})]}),K?.status==="failed"&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-yellow-900",children:"Finalization failed, admin retry required."})}),e.jsx("div",{className:"text-xs text-gray-600",children:a.userEntry.provider==="demo-wallet"?"Demo payouts are credited instantly after settlement is finalized.":"Crypto payouts are claimed on-chain after finalization. Connect wallet to claim."})]}),e.jsxs("div",{className:"mt-3 flex flex-col gap-2",children:[a.prediction.creator_id&&a.prediction.creator_id===A&&e.jsx("button",{onClick:oe,disabled:N,className:"w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:"Submit Settlement for Finalization"}),e.jsx("button",{onClick:ce,disabled:N,className:"w-full px-4 py-2 border border-gray-300 text-gray-800 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Finalize On-Chain"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-100",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Status History"}),b?e.jsx("div",{className:"text-sm text-gray-600",children:"Loading history…"}):ee?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:"We couldn’t load settlement history right now."}),e.jsx("button",{type:"button",onClick:re,className:"w-full px-4 py-2.5 rounded-xl border border-black/[0.06] bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors",children:"Retry"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1 text-xs text-gray-600 mb-3",children:[e.jsxs("span",{children:["Accepts: ",e.jsx("span",{className:"font-semibold text-gray-900",children:w?.summary?.accepts??0})]}),e.jsxs("span",{children:["Disputes: ",e.jsx("span",{className:"font-semibold text-gray-900",children:w?.summary?.disputes??0})," (Pending: ",e.jsx("span",{className:"font-semibold text-gray-900",children:w?.summary?.pendingDisputes??0}),")"]}),e.jsxs("span",{children:["Last action: ",e.jsx("span",{className:"font-semibold text-gray-900",children:w?.summary?.lastActionAt?new Date(w.summary.lastActionAt).toLocaleString():"—"})]})]}),Array.isArray(w?.items)&&w.items.length>0?e.jsx("div",{className:"space-y-2",children:w.items.map(m=>{const f=m.action==="dispute",v=m?.user?.full_name||m?.user?.username||(typeof m.user_id=="string"&&m.user_id.length>10?`${m.user_id.slice(0,6)}…${m.user_id.slice(-4)}`:m.user_id);return e.jsx("div",{className:"rounded-lg border border-gray-100 p-3",children:e.jsx("div",{className:"flex items-start justify-between gap-2",children:e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold ${f?"bg-yellow-100 text-yellow-800":"bg-emerald-100 text-emerald-800"}`,children:[f?e.jsx(Be,{className:"w-3 h-3"}):e.jsx(et,{className:"w-3 h-3"}),f?"Disputed":"Accepted"]}),m.status&&e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${m.status==="pending"?"bg-gray-100 text-gray-800":"bg-emerald-50 text-emerald-800"}`,children:m.status})]}),e.jsx("div",{className:"text-sm text-gray-900 font-medium truncate mt-1",children:v||"Unknown user"}),e.jsx("div",{className:"text-xs text-gray-500",children:m.created_at?new Date(m.created_at).toLocaleString():""}),f&&m.reason&&e.jsx("p",{className:"text-xs text-gray-700 mt-2",style:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:m.reason})]})})},m.id)})}):e.jsx("div",{className:"text-sm text-gray-600",children:"No actions yet."})]})]}),a.canValidate&&a.settlement&&!F&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Validate Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Do you agree with this settlement outcome?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>xe("accept"),disabled:x,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[e.jsx(et,{className:"w-4 h-4"}),"Accept"]}),e.jsxs("button",{onClick:()=>_(!0),disabled:x,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(Be,{className:"w-4 h-4"}),"Dispute"]})]})]}),F&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Dispute Settlement"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Reason for Dispute"}),e.jsx("textarea",{value:g,onChange:m=>O(m.target.value),placeholder:"Please explain why you disagree with this settlement...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",rows:4})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>_(!1),className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:()=>xe("dispute"),disabled:x||!g.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:"Submit Dispute"})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600",children:"Failed to load settlement information"})})})]})]})}):null},zs=Ts;function Ms({open:s,onOpenChange:c,prediction:t,onSaved:r,userId:i}){const[a,d]=h.useState(t.title||""),[n,l]=h.useState(t.description||""),[x,y]=h.useState((t.options||[]).map(p=>({id:p.id,label:p.label}))),[g,O]=h.useState(t.entry_deadline?new Date(t.entry_deadline).toISOString().slice(0,16):""),[F,_]=h.useState(t.category||"custom"),[U,k]=h.useState(!1),[w,L]=h.useState({}),b=t.hasEntries??(t.entriesCount??0)>0,D=t.entry_deadline?new Date(t.entry_deadline):null;h.useEffect(()=>{t&&(d(t.title||""),l(t.description||""),y((t.options||[]).map(p=>({id:p.id,label:p.label}))),O(t.entry_deadline?new Date(t.entry_deadline).toISOString().slice(0,16):""),_(t.category||"custom"),L({}))},[t,s]);const ee=()=>{const p={};if(!b)if(a.trim()||(p.title="Title is required"),x.length<2)p.options="Must have at least 2 options";else{const N=x.map(T=>T.label.toLowerCase().trim()).filter(Boolean),S=new Set(N);N.length!==S.size&&(p.options="Option labels must be unique")}if(g){const N=new Date(g);isNaN(N.getTime())?p.closesAt="Invalid date":b&&D&&N.getTime()<=D.getTime()&&(p.closesAt="Can only extend close time forward when entries exist")}return L(p),Object.keys(p).length===0},B=()=>{b||y([...x,{label:""}])},K=p=>{b||x.length<=2||y(x.filter((N,S)=>S!==p))},te=(p,N)=>{if(b)return;const S=[...x];S[p]={...S[p],label:N},y(S)},se=async()=>{if(!ee()){E.error("Please fix the errors before saving");return}k(!0);try{const p=i||window.__FCZ_USER_ID||localStorage.getItem("userId")||window.__FCZ_CURRENT_USER?.id;if(!p){E.error("Please sign in to edit predictions"),k(!1);return}const{data:N}=await ht.auth.getSession().catch(()=>({data:null})),S=N?.session?.access_token||null,T={};if(!b&&a!==t.title&&(T.title=a.trim()),n!==(t.description||"")&&(T.description=n.trim()||null),g&&(T.closesAt=new Date(g).toISOString()),!b&&F!==t.category&&(T.categoryId=F),!b&&x.length>0&&(x.length!==(t.options||[]).length||x.some((G,re)=>{const V=t.options?.[re];return!V||G.label!==V.label}))&&(T.options=x.filter(G=>G.label.trim())),Object.keys(T).length===0){E.success("No changes to save"),k(!1);return}const Z=await fetch(`${Ke()}/api/v2/predictions/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json",...S?{Authorization:`Bearer ${S}`}:{}},credentials:"include",body:JSON.stringify({...T,userId:p})});if(!Z.ok){const ae=await Z.json().catch(()=>({message:Z.statusText}));throw new Error(ae.message||"Failed to update prediction")}const A=await Z.json();E.success("Prediction updated successfully"),r(A.data),c(!1)}catch(p){E.error(p.message||"Failed to update prediction")}finally{k(!1)}};return e.jsx(rt,{open:s,onOpenChange:c,children:e.jsxs(it,{children:[e.jsx(nt,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[12000]"}),e.jsxs(lt,{className:"fixed left-0 right-0 bottom-[calc(4rem+env(safe-area-inset-bottom))] bg-white rounded-t-2xl shadow-2xl z-[12001] max-h-[calc(100vh-4rem-env(safe-area-inset-bottom))] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10",children:[e.jsx(ot,{className:"text-lg font-semibold text-gray-900",children:"Edit prediction"}),e.jsx(ct,{className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(ke,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"px-4 py-6 pb-[calc(1.5rem+env(safe-area-inset-bottom))] space-y-6",children:[b&&e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(ut,{className:"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-amber-900",children:"Editing limits"}),e.jsx("p",{className:"text-xs text-amber-700 mt-1",children:"This prediction already has participants. You can only extend the close time."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",!b&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a,onChange:p=>d(p.target.value),disabled:b,className:`w-full px-3 py-2 border rounded-lg ${b?"bg-gray-50 text-gray-500 cursor-not-allowed":w.title?"border-red-300":"border-gray-300"}`,placeholder:"Enter prediction title"}),w.title&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:w.title}),b&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Cannot change title after participants have staked"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:n,onChange:p=>l(p.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none",placeholder:"Optional description"})]}),!b&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Options ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"space-y-2",children:[x.map((p,N)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p.label,onChange:S=>te(N,S.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg",placeholder:`Option ${N+1}`}),x.length>2&&e.jsx("button",{type:"button",onClick:()=>K(N),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg",children:e.jsx(ms,{className:"w-4 h-4"})})]},N)),e.jsxs("button",{type:"button",onClick:B,className:"flex items-center gap-2 text-sm text-emerald-600 hover:text-emerald-700 font-medium",children:[e.jsx(Ht,{className:"w-4 h-4"}),"Add option"]})]}),w.options&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:w.options})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2",children:[e.jsx(Kt,{className:"w-4 h-4"}),"Close time ",!b&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"datetime-local",value:g,onChange:p=>O(p.target.value),min:D?D.toISOString().slice(0,16):void 0,className:`w-full px-3 py-2 border rounded-lg ${w.closesAt?"border-red-300":"border-gray-300"}`}),w.closesAt&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:w.closesAt}),b&&D&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Current: ",D.toLocaleString(),". Can only extend forward."]})]}),!b&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:F,onChange:p=>_(p.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[e.jsx("option",{value:"sports",children:"Sports"}),e.jsx("option",{value:"pop_culture",children:"Pop Culture"}),e.jsx("option",{value:"custom",children:"Custom"}),e.jsx("option",{value:"esports",children:"Esports"}),e.jsx("option",{value:"celebrity_gossip",children:"Celebrity Gossip"}),e.jsx("option",{value:"politics",children:"Politics"})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>c(!1),disabled:U,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50",children:"Cancel"}),e.jsx("button",{type:"button",onClick:se,disabled:U,className:"flex-1 px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Saving..."]}):"Save changes"})]})]})]})]})})}function Os({open:s,onOpenChange:c,prediction:t,onCancelled:r,userId:i}){const[a,d]=h.useState(""),[n,l]=h.useState(!1),x=async()=>{if(!a.trim()||a.trim().length<5){E.error("Please provide a reason (at least 5 characters)");return}l(!0);try{const y=i||window.__FCZ_USER_ID||localStorage.getItem("userId")||window.__FCZ_CURRENT_USER?.id;if(!y){E.error("Please sign in to cancel predictions"),l(!1);return}const{data:g}=await ht.auth.getSession().catch(()=>({data:null})),O=g?.session?.access_token||null,F=await fetch(`${Ke()}/api/v2/predictions/${t.id}/cancel`,{method:"POST",headers:{"Content-Type":"application/json",...O?{Authorization:`Bearer ${O}`}:{}},credentials:"include",body:JSON.stringify({reason:a.trim(),userId:y})});if(!F.ok){const _=await F.json().catch(()=>({message:F.statusText}));throw new Error(_.message||"Failed to cancel prediction")}await F.json().catch(()=>null),E.success("Prediction cancelled. Refunds initiated."),r({...t,status:"cancelled"}),c(!1),d("")}catch(y){E.error(y.message||"Failed to cancel prediction")}finally{l(!1)}};return e.jsx(rt,{open:s,onOpenChange:c,children:e.jsxs(it,{children:[e.jsx(nt,{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[12000]"}),e.jsxs(lt,{className:"fixed left-0 right-0 bottom-[calc(4rem+env(safe-area-inset-bottom))] bg-white rounded-t-2xl shadow-2xl z-[12001] max-h-[calc(100vh-4rem-env(safe-area-inset-bottom))] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10",children:[e.jsx(ot,{className:"text-lg font-semibold text-gray-900",children:"Cancel prediction?"}),e.jsx(ct,{className:"p-2 rounded-lg hover:bg-gray-100",children:e.jsx(ke,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"px-4 py-6 pb-[calc(1.5rem+env(safe-area-inset-bottom))] space-y-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(Be,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-red-900",children:"This action cannot be undone"}),e.jsx("p",{className:"text-xs text-red-700 mt-1",children:"All participants will receive refunds. The prediction will be marked as cancelled."})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Reason ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:a,onChange:y=>d(y.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none",placeholder:"Explain why you're cancelling this prediction (minimum 5 characters)",minLength:5}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a.length,"/5 minimum characters"]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:()=>{c(!1),d("")},disabled:n,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50",children:"Keep prediction"}),e.jsx("button",{type:"button",onClick:x,disabled:n||a.trim().length<5,className:"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Cancelling..."]}):"Cancel prediction"})]})]})]})]})})}function Us(s,c){return Mt({queryKey:[...H.prediction(s||"unknown"),"merkle-proof",(c||"").toLowerCase()],enabled:!!(s&&c),queryFn:async()=>{const t=new URLSearchParams({address:String(c)}),r=await fetch(`${Ke()}/api/v2/settlement/${s}/merkle-proof?${t.toString()}`,{headers:{Accept:"application/json"},credentials:"include"});if(!r.ok){const a=await r.json().catch(()=>({}));throw new Error(a?.message||"Failed to fetch merkle proof")}return(await r.json()).data},staleTime:1e4,refetchInterval:3e4})}const st={announce:s=>{}},at=s=>E.success(s),J=s=>E.error(s),la=({predictionId:s})=>{const c=Gt(),t=Vt(),r=Qt(),i=t.state??null;h.useRef(i);const a=h.useRef(i?.from??null),{user:d}=He(),{isAuthenticated:n,user:l}=qe(),x=!!d||n,y=d||l,g=s||r.id||r.predictionId||"",O=pt(u=>u.getCommentCount),F=g?O(g):0,[_,U]=h.useState(null),[k,w]=h.useState(""),[L,b]=h.useState(!1),ee=new URLSearchParams(t.search).get("tab")||"overview",[B,K]=h.useState(ee);h.useEffect(()=>{const j=new URLSearchParams(t.search).get("tab");j&&["overview","comments","activity"].includes(j)&&K(j)},[t.search]);const[te,se]=h.useState(""),[p,N]=h.useState(!1),[S,T]=h.useState(null),[Z,A]=h.useState(!1),[ae,G]=h.useState(!1),[re,V]=h.useState(!1),{predictions:oe,fetchPredictionById:ce,placePrediction:xe,loading:m,error:f}=Wt(),v=Ot(),{wallet:me,available:R,locked:ft,total:Bs,isLoading:Ce,refetch:bt}=ts(),{address:ie}=xs(),jt=ie?.toLowerCase(),he=h.useMemo(()=>!!oe.find(j=>j.id===g)?.settledAt,[oe,g]),{data:ue,isLoading:wt}=Us(he?g:void 0,ie),{claim:vt,isClaiming:Ge}=us(),ye=R,{mode:Ve,setMode:Pe,isDemoEnabled:Nt,isFiatEnabled:St,setFiatEnabled:Qe}=Jt(),$e=as.capabilities,_e=Nt&&$e.allowDemo,Ae=St&&$e.allowFiat,Ee=$e.allowCrypto,{data:Fe}=Xt(),{data:kt,isLoading:We}=It(y?.id);h.useEffect(()=>{Fe?.enabled!==void 0&&Qe(Fe.enabled)},[Fe?.enabled,Qe]);const z=_e&&Ve==="demo",P=Ae&&Ve==="fiat",Je=Ee&&!z&&!P,[Ct,De]=h.useState(null),[Le,ge]=h.useState(!1),Te=h.useCallback(async()=>{if(y?.id)try{ge(!0);const u=await fetch(`${le()}/api/demo-wallet/summary?userId=${y.id}`),j=await u.json().catch(()=>null);if(!u.ok)throw new Error(j?.message||"Failed to load demo wallet");De(j?.summary??null)}catch{De(null)}finally{ge(!1)}},[y?.id]),Ye=h.useCallback(async()=>{if(y?.id)try{ge(!0);const u=await fetch(`${le()}/api/demo-wallet/faucet`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:y.id})}),j=await u.json().catch(()=>null);if(!u.ok)throw new Error(j?.message||"Failed to faucet demo credits");if(De(j?.summary??null),j?.nextEligibleAt)try{localStorage.setItem(`fcz_demo_credits_next_at:${y.id}`,String(Date.parse(String(j.nextEligibleAt))))}catch{}if(j?.alreadyGranted&&j?.nextEligibleAt){const C=Date.parse(String(j.nextEligibleAt)),$=Math.max(0,C-Date.now());J(`Not yet available. Next request in ${Math.ceil($/6e4)} min.`)}}catch(u){J(u?.message||"Failed to get demo credits")}finally{ge(!1)}},[y?.id]);h.useEffect(()=>{x&&z&&Te()},[x,z,Te]);const o=h.useMemo(()=>g&&oe.find(u=>u.id===g)||null,[oe,g]),Pt=h.useMemo(()=>!!(y?.id&&o?.creator_id&&y.id===o.creator_id),[y?.id,o?.creator_id]),ze=h.useMemo(()=>{if(!o)return!1;const u=(o.status||"").toLowerCase();return he||u==="closed"||u==="settled"||u==="cancelled"},[o,he]),$t=h.useMemo(()=>{if(!o)return;const u=typeof o.pool_total=="number"?o.pool_total:typeof o.pool_total=="string"?Number(o.pool_total):null,j=typeof o.participant_count=="number"?o.participant_count:typeof o.participants=="number"?o.participants:null,C=[o.category,o.status,o.type,o.creator?.username??void 0,o.creator?.full_name??void 0].filter(q=>!!q),$=[o.settlement_method,o.settlement_criteria,o.creator?.is_verified?"verified creator":void 0].filter(q=>!!q);return{id:o.id,title:o.title,description:o.description??o.question??"",question:o.question??void 0,category:o.category,options:o.options?.map(q=>({label:q?.label??q?.title??q?.text??""})),keywords:C,attributes:$,tags:C,identity:{creator:o.creator?.full_name||o.creator?.username||null,community:o.creator?.username?`${o.creator.username} community`:null,personas:$},popularity:{pool:u,totalVolume:typeof o.total_volume=="number"?o.total_volume:null,players:j,comments:typeof o.comments=="number"?o.comments:null}}},[o]),{media:pe,status:Ze}=is(o?.id||"",$t);h.useEffect(()=>{},[pe,o]);const Me=Number(Ct?.available??0),Oe=Number(kt?.summary?.availableNgn??0),fe=x?P?Oe:z?Me:ye:0;h.useEffect(()=>{},[x,R,ye,fe,Ce]);const be=h.useCallback(async()=>{if(!g){c("/discover");return}try{await ce(g)}catch{J("Failed to load prediction details")}},[g,ce,c]);h.useEffect(()=>{be()},[be]);const{items:_t,refresh:qs}=os(g,{limit:25,autoLoad:!0});h.useEffect(()=>{if(typeof window>"u")return;const u=o?.title||o?.question||"";if(!u.trim()){se(`${window.location.origin}/prediction/${g}`);return}const j=u.toLowerCase().trim().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").slice(0,80);if(!j){se(`${window.location.origin}/prediction/${g}`);return}const C=`${window.location.origin}/predictions/${j}`;se(C);try{let $=document.querySelector('link[rel="canonical"]');$||($=document.createElement("link"),$.setAttribute("rel","canonical"),document.head.appendChild($)),$.setAttribute("href",C)}catch{}},[o?.title,g,c,i]);const je=()=>{const u=a.current;if(u){c(u,{replace:!0});return}window.history.length>1?window.history.back():c("/discover")},At=async()=>{if(navigator.share&&o)try{await navigator.share({title:o.title,text:`Check out this prediction: ${o.title}`,url:te})}catch{Xe()}else Xe()},Xe=async()=>{try{await navigator.clipboard.writeText(te),at("Link copied to clipboard!"),st.announce("Link copied to clipboard")}catch{J("Failed to copy link")}},Et=u=>{U(u===_?null:u),u!==_&&w("")},Ft=async()=>{if(!x){ve({intent:"place_prediction",payload:{predictionId:g}});return}if(!_||!k||!o||!y?.id){y?.id||J("User not authenticated. Please sign in.");return}const u=parseFloat(k),j=P?Oe:z?Me:ye;if(u>j){if(Je){N(!0);return}if(P){J(`Insufficient fiat balance. Available: ₦${j.toFixed(0)}`),c("/wallet");return}J(`Insufficient balance. Available: $${j.toFixed(2)}`);return}b(!0);try{await xe(o.id,_,u,y.id,ie),at(`Stake placed: ${P?`₦${Number(k).toLocaleString()}`:`$${k}`} | lock consumed`),st.announce(`Prediction placed successfully for ${k} ${P?"naira":"dollars"}`);const C=o.options.find(q=>q.id===_)?.label||`Your ${M("bet")}`;T({amount:u,optionLabel:C}),setTimeout(()=>T(null),6e3),U(null),w("");const $=y?.id;$&&(await Promise.all([v.invalidateQueries({queryKey:H.walletSummary($,jt)}),v.invalidateQueries({queryKey:H.walletActivity($)}),v.invalidateQueries({queryKey:H.escrowBalance($)}),v.invalidateQueries({queryKey:H.onchainActivity($)}),v.invalidateQueries({queryKey:H.prediction(g)}),v.invalidateQueries({queryKey:H.predictionEntries(g)})]),z&&await Te()),v.invalidateQueries({queryKey:["readContract"]}),await bt(),await be()}catch(C){if(C instanceof Error){if(C.message==="INSUFFICIENT_ESCROW"){N(!0),J("Insufficient escrow balance. Opening deposit modal...");return}J(C.message||"Failed to place prediction. Please try again.")}else J("Failed to place prediction. Please try again.")}finally{b(!1)}};if(m&&!o)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:je,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(we,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Loading..."})}),e.jsx("div",{className:"min-w-[40px]"})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx(Ss,{message:"Loading prediction details...",className:"py-20"})]});if(f&&!o)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:je,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(we,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Error"})}),e.jsx("div",{className:"min-w-[40px]"})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx(Cs,{error:"Failed to load prediction details",onRetry:be,className:"m-4"})]});if(!o&&!m)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:je,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(we,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Not Found"})}),e.jsx("div",{className:"min-w-[40px]"})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx($s,{icon:mt,title:"Prediction Not Found",description:"The prediction you're looking for doesn't exist or has been removed.",action:{label:"Browse Predictions",onClick:()=>c("/discover")},className:"py-20"})]});if(!o)return null;const Dt=o.participant_count||0,Lt=o.pool_total||0;return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0",children:[e.jsx("div",{className:"safe-px mx-auto max-w-screen-md",children:e.jsxs("div",{className:"h-12 flex items-center justify-between gap-2 px-4",children:[e.jsx("div",{className:"min-w-[40px] flex items-center",children:e.jsx("button",{onClick:je,className:"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2","aria-label":"Go back",children:e.jsx(we,{className:"w-5 h-5"})})}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("h1",{className:"text-base font-semibold leading-none truncate",children:"Prediction Details"})}),e.jsx("div",{className:"min-w-[40px] flex items-center justify-end gap-1",children:e.jsx("button",{onClick:At,className:"p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100","aria-label":"Share prediction",children:e.jsx(hs,{className:"w-5 h-5"})})})]})}),e.jsx("div",{className:"border-b border-gray-200"})]}),e.jsx("div",{className:"mx-4 mt-4 rounded-2xl overflow-hidden border border-gray-100 aspect-video",children:Ze==="ready"&&pe?.url?e.jsx("img",{src:pe.url,alt:pe.alt||o?.title,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):Ze==="loading"?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 animate-pulse"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-gray-500 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"📊"}),e.jsx("div",{className:"text-sm font-medium capitalize",children:o?.category||"Prediction"})]})})}),e.jsxs("main",{className:"px-4 pb-[calc(var(--bottom-nav-h,64px)+72px+env(safe-area-inset-bottom))] pt-4 space-y-4 bg-gray-50",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Fs,{title:o.title,creator:o.creator}),(()=>{const u=Yt(o);return u?e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-700",children:u})}):null})()]}),e.jsx(ps,{activeTab:B,onTabChange:K,commentCount:F||o.comments_count||0,activityCount:_t.length,children:e.jsxs(Re,{mode:"wait",children:[B==="overview"&&e.jsxs(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Prediction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Volume"}),e.jsx("p",{className:"font-semibold text-gray-900",children:I(Lt,{compact:!0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Zt,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Participants"}),e.jsx("p",{className:"font-semibold text-gray-900",children:Dt})]})]})]}),x&&g&&String(o.status||"").toLowerCase()!=="open"&&e.jsx("div",{className:"mt-3",children:e.jsx("button",{type:"button",onClick:()=>A(!0),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors",children:"Review Settlement"})}),Pt&&!ze&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("button",{type:"button",onClick:()=>G(!0),className:"w-full px-4 py-2 rounded-xl border border-gray-200 bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors",children:"Edit"}),e.jsx("button",{type:"button",onClick:()=>V(!0),className:"w-full px-4 py-2 rounded-xl border border-red-200 bg-white text-red-600 font-semibold hover:bg-red-50 transition-colors",children:"Cancel prediction"})]})]}),ze&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-2xl p-3",children:[e.jsx("div",{className:"text-sm text-yellow-900 font-medium",children:"This prediction is closed."}),e.jsx("div",{className:"text-xs text-yellow-800 mt-1",children:he?"Results are finalized.":`No new ${M("bets")} can be placed.`})]}),o.description&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:"Description"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:o.description})]}),!!ie&&!!ue&&Number(ue.amountUnits)>0&&!(()=>{try{return!!localStorage.getItem(`fcz:claimed:${g}:${ie.toLowerCase()}`)}catch{return!1}})()&&e.jsx("div",{className:"bg-gradient-to-br from-emerald-50 to-blue-50 rounded-2xl p-4 shadow-sm border border-emerald-100",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-base font-semibold text-gray-900",children:["You have ",M("winnings").toLowerCase()," to claim"]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-0.5",children:["Connected: ",e.jsxs("span",{className:"font-mono",children:[ie.slice(0,6),"…",ie.slice(-4)]})]})]}),e.jsx("button",{type:"button",className:"h-10 px-4 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:Ge||wt,onClick:async()=>{const u=BigInt(ue.amountUnits);await vt({predictionId:g,amountUnits:u,proof:ue.proof})},children:Ge?"Claiming…":`Claim ${I(ue.amountUSD,{compact:!1})}`})]})}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-2",children:"How This Works"}),e.jsxs("ul",{className:"space-y-1.5 text-sm text-gray-600",children:[e.jsx("li",{children:"• Choose an outcome you believe will happen"}),e.jsx("li",{children:"• Stake an amount you're comfortable with"}),e.jsx("li",{children:"• If you're right, win based on the current odds"}),e.jsx("li",{children:"• Betting closes when the prediction expires"})]})]}),!x&&String(o.status||"").toLowerCase()!=="settled"?e.jsx(Es,{onSignIn:()=>ve({intent:"place_prediction",payload:{predictionId:g}})}):e.jsx(Ds,{options:o.options||[],selectedId:_||void 0,onSelect:Et,disabled:L||!x||String(o.status||"").toLowerCase()!=="open",winningOptionId:o.winning_option_id||o.winningOptionId,showWinningIndicator:String(o.status||"").toLowerCase()==="settled"}),S&&e.jsxs("div",{className:"bg-emerald-50 border border-emerald-200 rounded-xl p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-emerald-800 font-medium",children:["You staked ",P?`₦${S.amount.toFixed(0)}`:`$${S.amount.toFixed(2)}`," on “",S.optionLabel,"”."]}),e.jsx("button",{type:"button",onClick:()=>K("activity"),className:"text-xs font-semibold text-emerald-700 hover:text-emerald-800 underline",children:"View activity"})]}),x&&_&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm border space-y-3",children:[(_e||Ae||Ee)&&e.jsxs("div",{className:"inline-flex rounded-lg bg-gray-100 p-1 flex-wrap gap-1",children:[Ee&&e.jsx("button",{onClick:()=>Pe("crypto"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${Je?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,type:"button",children:"Crypto (USDC)"}),_e&&e.jsx("button",{onClick:()=>Pe("demo"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${z?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,type:"button",children:"Demo Credits"}),Ae&&e.jsx("button",{onClick:()=>Pe("fiat"),className:`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${P?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"}`,type:"button",children:"Fiat (NGN)"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"stake-input",className:"block text-sm font-medium text-gray-900 mb-2",children:["Stake Amount (",P?"NGN":"USD",")"]}),e.jsxs("div",{className:"relative",children:[P?e.jsx(es,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}):e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none"}),e.jsx("input",{id:"stake-input",type:"number",inputMode:"decimal",placeholder:"0.00",value:k,onChange:u=>w(u.target.value),disabled:L,className:"w-full rounded-xl border bg-background pl-10 pr-4 py-3 text-lg font-semibold transition-colors border-border focus:border-primary focus:ring-primary/20 focus:outline-none focus:ring-2 disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600",children:["Available: ",(P?We:z?Le:Ce)?"Loading…":I(fe,{compact:!0,currency:P?"NGN":"USD"})]}),k&&!(P?We:z?Le:Ce)&&parseFloat(k)>fe&&e.jsx("span",{className:"text-red-600 font-medium",children:"Insufficient balance"})]}),z&&e.jsx("div",{className:"pt-1",children:e.jsx("button",{type:"button",onClick:Ye,disabled:Le,className:"w-full rounded-xl border bg-gray-50 px-4 py-2.5 text-sm font-semibold hover:bg-gray-100 transition-colors disabled:opacity-50",children:"Get Demo Credits"})}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:(P?[500,1e3,2500,5e3,1e4,25e3]:[10,25,50,100,250,500]).map(u=>e.jsx("button",{onClick:()=>w(u.toString()),disabled:L||u>fe,className:"rounded-lg border bg-gray-50 px-3 py-2 text-sm font-medium hover:bg-gray-100 transition-colors disabled:opacity-40 disabled:cursor-not-allowed",children:P?`₦${u.toLocaleString()}`:`$${u}`},u))})]})]},"overview"),B==="comments"&&e.jsx(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},"data-qa":"comments-section",children:e.jsx(vs,{predictionId:g})},"comments"),B==="activity"&&e.jsx(Y.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:e.jsx(As,{predictionId:g})},"activity")]})})]}),B==="overview"&&!ze&&(()=>{const u=parseFloat(k||"0"),C=Math.max(0,u-(P?Oe:z?Me:ye)),$=!u||u<=0?M("betVerb"):C>0?z?`Get demo credits (need $${C.toFixed(2)})`:P?`Deposit NGN (need ₦${C.toFixed(0)})`:`Add funds (need $${C.toFixed(2)})`:`${M("betVerb")}: ${P?`₦${u.toFixed(0)}`:`$${u.toFixed(2)}`}`,q=!!k&&u>0;return e.jsx(Ls,{canBet:q,onPlace:async()=>{if(z&&C>0){await Ye();return}if(P&&C>0){c("/wallet");return}await Ft()},loading:L,label:$})})(),p&&y?.id&&e.jsx(ss,{open:p,onClose:()=>N(!1),onSuccess:()=>N(!1),availableUSDC:me,userId:y.id}),e.jsx(zs,{isOpen:Z,onClose:()=>A(!1),predictionId:g,predictionTitle:o?.title??"Prediction",onValidated:()=>{v.invalidateQueries({queryKey:H.prediction(g)}),v.invalidateQueries({queryKey:H.predictionEntries(g)})}}),o&&e.jsxs(e.Fragment,{children:[e.jsx(Ms,{open:ae,onOpenChange:G,prediction:o,onSaved:u=>{v.invalidateQueries({queryKey:H.prediction(g)}),ce(g)},userId:y?.id}),e.jsx(Os,{open:re,onOpenChange:V,prediction:o,onCancelled:u=>{v.invalidateQueries({queryKey:H.prediction(g)}),ce(g)},userId:y?.id})]})]})};export{la as default};
