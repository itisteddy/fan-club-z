{"version":3,"file":"useFiatWallet-4b2d48ae.js","sources":["../../node_modules/lucide-react/dist/esm/icons/banknote.js","../../src/lib/apiClient.ts","../../src/hooks/useFiatWallet.ts"],"sourcesContent":["/**\n * @license lucide-react v0.303.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Banknote = createLucideIcon(\"Banknote\", [\n  [\"rect\", { width: \"20\", height: \"12\", x: \"2\", y: \"6\", rx: \"2\", key: \"9lu3g6\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"2\", key: \"1c9p78\" }],\n  [\"path\", { d: \"M6 12h.01M18 12h.01\", key: \"113zkx\" }]\n]);\n\nexport { Banknote as default };\n//# sourceMappingURL=banknote.js.map\n","/**\n * Unified API Client for Fan Club Z\n * \n * Uses CapacitorHttp on native platforms to bypass CORS entirely.\n * Falls back to fetch on web.\n * \n * This eliminates CORS preflight issues in iOS/Android Capacitor builds.\n */\n\nimport { Capacitor } from '@capacitor/core';\nimport { CapacitorHttp } from '@capacitor/core';\nimport { getApiUrl } from '@/utils/environment';\n\nconst API_BASE_URL = getApiUrl();\nconst API_VERSION = 'v2';\nconst API_URL = `${API_BASE_URL}/api/${API_VERSION}`;\n\n// Auth helpers\nconst getAuthToken = () => localStorage.getItem('token');\nconst setAuthToken = (token: string) => localStorage.setItem('token', token);\nconst removeAuthToken = () => localStorage.removeItem('token');\n\n// Check if running in native Capacitor shell\nconst isNative = () => Capacitor.isNativePlatform();\n\n/**\n * Convert HeadersInit to a plain object for CapacitorHttp\n */\nconst headersToObject = (headers: HeadersInit): Record<string, string> => {\n  if (headers instanceof Headers) {\n    const obj: Record<string, string> = {};\n    headers.forEach((value, key) => {\n      obj[key] = value;\n    });\n    return obj;\n  }\n  if (Array.isArray(headers)) {\n    return Object.fromEntries(headers);\n  }\n  return headers as Record<string, string>;\n};\n\n/**\n * Make HTTP request using CapacitorHttp (native) or fetch (web)\n */\nasync function httpRequest(\n  method: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE',\n  endpoint: string,\n  options?: {\n    body?: any;\n    headers?: HeadersInit;\n  }\n): Promise<any> {\n  const url = `${API_URL}${endpoint}`;\n  const token = getAuthToken();\n\n  // Build headers\n  const headers: Record<string, string> = {\n    ...(token && { Authorization: `Bearer ${token}` }),\n    ...(options?.headers ? headersToObject(options.headers) : {}),\n  };\n\n  // Native: Use CapacitorHttp (bypasses CORS)\n  if (isNative()) {\n    try {\n      // CapacitorHttp expects data as an object (not stringified)\n      // It will automatically JSON.stringify for us\n      const requestOptions: any = {\n        url,\n        method,\n        headers,\n      };\n\n      // Only add data if body exists (for POST/PUT/PATCH)\n      if (options?.body) {\n        requestOptions.data = options.body;\n      }\n\n      const response = await CapacitorHttp.request(requestOptions);\n\n      // CapacitorHttp returns { data, status, headers }\n      if (response.status >= 200 && response.status < 300) {\n        // CapacitorHttp automatically parses JSON responses\n        // If data is already an object, return it; if string, try to parse\n        if (typeof response.data === 'string') {\n          try {\n            return JSON.parse(response.data);\n          } catch {\n            return response.data;\n          }\n        }\n        return response.data;\n      }\n\n      // Include response data in error for debugging\n      const errorMessage = `HTTP error! status: ${response.status}`;\n      console.error(`[CapacitorHttp] ${errorMessage}`, { \n        url, \n        method, \n        responseData: response.data \n      });\n      throw new Error(errorMessage);\n    } catch (error: any) {\n      console.warn(`[CapacitorHttp] API call failed: ${endpoint}`, error);\n      throw error;\n    }\n  }\n\n  // Web: Use fetch\n  try {\n    const response = await fetch(url, {\n      method,\n      headers,\n      body: options?.body ? JSON.stringify(options.body) : undefined,\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP error! status: ${response.status}`);\n    }\n\n    return response.json();\n  } catch (error) {\n    console.warn(`[fetch] API call failed: ${endpoint}`, error);\n    throw error;\n  }\n}\n\n/**\n * Unified API Client\n * Automatically uses CapacitorHttp on native, fetch on web\n */\nexport const apiClient = {\n  get: async (endpoint: string, options?: RequestInit) => {\n    // GET requests should NOT include Content-Type to avoid unnecessary preflight\n    const headers: HeadersInit = {\n      ...(options?.headers || {}),\n    };\n    \n    return httpRequest('GET', endpoint, { headers });\n  },\n\n  post: async (endpoint: string, data?: any, options?: RequestInit) => {\n    const headers: HeadersInit = {\n      'Content-Type': 'application/json',\n      ...(options?.headers || {}),\n    };\n    \n    return httpRequest('POST', endpoint, { body: data, headers });\n  },\n\n  put: async (endpoint: string, data?: any, options?: RequestInit) => {\n    const headers: HeadersInit = {\n      'Content-Type': 'application/json',\n      ...(options?.headers || {}),\n    };\n    \n    return httpRequest('PUT', endpoint, { body: data, headers });\n  },\n\n  patch: async (endpoint: string, data?: any, options?: RequestInit) => {\n    const headers: HeadersInit = {\n      'Content-Type': 'application/json',\n      ...(options?.headers || {}),\n    };\n    \n    return httpRequest('PATCH', endpoint, { body: data, headers });\n  },\n\n  delete: async (endpoint: string, options?: RequestInit) => {\n    // DELETE requests should NOT include Content-Type unless there's a body\n    const headers: Record<string, string> = {\n      ...(options?.headers ? headersToObject(options.headers) : {}),\n    };\n    \n    // Only add Content-Type if there's a body\n    if (options?.body) {\n      headers['Content-Type'] = 'application/json';\n    }\n    \n    return httpRequest('DELETE', endpoint, { \n      body: options?.body ? (typeof options.body === 'string' ? JSON.parse(options.body) : options.body) : undefined,\n      headers \n    });\n  },\n};\n\n// Export auth helpers for compatibility\nexport { getAuthToken, setAuthToken, removeAuthToken };\nexport { API_BASE_URL, API_VERSION, API_URL };\n","/**\n * Fiat Wallet Hook - Phase 7A\n * Fetches fiat (NGN) balance and manages fiat wallet state\n */\n\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport { apiClient, API_BASE_URL } from '@/lib/api';\n\ninterface FiatSummary {\n  currency: string;\n  totalKobo: number;\n  availableKobo: number;\n  lockedKobo: number;\n  totalNgn: number;\n  availableNgn: number;\n  lockedNgn: number;\n  lastUpdated: string;\n  /** Phase 7D: display-only USD equivalent when fx rate available */\n  usdEstimate?: number | null;\n}\n\nexport interface FxMeta {\n  pair: string;\n  rate: number | null;\n  source: string;\n  asOf: string | null;\n  retrievedAt: string | null;\n  isStale: boolean;\n}\n\ninterface CombinedSummary {\n  demo: {\n    currency: string;\n    available: number;\n    reserved: number;\n    total: number;\n    lastUpdated: string;\n  };\n  fiat: FiatSummary | null;\n  fiatEnabled: boolean;\n}\n\ninterface PaystackStatus {\n  enabled: boolean;\n  currency: string;\n  minDepositNgn: number;\n}\n\ninterface InitializeResponse {\n  success: boolean;\n  authorizationUrl: string;\n  reference: string;\n  accessCode: string;\n  amountNgn: number;\n  amountKobo: number;\n}\n\n/**\n * Fetch Paystack status (enabled, min deposit)\n */\nexport function usePaystackStatus() {\n  return useQuery({\n    queryKey: ['paystack', 'status'],\n    queryFn: async (): Promise<PaystackStatus> => {\n      return await apiClient.get('/fiat/paystack/status');\n    },\n    staleTime: 5 * 60 * 1000, // 5 minutes\n  });\n}\n\n/**\n * Fetch fiat wallet summary (Phase 7D: includes fx + usdEstimate)\n */\nexport function useFiatSummary(userId: string | undefined) {\n  return useQuery({\n    queryKey: ['fiat', 'summary', userId],\n    queryFn: async (): Promise<{\n      enabled: boolean;\n      summary: FiatSummary | null;\n      fx?: FxMeta;\n    }> => {\n      if (!userId) return { enabled: false, summary: null };\n      const response = await fetch(`${API_BASE_URL}/api/demo-wallet/fiat/summary?userId=${userId}`);\n      return await response.json();\n    },\n    enabled: !!userId,\n    staleTime: 15 * 1000,\n    refetchInterval: 30 * 1000,\n  });\n}\n\n/**\n * Fetch combined wallet summary (demo + fiat)\n */\nexport function useCombinedWalletSummary(userId: string | undefined) {\n  return useQuery({\n    queryKey: ['wallet', 'combined-summary', userId],\n    queryFn: async (): Promise<CombinedSummary> => {\n      if (!userId) throw new Error('userId required');\n      // demo-wallet endpoints are at /api/demo-wallet, not /api/v2\n      const response = await fetch(`${API_BASE_URL}/api/demo-wallet/combined-summary?userId=${userId}`);\n      return await response.json();\n    },\n    enabled: !!userId,\n    staleTime: 15 * 1000,\n    refetchInterval: 30 * 1000,\n  });\n}\n\n/**\n * Initialize Paystack deposit\n */\nexport function useInitializeDeposit() {\n  const queryClient = useQueryClient();\n\n  return useMutation({\n    mutationFn: async ({ amountNgn, userId, email }: { amountNgn: number; userId: string; email?: string }): Promise<InitializeResponse> => {\n      return await apiClient.post('/fiat/paystack/initialize', {\n        amountNgn,\n        userId,\n        email,\n      });\n    },\n    onSuccess: () => {\n      // Invalidate wallet queries after deposit initiated\n      queryClient.invalidateQueries({ queryKey: ['fiat'] });\n      queryClient.invalidateQueries({ queryKey: ['wallet'] });\n    },\n  });\n}\n\n/**\n * Fetch Nigerian banks list (for withdrawals)\n */\nexport function useNigerianBanks() {\n  return useQuery({\n    queryKey: ['paystack', 'banks'],\n    queryFn: async (): Promise<Array<{ name: string; code: string; slug: string }>> => {\n      const data = await apiClient.get('/fiat/paystack/banks');\n      return data?.banks || [];\n    },\n    staleTime: 24 * 60 * 60 * 1000, // 24 hours\n  });\n}\n\nexport type { FiatSummary, CombinedSummary, PaystackStatus, InitializeResponse };\n"],"names":["Banknote","createLucideIcon","API_BASE_URL","getApiUrl","API_VERSION","API_URL","getAuthToken","isNative","Capacitor","headersToObject","headers","obj","value","key","httpRequest","method","endpoint","options","url","token","requestOptions","response","CapacitorHttp","errorMessage","error","apiClient","data","usePaystackStatus","useQuery","useFiatSummary","userId","useInitializeDeposit","queryClient","useQueryClient","useMutation","amountNgn","email","useNigerianBanks"],"mappings":"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","x_google_ignoreList":[0]}