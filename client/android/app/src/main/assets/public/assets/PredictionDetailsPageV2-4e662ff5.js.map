{"version":3,"file":"PredictionDetailsPageV2-4e662ff5.js","sources":["../../node_modules/lucide-react/dist/esm/icons/heart.js","../../node_modules/lucide-react/dist/esm/icons/log-in.js","../../src/store/unifiedCommentStore.ts","../../src/components/prediction/PredictionDetailsTabs.tsx","../../src/features/comments/CommentInput.tsx","../../src/features/comments/CommentItem.tsx","../../src/features/comments/CommentListSkeleton.tsx","../../src/features/comments/CommentList.tsx","../../src/features/comments/CommentsSection.tsx","../../src/components/ui/LoadingState.tsx","../../src/components/ui/ErrorBanner.tsx","../../src/components/ui/EmptyState.tsx","../../src/components/activity/ActivityFeed.tsx","../../src/components/auth/SignInCallout.tsx","../../src/components/predictions/TitleAndMeta.tsx","../../src/components/predictions/OptionsSection.tsx","../../src/components/predictions/StickyBetBar.tsx","../../src/components/modals/SettlementValidationModal.tsx","../../src/components/prediction/EditPredictionSheet.tsx","../../src/components/prediction/CancelPredictionSheet.tsx","../../src/hooks/useMerkleProof.ts","../../src/pages/PredictionDetailsPageV2.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.303.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Heart = createLucideIcon(\"Heart\", [\n  [\n    \"path\",\n    {\n      d: \"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z\",\n      key: \"c3ymky\"\n    }\n  ]\n]);\n\nexport { Heart as default };\n//# sourceMappingURL=heart.js.map\n","/**\n * @license lucide-react v0.303.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst LogIn = createLucideIcon(\"LogIn\", [\n  [\"path\", { d: \"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4\", key: \"u53s6r\" }],\n  [\"polyline\", { points: \"10 17 15 12 10 7\", key: \"1ail0h\" }],\n  [\"line\", { x1: \"15\", x2: \"3\", y1: \"12\", y2: \"12\", key: \"v6grx8\" }]\n]);\n\nexport { LogIn as default };\n//# sourceMappingURL=log-in.js.map\n","import { create } from 'zustand';\nimport { devtools } from 'zustand/middleware';\nimport { apiClient } from '../lib/api'; // Use the correct apiClient\nimport { useAuthStore } from './authStore';\nimport { qaLog } from '../utils/devQa';\n\n// Comment interface matching API response\nexport interface Comment {\n  id: string;\n  predictionId: string;\n  user: { \n    id: string; \n    username: string; \n    full_name?: string;\n    avatarUrl?: string; \n    avatar_url?: string;\n    is_verified?: boolean;\n  };\n  text: string;\n  content?: string; // Server uses 'content' field\n  createdAt: string;\n  created_at?: string; // Server uses 'created_at'\n  updatedAt: string;\n  updated_at?: string; // Server uses 'updated_at'\n  edited: boolean;\n  is_edited?: boolean; // Server uses 'is_edited'\n  isDeleted: boolean;\n  likeCount?: number;\n  likes_count?: number; // Server uses 'likes_count'\n  likedByMe?: boolean;\n  is_liked?: boolean; // Server uses 'is_liked'\n}\n\nexport type Status = 'idle' | 'loading' | 'loaded' | 'paginating' | \n                     'network_error' | 'server_error' | 'client_error' | 'parse_error';\n\ninterface PredictionCommentsState {\n  items?: Comment[];          // last good data only\n  nextCursor?: string | null;\n  status?: Status;\n  posting?: boolean;\n  draft?: string;           // session-persisted\n  highlightedId?: string;   // #comment-id\n}\n\ninterface CommentsState {\n  byPrediction: {\n    [predictionId: string]: PredictionCommentsState;\n  };\n}\n\ninterface CommentsActions {\n  // Main actions\n  fetchComments: (predictionId: string) => Promise<void>;\n  addComment: (predictionId: string, text: string) => Promise<void>;\n  editComment: (predictionId: string, commentId: string, text: string) => Promise<void>;\n  deleteComment: (predictionId: string, commentId: string) => Promise<void>;\n  loadMore: (predictionId: string) => Promise<void>;\n  \n  // UI state\n  setDraft: (predictionId: string, draft: string) => void;\n  clearDraft: (predictionId: string) => void;\n  setHighlighted: (predictionId: string, commentId: string | undefined) => void;\n  \n  // Getters\n  getComments: (predictionId: string) => Comment[];\n  getCommentCount: (predictionId: string) => number;\n  getStatus: (predictionId: string) => Status;\n  getDraft: (predictionId: string) => string;\n  isPosting: (predictionId: string) => boolean;\n  hasMore: (predictionId: string) => boolean;\n}\n\n// Transform server comment to client format\nconst transformComment = (serverComment: any): Comment => {\n  return {\n    id: serverComment.id,\n    predictionId: serverComment.prediction_id,\n    user: {\n      id: serverComment.user?.id || serverComment.user_id,\n      username: serverComment.user?.username || 'Anonymous',\n      full_name: serverComment.user?.full_name,\n      avatarUrl: serverComment.user?.avatar_url,\n      avatar_url: serverComment.user?.avatar_url,\n      is_verified: serverComment.user?.is_verified || false,\n    },\n    text: serverComment.content || serverComment.text || '',\n    content: serverComment.content,\n    createdAt: serverComment.created_at || serverComment.createdAt || new Date().toISOString(),\n    created_at: serverComment.created_at,\n    updatedAt: serverComment.updated_at || serverComment.updatedAt || new Date().toISOString(),\n    updated_at: serverComment.updated_at,\n    edited: serverComment.is_edited || serverComment.edited || false,\n    is_edited: serverComment.is_edited,\n    isDeleted: serverComment.is_deleted || false,\n    likeCount: serverComment.likes_count || serverComment.likeCount || 0,\n    likes_count: serverComment.likes_count,\n    likedByMe: serverComment.is_liked || serverComment.likedByMe || false,\n    is_liked: serverComment.is_liked,\n  };\n};\n\n// Classify errors based on response\nfunction classifyError(error: any): Status {\n  if (!error) return 'network_error';\n  \n  if (error.name === 'TypeError' || error.message?.includes('Failed to fetch')) {\n    return 'network_error';\n  }\n  \n  if (error.status >= 500) {\n    return 'server_error';\n  }\n  \n  if (error.status >= 400 && error.status < 500) {\n    return 'client_error';\n  }\n  \n  if (error.name === 'SyntaxError' || error.message?.includes('JSON')) {\n    return 'parse_error';\n  }\n  \n  return 'network_error';\n}\n\nexport const useUnifiedCommentStore = create<CommentsState & CommentsActions>()(\n  devtools(\n    (set, get) => ({\n      byPrediction: {},\n\n      // Getters\n      getComments: (predictionId: string) => {\n        const state = get().byPrediction[predictionId];\n        return state?.items || [];\n      },\n\n      getCommentCount: (predictionId: string) => {\n        const state = get().byPrediction[predictionId];\n        return state?.items?.length || 0;\n      },\n\n      getStatus: (predictionId: string) => {\n        const state = get().byPrediction[predictionId];\n        return state?.status || 'idle';\n      },\n\n      getDraft: (predictionId: string) => {\n        const state = get().byPrediction[predictionId];\n        return state?.draft || '';\n      },\n\n      isPosting: (predictionId: string) => {\n        const state = get().byPrediction[predictionId];\n        return state?.posting || false;\n      },\n\n      hasMore: (predictionId: string) => {\n        const state = get().byPrediction[predictionId];\n        return state?.nextCursor !== null;\n      },\n\n      // Fetch initial comments\n      fetchComments: async (predictionId: string) => {\n        if (!predictionId?.trim()) {\n          qaLog('fetchComments: invalid predictionId');\n          return;\n        }\n\n        const currentState = get().byPrediction[predictionId];\n        if (currentState?.status === 'loading') {\n          return; // Already loading\n        }\n\n        qaLog(`Fetching comments for ${predictionId}`);\n\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              status: 'loading',\n            },\n          },\n        }));\n\n        try {\n          // Try the social endpoint first, then the comments endpoint\n          let response;\n          try {\n            response = await apiClient.get(`/social/predictions/${predictionId}/comments?page=1&limit=20`);\n          } catch (socialError) {\n            qaLog('Social endpoint failed, trying comments endpoint:', socialError);\n            response = await apiClient.get(`/comments/predictions/${predictionId}/comments?page=1&limit=20`);\n          }\n          \n          // Handle different response formats\n          let items: Comment[] = [];\n          let nextCursor = null;\n          \n          if (response.data && Array.isArray(response.data)) {\n            // New social service format\n            items = response.data.map(transformComment);\n            nextCursor = response.pagination?.hasNext ? 'next' : null;\n          } else if (response.comments && Array.isArray(response.comments)) {\n            // Comments service format\n            items = response.comments.map(transformComment);\n            nextCursor = response.hasMore ? 'next' : null;\n          } else if (Array.isArray(response)) {\n            // Direct array format\n            items = response.map(transformComment);\n          }\n\n          qaLog(`Fetched ${items.length} comments for ${predictionId}`);\n\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items,\n                nextCursor,\n                status: 'loaded',\n              },\n            },\n          }));\n\n        } catch (error: any) {\n          // Handle 404 as empty comments (no error state)\n          if (error.status === 404) {\n            qaLog(`No comments found for ${predictionId} (404)`);\n            set((state) => ({\n              byPrediction: {\n                ...state.byPrediction,\n                [predictionId]: {\n                  ...state.byPrediction[predictionId],\n                  items: [],\n                  nextCursor: null,\n                  status: 'loaded',\n                },\n              },\n            }));\n            return;\n          }\n          \n          const errorStatus = classifyError(error);\n          qaLog(`Failed to fetch comments for ${predictionId}:`, error);\n\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: state.byPrediction[predictionId]?.items || [], // Keep last good data\n                status: errorStatus,\n              },\n            },\n          }));\n        }\n      },\n\n      // Load more comments (pagination)\n      loadMore: async (predictionId: string) => {\n        if (!predictionId?.trim()) {\n          return;\n        }\n\n        const currentState = get().byPrediction[predictionId];\n        if (!currentState?.nextCursor || currentState?.status === 'paginating') {\n          return; // No more data or already loading\n        }\n\n        qaLog(`Loading more comments for ${predictionId}`);\n\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              status: 'paginating',\n            },\n          },\n        }));\n\n        try {\n          // Calculate next page\n          const currentPage = Math.ceil((currentState.items?.length || 0) / 20) + 1;\n          \n          let response;\n          try {\n            response = await apiClient.get(`/social/predictions/${predictionId}/comments?page=${currentPage}&limit=20`);\n          } catch (socialError) {\n            response = await apiClient.get(`/comments/predictions/${predictionId}/comments?page=${currentPage}&limit=20`);\n          }\n          \n          let newItems: Comment[] = [];\n          let nextCursor = null;\n          \n          if (response.data && Array.isArray(response.data)) {\n            newItems = response.data.map(transformComment);\n            nextCursor = response.pagination?.hasNext ? 'next' : null;\n          } else if (response.comments && Array.isArray(response.comments)) {\n            newItems = response.comments.map(transformComment);\n            nextCursor = response.hasMore ? 'next' : null;\n          }\n\n          qaLog(`Loaded ${newItems.length} more comments for ${predictionId}`);\n\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: [...(state.byPrediction[predictionId]?.items || []), ...newItems],\n                nextCursor,\n                status: 'loaded',\n              },\n            },\n          }));\n\n        } catch (error: any) {\n          const errorStatus = classifyError(error);\n          qaLog(`Failed to load more comments for ${predictionId}:`, error);\n\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                status: errorStatus,\n              },\n            },\n          }));\n        }\n      },\n\n      // Add new comment\n      addComment: async (predictionId: string, text: string) => {\n        if (!predictionId?.trim() || !text?.trim()) {\n          throw new Error('Invalid input');\n        }\n\n        const trimmedText = text.trim();\n        if (trimmedText.length > 280) {\n          throw new Error('Comment too long');\n        }\n\n        qaLog(`Adding comment to ${predictionId}:`, trimmedText);\n\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              posting: true,\n            },\n          },\n        }));\n\n        // Create optimistic comment with current user info\n        const { user } = useAuthStore.getState();\n        const tempId = `temp_${Date.now()}`;\n        const optimisticComment: Comment = {\n          id: tempId,\n          predictionId,\n          user: { \n            id: user?.id || 'demo-user', \n            username: user?.username || 'You', \n            full_name: user?.full_name,\n            avatarUrl: user?.avatar_url,\n            is_verified: user?.is_verified || false\n          },\n          text: trimmedText,\n          content: trimmedText,\n          createdAt: new Date().toISOString(),\n          updatedAt: new Date().toISOString(),\n          edited: false,\n          isDeleted: false,\n          likeCount: 0,\n          likedByMe: false,\n        };\n\n        // Add optimistic comment\n        set((state) => {\n          const currentItems = state.byPrediction[predictionId]?.items || [];\n          return {\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: [optimisticComment, ...currentItems],\n              },\n            },\n          };\n        });\n\n        try {\n          // Try social endpoint first, then comments endpoint\n          let response;\n          try {\n            response = await apiClient.post(`/social/predictions/${predictionId}/comments`, {\n              content: trimmedText,\n              userId: user?.id || 'demo-user',\n              user: user\n            });\n          } catch (socialError) {\n            qaLog('Social endpoint failed, trying comments endpoint:', socialError);\n            response = await apiClient.post(`/comments/predictions/${predictionId}/comments`, {\n              content: trimmedText,\n              user: user\n            });\n          }\n\n          // Handle different response formats\n          let serverComment: Comment;\n          if (response.data) {\n            serverComment = transformComment(response.data);\n          } else if (response.success && response.data) {\n            serverComment = transformComment(response.data);\n          } else {\n            serverComment = transformComment(response);\n          }\n\n          qaLog(`Comment added successfully for ${predictionId}`);\n\n          // Replace optimistic comment with server response\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: (state.byPrediction[predictionId]?.items ?? []).map(item =>\n                  item.id === tempId ? serverComment : item\n                ) || [serverComment],\n                posting: false,\n                draft: '', // Clear draft on success\n              },\n            },\n          }));\n\n          // Clear draft from session storage\n          try {\n            sessionStorage.removeItem(`fcz_comment_draft_${predictionId}`);\n          } catch (e) {\n            // Ignore storage errors\n          }\n\n        } catch (error: any) {\n          qaLog(`Failed to add comment for ${predictionId}:`, error);\n\n          // Remove optimistic comment and restore state\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: (state.byPrediction[predictionId]?.items ?? []).filter(item => item.id !== tempId),\n                posting: false,\n              },\n            },\n          }));\n\n          throw error;\n        }\n      },\n\n      // Edit comment\n      editComment: async (predictionId: string, commentId: string, text: string) => {\n        if (!predictionId?.trim() || !commentId?.trim() || !text?.trim()) {\n          throw new Error('Invalid input');\n        }\n\n        const trimmedText = text.trim();\n        if (trimmedText.length > 280) {\n          throw new Error('Comment too long');\n        }\n\n        qaLog(`Editing comment ${commentId} in ${predictionId}`);\n\n        // Store original for rollback\n        const originalComment = get().byPrediction[predictionId]?.items?.find(c => c.id === commentId);\n        if (!originalComment) {\n          throw new Error('Comment not found');\n        }\n\n        // Optimistic update\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              items: (state.byPrediction[predictionId]?.items ?? []).map(item =>\n                item.id === commentId\n                  ? { ...item, text: trimmedText, edited: true, updatedAt: new Date().toISOString() }\n                  : item\n              ) || [],\n            },\n          },\n        }));\n\n        try {\n          // Try social endpoint first, then comments endpoint\n          let response;\n          try {\n            response = await apiClient.put(`/social/comments/${commentId}`, {\n              content: trimmedText\n            });\n          } catch (socialError) {\n            response = await apiClient.put(`/comments/${commentId}`, {\n              content: trimmedText\n            });\n          }\n\n          let updatedComment: Comment;\n          if (response.data) {\n            updatedComment = transformComment(response.data);\n          } else {\n            updatedComment = transformComment(response);\n          }\n\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: (state.byPrediction[predictionId]?.items ?? []).map(item =>\n                  item.id === commentId ? updatedComment : item\n                ) || [],\n              },\n            },\n          }));\n\n        } catch (error: any) {\n          qaLog(`Failed to edit comment ${commentId}:`, error);\n\n          // Rollback\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: (state.byPrediction[predictionId]?.items ?? []).map(item =>\n                  item.id === commentId ? originalComment : item\n                ) || [],\n              },\n            },\n          }));\n\n          throw error;\n        }\n      },\n\n      // Delete comment\n      deleteComment: async (predictionId: string, commentId: string) => {\n        if (!predictionId?.trim() || !commentId?.trim()) {\n          throw new Error('Invalid input');\n        }\n\n        qaLog(`Deleting comment ${commentId} from ${predictionId}`);\n\n        // Store original for rollback\n        const originalItems = get().byPrediction[predictionId]?.items ?? [];\n        const commentToDelete = originalItems.find(c => c.id === commentId);\n        if (!commentToDelete) {\n          throw new Error('Comment not found');\n        }\n\n        // Optimistic delete\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              items: (state.byPrediction[predictionId]?.items ?? []).filter(item => item.id !== commentId),\n            },\n          },\n        }));\n\n        try {\n          // Try social endpoint first, then comments endpoint\n          try {\n            await apiClient.delete(`/social/comments/${commentId}`);\n          } catch (socialError) {\n            await apiClient.delete(`/comments/${commentId}`);\n          }\n\n          qaLog(`Comment ${commentId} deleted successfully`);\n\n        } catch (error: any) {\n          qaLog(`Failed to delete comment ${commentId}:`, error);\n\n          // Rollback\n          set((state) => ({\n            byPrediction: {\n              ...state.byPrediction,\n              [predictionId]: {\n                ...state.byPrediction[predictionId],\n                items: originalItems,\n              },\n            },\n          }));\n\n          throw error;\n        }\n      },\n\n      // Set draft with session persistence\n      setDraft: (predictionId: string, draft: string) => {\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              draft,\n            },\n          },\n        }));\n\n        // Persist to session storage with debouncing\n        try {\n          if (draft.trim()) {\n            sessionStorage.setItem(`fcz_comment_draft_${predictionId}`, draft);\n          } else {\n            sessionStorage.removeItem(`fcz_comment_draft_${predictionId}`);\n          }\n        } catch (e) {\n          // Ignore storage errors\n        }\n      },\n\n      clearDraft: (predictionId: string) => {\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              draft: '',\n            },\n          },\n        }));\n\n        try {\n          sessionStorage.removeItem(`fcz_comment_draft_${predictionId}`);\n        } catch (e) {\n          // Ignore storage errors\n        }\n      },\n\n      setHighlighted: (predictionId: string, commentId: string | undefined) => {\n        set((state) => ({\n          byPrediction: {\n            ...state.byPrediction,\n            [predictionId]: {\n              ...state.byPrediction[predictionId],\n              highlightedId: commentId,\n            },\n          },\n        }));\n\n        // Auto-clear highlight after 1.5s\n        if (commentId) {\n          setTimeout(() => {\n            set((state) => ({\n              byPrediction: {\n                ...state.byPrediction,\n                [predictionId]: {\n                  ...state.byPrediction[predictionId],\n                  highlightedId: undefined,\n                },\n              },\n            }));\n          }, 1500);\n        }\n      },\n    }),\n    {\n      name: 'fcz-unified-comments',\n      partialize: (_state: CommentsState & CommentsActions) => ({}), // Don't persist to localStorage - using sessionStorage for drafts\n    }\n  )\n);\n\n// Hook for convenient access to a specific prediction's comments\nexport const useCommentsForPrediction = (predictionId: string) => {\n  const store = useUnifiedCommentStore();\n  \n  return {\n    comments: store.getComments(predictionId),\n    commentCount: store.getCommentCount(predictionId),\n    status: store.getStatus(predictionId),\n    draft: store.getDraft(predictionId),\n    isPosting: store.isPosting(predictionId),\n    hasMore: store.hasMore(predictionId),\n    \n    // Actions\n    fetchComments: () => store.fetchComments(predictionId),\n    loadMore: () => store.loadMore(predictionId),\n    addComment: (text: string) => store.addComment(predictionId, text),\n    editComment: (commentId: string, text: string) => store.editComment(predictionId, commentId, text),\n    deleteComment: (commentId: string) => store.deleteComment(predictionId, commentId),\n    setDraft: (draft: string) => store.setDraft(predictionId, draft),\n    clearDraft: () => store.clearDraft(predictionId),\n    setHighlighted: (commentId: string | undefined) => store.setHighlighted(predictionId, commentId),\n  };\n};\n","import React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { BarChart3, MessageCircle, Activity } from 'lucide-react';\nimport { cn } from '../../utils/cn';\n\ninterface PredictionDetailsTabsProps {\n  activeTab: string;\n  onTabChange: (tab: string) => void;\n  commentCount?: number;\n  activityCount?: number;\n  participantCount?: number;\n  children: React.ReactNode;\n}\n\nconst PredictionDetailsTabs: React.FC<PredictionDetailsTabsProps> = ({\n  activeTab,\n  onTabChange,\n  commentCount = 0,\n  activityCount = 0,\n  participantCount = 0,\n  children\n}) => {\n  const normalizedActivity = activityCount || participantCount || 0;\n  const tabs = [\n    { id: 'overview', label: 'Overview', count: 0, icon: BarChart3 },\n    { id: 'comments', label: 'Comments', count: commentCount, icon: MessageCircle },\n    { id: 'activity', label: 'Activity', count: normalizedActivity, icon: Activity }\n  ];\n\n  return (\n    <div className=\"bg-white\">\n      {/* Tab Navigation - exactly matching My Bets design */}\n      <div className=\"bg-white border-b border-gray-200\">\n        <div className=\"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex space-x-4 py-3\">\n            {tabs.map((tab, index) => {\n              const Icon = tab.icon;\n              return (\n                <button\n                  key={tab.id}\n                  onClick={() => onTabChange(tab.id)}\n                  className={cn(\n                    \"px-3 py-1 rounded-lg text-sm font-medium transition-colors\",\n                    activeTab === tab.id\n                      ? 'bg-emerald-100 text-emerald-700'\n                      : 'text-gray-600 hover:text-gray-900'\n                  )}\n                >\n                  <div className=\"flex items-center gap-1\">\n                    <Icon className=\"w-4 h-4\" />\n                    <span className=\"hidden sm:inline\">{tab.label}</span>\n                    <span className=\"sm:hidden\">{tab.id === 'overview' ? 'Overview' : tab.id === 'comments' ? 'Comments' : 'Activity'}</span>\n                  </div>\n                  {tab.count > 0 && (\n                    <span className={cn(\n                      \"ml-1 px-2 py-0.5 rounded-full text-xs font-semibold\",\n                      activeTab === tab.id \n                        ? 'bg-emerald-200 text-emerald-900' \n                        : 'bg-gray-200 text-gray-600'\n                    )}>\n                      {tab.count > 99 ? '99+' : tab.count}\n                    </span>\n                  )}\n                </button>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Tab Content */}\n      <div>\n        {children}\n      </div>\n    </div>\n  );\n};\n\nexport default PredictionDetailsTabs;","import React, { useState } from 'react';\nimport { Send } from 'lucide-react';\nimport { useAuthSession } from '../../providers/AuthSessionProvider';\nimport { openAuthGate } from '../../auth/authGateAdapter';\n\ninterface CommentInputProps {\n  onSubmit: (text: string) => Promise<void>;\n  isPosting: boolean;\n  placeholder?: string;\n}\n\nexport const CommentInput: React.FC<CommentInputProps> = ({\n  onSubmit,\n  isPosting,\n  placeholder = \"Share your thoughts...\"\n}) => {\n  const [text, setText] = useState('');\n  const { user } = useAuthSession();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!text.trim() || isPosting) return;\n    \n    if (!user) {\n      openAuthGate({ intent: 'comment_prediction' });\n      return;\n    }\n\n    try {\n      await onSubmit(text.trim());\n      setText('');\n    } catch (error) {\n      // Error handling done at parent level\n    }\n  };\n\n  if (!user) {\n    return (\n      <div className=\"p-4 border rounded-lg bg-gray-50\">\n        <button\n          onClick={() => openAuthGate({ intent: 'comment_prediction' })}\n          className=\"text-blue-600 hover:text-blue-700 text-sm font-medium\"\n        >\n          Sign in to comment\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-3\">\n      <div className=\"relative\">\n        <textarea\n          value={text}\n          onChange={(e) => setText(e.target.value)}\n          placeholder={placeholder}\n          disabled={isPosting}\n          rows={3}\n          className=\"w-full p-3 border rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed\"\n          maxLength={1000}\n        />\n        <div className=\"absolute bottom-2 right-2 text-xs text-gray-500\">\n          {text.length}/1000\n        </div>\n      </div>\n      \n      <div className=\"flex justify-between items-center\">\n        <div className=\"text-xs text-gray-500\">\n          Commenting as {user.user_metadata?.username || user.email}\n        </div>\n        <button\n          type=\"submit\"\n          disabled={!text.trim() || isPosting}\n          className=\"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n        >\n          <Send className=\"w-4 h-4\" />\n          {isPosting ? 'Posting...' : 'Post'}\n        </button>\n      </div>\n    </form>\n  );\n};\n","import React from 'react';\nimport { Heart, Clock } from 'lucide-react';\nimport { Comment } from '../../store/unifiedCommentStore';\nimport { formatDistanceToNow } from 'date-fns';\n\ninterface CommentItemProps {\n  comment: Comment;\n  onToggleLike?: (commentId: string) => void;\n}\n\nexport const CommentItem: React.FC<CommentItemProps> = ({\n  comment,\n  onToggleLike\n}) => {\n  const handleLikeClick = () => {\n    if (onToggleLike) {\n      onToggleLike(comment.id);\n    }\n  };\n\n  const likeCount = comment.likes_count || comment.likeCount || 0;\n  const isLiked = comment.is_liked || comment.likedByMe || false;\n  const createdAt = comment.created_at || comment.createdAt;\n  const content = comment.content || comment.text;\n  const username = comment.user?.username || 'Anonymous';\n  const avatarUrl = comment.user?.avatar_url || comment.user?.avatarUrl;\n\n  return (\n    <div className=\"border-b border-gray-100 pb-4 last:border-b-0\">\n      <div className=\"flex gap-3\">\n        {/* Avatar */}\n        <div className=\"flex-shrink-0\">\n          {avatarUrl ? (\n            <img\n              src={avatarUrl}\n              alt={username}\n              className=\"w-8 h-8 rounded-full object-cover\"\n            />\n          ) : (\n            <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center\">\n              <span className=\"text-sm font-medium text-gray-600\">\n                {username.charAt(0).toUpperCase()}\n              </span>\n            </div>\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          {/* Header */}\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"font-medium text-sm text-gray-900\">\n              {username}\n            </span>\n            {comment.user?.is_verified && (\n              <div className=\"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center\">\n                <span className=\"text-white text-xs\">✓</span>\n              </div>\n            )}\n            <div className=\"flex items-center gap-1 text-xs text-gray-500\">\n              <Clock className=\"w-3 h-3\" />\n              {formatDistanceToNow(new Date(createdAt), { addSuffix: true })}\n            </div>\n          </div>\n\n          {/* Comment text */}\n          <div className=\"text-sm text-gray-900 leading-relaxed mb-2\">\n            {content}\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex items-center gap-4\">\n            <button\n              onClick={handleLikeClick}\n              className={`flex items-center gap-1 text-xs transition-colors ${\n                isLiked \n                  ? 'text-red-600 hover:text-red-700' \n                  : 'text-gray-500 hover:text-red-600'\n              }`}\n            >\n              <Heart \n                className={`w-4 h-4 ${isLiked ? 'fill-current' : ''}`} \n              />\n              {likeCount > 0 && (\n                <span>{likeCount}</span>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n","import React from 'react';\n\ninterface CommentListSkeletonProps {\n  count?: number;\n}\n\nexport const CommentListSkeleton: React.FC<CommentListSkeletonProps> = ({ \n  count = 3 \n}) => {\n  return (\n    <div className=\"space-y-4\">\n      {Array.from({ length: count }).map((_, index) => (\n        <div key={index} className=\"animate-pulse\">\n          <div className=\"flex gap-3\">\n            {/* Avatar skeleton */}\n            <div className=\"w-8 h-8 bg-gray-200 rounded-full flex-shrink-0\"></div>\n            \n            {/* Content skeleton */}\n            <div className=\"flex-1 space-y-2\">\n              {/* Header skeleton */}\n              <div className=\"flex items-center gap-2\">\n                <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                <div className=\"h-3 bg-gray-200 rounded w-16\"></div>\n              </div>\n              \n              {/* Comment text skeleton */}\n              <div className=\"space-y-1\">\n                <div className=\"h-4 bg-gray-200 rounded w-full\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n              </div>\n              \n              {/* Actions skeleton */}\n              <div className=\"h-3 bg-gray-200 rounded w-12\"></div>\n            </div>\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n};\n","import React from 'react';\nimport { Comment } from '../../store/unifiedCommentStore';\nimport { CommentItem } from './CommentItem';\nimport { CommentListSkeleton } from './CommentListSkeleton';\n\ninterface CommentListProps {\n  comments: Comment[];\n  isLoading: boolean;\n  hasMore: boolean;\n  onLoadMore?: () => void;\n  onToggleLike?: (commentId: string) => void;\n}\n\nexport const CommentList: React.FC<CommentListProps> = ({\n  comments,\n  isLoading,\n  hasMore,\n  onLoadMore,\n  onToggleLike\n}) => {\n  if (isLoading && comments.length === 0) {\n    return <CommentListSkeleton count={3} />;\n  }\n\n  if (comments.length === 0) {\n    return (\n      <div className=\"text-center py-8 text-gray-500\">\n        <div className=\"text-lg mb-2\">No comments yet</div>\n        <div className=\"text-sm\">Be the first to share your thoughts!</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4\">\n      {comments.map((comment) => (\n        <CommentItem\n          key={comment.id}\n          comment={comment}\n          onToggleLike={onToggleLike}\n        />\n      ))}\n      \n      {hasMore && (\n        <div className=\"text-center\">\n          <button\n            onClick={onLoadMore}\n            disabled={isLoading}\n            className=\"px-6 py-2 text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            {isLoading ? 'Loading...' : 'Load more comments'}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n","import React, { useEffect } from 'react';\nimport { MessageSquare } from 'lucide-react';\nimport { useUnifiedCommentStore } from '../../store/unifiedCommentStore';\nimport { CommentInput } from './CommentInput';\nimport { CommentList } from './CommentList';\nimport toast from 'react-hot-toast';\n\ninterface CommentsSectionProps {\n  predictionId: string;\n  className?: string;\n}\n\nexport const CommentsSection: React.FC<CommentsSectionProps> = ({\n  predictionId,\n  className = ''\n}) => {\n  const {\n    getComments,\n    getCommentCount,\n    getStatus,\n    isPosting: isPostingFn,\n    hasMore: hasMoreFn,\n    fetchComments,\n    loadMore,\n    addComment,\n  } = useUnifiedCommentStore();\n\n  const predictionComments = getComments(predictionId);\n  const predictionStatus = getStatus(predictionId);\n  const predictionPosting = isPostingFn(predictionId);\n  const predictionHasMore = hasMoreFn(predictionId);\n\n  // Initialize comments on mount\n  useEffect(() => {\n    if (predictionStatus === 'idle') {\n      fetchComments(predictionId).catch((error) => {\n        // Only toast for 5xx errors, not 404s (empty threads are valid)\n        if (error?.status >= 500) {\n          toast.error('Failed to load comments. Please try again.');\n        }\n      });\n    }\n  }, [predictionId, predictionStatus, fetchComments]);\n\n  // Handle adding new comments\n  const handleAddComment = async (text: string) => {\n    try {\n      await addComment(predictionId, text);\n    } catch (error: any) {\n      // Toast for user-initiated errors only\n      const message = error?.message || 'Failed to post comment';\n      toast.error(message);\n      throw error; // Re-throw so CommentInput can handle UI state\n    }\n  };\n\n  // Handle like toggle\n  const handleToggleLike = async (commentId: string) => {\n    try {\n      // TODO: Implement toggleCommentLike when like functionality is ready\n      toast.success('Like feature coming soon!');\n    } catch (error: any) {\n      if (error?.status >= 500) {\n        toast.error('Failed to update like. Please try again.');\n      }\n    }\n  };\n\n  // Handle load more\n  const handleLoadMore = async () => {\n    try {\n      await loadMore(predictionId);\n    } catch (error: any) {\n      if (error?.status >= 500) {\n        toast.error('Failed to load more comments. Please try again.');\n      }\n    }\n  };\n\n  const isLoading = predictionStatus === 'loading' || predictionStatus === 'paginating';\n  const showCount = getCommentCount(predictionId);\n\n  return (\n    <div className={`bg-white rounded-lg ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center gap-2 p-4 border-b border-gray-100\">\n        <MessageSquare className=\"w-5 h-5 text-gray-600\" />\n        <h3 className=\"font-medium text-gray-900\">\n          Comments {showCount > 0 && `(${showCount})`}\n        </h3>\n      </div>\n\n      {/* Content */}\n      <div className=\"p-4 space-y-6\">\n        {/* Comment Input */}\n        <CommentInput\n          onSubmit={handleAddComment}\n          isPosting={predictionPosting}\n        />\n\n        {/* Comments List */}\n        <CommentList\n          comments={predictionComments}\n          isLoading={isLoading}\n          hasMore={predictionHasMore}\n          onLoadMore={handleLoadMore}\n          onToggleLike={handleToggleLike}\n        />\n      </div>\n    </div>\n  );\n};\n","import React from 'react';\nimport { motion } from 'framer-motion';\nimport { Loader2 } from 'lucide-react';\n\ninterface LoadingStateProps {\n  message?: string;\n  size?: 'sm' | 'md' | 'lg';\n  className?: string;\n  fullScreen?: boolean;\n}\n\nconst LoadingState: React.FC<LoadingStateProps> = ({\n  message = 'Loading...',\n  size = 'md',\n  className = '',\n  fullScreen = false,\n}) => {\n  const getSizeClasses = () => {\n    switch (size) {\n      case 'sm':\n        return {\n          spinner: 'h-4 w-4',\n          text: 'text-sm',\n          container: 'py-4',\n        };\n      case 'lg':\n        return {\n          spinner: 'h-8 w-8',\n          text: 'text-lg',\n          container: 'py-8',\n        };\n      case 'md':\n      default:\n        return {\n          spinner: 'h-6 w-6',\n          text: 'text-base',\n          container: 'py-6',\n        };\n    }\n  };\n\n  const sizeClasses = getSizeClasses();\n\n  const content = (\n    <div className={`flex flex-col items-center justify-center ${sizeClasses.container} ${className}`}>\n      <motion.div\n        animate={{ rotate: 360 }}\n        transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}\n        className={`${sizeClasses.spinner} text-emerald-500`}\n      >\n        <Loader2 className=\"h-full w-full\" />\n      </motion.div>\n      {message && (\n        <p className={`mt-3 text-gray-600 ${sizeClasses.text}`}>\n          {message}\n        </p>\n      )}\n    </div>\n  );\n\n  if (fullScreen) {\n    return (\n      <div className=\"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50\">\n        {content}\n      </div>\n    );\n  }\n\n  return content;\n};\n\nexport default LoadingState;\n","import React from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { AlertCircle, RefreshCw, X } from 'lucide-react';\n\ninterface ErrorBannerProps {\n  error: string;\n  onRetry?: () => void;\n  onDismiss?: () => void;\n  type?: 'error' | 'warning' | 'info';\n  showRetry?: boolean;\n  showDismiss?: boolean;\n  className?: string;\n}\n\nconst ErrorBanner: React.FC<ErrorBannerProps> = ({\n  error,\n  onRetry,\n  onDismiss,\n  type = 'error',\n  showRetry = true,\n  showDismiss = false,\n  className = '',\n}) => {\n  const getTypeStyles = () => {\n    switch (type) {\n      case 'warning':\n        return {\n          bg: 'bg-yellow-50',\n          border: 'border-yellow-200',\n          text: 'text-yellow-800',\n          icon: 'text-yellow-600',\n        };\n      case 'info':\n        return {\n          bg: 'bg-blue-50',\n          border: 'border-blue-200',\n          text: 'text-blue-800',\n          icon: 'text-blue-600',\n        };\n      case 'error':\n      default:\n        return {\n          bg: 'bg-red-50',\n          border: 'border-red-200',\n          text: 'text-red-800',\n          icon: 'text-red-600',\n        };\n    }\n  };\n\n  const styles = getTypeStyles();\n\n  return (\n    <AnimatePresence>\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        exit={{ opacity: 0, y: -20 }}\n        transition={{ duration: 0.2 }}\n        className={`rounded-lg border p-4 ${styles.bg} ${styles.border} ${className}`}\n        role=\"alert\"\n        aria-live=\"polite\"\n      >\n        <div className=\"flex items-start\">\n          <div className=\"flex-shrink-0\">\n            <AlertCircle className={`h-5 w-5 ${styles.icon}`} />\n          </div>\n          <div className=\"ml-3 flex-1\">\n            <p className={`text-sm font-medium ${styles.text}`}>\n              {error}\n            </p>\n          </div>\n          <div className=\"ml-3 flex space-x-2\">\n            {showRetry && onRetry && (\n              <button\n                onClick={onRetry}\n                className={`inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors ${styles.text} hover:bg-white/50`}\n                aria-label=\"Retry\"\n              >\n                <RefreshCw className=\"h-3 w-3\" />\n                Retry\n              </button>\n            )}\n            {showDismiss && onDismiss && (\n              <button\n                onClick={onDismiss}\n                className={`inline-flex items-center rounded-md p-1 transition-colors ${styles.text} hover:bg-white/50`}\n                aria-label=\"Dismiss\"\n              >\n                <X className=\"h-4 w-4\" />\n              </button>\n            )}\n          </div>\n        </div>\n      </motion.div>\n    </AnimatePresence>\n  );\n};\n\nexport default ErrorBanner;\n","import React from 'react';\nimport { motion } from 'framer-motion';\nimport { LucideIcon } from 'lucide-react';\n\ninterface EmptyStateProps {\n  icon?: LucideIcon;\n  title: string;\n  description?: string;\n  action?: {\n    label: string;\n    onClick: () => void;\n  };\n  className?: string;\n}\n\nconst EmptyState: React.FC<EmptyStateProps> = ({\n  icon: Icon,\n  title,\n  description,\n  action,\n  className = '',\n}) => {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3 }}\n      className={`flex flex-col items-center justify-center py-12 px-6 text-center ${className}`}\n    >\n      {Icon && (\n        <div className=\"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n          <Icon className=\"w-8 h-8 text-gray-400\" />\n        </div>\n      )}\n      <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n        {title}\n      </h3>\n      {description && (\n        <p className=\"text-gray-600 mb-6 max-w-sm\">\n          {description}\n        </p>\n      )}\n      {action && (\n        <motion.button\n          className=\"bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-lg font-medium transition-colors\"\n          onClick={action.onClick}\n          whileHover={{ scale: 1.02 }}\n          whileTap={{ scale: 0.98 }}\n        >\n          {action.label}\n        </motion.button>\n      )}\n    </motion.div>\n  );\n};\n\nexport default EmptyState;\n","import React from 'react';\nimport { motion } from 'framer-motion';\nimport { \n  MessageCircle, \n  DollarSign, \n  Heart, \n  TrendingUp, \n  Clock, \n  User,\n  Loader2,\n  RefreshCw\n} from 'lucide-react';\nimport { useActivityFeed, ActivityItem } from '../../hooks/useActivityFeed';\nimport { formatCurrency, formatTimeAgo } from '@/lib/format';\nimport { t } from '@/lib/lexicon';\n\ninterface ActivityFeedProps {\n  predictionId: string;\n  className?: string;\n}\n\ninterface ActivityItemComponentProps {\n  item: ActivityItem;\n}\n\n/**\n * Individual activity item component\n */\nfunction ActivityItemComponent({ item }: ActivityItemComponentProps) {\n  const getActivityIcon = (type: string) => {\n    if (type.startsWith('comment')) return MessageCircle;\n    if (type.startsWith('entry')) return DollarSign;\n    if (type.startsWith('reaction')) return Heart;\n    if (type.startsWith('prediction')) return TrendingUp;\n    return Clock;\n  };\n\n  const getActivityMessage = (item: ActivityItem) => {\n    const { type, actor, data } = item;\n    const actorName = actor?.full_name || actor?.username || 'Anonymous';\n    \n    switch (type) {\n      case 'comment':\n        return {\n          message: `${actorName} commented`,\n          details: data.content ? data.content.substring(0, 100) + (data.content.length > 100 ? '...' : '') : '',\n          icon: MessageCircle\n        };\n      \n      case 'entry.create':\n        return {\n          message: `${actorName} locked a ${t('bet')}`,\n          details: `${formatCurrency(data.amount, { compact: true })}${data.option_label ? ` on ${data.option_label}` : ''}`,\n          icon: DollarSign\n        };\n      \n      case 'reaction.like':\n        return {\n          message: `${actorName} liked this prediction`,\n          details: '',\n          icon: Heart\n        };\n      \n      case 'prediction.open':\n        return {\n          message: `Prediction is now open for ${t('betting')}`,\n          details: '',\n          icon: TrendingUp\n        };\n      \n      case 'prediction.settled':\n        return {\n          message: 'Prediction has been settled',\n          details: data.settled_outcome_id ? 'Outcome determined' : '',\n          icon: TrendingUp\n        };\n      case 'wallet.unlock':\n        return {\n          message: 'Escrow funds released',\n          details: data.amount ? formatCurrency(data.amount, { compact: true }) : '',\n          icon: DollarSign,\n        };\n      case 'wallet.payout':\n        return {\n          message: 'Settlement payout received',\n          details: data.amount ? `${formatCurrency(data.amount, { compact: true })}${data.prediction_title ? ` · ${data.prediction_title}` : ''}` : (data.prediction_title ?? ''),\n          icon: DollarSign,\n        };\n      case 'wallet.platform_fee':\n        return {\n          message: 'Platform fee credited',\n          details: data.amount ? formatCurrency(data.amount, { compact: true }) : '',\n          icon: DollarSign,\n        };\n      case 'wallet.creator_fee':\n        return {\n          message: 'Creator earnings received',\n          details: data.amount ? `${formatCurrency(data.amount, { compact: true })}${data.prediction_title ? ` · ${data.prediction_title}` : ''}` : (data.prediction_title ?? ''),\n          icon: DollarSign,\n        };\n      default:\n        return {\n          message: 'Activity occurred',\n          details: '',\n          icon: Clock\n        };\n    }\n  };\n\n  const activity = getActivityMessage(item);\n  const Icon = activity.icon;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"flex items-start gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors\"\n    >\n      {/* Avatar */}\n      <div className=\"flex-shrink-0\">\n        {item.actor?.avatar_url ? (\n          <img\n            src={item.actor.avatar_url}\n            alt={item.actor.full_name || item.actor.username || 'User'}\n            className=\"w-8 h-8 rounded-full object-cover\"\n          />\n        ) : (\n          <div className=\"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center\">\n            <User className=\"w-4 h-4 text-gray-500\" />\n          </div>\n        )}\n      </div>\n\n      {/* Content */}\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center gap-2\">\n          <Icon className=\"w-4 h-4 text-gray-500 flex-shrink-0\" />\n          <p className=\"text-sm font-medium text-gray-900 truncate\">\n            {activity.message}\n          </p>\n        </div>\n        \n        {activity.details && (\n          <p className=\"text-sm text-gray-600 mt-1 line-clamp-2\">\n            {activity.details}\n          </p>\n        )}\n        \n        <div className=\"flex items-center gap-2 mt-1\">\n          <span className=\"text-xs text-gray-500\">\n            {formatTimeAgo(item.timestamp)}\n          </span>\n          {item.actor?.is_verified && (\n            <span className=\"text-xs text-emerald-600 font-medium\">✓ Verified</span>\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n/**\n * Main activity feed component\n */\nexport function ActivityFeed({ predictionId, className = '' }: ActivityFeedProps) {\n  const { items, loading, error, hasMore, loadMore, refresh } = useActivityFeed({\n    predictionId,\n    limit: 25,\n    autoLoad: true\n  });\n\n  if (error) {\n    return (\n      <div className={`bg-white rounded-2xl p-4 shadow-sm border ${className}`}>\n        <div className=\"text-center py-6\">\n          <div className=\"text-red-500 mb-2\">⚠️</div>\n          <p className=\"text-sm text-gray-600 mb-3\">Failed to load activity feed</p>\n          <button\n            onClick={refresh}\n            className=\"text-sm text-emerald-600 hover:text-emerald-700 font-medium\"\n          >\n            Try again\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (loading && items.length === 0) {\n    return (\n      <div className={`bg-white rounded-2xl p-4 shadow-sm border ${className}`}>\n        <div className=\"text-center py-6\">\n          <Loader2 className=\"w-6 h-6 animate-spin mx-auto mb-2 text-gray-400\" />\n          <p className=\"text-sm text-gray-600\">Loading activity...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (items.length === 0) {\n    return (\n      <div className={`bg-white rounded-2xl p-4 shadow-sm border ${className}`}>\n        <div className=\"text-center py-6\">\n          <Clock className=\"w-8 h-8 mx-auto mb-2 text-gray-300\" />\n          <p className=\"text-sm text-gray-600\">No activity yet</p>\n          <p className=\"text-xs text-gray-500 mt-1\">\n            Be the first to comment or lock a {t('bet')}!\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={`bg-white rounded-2xl shadow-sm border ${className}`}>\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-4 border-b border-gray-100\">\n        <h3 className=\"text-base font-semibold text-gray-900\">Recent Activity</h3>\n        <button\n          onClick={refresh}\n          disabled={loading}\n          className=\"p-1 text-gray-400 hover:text-gray-600 transition-colors\"\n          title=\"Refresh\"\n        >\n          <RefreshCw className={`w-4 h-4 ${loading ? 'animate-spin' : ''}`} />\n        </button>\n      </div>\n\n      {/* Activity List */}\n      <div className=\"divide-y divide-gray-100\">\n        {items.map((item) => (\n          <ActivityItemComponent key={item.id} item={item} />\n        ))}\n      </div>\n\n      {/* Load More Button */}\n      {hasMore && (\n        <div className=\"p-4 border-t border-gray-100\">\n          <button\n            onClick={loadMore}\n            disabled={loading}\n            className=\"w-full py-2 text-sm text-emerald-600 hover:text-emerald-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n          >\n            {loading ? (\n              <div className=\"flex items-center justify-center gap-2\">\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                Loading more...\n              </div>\n            ) : (\n              'Load more activity'\n            )}\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ActivityFeed;\n","import React from 'react';\nimport { LogIn } from 'lucide-react';\nimport { t } from '@/lib/lexicon';\n\ninterface SignInCalloutProps {\n  onSignIn: () => void;\n  title?: string;\n  description?: string;\n}\n\n/**\n * Compact, on-brand sign-in CTA\n * Replaces large full-width cards with a tight, actionable prompt\n */\nexport default function SignInCallout({ \n  onSignIn,\n  title = `Sign in to ${t('betVerb').toLowerCase()}`,\n  description = `Create an account or sign in to ${t('bet')}.`\n}: SignInCalloutProps) {\n  return (\n    <div className=\"rounded-2xl border shadow-sm bg-white p-4 flex items-center justify-between gap-3\">\n      <div className=\"flex items-start gap-3 flex-1 min-w-0\">\n        <div className=\"shrink-0 rounded-xl bg-emerald-50 p-2\">\n          <LogIn className=\"h-5 w-5 text-emerald-600\" />\n        </div>\n        <div className=\"min-w-0 flex-1\">\n          <p className=\"font-semibold text-gray-900\">{title}</p>\n          <p className=\"text-sm text-gray-600 mt-0.5\">\n            {description}\n          </p>\n        </div>\n      </div>\n      <button\n        onClick={onSignIn}\n        className=\"shrink-0 rounded-xl h-10 px-4 bg-emerald-600 text-white font-medium shadow hover:bg-emerald-700 active:bg-emerald-800 transition-colors\"\n      >\n        Sign In\n      </button>\n    </div>\n  );\n}\n\n","import React from 'react';\nimport CreatorByline from './CreatorByline';\nimport type { CreatorInfo } from './CreatorByline';\n\ninterface TitleAndMetaProps {\n  title: string;\n  creator?: CreatorInfo;\n  className?: string;\n}\n\n/**\n * Compact title and creator display\n * Replaces large heading blocks with tight, predictable spacing\n */\nexport function TitleAndMeta({ title, creator, className = '' }: TitleAndMetaProps) {\n  return (\n    <header className={`space-y-2 ${className}`}>\n      <h1 className=\"text-2xl font-bold leading-snug text-gray-900\">\n        {title}\n      </h1>\n      <CreatorByline creator={creator} />\n    </header>\n  );\n}\n\n","import React from 'react';\nimport { TrendingUp } from 'lucide-react';\n\nexport interface PredictionOption {\n  id: string;\n  label: string;\n  current_odds?: number;\n  odds?: number;\n  total_staked?: number;\n  totalStaked?: number;\n  percentage?: number;\n}\n\ninterface OptionsSectionProps {\n  options: PredictionOption[];\n  selectedId?: string;\n  onSelect: (id: string) => void;\n  disabled?: boolean;\n  winningOptionId?: string;\n  showWinningIndicator?: boolean;\n}\n\n/**\n * Compact options list without excessive padding\n * Shows options with odds in a tight, scannable format\n */\nexport function OptionsSection({ \n  options, \n  selectedId, \n  onSelect, \n  disabled = false,\n  winningOptionId,\n  showWinningIndicator = false,\n}: OptionsSectionProps) {\n  return (\n    <section className=\"rounded-2xl bg-white border shadow-sm overflow-hidden\">\n      <ul className=\"divide-y divide-gray-100\">\n        {options.map((option) => {\n          const odds = option.current_odds ?? option.odds ?? 1.0;\n          const isSelected = selectedId === option.id;\n          const percentage = option.percentage ?? 0;\n          const isWinning = showWinningIndicator && winningOptionId && option.id === winningOptionId;\n          \n          return (\n            <li key={option.id}>\n              <button\n                onClick={() => !disabled && onSelect(option.id)}\n                disabled={disabled}\n                className={`w-full flex items-center justify-between px-4 py-3 text-left transition-colors ${\n                  isSelected\n                    ? 'bg-emerald-50 border-l-2 border-l-emerald-600'\n                    : isWinning\n                      ? 'bg-emerald-50/40 hover:bg-emerald-50/60'\n                      : 'hover:bg-gray-50'\n                } disabled:opacity-50 disabled:cursor-not-allowed`}\n              >\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"font-medium text-gray-900\">{option.label}</span>\n                    {isWinning && (\n                      <span className=\"inline-flex items-center rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] font-semibold text-emerald-800\">\n                        Winner\n                      </span>\n                    )}\n                  </div>\n                  {percentage > 0 && (\n                    <div className=\"flex items-center gap-1 mt-1 text-xs text-gray-500\">\n                      <TrendingUp className=\"h-3 w-3\" />\n                      <span>{percentage.toFixed(0)}% of pool</span>\n                    </div>\n                  )}\n                </div>\n                <span className=\"text-emerald-600 font-semibold ml-3\">\n                  {odds.toFixed(2)}x\n                </span>\n              </button>\n            </li>\n          );\n        })}\n      </ul>\n    </section>\n  );\n}\n\n","import React from 'react';\nimport { Loader2 } from 'lucide-react';\nimport { t } from '@/lib/lexicon';\n\ninterface StickyBetBarProps {\n  canBet: boolean;\n  onPlace: () => void;\n  loading?: boolean;\n  label?: string;\n}\n\n/**\n * Fixed bet bar that sits above the bottom navigation\n * Uses CSS variable --bottom-nav-h for proper spacing\n * Safe-area aware for devices with notches\n */\nexport function StickyBetBar({ \n  canBet, \n  onPlace, \n  loading = false,\n  label = t('betVerb')\n}: StickyBetBarProps) {\n  return (\n    <div\n      className=\"fixed inset-x-0 z-50 px-4 pb-[calc(env(safe-area-inset-bottom))] pointer-events-none\"\n      style={{ bottom: 'calc(var(--bottom-nav-h, 64px) + 16px)' }}\n    >\n      <div className=\"pointer-events-auto mx-auto max-w-screen-sm\">\n        <button\n          disabled={!canBet || loading}\n          onClick={onPlace}\n          className=\"w-full h-12 rounded-2xl bg-emerald-600 text-white font-semibold shadow-lg hover:bg-emerald-700 active:bg-emerald-800 disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center justify-center gap-2\"\n        >\n          {loading && <Loader2 className=\"h-5 w-5 animate-spin\" />}\n          <span>{loading ? `${t('betVerb')}…` : label}</span>\n        </button>\n      </div>\n    </div>\n  );\n}\n\n","import React, { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { X, CheckCircle, AlertTriangle, DollarSign, Users, Clock } from 'lucide-react';\nimport { getApiUrl } from '../../config';\nimport { useAuthStore } from '../../store/authStore';\nimport { useAuthSession } from '../../providers/AuthSessionProvider';\nimport { toast } from 'react-hot-toast';\nimport { adminPost } from '@/lib/adminApi';\n\ninterface SettlementValidationModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  predictionId: string;\n  predictionTitle: string;\n  onValidated?: () => void;\n}\n\ninterface SettlementStatus {\n  prediction: {\n    id: string;\n    title: string;\n    status: string;\n    pool_total: number;\n    creator_id?: string;\n  };\n  userEntry: {\n    id: string;\n    option_id: string;\n    amount: number;\n    status: string;\n    actual_payout: number;\n    provider?: string | null;\n  };\n  settlement: {\n    winning_option_id: string;\n    total_payout: number;\n    settlement_time: string;\n  } | null;\n  canValidate: boolean;\n  needsSettlement: boolean;\n}\n\ntype FinalizeJobStatus = 'queued' | 'running' | 'finalized' | 'failed';\ntype FinalizeStatusResponse = {\n  success: boolean;\n  data: {\n    status: FinalizeJobStatus | null;\n    txHash: string | null;\n    error: string | null;\n    job: any | null;\n  };\n};\n\nconst SettlementValidationModal: React.FC<SettlementValidationModalProps> = ({\n  isOpen,\n  onClose,\n  predictionId,\n  predictionTitle,\n  onValidated,\n}) => {\n  const [settlementStatus, setSettlementStatus] = useState<SettlementStatus | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [validating, setValidating] = useState(false);\n  const [disputeReason, setDisputeReason] = useState('');\n  const [showDisputeForm, setShowDisputeForm] = useState(false);\n  const [statusError, setStatusError] = useState<string | null>(null);\n  const [history, setHistory] = useState<null | { items: any[]; summary: { accepts: number; disputes: number; pendingDisputes: number; lastActionAt: string | null } }>(null);\n  const [historyLoading, setHistoryLoading] = useState(false);\n  const [historyError, setHistoryError] = useState<string | null>(null);\n  const [finalizeStatus, setFinalizeStatus] = useState<FinalizeStatusResponse['data'] | null>(null);\n  const [finalizeLoading, setFinalizeLoading] = useState(false);\n  const [finalizeSubmitting, setFinalizeSubmitting] = useState(false);\n  const { user } = useAuthStore();\n  const { user: sessionUser } = useAuthSession();\n  const userId = sessionUser?.id || user?.id;\n\n  const parseApiErrorMessage = async (res: Response, fallback: string) => {\n    // Prefer structured JSON errors; never surface raw JSON to end users.\n    const ct = res.headers.get('content-type') || '';\n    if (ct.includes('application/json')) {\n      const json = await res.json().catch(() => null);\n      const msg =\n        (json && typeof json === 'object' && (json as any).message && String((json as any).message)) ||\n        (json && typeof json === 'object' && (json as any).error && String((json as any).error)) ||\n        null;\n      return msg || fallback;\n    }\n    const txt = await res.text().catch(() => '');\n    // If server sent JSON as text, don't show it.\n    if (txt.trim().startsWith('{') && txt.trim().endsWith('}')) return fallback;\n    return txt || fallback;\n  };\n\n  useEffect(() => {\n    if (isOpen && userId) {\n      fetchSettlementStatus();\n      fetchHistory();\n      fetchFinalizeStatus();\n    }\n  }, [isOpen, userId, predictionId]);\n\n  const fetchSettlementStatus = async () => {\n    try {\n      setLoading(true);\n      setStatusError(null);\n      const response = await fetch(\n        `${getApiUrl()}/api/v2/settlement/${predictionId}/status?userId=${userId}`,\n        {\n          method: 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n\n      if (response.status === 403) {\n        setSettlementStatus(null);\n        setStatusError('You are not a participant in this prediction, so you cannot validate this settlement.');\n        return;\n      }\n\n      if (!response.ok) {\n        const message = await parseApiErrorMessage(response, 'Failed to load settlement status.');\n        throw new Error(message);\n      }\n\n      const data = await response.json();\n      setSettlementStatus(data.data);\n    } catch (error) {\n      console.error('Error fetching settlement status:', error);\n      const message = error instanceof Error ? error.message : 'Failed to load settlement information';\n      setSettlementStatus(null);\n      setStatusError(message);\n      toast.error(message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const fetchHistory = async () => {\n    try {\n      setHistoryLoading(true);\n      setHistoryError(null);\n      const response = await fetch(\n        `${getApiUrl()}/api/v2/settlement/${predictionId}/history?userId=${userId}`,\n        {\n          method: 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n\n      if (response.status === 403) {\n        setHistory(null);\n        setHistoryError('Only participants can view settlement history.');\n        return;\n      }\n\n      if (!response.ok) {\n        // Keep user-facing messaging friendly (no raw JSON)\n        const message = await parseApiErrorMessage(response, 'We couldn’t load settlement history right now. Please try again.');\n        throw new Error(message);\n      }\n\n      const data = await response.json();\n      setHistory(data.data || null);\n    } catch (error) {\n      console.error('Error fetching settlement history:', error);\n      const message =\n        error instanceof Error\n          ? error.message\n          : 'We couldn’t load settlement history right now. Please try again.';\n      setHistory(null);\n      setHistoryError(message);\n    } finally {\n      setHistoryLoading(false);\n    }\n  };\n\n  const fetchFinalizeStatus = async () => {\n    if (!userId) return;\n    try {\n      setFinalizeLoading(true);\n      const res = await fetch(`${getApiUrl()}/api/v2/settlement/${predictionId}/finalize/status?userId=${userId}`, {\n        method: 'GET',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      if (!res.ok) {\n        const txt = await res.text().catch(() => '');\n        throw new Error(txt || 'Failed to load finalization status');\n      }\n      const data: FinalizeStatusResponse = await res.json();\n      setFinalizeStatus(data.data);\n    } catch (e) {\n      console.warn('Error fetching finalization status:', e);\n      setFinalizeStatus(null);\n    } finally {\n      setFinalizeLoading(false);\n    }\n  };\n\n  const handleRequestFinalize = async () => {\n    if (!userId) return;\n    try {\n      setFinalizeSubmitting(true);\n      const res = await fetch(`${getApiUrl()}/api/v2/settlement/${predictionId}/request-finalize`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId }),\n      });\n      if (!res.ok) {\n        const txt = await res.text().catch(() => '');\n        throw new Error(txt || 'Failed to request finalization');\n      }\n      toast.success('Submitted. Admin will finalize on-chain.');\n      await fetchFinalizeStatus();\n    } catch (e: any) {\n      toast.error(e?.message || 'Failed to submit for finalization');\n    } finally {\n      setFinalizeSubmitting(false);\n    }\n  };\n\n  const handleAdminFinalize = async () => {\n    if (!userId) return;\n    try {\n      setFinalizeSubmitting(true);\n      let adminKey = localStorage.getItem('fcz_admin_key') || '';\n      if (!adminKey) {\n        const entered = window.prompt('Enter admin key');\n        if (!entered) {\n          setFinalizeSubmitting(false);\n          return;\n        }\n        adminKey = entered.trim();\n        localStorage.setItem('fcz_admin_key', adminKey);\n      }\n\n      await adminPost<any>(`/api/v2/admin/settlement/${predictionId}/finalize`, userId, { adminKey });\n      toast.success('Finalized on-chain.');\n      await Promise.all([fetchFinalizeStatus(), fetchSettlementStatus()]);\n      onValidated?.();\n    } catch (e: any) {\n      toast.error(e?.message || 'Finalization failed, admin retry required.');\n      await fetchFinalizeStatus();\n    } finally {\n      setFinalizeSubmitting(false);\n    }\n  };\n\n  const handleValidation = async (action: 'accept' | 'dispute') => {\n    try {\n      setValidating(true);\n      \n      const response = await fetch(\n        `${getApiUrl()}/api/v2/settlement/${predictionId}/validate`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n          body: JSON.stringify({\n            userId,\n            action,\n            reason: action === 'dispute' ? disputeReason : undefined\n          }),\n        }\n      );\n\n      if (!response.ok) {\n        const message = await response.text().catch(() => '');\n        throw new Error(message || `Failed to ${action} settlement`);\n      }\n\n      toast.success(\n        action === 'accept' \n          ? 'Settlement accepted successfully!' \n          : 'Dispute submitted successfully!'\n      );\n\n      // Refresh modal state (status + timeline) so changes reflect immediately\n      await Promise.all([fetchSettlementStatus(), fetchHistory()]);\n\n      onValidated?.();\n      onClose();\n    } catch (error) {\n      console.error(`Error ${action}ing settlement:`, error);\n      const message = error instanceof Error ? error.message : `Failed to ${action} settlement`;\n      toast.error(message);\n    } finally {\n      setValidating(false);\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <AnimatePresence>\n      {/* z-[9000] keeps bottom nav (z-[9999]) visible + clickable */}\n      <div className=\"fixed inset-0 z-[9000]\" aria-modal=\"true\" role=\"dialog\">\n        {/* Backdrop (click to close) */}\n        <div\n          className=\"absolute inset-0 bg-black/40 backdrop-blur-sm\"\n          onClick={onClose}\n          aria-hidden=\"true\"\n        />\n\n        {/* Panel: pinned above bottom nav so nothing gets hidden behind it */}\n        <motion.div\n          initial={{ opacity: 0, scale: 0.98, y: 8 }}\n          animate={{ opacity: 1, scale: 1, y: 0 }}\n          exit={{ opacity: 0, scale: 0.98, y: 8 }}\n          transition={{ duration: 0.15 }}\n          onClick={(e) => e.stopPropagation()}\n          className={[\n            // mobile: bottom-sheet-like, but NOT covering bottom nav\n            'fixed left-4 right-4 top-4',\n            'bottom-[calc(4rem+env(safe-area-inset-bottom)+1rem)]',\n            // desktop: centered card\n            'md:left-1/2 md:right-auto md:top-1/2 md:bottom-auto md:w-full md:max-w-md md:-translate-x-1/2 md:-translate-y-1/2',\n            'bg-white rounded-2xl border border-black/[0.06] shadow-2xl overflow-hidden',\n          ].join(' ')}\n        >\n          {/* Header stays visible (no full-modal scrolling) */}\n          <div className=\"sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-black/[0.06] px-4 py-3 flex items-center justify-between\">\n            <h2 className=\"text-base font-semibold text-gray-900 truncate\">Settlement review</h2>\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"p-2 -mr-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2\"\n              aria-label=\"Close\"\n            >\n              <X className=\"w-5 h-5 text-gray-600\" />\n            </button>\n          </div>\n\n          {/* Scroll only the content area */}\n          <div className=\"px-4 py-4 overflow-y-auto h-full pb-[calc(1rem+env(safe-area-inset-bottom))]\">\n            {loading ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <div className=\"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin\" />\n              </div>\n            ) : statusError && !settlementStatus ? (\n              <div className=\"space-y-4\">\n                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n                  <p className=\"text-sm text-yellow-900\">{statusError}</p>\n                </div>\n                <button\n                  onClick={onClose}\n                  className=\"w-full px-4 py-2.5 rounded-xl border border-black/[0.06] bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors\"\n                >\n                  Close\n                </button>\n              </div>\n            ) : settlementStatus ? (\n              <div className=\"space-y-6\">\n                {/* Prediction Info */}\n                <div>\n                  <h3 className=\"font-medium text-gray-900 mb-2\">{predictionTitle}</h3>\n                  <div className=\"flex items-center gap-4 text-sm text-gray-600\">\n                    <div className=\"flex items-center gap-1\">\n                      <DollarSign className=\"w-4 h-4\" />\n                      <span>Pool: ${settlementStatus.prediction.pool_total.toLocaleString()}</span>\n                    </div>\n                    <div className=\"flex items-center gap-1\">\n                      <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                        settlementStatus.prediction.status === 'settled' \n                          ? 'bg-emerald-100 text-emerald-800'\n                          : settlementStatus.prediction.status === 'disputed'\n                          ? 'bg-red-100 text-red-800'\n                          : 'bg-yellow-100 text-yellow-800'\n                      }`}>\n                        {settlementStatus.prediction.status}\n                      </span>\n                    </div>\n                  </div>\n                </div>\n\n                {/* Your Entry */}\n                <div className=\"bg-gray-50 rounded-lg p-4\">\n                  <h4 className=\"font-medium text-gray-900 mb-2\">Your Entry</h4>\n                  <div className=\"space-y-2 text-sm\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Amount Staked:</span>\n                      <span className=\"font-medium\">${settlementStatus.userEntry.amount.toLocaleString()}</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-gray-600\">Status:</span>\n                      <span className={`font-medium ${\n                        settlementStatus.userEntry.status === 'won' ? 'text-emerald-600' :\n                        settlementStatus.userEntry.status === 'lost' ? 'text-red-600' :\n                        settlementStatus.userEntry.status === 'refunded' ? 'text-blue-600' :\n                        'text-yellow-600'\n                      }`}>\n                        {settlementStatus.userEntry.status}\n                      </span>\n                    </div>\n                    {settlementStatus.userEntry.actual_payout > 0 && (\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Payout:</span>\n                        <span className=\"font-medium text-emerald-600\">\n                          ${settlementStatus.userEntry.actual_payout.toLocaleString()}\n                        </span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Settlement Info */}\n                {settlementStatus.settlement ? (\n                  <div className=\"bg-emerald-50 rounded-lg p-4\">\n                    <h4 className=\"font-medium text-gray-900 mb-2\">Settlement Details</h4>\n                    <div className=\"space-y-2 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Total Payout:</span>\n                        <span className=\"font-medium\">${settlementStatus.settlement.total_payout.toLocaleString()}</span>\n                      </div>\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Settled At:</span>\n                        <span className=\"font-medium\">\n                          {new Date(settlementStatus.settlement.settlement_time).toLocaleDateString()}\n                        </span>\n                      </div>\n                    </div>\n                  </div>\n                ) : settlementStatus.needsSettlement ? (\n                  <div className=\"bg-yellow-50 rounded-lg p-4\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Clock className=\"w-4 h-4 text-yellow-600\" />\n                      <h4 className=\"font-medium text-yellow-900\">Awaiting Settlement</h4>\n                    </div>\n                    <p className=\"text-sm text-yellow-800\">\n                      This prediction is waiting for the creator to provide settlement details.\n                    </p>\n                  </div>\n                ) : null}\n\n                {/* Finalization Status */}\n                <div className=\"bg-white rounded-lg p-4 border border-gray-100\">\n                  <h4 className=\"font-medium text-gray-900 mb-2\">Finalization Status</h4>\n                  {finalizeLoading ? (\n                    <div className=\"text-sm text-gray-600\">Loading finalization status…</div>\n                  ) : (\n                    <div className=\"space-y-2 text-sm\">\n                      <div className=\"flex justify-between\">\n                        <span className=\"text-gray-600\">Status:</span>\n                        <span className=\"font-medium text-gray-900\">\n                          {finalizeStatus?.status ?? '—'}\n                        </span>\n                      </div>\n                      {!!finalizeStatus?.txHash && (\n                        <div className=\"flex justify-between gap-3\">\n                          <span className=\"text-gray-600\">Tx Hash:</span>\n                          <span className=\"font-medium text-gray-900 truncate\">\n                            {finalizeStatus.txHash}\n                          </span>\n                        </div>\n                      )}\n                      {finalizeStatus?.status === 'failed' && (\n                        <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3\">\n                          <p className=\"text-sm text-yellow-900\">Finalization failed, admin retry required.</p>\n                        </div>\n                      )}\n                      <div className=\"text-xs text-gray-600\">\n                        {settlementStatus.userEntry.provider === 'demo-wallet'\n                          ? 'Demo payouts are credited instantly after settlement is finalized.'\n                          : 'Crypto payouts are claimed on-chain after finalization. Connect wallet to claim.'}\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"mt-3 flex flex-col gap-2\">\n                    {settlementStatus.prediction.creator_id && settlementStatus.prediction.creator_id === userId && (\n                      <button\n                        onClick={handleRequestFinalize}\n                        disabled={finalizeSubmitting}\n                        className=\"w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50\"\n                      >\n                        Submit Settlement for Finalization\n                      </button>\n                    )}\n\n                    {/* Admin-only: shown when an admin key exists (or prompt on click) */}\n                    <button\n                      onClick={handleAdminFinalize}\n                      disabled={finalizeSubmitting}\n                      className=\"w-full px-4 py-2 border border-gray-300 text-gray-800 rounded-lg hover:bg-gray-50 disabled:opacity-50\"\n                    >\n                      Finalize On-Chain\n                    </button>\n                  </div>\n                </div>\n\n                {/* Status History */}\n                <div className=\"bg-white rounded-lg p-4 border border-gray-100\">\n                  <h4 className=\"font-medium text-gray-900 mb-2\">Status History</h4>\n\n                  {historyLoading ? (\n                    <div className=\"text-sm text-gray-600\">Loading history…</div>\n                  ) : historyError ? (\n                    <div className=\"space-y-3\">\n                      <div className=\"text-sm text-gray-700\">\n                        We couldn’t load settlement history right now.\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={fetchHistory}\n                        className=\"w-full px-4 py-2.5 rounded-xl border border-black/[0.06] bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors\"\n                      >\n                        Retry\n                      </button>\n                    </div>\n                  ) : (\n                    <>\n                      <div className=\"flex flex-wrap gap-x-4 gap-y-1 text-xs text-gray-600 mb-3\">\n                        <span>Accepts: <span className=\"font-semibold text-gray-900\">{history?.summary?.accepts ?? 0}</span></span>\n                        <span>Disputes: <span className=\"font-semibold text-gray-900\">{history?.summary?.disputes ?? 0}</span> (Pending: <span className=\"font-semibold text-gray-900\">{history?.summary?.pendingDisputes ?? 0}</span>)</span>\n                        <span>Last action: <span className=\"font-semibold text-gray-900\">{history?.summary?.lastActionAt ? new Date(history.summary.lastActionAt).toLocaleString() : '—'}</span></span>\n                      </div>\n\n                      {Array.isArray(history?.items) && history.items.length > 0 ? (\n                        <div className=\"space-y-2\">\n                          {history.items.map((item: any) => {\n                            const isDispute = item.action === 'dispute';\n                            const name =\n                              item?.user?.full_name ||\n                              item?.user?.username ||\n                              (typeof item.user_id === 'string' && item.user_id.length > 10\n                                ? `${item.user_id.slice(0, 6)}…${item.user_id.slice(-4)}`\n                                : item.user_id);\n                            return (\n                              <div key={item.id} className=\"rounded-lg border border-gray-100 p-3\">\n                                <div className=\"flex items-start justify-between gap-2\">\n                                  <div className=\"min-w-0\">\n                                    <div className=\"flex items-center gap-2\">\n                                      <span className={`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs font-semibold ${\n                                        isDispute ? 'bg-yellow-100 text-yellow-800' : 'bg-emerald-100 text-emerald-800'\n                                      }`}>\n                                        {isDispute ? <AlertTriangle className=\"w-3 h-3\" /> : <CheckCircle className=\"w-3 h-3\" />}\n                                        {isDispute ? 'Disputed' : 'Accepted'}\n                                      </span>\n                                      {item.status && (\n                                        <span className={`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${\n                                          item.status === 'pending' ? 'bg-gray-100 text-gray-800' : 'bg-emerald-50 text-emerald-800'\n                                        }`}>\n                                          {item.status}\n                                        </span>\n                                      )}\n                                    </div>\n                                    <div className=\"text-sm text-gray-900 font-medium truncate mt-1\">{name || 'Unknown user'}</div>\n                                    <div className=\"text-xs text-gray-500\">{item.created_at ? new Date(item.created_at).toLocaleString() : ''}</div>\n                                    {isDispute && item.reason && (\n                                      <p\n                                        className=\"text-xs text-gray-700 mt-2\"\n                                        style={{\n                                          display: '-webkit-box',\n                                          WebkitLineClamp: 2,\n                                          WebkitBoxOrient: 'vertical' as any,\n                                          overflow: 'hidden',\n                                        }}\n                                      >\n                                        {item.reason}\n                                      </p>\n                                    )}\n                                  </div>\n                                </div>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      ) : (\n                        <div className=\"text-sm text-gray-600\">No actions yet.</div>\n                      )}\n                    </>\n                  )}\n                </div>\n\n                {/* Validation Actions */}\n                {settlementStatus.canValidate && settlementStatus.settlement && !showDisputeForm && (\n                  <div className=\"space-y-3\">\n                    <h4 className=\"font-medium text-gray-900\">Validate Settlement</h4>\n                    <p className=\"text-sm text-gray-600\">\n                      Do you agree with this settlement outcome?\n                    </p>\n                    <div className=\"flex gap-3\">\n                      <button\n                        onClick={() => handleValidation('accept')}\n                        disabled={validating}\n                        className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50\"\n                      >\n                        <CheckCircle className=\"w-4 h-4\" />\n                        Accept\n                      </button>\n                      <button\n                        onClick={() => setShowDisputeForm(true)}\n                        disabled={validating}\n                        className=\"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50\"\n                      >\n                        <AlertTriangle className=\"w-4 h-4\" />\n                        Dispute\n                      </button>\n                    </div>\n                  </div>\n                )}\n\n                {/* Dispute Form */}\n                {showDisputeForm && (\n                  <div className=\"space-y-4\">\n                    <h4 className=\"font-medium text-gray-900\">Dispute Settlement</h4>\n                    <div>\n                      <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                        Reason for Dispute\n                      </label>\n                      <textarea\n                        value={disputeReason}\n                        onChange={(e) => setDisputeReason(e.target.value)}\n                        placeholder=\"Please explain why you disagree with this settlement...\"\n                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500\"\n                        rows={4}\n                      />\n                    </div>\n                    <div className=\"flex gap-3\">\n                      <button\n                        onClick={() => setShowDisputeForm(false)}\n                        className=\"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50\"\n                      >\n                        Cancel\n                      </button>\n                      <button\n                        onClick={() => handleValidation('dispute')}\n                        disabled={validating || !disputeReason.trim()}\n                        className=\"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50\"\n                      >\n                        Submit Dispute\n                      </button>\n                    </div>\n                  </div>\n                )}\n              </div>\n            ) : (\n              <div className=\"text-center py-8\">\n                <p className=\"text-gray-600\">Failed to load settlement information</p>\n              </div>\n            )}\n          </div>\n        </motion.div>\n      </div>\n    </AnimatePresence>\n  );\n};\n\nexport default SettlementValidationModal;\n","import React, { useState, useEffect } from 'react';\nimport * as Dialog from '@radix-ui/react-dialog';\nimport { X, Plus, Trash2, Calendar, AlertCircle } from 'lucide-react';\nimport toast from 'react-hot-toast';\nimport { getApiUrl } from '@/utils/environment';\nimport type { Prediction } from '@/store/predictionStore';\nimport { supabase } from '@/lib/supabase';\n\ntype PredictionCategory = Prediction['category'];\n\ninterface EditPredictionSheetProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  prediction: Prediction & { entriesCount?: number; hasEntries?: boolean };\n  onSaved: (updatedPrediction: Prediction) => void;\n  userId?: string;\n}\n\nexport function EditPredictionSheet({\n  open,\n  onOpenChange,\n  prediction,\n  onSaved,\n  userId,\n}: EditPredictionSheetProps) {\n  const [title, setTitle] = useState(prediction.title || '');\n  const [description, setDescription] = useState(prediction.description || '');\n  const [options, setOptions] = useState<Array<{ id?: string; label: string }>>(\n    (prediction.options || []).map((opt) => ({ id: opt.id, label: opt.label }))\n  );\n  const [closesAt, setClosesAt] = useState(\n    prediction.entry_deadline\n      ? new Date(prediction.entry_deadline).toISOString().slice(0, 16)\n      : ''\n  );\n  const [category, setCategory] = useState(prediction.category || 'custom');\n  const [isSaving, setIsSaving] = useState(false);\n  const [errors, setErrors] = useState<Record<string, string>>({});\n\n  const hasEntries = prediction.hasEntries ?? (prediction.entriesCount ?? 0) > 0;\n  const oldDeadline = prediction.entry_deadline ? new Date(prediction.entry_deadline) : null;\n\n  // Reset form when prediction changes\n  useEffect(() => {\n    if (prediction) {\n      setTitle(prediction.title || '');\n      setDescription(prediction.description || '');\n      setOptions((prediction.options || []).map((opt) => ({ id: opt.id, label: opt.label })));\n      setClosesAt(\n        prediction.entry_deadline\n          ? new Date(prediction.entry_deadline).toISOString().slice(0, 16)\n          : ''\n      );\n      setCategory(prediction.category || 'custom');\n      setErrors({});\n    }\n  }, [prediction, open]);\n\n  const validateForm = (): boolean => {\n    const newErrors: Record<string, string> = {};\n\n    if (!hasEntries) {\n      if (!title.trim()) {\n        newErrors.title = 'Title is required';\n      }\n\n      if (options.length < 2) {\n        newErrors.options = 'Must have at least 2 options';\n      } else {\n        // Check for duplicate labels (case-insensitive)\n        const labels = options.map((o) => o.label.toLowerCase().trim()).filter(Boolean);\n        const uniqueLabels = new Set(labels);\n        if (labels.length !== uniqueLabels.size) {\n          newErrors.options = 'Option labels must be unique';\n        }\n      }\n    }\n\n    if (closesAt) {\n      const newDeadline = new Date(closesAt);\n      if (isNaN(newDeadline.getTime())) {\n        newErrors.closesAt = 'Invalid date';\n      } else if (hasEntries && oldDeadline && newDeadline.getTime() <= oldDeadline.getTime()) {\n        newErrors.closesAt = 'Can only extend close time forward when entries exist';\n      }\n    }\n\n    setErrors(newErrors);\n    return Object.keys(newErrors).length === 0;\n  };\n\n  const handleAddOption = () => {\n    if (hasEntries) return;\n    setOptions([...options, { label: '' }]);\n  };\n\n  const handleRemoveOption = (index: number) => {\n    if (hasEntries || options.length <= 2) return;\n    setOptions(options.filter((_, i) => i !== index));\n  };\n\n  const handleOptionChange = (index: number, label: string) => {\n    if (hasEntries) return;\n    const updated = [...options];\n    updated[index] = { ...updated[index], label };\n    setOptions(updated);\n  };\n\n  const handleSave = async () => {\n    if (!validateForm()) {\n      toast.error('Please fix the errors before saving');\n      return;\n    }\n\n    setIsSaving(true);\n    try {\n      // Use userId from props or try to get from auth\n      const effectiveUserId = userId || \n                              (window as any).__FCZ_USER_ID || \n                              localStorage.getItem('userId') ||\n                              (window as any).__FCZ_CURRENT_USER?.id;\n      if (!effectiveUserId) {\n        toast.error('Please sign in to edit predictions');\n        setIsSaving(false);\n        return;\n      }\n\n      const { data: sessionData } = await supabase.auth.getSession().catch(() => ({ data: null } as any));\n      const accessToken = sessionData?.session?.access_token || null;\n\n      const payload: any = {};\n      if (!hasEntries && title !== prediction.title) {\n        payload.title = title.trim();\n      }\n      if (description !== (prediction.description || '')) {\n        payload.description = description.trim() || null;\n      }\n      if (closesAt) {\n        payload.closesAt = new Date(closesAt).toISOString();\n      }\n      if (!hasEntries && category !== prediction.category) {\n        payload.categoryId = category;\n      }\n      if (!hasEntries && options.length > 0) {\n        // Only send options if they changed\n        const optionsChanged =\n          options.length !== (prediction.options || []).length ||\n          options.some((opt, idx) => {\n            const oldOpt = prediction.options?.[idx];\n            return !oldOpt || opt.label !== oldOpt.label;\n          });\n        if (optionsChanged) {\n          payload.options = options.filter((opt) => opt.label.trim());\n        }\n      }\n\n      if (Object.keys(payload).length === 0) {\n        toast.success('No changes to save');\n        setIsSaving(false);\n        return;\n      }\n\n      const response = await fetch(`${getApiUrl()}/api/v2/predictions/${prediction.id}`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(accessToken ? { Authorization: `Bearer ${accessToken}` } : {}),\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          ...payload,\n          userId: effectiveUserId,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({ message: response.statusText }));\n        throw new Error(error.message || 'Failed to update prediction');\n      }\n\n      const result = await response.json();\n      toast.success('Prediction updated successfully');\n      onSaved(result.data);\n      onOpenChange(false);\n    } catch (error: any) {\n      console.error('[EditPredictionSheet] Save failed:', error);\n      toast.error(error.message || 'Failed to update prediction');\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  return (\n    <Dialog.Root open={open} onOpenChange={onOpenChange}>\n      <Dialog.Portal>\n        {/* Must be above bottom nav (z-[9999]) */}\n        <Dialog.Overlay className=\"fixed inset-0 bg-black/40 backdrop-blur-sm z-[12000]\" />\n        {/* Keep sheet ABOVE the persistent bottom navigation area */}\n        <Dialog.Content className=\"fixed left-0 right-0 bottom-[calc(4rem+env(safe-area-inset-bottom))] bg-white rounded-t-2xl shadow-2xl z-[12001] max-h-[calc(100vh-4rem-env(safe-area-inset-bottom))] overflow-y-auto\">\n          <div className=\"sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10\">\n            <Dialog.Title className=\"text-lg font-semibold text-gray-900\">Edit prediction</Dialog.Title>\n            <Dialog.Close className=\"p-2 rounded-lg hover:bg-gray-100\">\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </Dialog.Close>\n          </div>\n\n          {/* Extra bottom padding for safe-area + comfortable scroll end */}\n          <div className=\"px-4 py-6 pb-[calc(1.5rem+env(safe-area-inset-bottom))] space-y-6\">\n            {/* Editing limits notice */}\n            {hasEntries && (\n              <div className=\"bg-amber-50 border border-amber-200 rounded-xl p-4 flex items-start gap-3\">\n                <AlertCircle className=\"w-5 h-5 text-amber-600 flex-shrink-0 mt-0.5\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-sm font-medium text-amber-900\">Editing limits</p>\n                  <p className=\"text-xs text-amber-700 mt-1\">\n                    This prediction already has participants. You can only extend the close time.\n                  </p>\n                </div>\n              </div>\n            )}\n\n            {/* Title */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Title {!hasEntries && <span className=\"text-red-500\">*</span>}\n              </label>\n              <input\n                type=\"text\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                disabled={hasEntries}\n                className={`w-full px-3 py-2 border rounded-lg ${\n                  hasEntries\n                    ? 'bg-gray-50 text-gray-500 cursor-not-allowed'\n                    : errors.title\n                    ? 'border-red-300'\n                    : 'border-gray-300'\n                }`}\n                placeholder=\"Enter prediction title\"\n              />\n              {errors.title && <p className=\"text-xs text-red-500 mt-1\">{errors.title}</p>}\n              {hasEntries && (\n                <p className=\"text-xs text-gray-500 mt-1\">Cannot change title after participants have staked</p>\n              )}\n            </div>\n\n            {/* Description */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n              <textarea\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                rows={3}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none\"\n                placeholder=\"Optional description\"\n              />\n            </div>\n\n            {/* Options (only when no entries) */}\n            {!hasEntries && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  Options <span className=\"text-red-500\">*</span>\n                </label>\n                <div className=\"space-y-2\">\n                  {options.map((option, index) => (\n                    <div key={index} className=\"flex gap-2\">\n                      <input\n                        type=\"text\"\n                        value={option.label}\n                        onChange={(e) => handleOptionChange(index, e.target.value)}\n                        className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg\"\n                        placeholder={`Option ${index + 1}`}\n                      />\n                      {options.length > 2 && (\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveOption(index)}\n                          className=\"p-2 text-red-600 hover:bg-red-50 rounded-lg\"\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                      )}\n                    </div>\n                  ))}\n                  <button\n                    type=\"button\"\n                    onClick={handleAddOption}\n                    className=\"flex items-center gap-2 text-sm text-emerald-600 hover:text-emerald-700 font-medium\"\n                  >\n                    <Plus className=\"w-4 h-4\" />\n                    Add option\n                  </button>\n                </div>\n                {errors.options && <p className=\"text-xs text-red-500 mt-1\">{errors.options}</p>}\n              </div>\n            )}\n\n            {/* Close time */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2\">\n                <Calendar className=\"w-4 h-4\" />\n                Close time {!hasEntries && <span className=\"text-red-500\">*</span>}\n              </label>\n              <input\n                type=\"datetime-local\"\n                value={closesAt}\n                onChange={(e) => setClosesAt(e.target.value)}\n                min={oldDeadline ? oldDeadline.toISOString().slice(0, 16) : undefined}\n                className={`w-full px-3 py-2 border rounded-lg ${\n                  errors.closesAt ? 'border-red-300' : 'border-gray-300'\n                }`}\n              />\n              {errors.closesAt && <p className=\"text-xs text-red-500 mt-1\">{errors.closesAt}</p>}\n              {hasEntries && oldDeadline && (\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Current: {oldDeadline.toLocaleString()}. Can only extend forward.\n                </p>\n              )}\n            </div>\n\n            {/* Category (only when no entries) */}\n            {!hasEntries && (\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">Category</label>\n                <select\n                  value={category}\n                  onChange={(e) => setCategory(e.target.value as PredictionCategory)}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n                >\n                  <option value=\"sports\">Sports</option>\n                  <option value=\"pop_culture\">Pop Culture</option>\n                  <option value=\"custom\">Custom</option>\n                  <option value=\"esports\">Esports</option>\n                  <option value=\"celebrity_gossip\">Celebrity Gossip</option>\n                  <option value=\"politics\">Politics</option>\n                </select>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-3 pt-4 border-t\">\n              <button\n                type=\"button\"\n                onClick={() => onOpenChange(false)}\n                disabled={isSaving}\n                className=\"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleSave}\n                disabled={isSaving}\n                className=\"flex-1 px-4 py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n              >\n                {isSaving ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    Saving...\n                  </>\n                ) : (\n                  'Save changes'\n                )}\n              </button>\n            </div>\n          </div>\n        </Dialog.Content>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n}\n","import React, { useState } from 'react';\nimport * as Dialog from '@radix-ui/react-dialog';\nimport { X, AlertTriangle } from 'lucide-react';\nimport toast from 'react-hot-toast';\nimport { getApiUrl } from '@/utils/environment';\nimport type { Prediction } from '@/store/predictionStore';\nimport { supabase } from '@/lib/supabase';\n\ninterface CancelPredictionSheetProps {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  prediction: Prediction;\n  onCancelled: (updatedPrediction: Prediction) => void;\n  userId?: string;\n}\n\nexport function CancelPredictionSheet({\n  open,\n  onOpenChange,\n  prediction,\n  onCancelled,\n  userId,\n}: CancelPredictionSheetProps) {\n  const [reason, setReason] = useState('');\n  const [isCancelling, setIsCancelling] = useState(false);\n\n  const handleCancel = async () => {\n    if (!reason.trim() || reason.trim().length < 5) {\n      toast.error('Please provide a reason (at least 5 characters)');\n      return;\n    }\n\n    setIsCancelling(true);\n    try {\n      // Prefer the passed in authenticated userId\n      const effectiveUserId =\n        userId ||\n        (window as any).__FCZ_USER_ID ||\n        localStorage.getItem('userId') ||\n        (window as any).__FCZ_CURRENT_USER?.id;\n\n      if (!effectiveUserId) {\n        toast.error('Please sign in to cancel predictions');\n        setIsCancelling(false);\n        return;\n      }\n\n      const { data: sessionData } = await supabase.auth.getSession().catch(() => ({ data: null } as any));\n      const accessToken = sessionData?.session?.access_token || null;\n\n      const response = await fetch(`${getApiUrl()}/api/v2/predictions/${prediction.id}/cancel`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...(accessToken ? { Authorization: `Bearer ${accessToken}` } : {}),\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          reason: reason.trim(),\n          userId: effectiveUserId,\n        }),\n      });\n\n      if (!response.ok) {\n        const error = await response.json().catch(() => ({ message: response.statusText }));\n        throw new Error(error.message || 'Failed to cancel prediction');\n      }\n\n      await response.json().catch(() => null);\n      toast.success('Prediction cancelled. Refunds initiated.');\n      \n      // Update prediction status locally\n      onCancelled({\n        ...prediction,\n        status: 'cancelled',\n      });\n      \n      onOpenChange(false);\n      setReason('');\n    } catch (error: any) {\n      console.error('[CancelPredictionSheet] Cancel failed:', error);\n      toast.error(error.message || 'Failed to cancel prediction');\n    } finally {\n      setIsCancelling(false);\n    }\n  };\n\n  return (\n    <Dialog.Root open={open} onOpenChange={onOpenChange}>\n      <Dialog.Portal>\n        {/* Must be above bottom nav (z-[9999]) */}\n        <Dialog.Overlay className=\"fixed inset-0 bg-black/40 backdrop-blur-sm z-[12000]\" />\n        {/* Keep sheet ABOVE the persistent bottom navigation area */}\n        <Dialog.Content className=\"fixed left-0 right-0 bottom-[calc(4rem+env(safe-area-inset-bottom))] bg-white rounded-t-2xl shadow-2xl z-[12001] max-h-[calc(100vh-4rem-env(safe-area-inset-bottom))] overflow-y-auto\">\n          <div className=\"sticky top-0 bg-white border-b border-gray-200 px-4 py-4 flex items-center justify-between z-10\">\n            <Dialog.Title className=\"text-lg font-semibold text-gray-900\">Cancel prediction?</Dialog.Title>\n            <Dialog.Close className=\"p-2 rounded-lg hover:bg-gray-100\">\n              <X className=\"w-5 h-5 text-gray-500\" />\n            </Dialog.Close>\n          </div>\n\n          {/* Extra bottom padding for safe-area + comfortable scroll end */}\n          <div className=\"px-4 py-6 pb-[calc(1.5rem+env(safe-area-inset-bottom))] space-y-6\">\n            {/* Warning */}\n            <div className=\"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3\">\n              <AlertTriangle className=\"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5\" />\n              <div className=\"flex-1\">\n                <p className=\"text-sm font-medium text-red-900\">This action cannot be undone</p>\n                <p className=\"text-xs text-red-700 mt-1\">\n                  All participants will receive refunds. The prediction will be marked as cancelled.\n                </p>\n              </div>\n            </div>\n\n            {/* Reason */}\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Reason <span className=\"text-red-500\">*</span>\n              </label>\n              <textarea\n                value={reason}\n                onChange={(e) => setReason(e.target.value)}\n                rows={4}\n                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg resize-none\"\n                placeholder=\"Explain why you're cancelling this prediction (minimum 5 characters)\"\n                minLength={5}\n              />\n              <p className=\"text-xs text-gray-500 mt-1\">\n                {reason.length}/5 minimum characters\n              </p>\n            </div>\n\n            {/* Actions */}\n            <div className=\"flex gap-3 pt-4 border-t\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  onOpenChange(false);\n                  setReason('');\n                }}\n                disabled={isCancelling}\n                className=\"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50\"\n              >\n                Keep prediction\n              </button>\n              <button\n                type=\"button\"\n                onClick={handleCancel}\n                disabled={isCancelling || reason.trim().length < 5}\n                className=\"flex-1 px-4 py-3 bg-red-600 hover:bg-red-700 text-white rounded-xl font-medium transition-colors disabled:opacity-50 flex items-center justify-center gap-2\"\n              >\n                {isCancelling ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                    Cancelling...\n                  </>\n                ) : (\n                  'Cancel prediction'\n                )}\n              </button>\n            </div>\n          </div>\n        </Dialog.Content>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n}\n","import { useQuery } from '@tanstack/react-query';\nimport { getApiUrl } from '@/utils/environment';\nimport { QK } from '@/lib/queryKeys';\n\nexport type MerkleProofResponse = {\n  success: boolean;\n  data: {\n    predictionId: string;\n    merkleRoot: `0x${string}`;\n    amountUnits: string;\n    amountUSD: number;\n    proof: `0x${string}`[];\n  };\n  version: string;\n};\n\nexport function useMerkleProof(predictionId?: string, address?: string) {\n  return useQuery({\n    queryKey: [...QK.prediction(predictionId || 'unknown'), 'merkle-proof', (address || '').toLowerCase()],\n    enabled: Boolean(predictionId && address),\n    queryFn: async (): Promise<MerkleProofResponse['data']> => {\n      const params = new URLSearchParams({ address: String(address) });\n      const r = await fetch(`${getApiUrl()}/api/v2/settlement/${predictionId}/merkle-proof?${params.toString()}`, {\n        headers: { Accept: 'application/json' },\n        credentials: 'include',\n      });\n      if (!r.ok) {\n        const body = await r.json().catch(() => ({}));\n        throw new Error(body?.message || 'Failed to fetch merkle proof');\n      }\n      const json: MerkleProofResponse = await r.json();\n      return json.data;\n    },\n    staleTime: 10_000,\n    refetchInterval: 30_000,\n  });\n}\n\n\n","import React, { useState, useEffect, useMemo, useCallback, useRef } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { useNavigate, useParams, useLocation } from 'react-router-dom';\nimport { Share2, BarChart3, Users, Calendar, DollarSign, ArrowLeft, Clock, User, Banknote } from 'lucide-react';\nimport { useQueryClient } from '@tanstack/react-query';\nimport { QK } from '@/lib/queryKeys';\nimport { useAccount } from 'wagmi';\n\nimport { usePredictionStore } from '../store/predictionStore';\nimport { useAuthStore } from '../store/authStore';\nimport { useUnifiedCommentStore } from '../store/unifiedCommentStore';\n// DISABLED: useWalletStore reads from wallets table (demo/mock data)\n// import { useWalletStore } from '../stores/walletStore';\nimport { openAuthGate } from '../auth/authGateAdapter';\nimport { useAuthSession } from '../providers/AuthSessionProvider';\nimport { useUnifiedBalance } from '../hooks/useUnifiedBalance';\nimport { useFundingModeStore } from '../store/fundingModeStore';\nimport { getApiUrl } from '../config';\nimport DepositUSDCModal from '../components/wallet/DepositUSDCModal';\nimport { usePaystackStatus, useFiatSummary } from '@/hooks/useFiatWallet';\nimport { Runtime } from '@/config/runtime';\n// TODO: Implement accessibility utils\nconst prefersReducedMotion = () => false;\nconst AriaUtils = { announce: (message: string) => console.log('Announce:', message) };\n\n// Import unified header system\nimport { AppHeader } from '../components/layout/AppHeader';\nimport PredictionDetailsTabs from '../components/prediction/PredictionDetailsTabs';\nimport { CommentsSection } from '../features/comments';\nimport { useMedia } from '../hooks/useMedia';\nimport LoadingState from '../components/ui/LoadingState';\nimport ErrorBanner from '../components/ui/ErrorBanner';\nimport EmptyState from '../components/ui/EmptyState';\nimport ActivityFeed from '../components/activity/ActivityFeed';\n\n// New compact components\nimport CreatorByline from '../components/predictions/CreatorByline';\nimport SignInCallout from '../components/auth/SignInCallout';\nimport { TitleAndMeta } from '../components/predictions/TitleAndMeta';\nimport { OptionsSection } from '../components/predictions/OptionsSection';\nimport { StickyBetBar } from '../components/predictions/StickyBetBar';\nimport SettlementValidationModal from '../components/modals/SettlementValidationModal';\nimport { EditPredictionSheet } from '../components/prediction/EditPredictionSheet';\nimport { CancelPredictionSheet } from '../components/prediction/CancelPredictionSheet';\nimport { getCategoryLabel } from '@/lib/categoryUi';\n// TODO: Re-enable share functionality after testing\n// import { useShareResult } from '../components/share/useShareResult';\n\nimport toast from 'react-hot-toast';\nimport { formatCurrency } from '@/lib/format';\nimport { t } from '@/lib/lexicon';\nimport { useMerkleProof } from '@/hooks/useMerkleProof';\nimport { useMerkleClaim } from '@/hooks/useMerkleClaim';\nimport { usePredictionActivity } from '@/hooks/useActivityFeed';\n\nconst showSuccessToast = (message: string) => toast.success(message);\nconst showErrorToast = (message: string) => toast.error(message);\n\ninterface PredictionDetailsPageProps {\n  predictionId?: string;\n}\n\ntype DetailsLocationState = { from?: string } | null;\n\nconst PredictionDetailsPage: React.FC<PredictionDetailsPageProps> = ({\n  predictionId: propPredictionId\n}) => {\n  const navigate = useNavigate();\n  const location = useLocation();\n  const params = useParams<{ id?: string; predictionId?: string }>();\n  const locationState = (location.state as DetailsLocationState) ?? null;\n  const preservedStateRef = useRef<DetailsLocationState>(locationState);\n  const returnToRef = useRef<string | null>(locationState?.from ?? null);\n  const { user: sessionUser } = useAuthSession();\n  const reduceMotion = prefersReducedMotion();\n  const { isAuthenticated: storeAuth, user: storeUser } = useAuthStore();\n  \n  // Use either auth source\n  const isAuthenticated = !!sessionUser || storeAuth;\n  const currentUser = sessionUser || storeUser;\n\n  // Auth state logging removed - excessive logging issue\n\n  // Get prediction ID from multiple sources (URL params, props)\n  const predictionId = propPredictionId || params.id || params.predictionId || '';\n  const getCommentCount = useUnifiedCommentStore((s) => s.getCommentCount);\n  const liveCommentCount = predictionId ? getCommentCount(predictionId) : 0;\n\n  // Local state\n  const [selectedOptionId, setSelectedOptionId] = useState<string | null>(null);\n  const [stakeAmount, setStakeAmount] = useState<string>('');\n  const [isPlacingBet, setIsPlacingBet] = useState(false);\n  // Check URL for tab query param on mount\n  const searchParams = new URLSearchParams(location.search);\n  const initialTab = searchParams.get('tab') || 'overview';\n  const [activeTab, setActiveTab] = useState(initialTab);\n  \n  // Update tab when query param changes\n  useEffect(() => {\n    const currentSearchParams = new URLSearchParams(location.search);\n    const tabFromUrl = currentSearchParams.get('tab');\n    if (tabFromUrl && ['overview', 'comments', 'activity'].includes(tabFromUrl)) {\n      setActiveTab(tabFromUrl);\n    }\n  }, [location.search]);\n  const [shareUrl, setShareUrl] = useState('');\n  const [showDepositModal, setShowDepositModal] = useState(false);\n  const [justPlaced, setJustPlaced] = useState<{ amount: number; optionLabel: string } | null>(null);\n  const [settlementModalOpen, setSettlementModalOpen] = useState(false);\n  const [editSheetOpen, setEditSheetOpen] = useState(false);\n  const [cancelSheetOpen, setCancelSheetOpen] = useState(false);\n  \n  // TODO: Re-enable share functionality after testing\n  // const { SharePreview, share: shareResult } = useShareResult();\n\n  // Store hooks\n  const {\n    predictions,\n    fetchPredictionById,\n    placePrediction,\n    loading,\n    error\n  } = usePredictionStore();\n  \n  // DISABLED: Wallet store refresh - use query invalidation instead\n  // const { refresh: refreshWallet } = useWalletStore();\n\n  // Query client for cache invalidation\n  const queryClient = useQueryClient();\n\n  // Unified balance hook - SINGLE SOURCE OF TRUTH\n  const { \n    wallet: walletUSDC,\n    available: escrowAvailableUSD,\n    locked: escrowLockedUSD,\n    total: escrowTotalUSD,\n    isLoading: isLoadingBalance,\n    refetch: refetchBalances\n  } = useUnifiedBalance();\n  \n  // Wallet address for additional checks\n  const { address: walletAddress } = useAccount();\n  const lowerWallet = walletAddress?.toLowerCase();\n  // Only request proof when prediction is actually settled\n  const isSettled = useMemo(() => {\n    const p = predictions.find(p => p.id === predictionId);\n    return Boolean(p?.settledAt);\n  }, [predictions, predictionId]);\n  const { data: merkle, isLoading: loadingProof } = useMerkleProof(isSettled ? predictionId : undefined, walletAddress);\n  const { claim, isClaiming } = useMerkleClaim();\n  \n  // Server snapshot for database locks (if still needed)\n  // Available to stake = on-chain available balance\n  const availableToStake = escrowAvailableUSD;\n\n  // Funding mode (crypto vs demo) — demo is UI-gated by env via fundingModeStore\n  const { mode, setMode, isDemoEnabled, isFiatEnabled, setFiatEnabled } = useFundingModeStore();\n  const capabilities = Runtime.capabilities;\n  const showDemo = isDemoEnabled && capabilities.allowDemo;\n  // Gate fiat/crypto modes by capabilities\n  const effectiveFiatEnabled = isFiatEnabled && capabilities.allowFiat;\n  const effectiveCryptoEnabled = capabilities.allowCrypto;\n  const { data: paystackStatus } = usePaystackStatus();\n  const { data: fiatData, isLoading: loadingFiat } = useFiatSummary(currentUser?.id);\n  useEffect(() => {\n    if (paystackStatus?.enabled !== undefined) {\n      setFiatEnabled(paystackStatus.enabled);\n    }\n  }, [paystackStatus?.enabled, setFiatEnabled]);\n  const isDemoMode = showDemo && mode === 'demo';\n  const isFiatMode = effectiveFiatEnabled && mode === 'fiat';\n  const isCryptoMode = effectiveCryptoEnabled && !isDemoMode && !isFiatMode;\n\n  // Demo wallet summary (DB-backed)\n  const [demoSummary, setDemoSummary] = useState<null | { currency: string; available: number; reserved: number; total: number; lastUpdated: string }>(null);\n  const [demoLoading, setDemoLoading] = useState(false);\n\n  const fetchDemoSummary = useCallback(async () => {\n    if (!currentUser?.id) return;\n    try {\n      setDemoLoading(true);\n      const resp = await fetch(`${getApiUrl()}/api/demo-wallet/summary?userId=${currentUser.id}`);\n      const json = await resp.json().catch(() => null);\n      if (!resp.ok) throw new Error(json?.message || 'Failed to load demo wallet');\n      setDemoSummary(json?.summary ?? null);\n    } catch (e: any) {\n      console.error('[DEMO] summary error', e);\n      setDemoSummary(null);\n    } finally {\n      setDemoLoading(false);\n    }\n  }, [currentUser?.id]);\n\n  const faucetDemo = useCallback(async () => {\n    if (!currentUser?.id) return;\n    try {\n      setDemoLoading(true);\n      const resp = await fetch(`${getApiUrl()}/api/demo-wallet/faucet`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ userId: currentUser.id }),\n      });\n      const json = await resp.json().catch(() => null);\n      if (!resp.ok) throw new Error(json?.message || 'Failed to faucet demo credits');\n      setDemoSummary(json?.summary ?? null);\n      // Persist cooldown timestamp for consistent UX across the app\n      if (json?.nextEligibleAt) {\n        try {\n          localStorage.setItem(\n            `fcz_demo_credits_next_at:${currentUser.id}`,\n            String(Date.parse(String(json.nextEligibleAt)))\n          );\n        } catch {}\n      }\n      if (json?.alreadyGranted && json?.nextEligibleAt) {\n        const nextMs = Date.parse(String(json.nextEligibleAt));\n        const remaining = Math.max(0, nextMs - Date.now());\n        showErrorToast(`Not yet available. Next request in ${Math.ceil(remaining / 60000)} min.`);\n      }\n    } catch (e: any) {\n      console.error('[DEMO] faucet error', e);\n      showErrorToast(e?.message || 'Failed to get demo credits');\n    } finally {\n      setDemoLoading(false);\n    }\n  }, [currentUser?.id]);\n\n  useEffect(() => {\n    if (isAuthenticated && isDemoMode) {\n      void fetchDemoSummary();\n    }\n  }, [isAuthenticated, isDemoMode, fetchDemoSummary]);\n  \n  // Get prediction from store\n  const prediction = useMemo(() => {\n    if (!predictionId) return null;\n    return predictions.find(p => p.id === predictionId) || null;\n  }, [predictions, predictionId]);\n\n  // Check if current user is creator\n  const isCreator = useMemo(() => {\n    return !!(currentUser?.id && prediction?.creator_id && currentUser.id === prediction.creator_id);\n  }, [currentUser?.id, prediction?.creator_id]);\n  const isClosedOrSettled = useMemo(() => {\n    if (!prediction) return false;\n    const status = (prediction.status || '').toLowerCase();\n    return isSettled || status === 'closed' || status === 'settled' || status === 'cancelled';\n  }, [prediction, isSettled]);\n\n  const mediaMetadata = useMemo(() => {\n    if (!prediction) return undefined;\n\n    const poolTotal =\n      typeof prediction.pool_total === 'number'\n        ? prediction.pool_total\n        : typeof prediction.pool_total === 'string'\n          ? Number(prediction.pool_total)\n          : null;\n\n    const participantCount =\n      typeof prediction.participant_count === 'number'\n        ? prediction.participant_count\n        : typeof prediction.participants === 'number'\n          ? prediction.participants\n          : null;\n\n    const baseKeywords = [\n      prediction.category,\n      prediction.status,\n      prediction.type,\n      prediction.creator?.username ?? undefined,\n      prediction.creator?.full_name ?? undefined,\n    ].filter((value): value is string => Boolean(value));\n\n    const attributeHints = [\n      prediction.settlement_method,\n      prediction.settlement_criteria,\n      prediction.creator?.is_verified ? 'verified creator' : undefined,\n    ].filter((value): value is string => Boolean(value));\n\n    return {\n      id: prediction.id,\n      title: prediction.title,\n      description: prediction.description ?? prediction.question ?? '',\n      question: prediction.question ?? undefined,\n      category: prediction.category,\n      options: prediction.options?.map(option => ({\n        label: option?.label ?? option?.title ?? option?.text ?? '',\n      })),\n      keywords: baseKeywords,\n      attributes: attributeHints,\n      tags: baseKeywords,\n      identity: {\n        creator: prediction.creator?.full_name || prediction.creator?.username || null,\n        community: prediction.creator?.username\n          ? `${prediction.creator.username} community`\n          : null,\n        personas: attributeHints,\n      },\n      popularity: {\n        pool: poolTotal,\n        totalVolume: typeof prediction.total_volume === 'number' ? prediction.total_volume : null,\n        players: participantCount,\n        comments: typeof prediction.comments === 'number' ? prediction.comments : null,\n      },\n    };\n  }, [prediction]);\n\n  // Use the unified media system for consistent, relevant images (after prediction is defined)\n  const { media, status: mediaStatus } = useMedia(\n    prediction?.id || '',\n    mediaMetadata\n  );\n\n  // Log for debugging consistency (as requested in acceptance criteria)\n  useEffect(() => {\n    if (media && prediction && import.meta.env.DEV) {\n      console.log(`[PredictionDetailsPageV2] ${prediction.id}: ${media.provider}:${media.id}`);\n    }\n  }, [media, prediction]);\n\n  const demoAvailable = Number(demoSummary?.available ?? 0);\n  const fiatAvailable = Number(fiatData?.summary?.availableNgn ?? 0);\n  const displayAvailable = isFiatMode ? fiatAvailable : (isDemoMode ? demoAvailable : availableToStake);\n\n  // User balance - source depends on funding mode\n  const userBalance = isAuthenticated ? displayAvailable : 0;\n\n  // Log balance for debugging\n  useEffect(() => {\n    if (isAuthenticated) {\n      console.log('💰 PredictionDetailsPageV2 - Balance:', { \n        escrowTotal: escrowAvailableUSD,\n        availableToStake,\n        userBalance,\n        isLoadingBalance,\n        formatted: `${userBalance.toFixed(2)}`\n      });\n    }\n  }, [isAuthenticated, escrowAvailableUSD, availableToStake, userBalance, isLoadingBalance]);\n\n  // Load prediction data\n  const loadPrediction = useCallback(async () => {\n    if (!predictionId) {\n      console.log('❌ No prediction ID found');\n      navigate('/discover');\n      return;\n    }\n\n    try {\n      console.log('🔍 Loading prediction:', predictionId);\n      await fetchPredictionById(predictionId);\n    } catch (error) {\n      console.error('❌ Error loading prediction:', error);\n      showErrorToast('Failed to load prediction details');\n    }\n  }, [predictionId, fetchPredictionById, navigate]);\n\n  // Load prediction on mount\n  useEffect(() => {\n    loadPrediction();\n  }, [loadPrediction]);\n\n  // Activity feed for count badge\n  const { items: activityItems, refresh: refreshActivity } = usePredictionActivity(predictionId, { limit: 25, autoLoad: true });\n\n  // Set share URL (canonical slug) and gently rewrite URL to SEO path\n  useEffect(() => {\n    if (typeof window === 'undefined') return;\n    const title = prediction?.title || prediction?.question || '';\n    // Avoid rewriting/navigating while the prediction is still loading.\n    // In particular, an empty title would produce an empty slug and redirect to `/predictions`,\n    // which breaks deep links (opens the Stakes tab instead of details).\n    if (!title.trim()) {\n      setShareUrl(`${window.location.origin}/prediction/${predictionId}`);\n      return;\n    }\n    const slug = title\n      .toLowerCase()\n      .trim()\n      .replace(/[^a-z0-9\\s-]/g, '')\n      .replace(/\\s+/g, '-')\n      .replace(/-+/g, '-')\n      .slice(0, 80);\n    if (!slug) {\n      setShareUrl(`${window.location.origin}/prediction/${predictionId}`);\n      return;\n    }\n    const canonical = `${window.location.origin}/predictions/${slug}`;\n    setShareUrl(canonical);\n    // Inject/replace canonical link\n    try {\n      let link = document.querySelector('link[rel=\"canonical\"]') as HTMLLinkElement | null;\n      if (!link) {\n        link = document.createElement('link');\n        link.setAttribute('rel', 'canonical');\n        document.head.appendChild(link);\n      }\n      link.setAttribute('href', canonical);\n    } catch {}\n    // NOTE: We intentionally do NOT auto-navigate/replace the URL to the slug path here.\n    // Auto-rewriting has caused deep-link overrides on initial load (sending users to `/predictions`).\n  }, [prediction?.title, predictionId, navigate, locationState]);\n\n  // Handle navigation\n  const handleBack = () => {\n    const returnTo = returnToRef.current;\n    if (returnTo) {\n      navigate(returnTo, { replace: true });\n      return;\n    }\n    if (window.history.length > 1) {\n      window.history.back();\n    } else {\n      navigate('/discover');\n    }\n  };\n\n  // Handle sharing\n  const handleShare = async () => {\n    if (navigator.share && prediction) {\n      try {\n        await navigator.share({\n          title: prediction.title,\n          text: `Check out this prediction: ${prediction.title}`,\n          url: shareUrl,\n        });\n      } catch (error) {\n        // Fallback to clipboard\n        handleCopyLink();\n      }\n    } else {\n      handleCopyLink();\n    }\n  };\n\n  const handleCopyLink = async () => {\n    try {\n      await navigator.clipboard.writeText(shareUrl);\n      showSuccessToast('Link copied to clipboard!');\n      AriaUtils.announce('Link copied to clipboard');\n    } catch (error) {\n      console.error('Failed to copy link:', error);\n      showErrorToast('Failed to copy link');\n    }\n  };\n\n  // Handle option selection\n  const handleOptionSelect = (optionId: string) => {\n    setSelectedOptionId(optionId === selectedOptionId ? null : optionId);\n    if (optionId !== selectedOptionId) {\n      setStakeAmount('');\n    }\n  };\n\n  // Handle placing bet\n  const handlePlaceBet = async () => {\n    if (!isAuthenticated) {\n      openAuthGate({\n        intent: 'place_prediction',\n        payload: { predictionId }\n      });\n      return;\n    }\n\n    if (!selectedOptionId || !stakeAmount || !prediction || !currentUser?.id) {\n      if (!currentUser?.id) {\n        showErrorToast('User not authenticated. Please sign in.');\n      }\n      return;\n    }\n\n    // Check if stake amount exceeds available balance\n    const amount = parseFloat(stakeAmount);\n    const BASE_BETS_ENABLED = import.meta.env.VITE_FCZ_BASE_BETS === '1';\n    \n    // Funding source:\n    // - crypto: on-chain availableToStake\n    // - demo: demo ledger available\n    // - fiat: fiat ledger available (NGN)\n    const maxAvailable = isFiatMode ? fiatAvailable : (isDemoMode ? demoAvailable : availableToStake);\n    \n    if (amount > maxAvailable) {\n      // Open deposit modal instead of placing bet (crypto mode)\n      if (isCryptoMode) {\n        setShowDepositModal(true);\n        return;\n      }\n      if (isFiatMode) {\n        showErrorToast(`Insufficient fiat balance. Available: ₦${maxAvailable.toFixed(0)}`);\n        navigate('/wallet');\n        return;\n      }\n      showErrorToast(`Insufficient balance. Available: $${maxAvailable.toFixed(2)}`);\n      return;\n    }\n\n    setIsPlacingBet(true);\n    \n    try {\n      console.log('🎲 Placing prediction with amount:', { \n        stakeAmount, \n        parsedAmount: amount, \n        availableBalance: userBalance,\n        userId: currentUser.id,\n        isNaN: isNaN(amount), \n        isPositive: amount > 0 \n      });\n      \n      await placePrediction(\n        prediction.id,\n        selectedOptionId,\n        amount,\n        currentUser.id,\n        walletAddress\n      );\n\n      showSuccessToast(`Stake placed: ${isFiatMode ? `₦${Number(stakeAmount).toLocaleString()}` : `$${stakeAmount}`} | lock consumed`);\n      AriaUtils.announce(`Prediction placed successfully for ${stakeAmount} ${isFiatMode ? 'naira' : 'dollars'}`);\n      \n      // IMPORTANT: Keep user on prediction details page - do not navigate away\n      // Inline confirmation chip (keep user on overview)\n      const optionLabel = prediction.options.find(o => o.id === selectedOptionId)?.label || `Your ${t('bet')}`;\n      setJustPlaced({ amount, optionLabel });\n      setTimeout(() => setJustPlaced(null), 6000);\n      \n      // Reset form\n      setSelectedOptionId(null);\n      setStakeAmount('');\n\n      // Invalidate all related queries using unified query keys\n      const userId = currentUser?.id;\n      if (userId) {\n        await Promise.all([\n          queryClient.invalidateQueries({ queryKey: QK.walletSummary(userId, lowerWallet) }),\n          queryClient.invalidateQueries({ queryKey: QK.walletActivity(userId) }),\n          queryClient.invalidateQueries({ queryKey: QK.escrowBalance(userId) }),\n          queryClient.invalidateQueries({ queryKey: QK.onchainActivity(userId) }),\n          queryClient.invalidateQueries({ queryKey: QK.prediction(predictionId) }),\n          queryClient.invalidateQueries({ queryKey: QK.predictionEntries(predictionId) }),\n        ]);\n      if (isDemoMode) {\n        await fetchDemoSummary();\n      }\n      }\n      \n      // Also invalidate contract reads\n      queryClient.invalidateQueries({ queryKey: ['readContract'] });\n      \n      // Refresh escrow balances (on-chain and snapshot)\n      await refetchBalances();\n      \n      // Reload the prediction to get updated pool totals\n      await loadPrediction();\n      \n      // Explicitly ensure we stay on this page - no navigation\n      // The user should remain on the prediction details page to see their bet\n      \n    } catch (error) {\n      console.error('[FCZ-BET] Error placing prediction:', error);\n      \n      // Handle specific errors\n      if (error instanceof Error) {\n        if (error.message === 'INSUFFICIENT_ESCROW') {\n          setShowDepositModal(true);\n          showErrorToast('Insufficient escrow balance. Opening deposit modal...');\n          return;\n        }\n        showErrorToast(error.message || 'Failed to place prediction. Please try again.');\n      } else {\n        showErrorToast('Failed to place prediction. Please try again.');\n      }\n    } finally {\n      setIsPlacingBet(false);\n    }\n  };\n\n  // Handle like toggle (placeholder - not currently used)\n  const handleLike = async () => {\n    if (!isAuthenticated) {\n      openAuthGate({\n        intent: 'like_prediction',\n        payload: { predictionId }\n      });\n      return;\n    }\n    // TODO: Implement like functionality\n    console.log('Like toggled');\n  };\n\n  // Handle comment navigation\n  const handleComment = () => {\n    setActiveTab('comments');\n    // Scroll to comments after tab change\n    setTimeout(() => {\n      const commentsSection = document.querySelector('[data-qa=\"comments-section\"]');\n      if (commentsSection) {\n        commentsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }\n    }, 100);\n  };\n\n  // Loading state\n  if (loading && !prediction) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        {/* Consistent Header with AppHeader styling */}\n        <header className=\"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0\">\n          <div className=\"safe-px mx-auto max-w-screen-md\">\n            <div className=\"h-12 flex items-center justify-between gap-2 px-4\">\n              <div className=\"min-w-[40px] flex items-center\">\n                <button\n                  onClick={handleBack}\n                  className=\"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2\"\n                  aria-label=\"Go back\"\n                >\n                  <ArrowLeft className=\"w-5 h-5\" />\n                </button>\n              </div>\n              <div className=\"flex-1 text-center\">\n                <h1 className=\"text-base font-semibold leading-none truncate\">Loading...</h1>\n              </div>\n              <div className=\"min-w-[40px]\" />\n            </div>\n          </div>\n          <div className=\"border-b border-gray-200\" />\n        </header>\n        \n        <LoadingState \n          message=\"Loading prediction details...\"\n          className=\"py-20\"\n        />\n      </div>\n    );\n  }\n\n  // Error state\n  if (error && !prediction) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        {/* Consistent Header with AppHeader styling */}\n        <header className=\"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0\">\n          <div className=\"safe-px mx-auto max-w-screen-md\">\n            <div className=\"h-12 flex items-center justify-between gap-2 px-4\">\n              <div className=\"min-w-[40px] flex items-center\">\n                <button\n                  onClick={handleBack}\n                  className=\"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2\"\n                  aria-label=\"Go back\"\n                >\n                  <ArrowLeft className=\"w-5 h-5\" />\n                </button>\n              </div>\n              <div className=\"flex-1 text-center\">\n                <h1 className=\"text-base font-semibold leading-none truncate\">Error</h1>\n              </div>\n              <div className=\"min-w-[40px]\" />\n            </div>\n          </div>\n          <div className=\"border-b border-gray-200\" />\n        </header>\n        \n        <ErrorBanner\n          error=\"Failed to load prediction details\"\n          onRetry={loadPrediction}\n          className=\"m-4\"\n        />\n      </div>\n    );\n  }\n\n  // Not found state\n  if (!prediction && !loading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        {/* Consistent Header with AppHeader styling */}\n        <header className=\"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0\">\n          <div className=\"safe-px mx-auto max-w-screen-md\">\n            <div className=\"h-12 flex items-center justify-between gap-2 px-4\">\n              <div className=\"min-w-[40px] flex items-center\">\n                <button\n                  onClick={handleBack}\n                  className=\"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2\"\n                  aria-label=\"Go back\"\n                >\n                  <ArrowLeft className=\"w-5 h-5\" />\n                </button>\n              </div>\n              <div className=\"flex-1 text-center\">\n                <h1 className=\"text-base font-semibold leading-none truncate\">Not Found</h1>\n              </div>\n              <div className=\"min-w-[40px]\" />\n            </div>\n          </div>\n          <div className=\"border-b border-gray-200\" />\n        </header>\n        \n        <EmptyState\n          icon={BarChart3}\n          title=\"Prediction Not Found\"\n          description=\"The prediction you're looking for doesn't exist or has been removed.\"\n          action={{\n            label: 'Browse Predictions',\n            onClick: () => navigate('/discover')\n          }}\n          className=\"py-20\"\n        />\n      </div>\n    );\n  }\n\n  if (!prediction) return null;\n\n  const participantCount = prediction.participant_count || 0;\n  const totalVolume = prediction.pool_total || 0;\n\n  return (\n    <>\n      {/* Header - Consistent with AppHeader styling */}\n      <header className=\"w-full z-20 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 sticky top-0\">\n        <div className=\"safe-px mx-auto max-w-screen-md\">\n          <div className=\"h-12 flex items-center justify-between gap-2 px-4\">\n            <div className=\"min-w-[40px] flex items-center\">\n              <button\n                onClick={handleBack}\n                className=\"p-2 -ml-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2\"\n                aria-label=\"Go back\"\n              >\n                <ArrowLeft className=\"w-5 h-5\" />\n              </button>\n            </div>\n            <div className=\"flex-1 text-center\">\n              <h1 className=\"text-base font-semibold leading-none truncate\">Prediction Details</h1>\n            </div>\n            <div className=\"min-w-[40px] flex items-center justify-end gap-1\">\n              <button\n                onClick={handleShare}\n                className=\"p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100\"\n                aria-label=\"Share prediction\"\n              >\n                <Share2 className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n        </div>\n        <div className=\"border-b border-gray-200\" />\n      </header>\n\n      {/* Compact Hero Image - 16:9 aspect ratio as per spec */}\n      <div className=\"mx-4 mt-4 rounded-2xl overflow-hidden border border-gray-100 aspect-video\">\n        {mediaStatus === 'ready' && media?.url ? (\n          <img\n            src={media.url}\n            alt={media.alt || prediction?.title}\n            className=\"w-full h-full object-cover\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        ) : mediaStatus === 'loading' ? (\n          <div className=\"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 animate-pulse\" />\n        ) : (\n          <div className=\"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center\">\n            <div className=\"text-gray-500 text-center\">\n              <div className=\"text-2xl mb-2\">📊</div>\n              <div className=\"text-sm font-medium capitalize\">\n                {prediction?.category || 'Prediction'}\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Main content with proper bottom padding to avoid overlap with fixed elements */}\n      <main className=\"px-4 pb-[calc(var(--bottom-nav-h,64px)+72px+env(safe-area-inset-bottom))] pt-4 space-y-4 bg-gray-50\">\n        {/* Title and Creator */}\n        <div className=\"space-y-2\">\n          <TitleAndMeta title={prediction.title} creator={prediction.creator} />\n          {/* Category chip */}\n          {(() => {\n            const categoryLabel = getCategoryLabel(prediction);\n            return categoryLabel ? (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"inline-flex items-center rounded-full bg-gray-100 px-2.5 py-0.5 text-xs font-medium text-gray-700\">\n                  {categoryLabel}\n                </span>\n              </div>\n            ) : null;\n          })()}\n        </div>\n\n        {/* Tabs */}\n          <PredictionDetailsTabs\n            activeTab={activeTab}\n            onTabChange={setActiveTab}\n            commentCount={liveCommentCount || prediction.comments_count || 0}\n            activityCount={activityItems.length}\n          >\n          <AnimatePresence mode=\"wait\">\n            {activeTab === 'overview' && (\n              <motion.div\n                key=\"overview\"\n                initial={reduceMotion ? {} : { opacity: 0, x: -20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={reduceMotion ? {} : { opacity: 0, x: 20 }}\n                className=\"space-y-4\"\n              >\n                  {/* Prediction Stats */}\n                  <div className=\"bg-white rounded-2xl p-4 shadow-sm border\">\n                    <h3 className=\"text-base font-semibold text-gray-900 mb-3\">\n                      Prediction Details\n                    </h3>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"p-2 bg-emerald-100 rounded-lg\">\n                          <DollarSign className=\"w-5 h-5 text-emerald-600\" />\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Total Volume</p>\n                          <p className=\"font-semibold text-gray-900\">{formatCurrency(totalVolume, { compact: true })}</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-3\">\n                        <div className=\"p-2 bg-blue-100 rounded-lg\">\n                          <Users className=\"w-5 h-5 text-blue-600\" />\n                        </div>\n                        <div>\n                          <p className=\"text-sm text-gray-500\">Participants</p>\n                          <p className=\"font-semibold text-gray-900\">{participantCount}</p>\n                        </div>\n                      </div>\n                    </div>\n                    {isAuthenticated && predictionId && String(prediction.status || '').toLowerCase() !== 'open' && (\n                      <div className=\"mt-3\">\n                        <button\n                          type=\"button\"\n                          onClick={() => setSettlementModalOpen(true)}\n                          className=\"w-full px-4 py-2 rounded-xl border border-gray-200 bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors\"\n                        >\n                          Review Settlement\n                        </button>\n                      </div>\n                    )}\n                    {/* Creator actions */}\n                    {isCreator && !isClosedOrSettled && (\n                      <div className=\"mt-3 space-y-2\">\n                        <button\n                          type=\"button\"\n                          onClick={() => setEditSheetOpen(true)}\n                          className=\"w-full px-4 py-2 rounded-xl border border-gray-200 bg-white text-gray-900 font-semibold hover:bg-gray-50 transition-colors\"\n                        >\n                          Edit\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={() => setCancelSheetOpen(true)}\n                          className=\"w-full px-4 py-2 rounded-xl border border-red-200 bg-white text-red-600 font-semibold hover:bg-red-50 transition-colors\"\n                        >\n                          Cancel prediction\n                        </button>\n                      </div>\n                    )}\n                  </div>\n\n                  {/* Closed/Settled callout */}\n                  {isClosedOrSettled && (\n                    <div className=\"bg-yellow-50 border border-yellow-200 rounded-2xl p-3\">\n                      <div className=\"text-sm text-yellow-900 font-medium\">This prediction is closed.</div>\n                      <div className=\"text-xs text-yellow-800 mt-1\">\n                        {isSettled ? 'Results are finalized.' : `No new ${t('bets')} can be placed.`}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Description */}\n                  {prediction.description && (\n                    <div className=\"bg-white rounded-2xl p-4 shadow-sm border\">\n                      <h3 className=\"text-base font-semibold text-gray-900 mb-2\">\n                        Description\n                      </h3>\n                      <p className=\"text-sm text-gray-700 leading-relaxed\">\n                        {prediction.description}\n                      </p>\n                    </div>\n                  )}\n\n                  {/* Claim Winnings - shown when a connected wallet has a claimable amount and not locally claimed */}\n                  {!!walletAddress && !!merkle && Number(merkle.amountUnits) > 0 && !(() => {\n                    try {\n                      return Boolean(localStorage.getItem(`fcz:claimed:${predictionId}:${walletAddress.toLowerCase()}`));\n                    } catch { return false; }\n                  })() && (\n                    <div className=\"bg-gradient-to-br from-emerald-50 to-blue-50 rounded-2xl p-4 shadow-sm border border-emerald-100\">\n                      <div className=\"flex items-center justify-between gap-2\">\n                        <div>\n                          <h3 className=\"text-base font-semibold text-gray-900\">\n                            You have {t('winnings').toLowerCase()} to claim\n                          </h3>\n                          <p className=\"text-sm text-gray-600 mt-0.5\">\n                            Connected: <span className=\"font-mono\">{walletAddress.slice(0, 6)}…{walletAddress.slice(-4)}</span>\n                          </p>\n                        </div>\n                        <button\n                          type=\"button\"\n                          className=\"h-10 px-4 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n                          disabled={isClaiming || loadingProof}\n                          onClick={async () => {\n                            const units = BigInt(merkle.amountUnits);\n                            await claim({\n                              predictionId,\n                              amountUnits: units,\n                              proof: merkle.proof as `0x${string}`[],\n                            });\n                          }}\n                        >\n                          {isClaiming ? 'Claiming…' : `Claim ${formatCurrency(merkle.amountUSD, { compact: false })}`}\n                        </button>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* How This Works Section - Now outside tabs and compact */}\n                  <div className=\"bg-white rounded-2xl p-4 shadow-sm border\">\n                    <h3 className=\"text-base font-semibold text-gray-900 mb-2\">\n                      How This Works\n                    </h3>\n                    <ul className=\"space-y-1.5 text-sm text-gray-600\">\n                      <li>• Choose an outcome you believe will happen</li>\n                      <li>• Stake an amount you're comfortable with</li>\n                      <li>• If you're right, win based on the current odds</li>\n                      <li>• Betting closes when the prediction expires</li>\n                    </ul>\n                  </div>\n\n                  {/* Options Section - Only on Overview tab */}\n                  {(!isAuthenticated && String((prediction as any).status || '').toLowerCase() !== 'settled') ? (\n                    <SignInCallout\n                      onSignIn={() =>\n                        openAuthGate({\n                          intent: 'place_prediction',\n                          payload: { predictionId }\n                        })\n                      }\n                    />\n                  ) : (\n                    <OptionsSection\n                      options={prediction.options || []}\n                      selectedId={selectedOptionId || undefined}\n                      onSelect={handleOptionSelect}\n                      disabled={isPlacingBet || !isAuthenticated || String((prediction as any).status || '').toLowerCase() !== 'open'}\n                      winningOptionId={(prediction as any).winning_option_id || (prediction as any).winningOptionId}\n                      showWinningIndicator={String((prediction as any).status || '').toLowerCase() === 'settled'}\n                    />\n                  )}\n\n                  {justPlaced && (\n                    <div className=\"bg-emerald-50 border border-emerald-200 rounded-xl p-3 flex items-center justify-between\">\n                      <div className=\"text-sm text-emerald-800 font-medium\">\n                        You staked {isFiatMode ? `₦${justPlaced.amount.toFixed(0)}` : `$${justPlaced.amount.toFixed(2)}`} on “{justPlaced.optionLabel}”.\n                      </div>\n                      <button\n                        type=\"button\"\n                        onClick={() => setActiveTab('activity')}\n                        className=\"text-xs font-semibold text-emerald-700 hover:text-emerald-800 underline\"\n                      >\n                        View activity\n                      </button>\n                    </div>\n                  )}\n\n                  {/* Stake Input - Only shows after option selection */}\n                  {isAuthenticated && selectedOptionId && (\n                    <div className=\"bg-white rounded-2xl p-4 shadow-sm border space-y-3\">\n                      {/* Funding mode toggle (Demo/Fiat gated by feature flags + store-safe mode) */}\n                      {(showDemo || effectiveFiatEnabled || effectiveCryptoEnabled) && (\n                        <div className=\"inline-flex rounded-lg bg-gray-100 p-1 flex-wrap gap-1\">\n                          {effectiveCryptoEnabled && (\n                            <button\n                              onClick={() => setMode('crypto')}\n                              className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\n                                isCryptoMode ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'\n                              }`}\n                              type=\"button\"\n                            >\n                              Crypto (USDC)\n                            </button>\n                          )}\n                          {showDemo && (\n                            <button\n                              onClick={() => setMode('demo')}\n                              className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\n                                isDemoMode ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'\n                              }`}\n                              type=\"button\"\n                            >\n                              Demo Credits\n                            </button>\n                          )}\n                          {effectiveFiatEnabled && (\n                            <button\n                              onClick={() => setMode('fiat')}\n                              className={`px-3 py-1.5 text-sm font-medium rounded-md transition-colors ${\n                                isFiatMode ? 'bg-white text-gray-900 shadow-sm' : 'text-gray-600 hover:text-gray-900'\n                              }`}\n                              type=\"button\"\n                            >\n                              Fiat (NGN)\n                            </button>\n                          )}\n                        </div>\n                      )}\n\n                      <div>\n                        <label htmlFor=\"stake-input\" className=\"block text-sm font-medium text-gray-900 mb-2\">\n                          Stake Amount ({isFiatMode ? 'NGN' : 'USD'})\n                        </label>\n                        <div className=\"relative\">\n                          {isFiatMode ? (\n                            <Banknote className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n                          ) : (\n                            <DollarSign className=\"absolute left-3 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 pointer-events-none\" />\n                          )}\n                          <input\n                            id=\"stake-input\"\n                            type=\"number\"\n                            inputMode=\"decimal\"\n                            placeholder=\"0.00\"\n                            value={stakeAmount}\n                            onChange={(e) => setStakeAmount(e.target.value)}\n                            disabled={isPlacingBet}\n                            className=\"w-full rounded-xl border bg-background pl-10 pr-4 py-3 text-lg font-semibold transition-colors border-border focus:border-primary focus:ring-primary/20 focus:outline-none focus:ring-2 disabled:opacity-50\"\n                          />\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-gray-600\">\n                          Available: {(isFiatMode ? loadingFiat : (isDemoMode ? demoLoading : isLoadingBalance)) ? 'Loading…' : formatCurrency(userBalance, { compact: true, currency: isFiatMode ? 'NGN' : 'USD' })}\n                        </span>\n                        {stakeAmount && !(isFiatMode ? loadingFiat : (isDemoMode ? demoLoading : isLoadingBalance)) && parseFloat(stakeAmount) > userBalance && (\n                          <span className=\"text-red-600 font-medium\">Insufficient balance</span>\n                        )}\n                      </div>\n\n                      {isDemoMode && (\n                        <div className=\"pt-1\">\n                          <button\n                            type=\"button\"\n                            onClick={faucetDemo}\n                            disabled={demoLoading}\n                            className=\"w-full rounded-xl border bg-gray-50 px-4 py-2.5 text-sm font-semibold hover:bg-gray-100 transition-colors disabled:opacity-50\"\n                          >\n                            Get Demo Credits\n                          </button>\n                        </div>\n                      )}\n                      \n                      {/* Quick Amount Buttons */}\n                      <div className=\"grid grid-cols-3 gap-2\">\n                        {(isFiatMode ? [500, 1000, 2500, 5000, 10000, 25000] : [10, 25, 50, 100, 250, 500]).map((amount) => (\n                          <button\n                            key={amount}\n                            onClick={() => setStakeAmount(amount.toString())}\n                            disabled={isPlacingBet || amount > userBalance}\n                            className=\"rounded-lg border bg-gray-50 px-3 py-2 text-sm font-medium hover:bg-gray-100 transition-colors disabled:opacity-40 disabled:cursor-not-allowed\"\n                          >\n                            {isFiatMode ? `₦${amount.toLocaleString()}` : `$${amount}`}\n                          </button>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </motion.div>\n              )}\n\n              {activeTab === 'comments' && (\n                <motion.div\n                  key=\"comments\"\n                  initial={reduceMotion ? {} : { opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  exit={reduceMotion ? {} : { opacity: 0, x: 20 }}\n                  data-qa=\"comments-section\"\n                >\n                  <CommentsSection predictionId={predictionId} />\n                </motion.div>\n              )}\n\n              {activeTab === 'activity' && (\n                <motion.div\n                  key=\"activity\"\n                  initial={reduceMotion ? {} : { opacity: 0, x: -20 }}\n                  animate={{ opacity: 1, x: 0 }}\n                  exit={reduceMotion ? {} : { opacity: 0, x: 20 }}\n                >\n                  <ActivityFeed predictionId={predictionId} />\n                </motion.div>\n              )}\n            </AnimatePresence>\n          </PredictionDetailsTabs>\n\n      </main>\n\n      {/* Fixed Bet Bar - Above Bottom Navigation - Only on Overview tab */}\n      {activeTab === 'overview' && !isClosedOrSettled && (\n        (() => {\n          const amt = parseFloat(stakeAmount || '0');\n          const availableNow = isFiatMode ? fiatAvailable : (isDemoMode ? demoAvailable : availableToStake);\n          const need = Math.max(0, amt - availableNow);\n          const computedLabel = !amt || amt <= 0\n            ? t('betVerb')\n            : (need > 0\n                ? (isDemoMode\n                    ? `Get demo credits (need $${need.toFixed(2)})`\n                    : (isFiatMode ? `Deposit NGN (need ₦${need.toFixed(0)})` : `Add funds (need $${need.toFixed(2)})`))\n                : `${t('betVerb')}: ${isFiatMode ? `₦${amt.toFixed(0)}` : `$${amt.toFixed(2)}`}`);\n          const canBet = !!stakeAmount && amt > 0;\n          return (\n            <StickyBetBar\n              canBet={canBet}\n              onPlace={async () => {\n                if (isDemoMode && need > 0) {\n                  await faucetDemo();\n                  return;\n                }\n                if (isFiatMode && need > 0) {\n                  navigate('/wallet');\n                  return;\n                }\n                await handlePlaceBet();\n              }}\n              loading={isPlacingBet}\n              label={computedLabel}\n            />\n          );\n        })()\n      )}\n      \n      {/* Deposit Modal */}\n      {showDepositModal && currentUser?.id && (\n        <DepositUSDCModal\n          open={showDepositModal}\n          onClose={() => setShowDepositModal(false)}\n          onSuccess={() => setShowDepositModal(false)}\n          availableUSDC={walletUSDC}\n          userId={currentUser.id}\n        />\n      )}\n\n      <SettlementValidationModal\n        isOpen={settlementModalOpen}\n        onClose={() => setSettlementModalOpen(false)}\n        predictionId={predictionId}\n        predictionTitle={prediction?.title ?? 'Prediction'}\n        onValidated={() => {\n          queryClient.invalidateQueries({ queryKey: QK.prediction(predictionId) });\n          queryClient.invalidateQueries({ queryKey: QK.predictionEntries(predictionId) });\n        }}\n      />\n\n      {prediction && (\n        <>\n          <EditPredictionSheet\n            open={editSheetOpen}\n            onOpenChange={setEditSheetOpen}\n            prediction={prediction}\n            onSaved={(updated) => {\n              queryClient.invalidateQueries({ queryKey: QK.prediction(predictionId) });\n              fetchPredictionById(predictionId);\n            }}\n            userId={currentUser?.id}\n          />\n          <CancelPredictionSheet\n            open={cancelSheetOpen}\n            onOpenChange={setCancelSheetOpen}\n            prediction={prediction}\n            onCancelled={(updated) => {\n              queryClient.invalidateQueries({ queryKey: QK.prediction(predictionId) });\n              fetchPredictionById(predictionId);\n            }}\n            userId={currentUser?.id}\n          />\n        </>\n      )}\n    </>\n  );\n};\n\nexport default PredictionDetailsPage;\n"],"names":["Heart","createLucideIcon","LogIn","transformComment","serverComment","classifyError","error","useUnifiedCommentStore","create","devtools","set","get","predictionId","state","response","apiClient","socialError","qaLog","items","nextCursor","errorStatus","currentState","currentPage","newItems","text","trimmedText","user","useAuthStore","tempId","optimisticComment","currentItems","item","commentId","originalComment","c","updatedComment","originalItems","draft","_state","PredictionDetailsTabs","activeTab","onTabChange","commentCount","activityCount","participantCount","children","tabs","BarChart3","MessageCircle","Activity","jsxs","jsx","tab","index","Icon","cn","PredictionDetailsTabs$1","CommentInput","onSubmit","isPosting","placeholder","setText","useState","useAuthSession","handleSubmit","e","openAuthGate","Send","CommentItem","comment","onToggleLike","handleLikeClick","likeCount","isLiked","createdAt","content","username","avatarUrl","Clock","formatDistanceToNow","CommentListSkeleton","count","_","CommentList","comments","isLoading","hasMore","onLoadMore","CommentsSection","className","getComments","getCommentCount","getStatus","isPostingFn","hasMoreFn","fetchComments","loadMore","addComment","predictionComments","predictionStatus","predictionPosting","predictionHasMore","useEffect","toast","handleAddComment","message","handleToggleLike","handleLoadMore","showCount","MessageSquare","LoadingState","size","fullScreen","sizeClasses","motion","Loader2","LoadingState$1","ErrorBanner","onRetry","onDismiss","type","showRetry","showDismiss","styles","AnimatePresence","AlertCircle","RefreshCw","X","ErrorBanner$1","EmptyState","title","description","action","EmptyState$1","ActivityItemComponent","activity","actor","data","actorName","t","formatCurrency","DollarSign","TrendingUp","User","formatTimeAgo","ActivityFeed","loading","refresh","useActivityFeed","SignInCallout","onSignIn","TitleAndMeta","creator","CreatorByline","OptionsSection","options","selectedId","onSelect","disabled","winningOptionId","showWinningIndicator","option","odds","isSelected","percentage","isWinning","StickyBetBar","canBet","onPlace","label","SettlementValidationModal","isOpen","onClose","predictionTitle","onValidated","settlementStatus","setSettlementStatus","setLoading","validating","setValidating","disputeReason","setDisputeReason","showDisputeForm","setShowDisputeForm","statusError","setStatusError","history","setHistory","historyLoading","setHistoryLoading","historyError","setHistoryError","finalizeStatus","setFinalizeStatus","finalizeLoading","setFinalizeLoading","finalizeSubmitting","setFinalizeSubmitting","sessionUser","userId","parseApiErrorMessage","res","fallback","json","txt","fetchSettlementStatus","fetchHistory","fetchFinalizeStatus","getApiUrl","handleRequestFinalize","handleAdminFinalize","adminKey","entered","adminPost","handleValidation","Fragment","isDispute","name","AlertTriangle","CheckCircle","SettlementValidationModal$1","EditPredictionSheet","open","onOpenChange","prediction","onSaved","setTitle","setDescription","setOptions","opt","closesAt","setClosesAt","category","setCategory","isSaving","setIsSaving","errors","setErrors","hasEntries","oldDeadline","validateForm","newErrors","labels","o","uniqueLabels","newDeadline","handleAddOption","handleRemoveOption","i","handleOptionChange","updated","handleSave","effectiveUserId","sessionData","supabase","accessToken","payload","idx","oldOpt","result","Dialog.Root","Dialog.Portal","Dialog.Overlay","Dialog.Content","Dialog.Title","Dialog.Close","Trash2","Plus","Calendar","CancelPredictionSheet","onCancelled","reason","setReason","isCancelling","setIsCancelling","handleCancel","useMerkleProof","address","useQuery","QK","params","body","AriaUtils","showSuccessToast","showErrorToast","PredictionDetailsPage","propPredictionId","navigate","useNavigate","location","useLocation","useParams","locationState","useRef","returnToRef","storeAuth","storeUser","isAuthenticated","currentUser","s","liveCommentCount","selectedOptionId","setSelectedOptionId","stakeAmount","setStakeAmount","isPlacingBet","setIsPlacingBet","initialTab","setActiveTab","tabFromUrl","shareUrl","setShareUrl","showDepositModal","setShowDepositModal","justPlaced","setJustPlaced","settlementModalOpen","setSettlementModalOpen","editSheetOpen","setEditSheetOpen","cancelSheetOpen","setCancelSheetOpen","predictions","fetchPredictionById","placePrediction","usePredictionStore","queryClient","useQueryClient","walletUSDC","escrowAvailableUSD","escrowLockedUSD","escrowTotalUSD","isLoadingBalance","refetchBalances","useUnifiedBalance","walletAddress","useAccount","lowerWallet","isSettled","useMemo","p","merkle","loadingProof","claim","isClaiming","useMerkleClaim","availableToStake","mode","setMode","isDemoEnabled","isFiatEnabled","setFiatEnabled","useFundingModeStore","capabilities","Runtime","showDemo","effectiveFiatEnabled","effectiveCryptoEnabled","paystackStatus","usePaystackStatus","fiatData","loadingFiat","useFiatSummary","isDemoMode","isFiatMode","isCryptoMode","demoSummary","setDemoSummary","demoLoading","setDemoLoading","fetchDemoSummary","useCallback","resp","faucetDemo","nextMs","remaining","isCreator","isClosedOrSettled","status","mediaMetadata","poolTotal","baseKeywords","value","attributeHints","media","mediaStatus","useMedia","demoAvailable","fiatAvailable","userBalance","loadPrediction","activityItems","refreshActivity","usePredictionActivity","slug","canonical","link","handleBack","returnTo","handleShare","handleCopyLink","handleOptionSelect","optionId","handlePlaceBet","amount","maxAvailable","optionLabel","ArrowLeft","totalVolume","Share2","categoryLabel","getCategoryLabel","Users","units","Banknote","amt","need","computedLabel","DepositUSDCModal"],"mappings":"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","x_google_ignoreList":[0,1]}