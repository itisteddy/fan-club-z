import{r as b}from"./vendor-499a370b.js";import{u as k,a as z}from"./DepositUSDCModal-2048ba50.js";import{Q as R,u as T}from"./index-6112b649.js";import{d as W}from"./utils-17ec81d9.js";import{u as x}from"./useWriteContract-ab9d8160.js";function M(a,v={}){const{walletAddress:f,enabled:l=!0,refetchIntervalMs:n=1e4}=v,t=f?.toLowerCase()??null;return W({queryKey:R.walletSummary(a??"anon",t),enabled:!!a&&l,refetchInterval:n,queryFn:async()=>{if(!a)throw new Error("userId is required to load wallet summary");const o=new URLSearchParams;t&&o.set("walletAddress",t);const s=await fetch(`/api/wallet/summary/${a}${o.size?`?${o.toString()}`:""}`,{headers:{Accept:"application/json"}});if(!s.ok){const d=await s.json().catch(()=>({}));throw new Error(d.message||"Failed to load wallet summary")}const e=await s.json();return{currency:"USD",available:Number(e.available??0),reserved:Number(e.reserved??0),total:Number(e.total??0),availableToStakeUSDC:Number(e.availableToStakeUSDC??e.available??0),reservedUSDC:Number(e.reservedUSDC??e.reserved??0),escrowUSDC:Number(e.escrowUSDC??e.total??0),totalDeposited:Number(e.totalDeposited??e.totalDepositedUSDC??0),totalWithdrawn:Number(e.totalWithdrawn??e.totalWithdrawnUSDC??0),updatedAt:e.updatedAt??e.updated_at??new Date().toISOString(),walletAddress:e.walletAddress??e.wallet_address??null}}})}function I(){const{user:a}=T(),{address:v}=x(),{balance:f,isLoading:l,error:n,refetch:t}=k(),{availableUSD:o,reservedUSD:s,totalUSD:e,isLoading:d,error:S,refetch:h}=z(),{data:r,isLoading:g,error:p,refetch:D}=M(a?.id,{walletAddress:v,refetchIntervalMs:1e4,enabled:!!a?.id}),U=Number(r?.availableToStakeUSDC??r?.available??o??0),y=Number(r?.reservedUSDC??r?.reserved??s??0),E=Number(r?(r.availableToStakeUSDC??0)+(r.reservedUSDC??0):e??U+y),c=Math.max(U,0),i=Math.max(y,0),u=Math.max(E,0),m=b.useRef({available:c,reserved:i,total:u});b.useEffect(()=>{m.current={available:c,reserved:i,total:u}},[c,i,u]);const w=l||d||g,L=w?m.current.available:c,N=w?m.current.reserved:i,B=w?m.current.total:u,C=()=>{t(),h(),a?.id&&D()};return b.useEffect(()=>{const A=()=>{console.log("[FCZ] Balance refresh requested"),C()};return window.addEventListener("fcz:balance:refresh",A),()=>window.removeEventListener("fcz:balance:refresh",A)},[a?.id]),{wallet:f||0,available:L,locked:N,total:B,summary:r,isLoading:w,isWalletLoading:l,isEscrowLoading:d,error:n||S||p,walletError:n,escrowError:S,summaryError:p,refetch:C,refetchWallet:t,refetchEscrow:h,refetchSummary:D}}export{I as u};
