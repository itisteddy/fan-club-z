import{j as e,m as p,A as M}from"./ui-7ef4368a.js";import{r as h}from"./vendor-2237fdcd.js";import{u as Q}from"./predictionStore-415d4c1d.js";import{m as D,B as I,k as H,o as $,L as Z,R as ee,X as se,u as te,v as ae,a as re,d as ie,z as R}from"./index-6760ed68.js";import{A as ne}from"./AppHeader-c71ea18b.js";import{H as U,M as P,a as le}from"./unifiedCommentStore-aa9c069b.js";import{A as oe}from"./activity-729797e0.js";import{U as ce}from"./UserAvatar-555ceab5.js";import{A as de,S as me}from"./share-2-f6dc3e7f.js";import{A as v}from"./arrow-left-d90f7379.js";import{D as xe}from"./dollar-sign-db1409ae.js";import{U as E}from"./users-690cce10.js";import"./utils-fa2f248f.js";import"./index-ad3745ce.js";import"./utils-95db8db5.js";const he=({prediction:s,selectedOptionId:n,stakeAmount:r,isPlacingBet:c,userBalance:l,onOptionSelect:a,onStakeChange:t,onPlaceBet:u,onLike:d,onComment:g})=>s.status==="open"?e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choose an option:"}),e.jsx("div",{className:"grid gap-2",children:s.options.map(x=>e.jsx("button",{onClick:()=>a(x.id),className:`p-3 rounded-lg border-2 transition-all ${n===x.id?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:x.label}),e.jsx("span",{className:"text-sm text-gray-600",children:x.odds?`${x.odds.toFixed(2)}x`:"1.00x"})]})},x.id))})]}),n&&e.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stake Amount (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:r,onChange:x=>t(x.target.value),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",min:"0",step:"0.01"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Balance: $",l.toLocaleString()]})]}),e.jsx("button",{onClick:u,disabled:!r||c||parseFloat(r)>l,className:`w-full py-3 rounded-lg font-semibold transition-colors ${!r||c||parseFloat(r)>l?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:c?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Placing Bet..."})]}):`Place Bet - $${r||"0.00"}`})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-8 pt-2 border-t border-gray-100",children:[e.jsxs("button",{onClick:d,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors ${s.isLiked?"bg-red-50 text-red-600":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(U,{className:`w-4 h-4 ${s.isLiked?"fill-current":""}`}),e.jsx("span",{children:s.likeCount||0})]}),e.jsxs("button",{onClick:g,className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-50 text-gray-600 hover:bg-gray-100 transition-colors",children:[e.jsx(P,{className:"w-4 h-4"}),e.jsx("span",{children:s.commentCount||0})]})]})]}):e.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-8 max-w-md mx-auto",children:[e.jsxs("button",{onClick:d,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${s.isLiked?"bg-red-50 text-red-600":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(U,{className:`w-5 h-5 ${s.isLiked?"fill-current":""}`}),e.jsx("span",{children:s.likeCount||0})]}),e.jsxs("button",{onClick:g,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-gray-50 text-gray-600 hover:bg-gray-100 transition-colors",children:[e.jsx(P,{className:"w-5 h-5"}),e.jsx("span",{children:s.commentCount||0})]})]})}),ue=({activeTab:s,onTabChange:n,commentCount:r=0,participantCount:c=0,children:l})=>{const a=[{id:"overview",label:"Overview",count:0,icon:I},{id:"comments",label:"Comments",count:r,icon:P},{id:"activity",label:"Activity",count:c,icon:oe}];return e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:a.map((t,u)=>{const d=t.icon;return e.jsxs("button",{onClick:()=>n(t.id),className:D("px-3 py-1 rounded-lg text-sm font-medium transition-colors",s===t.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(d,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:t.label}),e.jsx("span",{className:"sm:hidden",children:t.id==="overview"?"Overview":t.id==="comments"?"Comments":"Activity"})]}),t.count>0&&e.jsx("span",{className:D("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold",s===t.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:t.count>99?"99+":t.count})]},t.id)})})})}),e.jsx("div",{className:"min-h-screen",children:l})]})};function ge(s){const n=typeof s=="string"?new Date(s):s,r=new Date,c=Math.floor((r.getTime()-n.getTime())/1e3);if(c<60)return"just now";const l=Math.floor(c/60);if(l<60)return`${l}m ago`;const a=Math.floor(l/60);if(a<24)return`${a}h ago`;const t=Math.floor(a/24);if(t<7)return`${t}d ago`;const u=Math.floor(t/7);return u<4?`${u}w ago`:n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:n.getFullYear()!==r.getFullYear()?"numeric":void 0})}function pe({predictionId:s}){const{user:n}=H(),[r,c]=h.useState(""),[l,a]=h.useState(!1),{getComments:t,getCommentCount:u,addComment:d,fetchComments:g,hasMore:j,loadMore:x}=le(),y=t(s)||[],b=u(s);h.useEffect(()=>{g(s)},[s,g]);const f=async()=>{if(!(!r.trim()||l)){a(!0);try{await d(s,r.trim()),c("")}catch(o){console.error("Failed to post comment:",o)}finally{a(!1)}}},k=o=>{o.key==="Enter"&&(o.metaKey||o.ctrlKey)&&(o.preventDefault(),f())};return e.jsxs("section",{className:"px-4 mx-auto max-w-screen-md",children:[n?e.jsxs("div",{className:"rounded-2xl border border-gray-200 p-4 mb-6",children:[e.jsx("textarea",{value:r,onChange:o=>c(o.target.value),onKeyDown:k,placeholder:"Share your thoughtsâ€¦",className:"w-full min-h-[72px] resize-none border-0 outline-none text-sm placeholder-gray-500",disabled:l}),e.jsxs("div",{className:"flex justify-between items-center mt-3 pt-3 border-t border-gray-100",children:[e.jsx("div",{className:"text-xs text-gray-500",children:b>0?`${b} comments`:"Be the first to comment"}),e.jsx("button",{onClick:f,disabled:l||!r.trim(),className:"px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-medium hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors min-w-[80px]",style:{minHeight:"44px"},children:l?"Posting...":"Post"})]})]}):e.jsx("div",{className:"rounded-2xl border border-gray-200 p-4 mb-6",children:e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{children:"Sign in to join the discussion. "}),e.jsx("button",{onClick:()=>$({intent:"comment"}),className:"text-emerald-600 hover:text-emerald-700 font-medium underline",children:"Sign in"})]})}),e.jsx("ul",{className:"space-y-4",children:y.map(o=>e.jsx("li",{className:"rounded-2xl border border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ce,{email:o.user?.email,username:o.user?.username||o.user?.firstName,avatarUrl:o.user?.avatarUrl,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:o.user?.username?`@${o.user.username}`:o.user?.firstName||"User"}),e.jsx("time",{className:"text-xs text-gray-500 flex-shrink-0",children:ge(o.createdAt)})]}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:o.text})]})]})},o.id))}),j&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("button",{onClick:()=>x(s),className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors",children:"Load more comments"})}),y.length===0&&!n&&e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No comments yet."})}),y.length===0&&n&&e.jsx("div",{className:"text-center py-6",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No comments yet. Your comment will be the first!"})})]})}const ye=({message:s="Loading...",size:n="md",className:r="",fullScreen:c=!1})=>{const a=(()=>{switch(n){case"sm":return{spinner:"h-4 w-4",text:"text-sm",container:"py-4"};case"lg":return{spinner:"h-8 w-8",text:"text-lg",container:"py-8"};case"md":default:return{spinner:"h-6 w-6",text:"text-base",container:"py-6"}}})(),t=e.jsxs("div",{className:`flex flex-col items-center justify-center ${a.container} ${r}`,children:[e.jsx(p.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:`${a.spinner} text-emerald-500`,children:e.jsx(Z,{className:"h-full w-full"})}),s&&e.jsx("p",{className:`mt-3 text-gray-600 ${a.text}`,children:s})]});return c?e.jsx("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50",children:t}):t},be=({error:s,onRetry:n,onDismiss:r,type:c="error",showRetry:l=!0,showDismiss:a=!1,className:t=""})=>{const d=(()=>{switch(c){case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:"text-yellow-600"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"};case"error":default:return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"}}})();return e.jsx(M,{children:e.jsx(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:`rounded-lg border p-4 ${d.bg} ${d.border} ${t}`,role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(de,{className:`h-5 w-5 ${d.icon}`})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsx("p",{className:`text-sm font-medium ${d.text}`,children:s})}),e.jsxs("div",{className:"ml-3 flex space-x-2",children:[l&&n&&e.jsxs("button",{onClick:n,className:`inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors ${d.text} hover:bg-white/50`,"aria-label":"Retry",children:[e.jsx(ee,{className:"h-3 w-3"}),"Retry"]}),a&&r&&e.jsx("button",{onClick:r,className:`inline-flex items-center rounded-md p-1 transition-colors ${d.text} hover:bg-white/50`,"aria-label":"Dismiss",children:e.jsx(se,{className:"h-4 w-4"})})]})]})})})},fe=({icon:s,title:n,description:r,action:c,className:l=""})=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex flex-col items-center justify-center py-12 px-6 text-center ${l}`,children:[s&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(s,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:n}),r&&e.jsx("p",{className:"text-gray-600 mb-6 max-w-sm",children:r}),c&&e.jsx(p.button,{className:"bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",onClick:c.onClick,whileHover:{scale:1.02},whileTap:{scale:.98},children:c.label})]}),S={announce:s=>console.log("Announce:",s)},z=s=>R.success(s),w=s=>R.error(s),Ue=({predictionId:s})=>{const n=te(),r=ae(),{user:c,isAuthenticated:l}=H(),a=s||r.id||r.predictionId||"",[t,u]=h.useState(null),[d,g]=h.useState(""),[j,x]=h.useState(!1),[y,b]=h.useState("overview"),[f,k]=h.useState(""),{predictions:o,fetchPredictionById:A,placePrediction:G,togglePredictionLike:O,loading:L,error:K}=Q();re();const{getBalance:T}=ie(),i=h.useMemo(()=>a&&o.find(m=>m.id===a)||null,[o,a]),V=h.useMemo(()=>l?T():0,[l,T]),C=h.useCallback(async()=>{if(!a){console.log("âŒ No prediction ID found"),n("/discover");return}try{console.log("ðŸ” Loading prediction:",a),await A(a)}catch(m){console.error("âŒ Error loading prediction:",m),w("Failed to load prediction details")}},[a,A,n]);h.useEffect(()=>{C()},[C]),h.useEffect(()=>{typeof window<"u"&&k(window.location.href)},[a]);const N=()=>{window.history.length>1?window.history.back():n("/discover")},q=async()=>{if(navigator.share&&i)try{await navigator.share({title:i.title,text:`Check out this prediction: ${i.title}`,url:f})}catch{F()}else F()},F=async()=>{try{await navigator.clipboard.writeText(f),z("Link copied to clipboard!"),S.announce("Link copied to clipboard")}catch(m){console.error("Failed to copy link:",m),w("Failed to copy link")}},W=m=>{u(m===t?null:m),m!==t&&g("")},Y=async()=>{if(!l){$({intent:"place_prediction",payload:{predictionId:a}});return}if(!(!t||!d||!i)){x(!0);try{await G({predictionId:i.id,optionId:t,amount:parseFloat(d)}),z(`Prediction placed! $${d} on your choice.`),S.announce(`Prediction placed successfully for ${d} dollars`),u(null),g(""),b("activity")}catch(m){console.error("Error placing prediction:",m),w("Failed to place prediction. Please try again.")}finally{x(!1)}}},_=async()=>{if(!l){$({intent:"like_prediction",payload:{predictionId:a}});return}if(i)try{await O(i.id),S.announce(i.isLiked?"Prediction unliked":"Prediction liked")}catch(m){console.error("Error toggling like:",m),w("Failed to update like")}},X=()=>{b("comments"),setTimeout(()=>{const m=document.querySelector('[data-qa="comments-section"]');m&&m.scrollIntoView({behavior:"smooth",block:"start"})},100)};if(L&&!i)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(v,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Loading..."})]})})}),e.jsx(ye,{message:"Loading prediction details...",className:"py-20"})]});if(K&&!i)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(v,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Error"})]})})}),e.jsx(be,{message:"Failed to load prediction details",onRetry:C,className:"m-4"})]});if(!i&&!L)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(v,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Not Found"})]})})}),e.jsx(fe,{icon:I,title:"Prediction Not Found",description:"The prediction you're looking for doesn't exist or has been removed.",primaryAction:{label:"Browse Predictions",onClick:()=>n("/discover")},className:"py-20"})]});if(!i)return null;const B=i.participants?.length||0,J=i.totalVolume||"0.00";return e.jsxs(e.Fragment,{children:[e.jsx(ne,{title:"Prediction",left:e.jsx("button",{onClick:N,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(v,{className:"w-5 h-5 text-gray-600"})}),right:e.jsx("button",{onClick:q,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Share prediction",children:e.jsx(me,{className:"h-5 w-5"})})}),e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"pb-safe",children:[e.jsx(ue,{activeTab:y,onTabChange:b,commentCount:i.commentCount,participantCount:B,children:e.jsxs(M,{mode:"wait",children:[y==="overview"&&e.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight mb-2",children:i.title}),i.creator&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{children:"Created by"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:i.creator.firstName||i.creator.email?.split("@")[0]||"User"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prediction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(xe,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Volume"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:["$",J]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Participants"}),e.jsx("p",{className:"font-semibold text-gray-900",children:B})]})]})]})]}),i.description&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:i.description})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"How This Works"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsx("p",{children:"â€¢ Choose an outcome you believe will happen"}),e.jsx("p",{children:"â€¢ Stake an amount you're comfortable with"}),e.jsx("p",{children:"â€¢ If you're right, win based on the current odds"}),e.jsx("p",{children:"â€¢ Betting closes when the prediction expires"})]})]})]},"overview"),y==="comments"&&e.jsx(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},"data-qa":"comments-section",className:"p-6",children:e.jsx(pe,{predictionId:a})},"comments"),y==="activity"&&e.jsx(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Activity feed coming soon"}),e.jsx("p",{className:"text-sm mt-2",children:"Track predictions, settlements, and community engagement"})]})]})},"activity")]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-20 safe-area-inset",children:e.jsx(he,{prediction:{id:i.id,status:i.status,options:i.options||[],likeCount:i.likeCount,commentCount:i.commentCount,isLiked:i.isLiked},selectedOptionId:t,stakeAmount:d,isPlacingBet:j,userBalance:V,onOptionSelect:W,onStakeChange:g,onPlaceBet:Y,onLike:_,onComment:X})})]})})]})};export{Ue as default};
