import{a4 as M,z as x,X as P,B as R,k as B,y as E,A as I,c as T}from"./index-78beacc5.js";import{j as e}from"./ui-c369d1f3.js";import{r}from"./vendor-c36eaa8e.js";import{u as G,c as H,d as Q,b as V}from"./useFiatWallet-4b2d48ae.js";import{b as U,a as Y}from"./utils-617af415.js";import{u as _}from"./useWalletConnectSession-1627a74c.js";import{m as K,t as $,j as L}from"./wagmi-c444efa6.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=M("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=M("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=M("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),Z=[500,1e3,2e3,5e3,1e4],ie=({open:p,onClose:i,userId:c,userEmail:h,onSuccess:j})=>{const[n,b]=r.useState(""),{data:l}=G(),{mutateAsync:o,isPending:a}=H(),d=l?.minDepositNgn||100,g=r.useCallback(s=>{const u=s.target.value.replace(/[^0-9.]/g,"");b(u)},[]),N=r.useCallback(s=>{b(s.toString())},[]),f=r.useCallback(async()=>{const s=parseFloat(n);if(isNaN(s)||s<d){x.error(`Minimum deposit is ₦${d}`);return}try{const u=await o({amountNgn:s,userId:c,email:h});u.authorizationUrl?(x.success("Redirecting to Paystack..."),window.location.href=u.authorizationUrl):x.error("Failed to initialize payment")}catch(u){x.error(u?.response?.data?.message||"Failed to start deposit")}},[n,d,o,c,h]);if(!p)return null;const m=parseFloat(n)||0,v=m>=d;return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:i}),e.jsxs("div",{className:"relative w-full md:max-w-md bg-white rounded-t-3xl md:rounded-2xl shadow-2xl z-10 mb-[calc(72px+env(safe-area-inset-bottom,0px))] pb-[env(safe-area-inset-bottom,0px)] max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white/95 backdrop-blur px-6 pt-6 pb-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Deposit NGN"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Via Paystack"})]})]}),e.jsx("button",{onClick:i,className:"p-2 rounded-full hover:bg-gray-100 transition-colors","aria-label":"Close",children:e.jsx(P,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (NGN)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg font-medium",children:"₦"}),e.jsx("input",{type:"text",inputMode:"decimal",value:n,onChange:g,placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 text-2xl font-semibold text-gray-900 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Minimum deposit: ₦",d.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quick Select"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Z.map(s=>e.jsxs("button",{onClick:()=>N(s),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${parseFloat(n)===s?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["₦",s.toLocaleString()]},s))})]}),e.jsxs("div",{className:"bg-blue-50 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(R,{className:"w-5 h-5 text-blue-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"How it works"}),e.jsx("p",{className:"text-blue-700",children:"You'll be redirected to Paystack to complete your payment securely. Your balance will update automatically once payment is confirmed."})]})]}),e.jsx("button",{onClick:f,disabled:!v||a,className:"w-full py-4 bg-green-600 text-white rounded-xl font-semibold text-lg hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-5 h-5 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:["Deposit ₦",m>0?m.toLocaleString():"0"]})}),e.jsx("p",{className:"text-center text-xs text-gray-400",children:"Secured by Paystack"})]})]})]})},z=200,ce=({open:p,onClose:i,userId:c,fiatSummary:h,onSuccess:j})=>{const[n,b]=r.useState(""),[l,o]=r.useState(""),[a,d]=r.useState(""),[g,N]=r.useState(""),[f,m]=r.useState("form"),v=U(),{data:s,isLoading:u}=Q(),w=Y({mutationFn:async t=>await V.post("/fiat/withdrawals",t),onSuccess:()=>{v.invalidateQueries({queryKey:["fiat"]}),v.invalidateQueries({queryKey:["wallet"]}),m("success"),j?.()}}),k=h?.availableNgn||0,y=parseFloat(n)||0,C=y>=z&&y<=k&&l&&a.length===10,D=s?.find(t=>t.code===l),W=r.useCallback(t=>{const A=t.target.value.replace(/[^0-9.]/g,"");b(A)},[]),q=r.useCallback(t=>{const A=t.target.value.replace(/[^0-9]/g,"").slice(0,10);d(A)},[]),F=r.useCallback(async()=>{if(C){if(f==="form"){m("confirm");return}try{await w.mutateAsync({amountNgn:y,userId:c,bankCode:l,accountNumber:a,accountName:g||void 0})}catch(t){x.error(t?.response?.data?.message||"Failed to create withdrawal request")}}},[C,f,y,c,l,a,g,w]),S=r.useCallback(()=>{m("form"),b(""),o(""),d(""),N(""),i()},[i]);return p?e.jsxs("div",{className:"fixed inset-0 z-50 flex items-end md:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:S}),e.jsxs("div",{className:"relative w-full md:max-w-md bg-white rounded-t-3xl md:rounded-2xl shadow-2xl z-10 mb-[calc(72px+env(safe-area-inset-bottom,0px))] pb-[env(safe-area-inset-bottom,0px)] max-h-[85vh] overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 bg-white/95 backdrop-blur px-6 pt-6 pb-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-amber-100 flex items-center justify-center",children:e.jsx(O,{className:"w-5 h-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Withdraw NGN"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Available: ₦",k.toLocaleString()]})]})]}),e.jsx("button",{onClick:S,className:"p-2 rounded-full hover:bg-gray-100",children:e.jsx(P,{className:"w-5 h-5 text-gray-500"})})]})}),e.jsx("div",{className:"p-6 space-y-6",children:f==="success"?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(E,{className:"w-8 h-8 text-green-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Request Submitted"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Your withdrawal request for ₦",y.toLocaleString()," has been submitted. It will be reviewed and processed shortly."]}),e.jsx("button",{onClick:S,className:"px-6 py-2 bg-gray-100 text-gray-700 rounded-lg font-medium hover:bg-gray-200",children:"Done"})]}):f==="confirm"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-amber-50 rounded-xl p-4 flex items-start gap-3",children:[e.jsx(I,{className:"w-5 h-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-amber-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"Please confirm your withdrawal"}),e.jsx("p",{children:"Double-check the bank details before submitting."})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Amount"}),e.jsxs("span",{className:"font-semibold",children:["₦",y.toLocaleString()]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Bank"}),e.jsx("span",{className:"font-medium",children:D?.name||l})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Account"}),e.jsx("span",{className:"font-mono",children:a})]}),g&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Name"}),e.jsx("span",{className:"font-medium",children:g})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m("form"),className:"flex-1 py-3 border border-gray-200 text-gray-700 rounded-xl font-medium hover:bg-gray-50",children:"Back"}),e.jsx("button",{onClick:F,disabled:w.isPending,className:"flex-1 py-3 bg-amber-600 text-white rounded-xl font-semibold hover:bg-amber-700 disabled:bg-gray-300 flex items-center justify-center gap-2",children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):"Confirm Withdrawal"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount (NGN)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg",children:"₦"}),e.jsx("input",{type:"text",inputMode:"decimal",value:n,onChange:W,placeholder:"0.00",className:"w-full pl-10 pr-4 py-3 text-xl font-semibold border border-gray-200 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsxs("div",{className:"mt-2 flex justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Min: ₦",z.toLocaleString()]}),e.jsxs("button",{type:"button",onClick:()=>b(k.toString()),className:"text-amber-600 font-medium hover:underline",children:["Max: ₦",k.toLocaleString()]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bank"}),e.jsxs("select",{value:l,onChange:t=>o(t.target.value),className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent",disabled:u,children:[e.jsx("option",{value:"",children:"Select a bank"}),s?.map(t=>e.jsx("option",{value:t.code,children:t.name},t.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Account Number"}),e.jsx("input",{type:"text",inputMode:"numeric",value:a,onChange:q,placeholder:"Enter 10-digit account number",maxLength:10,className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent font-mono"}),a.length>0&&a.length<10&&e.jsxs("p",{className:"mt-1 text-xs text-amber-600",children:[10-a.length," digits remaining"]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Account Name ",e.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),e.jsx("input",{type:"text",value:g,onChange:t=>N(t.target.value),placeholder:"Enter account holder name",className:"w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-amber-500 focus:border-transparent"})]}),e.jsx("button",{onClick:F,disabled:!C,className:"w-full py-4 bg-amber-600 text-white rounded-xl font-semibold text-lg hover:bg-amber-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Continue"}),e.jsx("p",{className:"text-center text-xs text-gray-400",children:"Withdrawals are reviewed before processing"})]})})]})]}):null};function oe(){const{chainId:p,isConnected:i,address:c}=K(),{switchChainAsync:h}=$(),{recoverFromError:j}=_(),{sessionHealthy:n}=T();r.useEffect(()=>{if(!i||!c||p===L.id||n===!1)return;const l=setTimeout(async()=>{try{await h({chainId:L.id}),x.success("Switched to Base Sepolia")}catch(o){const a=String(o?.message||o).toLowerCase();a.includes("connect")&&a.includes("before request")?(await j({attemptReconnect:!0,silent:!0}),x.error("Wallet connection lost. Please reconnect your wallet, then switch to Base Sepolia.")):x.error("Switch network failed. Please switch to Base Sepolia in your wallet.")}},500);return()=>clearTimeout(l)},[p,i,c,h,j,n])}export{le as A,ie as F,ce as a,oe as u};
