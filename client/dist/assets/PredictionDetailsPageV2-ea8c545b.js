import{j as e,m as p,A as K}from"./ui-78f6af00.js";import{r as y}from"./vendor-2237fdcd.js";import{u as le}from"./predictionStore-9decf1a2.js";import{e as q,k as Z,B as Q,i as I,o as z,r as ce,t as de,v as P,u as ee,z as k,d as me,R as xe,X as ue,c as he,w as ye,a as ge}from"./index-c088a804.js";import{A as be}from"./activity-426a18e7.js";import{f as fe,c as pe}from"./utils-228faac7.js";import{C as je,M as Ne,A as we,S as ve}from"./share-2-671fd934.js";import{u as Pe}from"./useMedia-d4e07280.js";import{A as E}from"./arrow-left-aed3d631.js";import{D as ke}from"./dollar-sign-16a9c6de.js";import{U as W}from"./users-5f3355f5.js";import"./index-50eb3521.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=q("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=q("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=q("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),Se=({prediction:t,selectedOptionId:l,stakeAmount:s,isPlacingBet:r,userBalance:a,onOptionSelect:i,onStakeChange:n,onPlaceBet:c,onLike:o,onComment:m})=>t.status==="open"?e.jsxs("div",{className:"bg-white border-t border-gray-200 p-4 space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Choose an option:"}),e.jsx("div",{className:"grid gap-2",children:t.options.map(h=>e.jsx("button",{onClick:()=>i(h.id),className:`p-3 rounded-lg border-2 transition-all ${l===h.id?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"font-medium",children:h.label}),e.jsx("span",{className:"text-sm text-gray-600",children:h.odds?`${h.odds.toFixed(2)}x`:"1.00x"})]})},h.id))})]}),l&&e.jsxs(p.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stake Amount (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:s,onChange:h=>n(h.target.value),placeholder:"0.00",className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500",min:"0",step:"0.01"})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Balance: $",a.toLocaleString()]})]}),e.jsx("button",{onClick:c,disabled:!s||r||parseFloat(s)>a,className:`w-full py-3 rounded-lg font-semibold transition-colors ${!s||r||parseFloat(s)>a?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-emerald-500 text-white hover:bg-emerald-600"}`,children:r?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Placing Bet..."})]}):`Place Bet - $${s||"0.00"}`})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-8 pt-2 border-t border-gray-100",children:[e.jsxs("button",{onClick:o,className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors ${t.isLiked?"bg-red-50 text-red-600":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(H,{className:`w-4 h-4 ${t.isLiked?"fill-current":""}`}),e.jsx("span",{children:t.likeCount||0})]}),e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-50 text-gray-600 hover:bg-gray-100 transition-colors",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:t.commentCount||0})]})]})]}):e.jsx("div",{className:"bg-white border-t border-gray-200 p-4",children:e.jsxs("div",{className:"flex items-center justify-center space-x-8 max-w-md mx-auto",children:[e.jsxs("button",{onClick:o,className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${t.isLiked?"bg-red-50 text-red-600":"bg-gray-50 text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(H,{className:`w-5 h-5 ${t.isLiked?"fill-current":""}`}),e.jsx("span",{children:t.likeCount||0})]}),e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-4 py-2 rounded-lg bg-gray-50 text-gray-600 hover:bg-gray-100 transition-colors",children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:t.commentCount||0})]})]})}),Ce=({activeTab:t,onTabChange:l,commentCount:s=0,participantCount:r=0,children:a})=>{const i=[{id:"overview",label:"Overview",count:0,icon:Q},{id:"comments",label:"Comments",count:s,icon:R},{id:"activity",label:"Activity",count:r,icon:be}];return e.jsxs("div",{className:"bg-white",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:i.map((n,c)=>{const o=n.icon;return e.jsxs("button",{onClick:()=>l(n.id),className:Z("px-3 py-1 rounded-lg text-sm font-medium transition-colors",t===n.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(o,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:n.label}),e.jsx("span",{className:"sm:hidden",children:n.id==="overview"?"Overview":n.id==="comments"?"Comments":"Activity"})]}),n.count>0&&e.jsx("span",{className:Z("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold",t===n.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:n.count>99?"99+":n.count})]},n.id)})})})}),e.jsx("div",{className:"min-h-screen",children:a})]})},_e=({onSubmit:t,isPosting:l,placeholder:s="Share your thoughts..."})=>{const[r,a]=y.useState(""),{user:i}=I(),n=async c=>{if(c.preventDefault(),!(!r.trim()||l)){if(!i){z({intent:"comment"});return}try{await t(r.trim()),a("")}catch{}}};return i?e.jsxs("form",{onSubmit:n,className:"space-y-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("textarea",{value:r,onChange:c=>a(c.target.value),placeholder:s,disabled:l,rows:3,className:"w-full p-3 border rounded-lg resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed",maxLength:1e3}),e.jsxs("div",{className:"absolute bottom-2 right-2 text-xs text-gray-500",children:[r.length,"/1000"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-gray-500",children:["Commenting as ",i.user_metadata?.username||i.email]}),e.jsxs("button",{type:"submit",disabled:!r.trim()||l,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:[e.jsx($e,{className:"w-4 h-4"}),l?"Posting...":"Post"]})]})]}):e.jsx("div",{className:"p-4 border rounded-lg bg-gray-50",children:e.jsx("button",{onClick:()=>z({intent:"comment"}),className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"Sign in to comment"})})},Ae=({comment:t,onToggleLike:l})=>{const s=()=>{l&&l(t.id)},r=t.likes_count||t.likeCount||0,a=t.is_liked||t.likedByMe||!1,i=t.created_at||t.createdAt,n=t.content||t.text,c=t.user?.username||"Anonymous",o=t.user?.avatar_url||t.user?.avatarUrl;return e.jsx("div",{className:"border-b border-gray-100 pb-4 last:border-b-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:o?e.jsx("img",{src:o,alt:c,className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-medium text-gray-600",children:c.charAt(0).toUpperCase()})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm text-gray-900",children:c}),t.user?.is_verified&&e.jsx("div",{className:"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-white text-xs",children:"✓"})}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500",children:[e.jsx(je,{className:"w-3 h-3"}),fe(new Date(i),{addSuffix:!0})]})]}),e.jsx("div",{className:"text-sm text-gray-900 leading-relaxed mb-2",children:n}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("button",{onClick:s,className:`flex items-center gap-1 text-xs transition-colors ${a?"text-red-600 hover:text-red-700":"text-gray-500 hover:text-red-600"}`,children:[e.jsx(H,{className:`w-4 h-4 ${a?"fill-current":""}`}),r>0&&e.jsx("span",{children:r})]})})]})]})})},Ee=({count:t=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:t}).map((l,s)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})]})]})},s))}),Te=({comments:t,isLoading:l,hasMore:s,onLoadMore:r,onToggleLike:a})=>l&&t.length===0?e.jsx(Ee,{count:3}):t.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("div",{className:"text-lg mb-2",children:"No comments yet"}),e.jsx("div",{className:"text-sm",children:"Be the first to share your thoughts!"})]}):e.jsxs("div",{className:"space-y-4",children:[t.map(i=>e.jsx(Ae,{comment:i,onToggleLike:a},i.id)),s&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:r,disabled:l,className:"px-6 py-2 text-blue-600 hover:text-blue-700 font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Loading...":"Load more comments"})})]}),Le=ce(),De="v2",T=`${Le}/api/${De}`,L=()=>localStorage.getItem("token"),g={get:async(t,l)=>{const s=L();try{const r=await fetch(`${T}${t}`,{method:"GET",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`},...l?.headers},...l});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}catch(r){throw console.warn(`API call failed: ${t}`,r),r}},post:async(t,l,s)=>{const r=L();try{const a=await fetch(`${T}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...s?.headers},body:l?JSON.stringify(l):void 0,...s});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}catch(a){throw console.warn(`API call failed: ${t}`,a),a}},put:async(t,l,s)=>{const r=L();try{const a=await fetch(`${T}${t}`,{method:"PUT",headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...s?.headers},body:l?JSON.stringify(l):void 0,...s});if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return a.json()}catch(a){throw console.warn(`API call failed: ${t}`,a),a}},delete:async(t,l)=>{const s=L();try{const r=await fetch(`${T}${t}`,{method:"DELETE",headers:{"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`},...l?.headers},...l});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return r.json()}catch(r){throw console.warn(`API call failed: ${t}`,r),r}}},b=t=>({id:t.id,predictionId:t.prediction_id,user:{id:t.user?.id||t.user_id,username:t.user?.username||"Anonymous",full_name:t.user?.full_name,avatarUrl:t.user?.avatar_url,avatar_url:t.user?.avatar_url,is_verified:t.user?.is_verified||!1},text:t.content||t.text||"",content:t.content,createdAt:t.created_at||t.createdAt||new Date().toISOString(),created_at:t.created_at,updatedAt:t.updated_at||t.updatedAt||new Date().toISOString(),updated_at:t.updated_at,edited:t.is_edited||t.edited||!1,is_edited:t.is_edited,isDeleted:t.is_deleted||!1,likeCount:t.likes_count||t.likeCount||0,likes_count:t.likes_count,likedByMe:t.is_liked||t.likedByMe||!1,is_liked:t.is_liked});function X(t){return!t||t.name==="TypeError"||t.message?.includes("Failed to fetch")?"network_error":t.status>=500?"server_error":t.status>=400&&t.status<500?"client_error":t.name==="SyntaxError"||t.message?.includes("JSON")?"parse_error":"network_error"}const ze=pe()(de((t,l)=>({byPrediction:{},getComments:s=>l().byPrediction[s]?.items||[],getCommentCount:s=>l().byPrediction[s]?.items?.length||0,getStatus:s=>l().byPrediction[s]?.status||"idle",getDraft:s=>l().byPrediction[s]?.draft||"",isPosting:s=>l().byPrediction[s]?.posting||!1,hasMore:s=>l().byPrediction[s]?.nextCursor!==null,fetchComments:async s=>{if(!(!s?.trim()||l().byPrediction[s]?.status==="loading")){t(a=>({byPrediction:{...a.byPrediction,[s]:{...a.byPrediction[s],status:"loading"}}}));try{let a;try{a=await g.get(`/social/predictions/${s}/comments?page=1&limit=20`)}catch(c){P("Social endpoint failed, trying comments endpoint:",c),a=await g.get(`/comments/predictions/${s}/comments?page=1&limit=20`)}let i=[],n=null;a.data&&Array.isArray(a.data)?(i=a.data.map(b),n=a.pagination?.hasNext?"next":null):a.comments&&Array.isArray(a.comments)?(i=a.comments.map(b),n=a.hasMore?"next":null):Array.isArray(a)&&(i=a.map(b)),P(`Fetched ${i.length} comments for ${s}`),t(c=>({byPrediction:{...c.byPrediction,[s]:{...c.byPrediction[s],items:i,nextCursor:n,status:"loaded"}}}))}catch(a){if(a.status===404){t(n=>({byPrediction:{...n.byPrediction,[s]:{...n.byPrediction[s],items:[],nextCursor:null,status:"loaded"}}}));return}const i=X(a);t(n=>({byPrediction:{...n.byPrediction,[s]:{...n.byPrediction[s],items:n.byPrediction[s]?.items||[],status:i}}}))}}},loadMore:async s=>{if(!s?.trim())return;const r=l().byPrediction[s];if(!(!r?.nextCursor||r?.status==="paginating")){t(a=>({byPrediction:{...a.byPrediction,[s]:{...a.byPrediction[s],status:"paginating"}}}));try{const a=Math.ceil((r.items?.length||0)/20)+1;let i;try{i=await g.get(`/social/predictions/${s}/comments?page=${a}&limit=20`)}catch{i=await g.get(`/comments/predictions/${s}/comments?page=${a}&limit=20`)}let n=[],c=null;i.data&&Array.isArray(i.data)?(n=i.data.map(b),c=i.pagination?.hasNext?"next":null):i.comments&&Array.isArray(i.comments)&&(n=i.comments.map(b),c=i.hasMore?"next":null),P(`Loaded ${n.length} more comments for ${s}`),t(o=>({byPrediction:{...o.byPrediction,[s]:{...o.byPrediction[s],items:[...o.byPrediction[s]?.items||[],...n],nextCursor:c,status:"loaded"}}}))}catch(a){const i=X(a);t(n=>({byPrediction:{...n.byPrediction,[s]:{...n.byPrediction[s],status:i}}}))}}},addComment:async(s,r)=>{if(!s?.trim()||!r?.trim())throw new Error("Invalid input");const a=r.trim();if(a.length>280)throw new Error("Comment too long");t(o=>({byPrediction:{...o.byPrediction,[s]:{...o.byPrediction[s],posting:!0}}}));const{user:i}=ee.getState(),n=`temp_${Date.now()}`,c={id:n,predictionId:s,user:{id:i?.id||"demo-user",username:i?.username||"You",full_name:i?.full_name,avatarUrl:i?.avatar_url,is_verified:i?.is_verified||!1},text:a,content:a,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),edited:!1,isDeleted:!1,likeCount:0,likedByMe:!1};t(o=>{const m=o.byPrediction[s]?.items||[];return{byPrediction:{...o.byPrediction,[s]:{...o.byPrediction[s],items:[c,...m]}}}});try{let o;try{o=await g.post(`/social/predictions/${s}/comments`,{content:a,userId:i?.id||"demo-user",user:i})}catch(u){P("Social endpoint failed, trying comments endpoint:",u),o=await g.post(`/comments/predictions/${s}/comments`,{content:a,user:i})}let m;o.data||o.success&&o.data?m=b(o.data):m=b(o),P(`Comment added successfully for ${s}`),t(u=>({byPrediction:{...u.byPrediction,[s]:{...u.byPrediction[s],items:u.byPrediction[s]?.items.map(h=>h.id===n?m:h)||[m],posting:!1,draft:""}}}));try{sessionStorage.removeItem(`fcz_comment_draft_${s}`)}catch{}}catch(o){throw t(m=>({byPrediction:{...m.byPrediction,[s]:{...m.byPrediction[s],items:m.byPrediction[s]?.items.filter(u=>u.id!==n)||[],posting:!1}}})),o}},editComment:async(s,r,a)=>{if(!s?.trim()||!r?.trim()||!a?.trim())throw new Error("Invalid input");const i=a.trim();if(i.length>280)throw new Error("Comment too long");const n=l().byPrediction[s]?.items.find(c=>c.id===r);if(!n)throw new Error("Comment not found");t(c=>({byPrediction:{...c.byPrediction,[s]:{...c.byPrediction[s],items:c.byPrediction[s]?.items.map(o=>o.id===r?{...o,text:i,edited:!0,updatedAt:new Date().toISOString()}:o)||[]}}}));try{let c;try{c=await g.put(`/social/comments/${r}`,{content:i})}catch{c=await g.put(`/comments/${r}`,{content:i})}let o;c.data?o=b(c.data):o=b(c),t(m=>({byPrediction:{...m.byPrediction,[s]:{...m.byPrediction[s],items:m.byPrediction[s]?.items.map(u=>u.id===r?o:u)||[]}}}))}catch(c){throw t(o=>({byPrediction:{...o.byPrediction,[s]:{...o.byPrediction[s],items:o.byPrediction[s]?.items.map(m=>m.id===r?n:m)||[]}}})),c}},deleteComment:async(s,r)=>{if(!s?.trim()||!r?.trim())throw new Error("Invalid input");const a=l().byPrediction[s]?.items||[];if(!a.find(n=>n.id===r))throw new Error("Comment not found");t(n=>({byPrediction:{...n.byPrediction,[s]:{...n.byPrediction[s],items:n.byPrediction[s]?.items.filter(c=>c.id!==r)||[]}}}));try{try{await g.delete(`/social/comments/${r}`)}catch{await g.delete(`/comments/${r}`)}P(`Comment ${r} deleted successfully`)}catch(n){throw t(c=>({byPrediction:{...c.byPrediction,[s]:{...c.byPrediction[s],items:a}}})),n}},setDraft:(s,r)=>{t(a=>({byPrediction:{...a.byPrediction,[s]:{...a.byPrediction[s],draft:r}}}));try{r.trim()?sessionStorage.setItem(`fcz_comment_draft_${s}`,r):sessionStorage.removeItem(`fcz_comment_draft_${s}`)}catch{}},clearDraft:s=>{t(r=>({byPrediction:{...r.byPrediction,[s]:{...r.byPrediction[s],draft:""}}}));try{sessionStorage.removeItem(`fcz_comment_draft_${s}`)}catch{}},setHighlighted:(s,r)=>{t(a=>({byPrediction:{...a.byPrediction,[s]:{...a.byPrediction[s],highlightedId:r}}})),r&&setTimeout(()=>{t(a=>({byPrediction:{...a.byPrediction,[s]:{...a.byPrediction[s],highlightedId:void 0}}}))},1500)}}),{name:"fcz-unified-comments",partialize:t=>({})})),Me=({predictionId:t,className:l=""})=>{const{comments:s,commentCount:r,status:a,isPosting:i,hasMore:n,fetchComments:c,loadMore:o,addComment:m,toggleCommentLike:u,clearErrors:h}=ze(),N=s[t]||[],j=a[t]||"idle",S=i[t]||!1,M=n[t]||!1;y.useEffect(()=>{j==="idle"&&c(t).catch(f=>{f?.status>=500&&k.error("Failed to load comments. Please try again.")})},[t,j,c]);const C=async f=>{try{await m(t,f)}catch(w){const d=w?.message||"Failed to post comment";throw k.error(d),w}},_=async f=>{try{await u(t,f)}catch(w){w?.status>=500&&k.error("Failed to update like. Please try again.")}},B=async()=>{try{await o(t)}catch(f){f?.status>=500&&k.error("Failed to load more comments. Please try again.")}},F=j==="loading"||j==="paginating",$=r[t]||N.length;return e.jsxs("div",{className:`bg-white rounded-lg ${l}`,children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border-b border-gray-100",children:[e.jsx(Ne,{className:"w-5 h-5 text-gray-600"}),e.jsxs("h3",{className:"font-medium text-gray-900",children:["Comments ",$>0&&`(${$})`]})]}),e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx(_e,{onSubmit:C,isPosting:S}),e.jsx(Te,{comments:N,isLoading:F,hasMore:M,onLoadMore:B,onToggleLike:_})]})]})},Be=({message:t="Loading...",size:l="md",className:s="",fullScreen:r=!1})=>{const i=(()=>{switch(l){case"sm":return{spinner:"h-4 w-4",text:"text-sm",container:"py-4"};case"lg":return{spinner:"h-8 w-8",text:"text-lg",container:"py-8"};case"md":default:return{spinner:"h-6 w-6",text:"text-base",container:"py-6"}}})(),n=e.jsxs("div",{className:`flex flex-col items-center justify-center ${i.container} ${s}`,children:[e.jsx(p.div,{animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"},className:`${i.spinner} text-emerald-500`,children:e.jsx(me,{className:"h-full w-full"})}),t&&e.jsx("p",{className:`mt-3 text-gray-600 ${i.text}`,children:t})]});return r?e.jsx("div",{className:"fixed inset-0 bg-white/80 backdrop-blur-sm flex items-center justify-center z-50",children:n}):n},Fe=({error:t,onRetry:l,onDismiss:s,type:r="error",showRetry:a=!0,showDismiss:i=!1,className:n=""})=>{const o=(()=>{switch(r){case"warning":return{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:"text-yellow-600"};case"info":return{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:"text-blue-600"};case"error":default:return{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:"text-red-600"}}})();return e.jsx(K,{children:e.jsx(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:`rounded-lg border p-4 ${o.bg} ${o.border} ${n}`,role:"alert","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(we,{className:`h-5 w-5 ${o.icon}`})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsx("p",{className:`text-sm font-medium ${o.text}`,children:t})}),e.jsxs("div",{className:"ml-3 flex space-x-2",children:[a&&l&&e.jsxs("button",{onClick:l,className:`inline-flex items-center gap-1 rounded-md px-2 py-1 text-xs font-medium transition-colors ${o.text} hover:bg-white/50`,"aria-label":"Retry",children:[e.jsx(xe,{className:"h-3 w-3"}),"Retry"]}),i&&s&&e.jsx("button",{onClick:s,className:`inline-flex items-center rounded-md p-1 transition-colors ${o.text} hover:bg-white/50`,"aria-label":"Dismiss",children:e.jsx(ue,{className:"h-4 w-4"})})]})]})})})},Ue=({icon:t,title:l,description:s,action:r,className:a=""})=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},className:`flex flex-col items-center justify-center py-12 px-6 text-center ${a}`,children:[t&&e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(t,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:l}),s&&e.jsx("p",{className:"text-gray-600 mb-6 max-w-sm",children:s}),r&&e.jsx(p.button,{className:"bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-2 rounded-lg font-medium transition-colors",onClick:r.onClick,whileHover:{scale:1.02},whileTap:{scale:.98},children:r.label})]}),O={announce:t=>console.log("Announce:",t)},Y=t=>k.success(t),D=t=>k.error(t),Qe=({predictionId:t})=>{const l=he(),s=ye(),{user:r,isAuthenticated:a}=I(),i=t||s.id||s.predictionId||"",[n,c]=y.useState(null),[o,m]=y.useState(""),[u,h]=y.useState(!1),[N,j]=y.useState("overview"),[S,M]=y.useState(""),{predictions:C,fetchPredictionById:_,placePrediction:B,togglePredictionLike:F,loading:$,error:f}=le();ee();const{getBalance:w}=ge(),d=y.useMemo(()=>i&&C.find(x=>x.id===i)||null,[C,i]),{media:v,status:V}=Pe(d?.id||"",d?{id:d.id,title:d.title,category:d.category}:void 0);y.useEffect(()=>{},[v,d]);const te=y.useMemo(()=>a?w():0,[a,w]),U=y.useCallback(async()=>{if(!i){console.log("❌ No prediction ID found"),l("/discover");return}try{console.log("🔍 Loading prediction:",i),await _(i)}catch(x){console.error("❌ Error loading prediction:",x),D("Failed to load prediction details")}},[i,_,l]);y.useEffect(()=>{U()},[U]),y.useEffect(()=>{typeof window<"u"&&M(window.location.href)},[i]);const A=()=>{window.history.length>1?window.history.back():l("/discover")},se=async()=>{if(navigator.share&&d)try{await navigator.share({title:d.title,text:`Check out this prediction: ${d.title}`,url:S})}catch{G()}else G()},G=async()=>{try{await navigator.clipboard.writeText(S),Y("Link copied to clipboard!"),O.announce("Link copied to clipboard")}catch(x){console.error("Failed to copy link:",x),D("Failed to copy link")}},ae=x=>{c(x===n?null:x),x!==n&&m("")},re=async()=>{if(!a){z({intent:"place_prediction",payload:{predictionId:i}});return}if(!(!n||!o||!d)){h(!0);try{await B({predictionId:d.id,optionId:n,amount:parseFloat(o)}),Y(`Prediction placed! $${o} on your choice.`),O.announce(`Prediction placed successfully for ${o} dollars`),c(null),m(""),j("activity")}catch(x){console.error("Error placing prediction:",x),D("Failed to place prediction. Please try again.")}finally{h(!1)}}},ie=async()=>{if(!a){z({intent:"like_prediction",payload:{predictionId:i}});return}if(d)try{await F(d.id),O.announce(d.isLiked?"Prediction unliked":"Prediction liked")}catch(x){console.error("Error toggling like:",x),D("Failed to update like")}},ne=()=>{j("comments"),setTimeout(()=>{const x=document.querySelector('[data-qa="comments-section"]');x&&x.scrollIntoView({behavior:"smooth",block:"start"})},100)};if($&&!d)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(E,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Loading..."})]})})}),e.jsx(Be,{message:"Loading prediction details...",className:"py-20"})]});if(f&&!d)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(E,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Error"})]})})}),e.jsx(Fe,{message:"Failed to load prediction details",onRetry:U,className:"m-4"})]});if(!d&&!$)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsx("div",{className:"px-6 pt-12 pb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(E,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Not Found"})]})})}),e.jsx(Ue,{icon:Q,title:"Prediction Not Found",description:"The prediction you're looking for doesn't exist or has been removed.",primaryAction:{label:"Browse Predictions",onClick:()=>l("/discover")},className:"py-20"})]});if(!d)return null;const J=d.participants?.length||0,oe=d.totalVolume||"0.00";return y.useEffect(()=>{},[v,d]),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-30",children:e.jsxs("div",{className:"px-4 py-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:A,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Go back",children:e.jsx(E,{className:"w-5 h-5 text-gray-600"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Prediction Details"})]}),e.jsx("button",{onClick:se,className:"p-2 hover:bg-gray-100 rounded-full transition-colors","aria-label":"Share prediction",children:e.jsx(ve,{className:"h-5 w-5 text-gray-600"})})]})}),e.jsx("div",{className:"mx-4 mt-4 rounded-2xl overflow-hidden border border-gray-100 aspect-video",children:V==="ready"&&v?.url?e.jsx("img",{src:v.url,alt:v.alt||d?.title,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):V==="loading"?e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 animate-pulse"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center",children:e.jsxs("div",{className:"text-gray-500 text-center",children:[e.jsx("div",{className:"text-2xl mb-2",children:"📊"}),e.jsx("div",{className:"text-sm font-medium capitalize",children:d?.category||"Prediction"})]})})}),e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"pb-safe",children:[e.jsx(Ce,{activeTab:N,onTabChange:j,commentCount:d.commentCount,participantCount:J,children:e.jsxs(K,{mode:"wait",children:[N==="overview"&&e.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 leading-tight mb-2",children:d.title}),d.creator&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{children:"Created by"}),e.jsx("span",{className:"ml-1 font-medium text-gray-900",children:d.creator.firstName||d.creator.email?.split("@")[0]||"User"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prediction Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-emerald-100 rounded-lg",children:e.jsx(ke,{className:"w-5 h-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Total Volume"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:["$",oe]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(W,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Participants"}),e.jsx("p",{className:"font-semibold text-gray-900",children:J})]})]})]})]}),d.description&&e.jsxs("div",{className:"bg-white rounded-2xl p-6 mb-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-700 leading-relaxed",children:d.description})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"How This Works"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsx("p",{children:"• Choose an outcome you believe will happen"}),e.jsx("p",{children:"• Stake an amount you're comfortable with"}),e.jsx("p",{children:"• If you're right, win based on the current odds"}),e.jsx("p",{children:"• Betting closes when the prediction expires"})]})]})]},"overview"),N==="comments"&&e.jsx(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},"data-qa":"comments-section",className:"p-6",children:e.jsx(Me,{predictionId:i})},"comments"),N==="activity"&&e.jsx(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(W,{className:"w-12 h-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Activity feed coming soon"}),e.jsx("p",{className:"text-sm mt-2",children:"Track predictions and settlements"})]})]})},"activity")]})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-20 safe-area-inset",children:e.jsx(Se,{prediction:{id:d.id,status:d.status,options:d.options||[],likeCount:d.likeCount,commentCount:d.commentCount,isLiked:d.isLiked},selectedOptionId:n,stakeAmount:o,isPlacingBet:u,userBalance:te,onOptionSelect:ae,onStakeChange:m,onPlaceBet:re,onLike:ie,onComment:ne})})]})})]})};export{Qe as default};
