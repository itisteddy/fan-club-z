{"version":3,"file":"ProfilePage-54401e6e.js","sources":["../../src/components/profile/SignOutButton.tsx","../../src/legacy/pages/ProfilePage.tsx"],"sourcesContent":["import React from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport toast from 'react-hot-toast';\nimport { supabase } from '../../lib/supabase';\n// import { resetAllStores } from '../../stores/resetAllStores'; // Module not found - commented out\n\ntype ButtonProps = React.ButtonHTMLAttributes<HTMLButtonElement>;\n\nexport function SignOutButton(props: ButtonProps) {\n  const navigate = useNavigate();\n\n  const onClick = async () => {\n    try {\n      await supabase.auth.signOut();\n      // Clear client stores so the UI doesn't show stale state\n      // resetAllStores?.(); // Module not found - commented out\n      toast.success('Signed out');\n      navigate('/');\n    } catch (err) {\n      console.error(err);\n      toast.error('Failed to sign out. Please try again.');\n    }\n  };\n\n  return (\n    <button\n      type=\"button\"\n      onClick={onClick}\n      data-qa=\"signout\"\n      className=\"w-full rounded-xl border border-black/10 bg-white px-4 py-3 text-sm font-medium hover:bg-white/80 active:scale-[0.99]\"\n      {...props}\n    >\n      Sign Out\n    </button>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport { Edit3, User, Activity, DollarSign } from 'lucide-react';\nimport { useAuthStore } from '../../store/authStore';\nimport { usePredictionStore, PredictionEntry, Prediction } from '../../store/predictionStore';\nimport { openAuthGate } from '../../auth/authGateAdapter';\nimport UserAvatar from '../../components/common/UserAvatar';\nimport AppHeader from '../../components/layout/AppHeader';\nimport { SignOutButton } from '../../components/profile/SignOutButton';\nimport { formatCurrency, formatInt, formatPercent } from '@/lib/format';\n\ninterface ProfilePageProps {\n  onNavigateBack?: () => void;\n  userId?: string;\n}\n\nconst ProfilePage: React.FC<ProfilePageProps> = ({ onNavigateBack, userId }) => {\n  const { user, isAuthenticated } = useAuthStore();\n  const { getUserPredictionEntries, getUserCreatedPredictions } = usePredictionStore();\n  const [loading, setLoading] = useState(!isAuthenticated);\n  \n  // Determine if viewing own profile\n  const isOwnProfile = !userId || userId === user?.id;\n  const displayUser = user;\n\n  useEffect(() => {\n    if (isAuthenticated && user?.id) {\n      setLoading(false);\n    }\n  }, [isAuthenticated, user?.id]);\n\n  // Calculate user stats\n  const userEntries = getUserPredictionEntries(user?.id || '') || [];\n  const userCreated = getUserCreatedPredictions(user?.id || '') || [];\n  const completedEntries = userEntries.filter((entry: PredictionEntry) => entry?.status === 'won' || entry?.status === 'lost');\n  const wonEntries = userEntries.filter((entry: PredictionEntry) => entry?.status === 'won');\n  const totalInvested = userEntries.reduce((sum: number, entry: PredictionEntry) => sum + (entry?.amount || 0), 0);\n  const totalEarnings = wonEntries.reduce((sum: number, entry: PredictionEntry) => sum + (entry?.actual_payout || 0), 0);\n  const winRate = completedEntries.length > 0 ? Math.round((wonEntries.length / completedEntries.length) * 100) : 0;\n  const balance = totalEarnings - totalInvested;\n\n  // Recent activity (last 5 items)\n  const recentActivity = [...userEntries, ...userCreated]\n    .sort((a, b) => new Date(b.created_at || 0).getTime() - new Date(a.created_at || 0).getTime())\n    .slice(0, 5);\n\n  // Handle authentication required\n  if (!isAuthenticated) {\n    return (\n      <div className=\"min-h-screen bg-gray-50\">\n        <AppHeader title=\"Profile\" />\n        <div className=\"mx-auto w-full max-w-[720px] lg:max-w-[960px] px-4 py-4\">\n          <div className=\"flex flex-col items-center justify-center text-center py-12 px-4\">\n            <div className=\"mb-4 text-gray-300\">\n              <User className=\"w-8 h-8\" />\n            </div>\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">Sign in to view your profile</h3>\n            <p className=\"text-sm text-gray-600 mb-6 max-w-sm\">Customize your handle, avatar, and preferences.</p>\n            <button\n              onClick={async () => {\n                try {\n                  await openAuthGate({ intent: 'edit_profile' });\n                } catch (error) {\n                  console.error('Auth gate error:', error);\n                }\n              }}\n              className=\"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors\"\n            >\n              Sign In\n            </button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <AppHeader title=\"Profile\" />\n      \n      <div className=\"mx-auto w-full max-w-[720px] lg:max-w-[960px] px-4 py-4\">\n        <div className=\"space-y-4\">\n          {loading ? (\n            <>\n              {/* Loading Skeleton */}\n              <div className=\"grid grid-cols-3 gap-3\">\n                <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] animate-pulse\">\n                  <div className=\"h-4 bg-gray-200 rounded mb-2 w-2/3\"></div>\n                  <div className=\"h-6 bg-gray-200 rounded w-3/4\"></div>\n                </div>\n                <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] animate-pulse\">\n                  <div className=\"h-4 bg-gray-200 rounded mb-2 w-2/3\"></div>\n                  <div className=\"h-6 bg-gray-200 rounded w-3/4\"></div>\n                </div>\n                <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] animate-pulse\">\n                  <div className=\"h-4 bg-gray-200 rounded mb-2 w-2/3\"></div>\n                  <div className=\"h-6 bg-gray-200 rounded w-3/4\"></div>\n                </div>\n              </div>\n            </>\n          ) : (\n            <>\n              {/* Stat Row */}\n              <div className=\"grid grid-cols-3 gap-3\">\n                <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] flex flex-col justify-center\">\n                  <div className=\"flex items-center space-x-1 mb-2\">\n                    <Activity className=\"w-4 h-4 text-gray-500\" />\n                    <div className=\"text-xs text-gray-600 font-medium\">Predictions</div>\n                  </div>\n                  <div className=\"text-xl font-semibold text-gray-900 font-mono\">\n                    {userEntries.length}\n                  </div>\n                </div>\n                <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] flex flex-col justify-center\">\n                  <div className=\"flex items-center space-x-1 mb-2\">\n                    <User className=\"w-4 h-4 text-gray-500\" />\n                    <div className=\"text-xs text-gray-600 font-medium\">Win Rate</div>\n                  </div>\n                  <div className=\"text-xl font-semibold text-gray-900 font-mono\">\n                    {winRate}%\n                  </div>\n                </div>\n                <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] flex flex-col justify-center\">\n                  <div className=\"flex items-center space-x-1 mb-2\">\n                    <DollarSign className=\"w-4 h-4 text-gray-500\" />\n                    <div className=\"text-xs text-gray-600 font-medium\">Balance</div>\n                  </div>\n                  <div className=\"text-xl font-semibold text-gray-900 font-mono\">\n                    {formatCurrency(balance)}\n                  </div>\n                </div>\n              </div>\n\n              {/* Overview Card */}\n              <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4\">\n                <div className=\"flex items-start justify-between mb-4\">\n                  <h3 className=\"text-sm font-semibold text-gray-900\">Overview</h3>\n                  {isOwnProfile && (\n                    <button className=\"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors\">\n                      <Edit3 className=\"w-4 h-4\" />\n                    </button>\n                  )}\n                </div>\n                <div className=\"flex items-center space-x-4\">\n                  <UserAvatar\n                    email={displayUser?.email}\n                    username={displayUser?.firstName || displayUser?.email?.split('@')[0]}\n                    avatarUrl={displayUser?.avatar}\n                    size=\"lg\"\n                  />\n                  <div className=\"flex-1 min-w-0\">\n                    <h3 className=\"text-lg font-semibold text-gray-900\">\n                      {displayUser?.firstName && displayUser?.lastName \n                        ? `${displayUser.firstName} ${displayUser.lastName}`\n                        : displayUser?.email?.split('@')[0] || 'User'\n                      }\n                    </h3>\n                    <p className=\"text-sm text-gray-600\">\n                      @{displayUser?.email?.split('@')[0] || 'user'}\n                    </p>\n                    <div className=\"flex space-x-4 mt-2 text-xs text-gray-500\">\n                      <span>{completedEntries.length} completed</span>\n                      <span>{userEntries.filter((e: PredictionEntry) => e.status === 'active').length} active</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Recent Activity Card */}\n              <div className=\"bg-white rounded-2xl border border-black/[0.06] p-4\">\n                <h3 className=\"text-sm font-semibold text-gray-900 mb-4\">Recent Activity</h3>\n                {recentActivity.length > 0 ? (\n                  <div className=\"space-y-3\">\n                    {recentActivity.map((item, index) => (\n                      <div key={index} className=\"flex items-center justify-between py-2\">\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"text-sm font-medium text-gray-900 truncate\">\n                            {'question' in item ? item.question : 'Prediction Entry'}\n                          </p>\n                          <p className=\"text-xs text-gray-500\">\n                            {new Date(item.created_at || 0).toLocaleDateString()}\n                          </p>\n                        </div>\n                        <div className=\"text-right\">\n                          {'status' in item && (\n                            <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${\n                              item.status === 'won' ? 'bg-green-100 text-green-800' :\n                              item.status === 'lost' ? 'bg-red-100 text-red-800' :\n                              'bg-yellow-100 text-yellow-800'\n                            }`}>\n                              {item.status}\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-8 text-gray-500\">\n                    <p>No recent activity</p>\n                    <p className=\"text-sm\">Your prediction activity will appear here.</p>\n                  </div>\n                )}\n              </div>\n\n              {/* Sign Out Button - Only for own profile */}\n              {isOwnProfile && (\n                <div className=\"mt-4\">\n                  <SignOutButton />\n                </div>\n              )}\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default ProfilePage;\n"],"names":["SignOutButton","props","navigate","useNavigate","onClick","supabase","toast","jsx","ProfilePage","onNavigateBack","userId","user","isAuthenticated","useAuthStore","getUserPredictionEntries","getUserCreatedPredictions","usePredictionStore","loading","setLoading","useState","isOwnProfile","displayUser","useEffect","userEntries","userCreated","completedEntries","entry","wonEntries","totalInvested","sum","totalEarnings","winRate","balance","recentActivity","a","b","jsxs","AppHeader","Fragment","Activity","User","DollarSign","formatCurrency","Edit3","UserAvatar","e","item","index","openAuthGate"],"mappings":"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"}