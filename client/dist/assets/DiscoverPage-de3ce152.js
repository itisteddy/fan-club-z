import{u as ee,a as q,A as Z,F as ge,X as te,K as he,z as P,E as fe,T as se,S as pe,b as ye,c as ve,Z as be,d as je,e as Ne,_ as we,n as B,L as ke}from"./index-9e31fc92.js";import{j as e,m as j,A as Y}from"./ui-7ef4368a.js";import{r,R as Q}from"./vendor-2237fdcd.js";import{u as ae}from"./predictionStore-f02705f1.js";import{u as Ce,M as H,H as re,S as Se,a as Pe}from"./unifiedCommentStore-c069f7e9.js";import{U as $e}from"./UserAvatar-ff7f887a.js";import{U as Te}from"./users-20d513a8.js";import{C as Ee}from"./clock-d2a462c9.js";import{I as Le,B as J}from"./input-f0690c3a.js";import{c as A}from"./utils-6f98344a.js";import{c as De}from"./utils-ac284782.js";import{A as Me}from"./AppHeader-1e74d6d2.js";import"./index-57f953c6.js";const le=({username:t,userId:a,displayName:s,className:l="",showAt:i=!0,onClick:o})=>{const m=ee(),y=u=>{if(u.stopPropagation(),console.log("👤 TappableUsername clicked:",{username:t,userId:a,displayName:s}),o){o();return}const x=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;if(a&&a.trim()!==""&&x.test(a.trim()))console.log("🔗 Navigating to profile with userId:",a),m(`/profile/${a.trim()}`);else if(t&&t.trim()!==""){a&&!x.test(a.trim())&&console.warn("⚠️ Invalid userId format, using username instead:",a);const f=t.replace("@","").trim();console.log("🔗 Navigating to profile with username:",f),m(`/profile/${f}`)}else{console.warn("⚠️ No valid userId or username provided for profile navigation");return}},k=s||(i?`@${t.replace("@","")}`:t.replace("@",""));return e.jsx(j.button,{className:`inline-flex items-center font-medium text-blue-600 hover:text-blue-700 hover:underline transition-all cursor-pointer rounded-md px-1 py-0.5 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 ${l}`,whileHover:{scale:1.02},whileTap:{scale:.98},onClick:y,type:"button","aria-label":`View profile for ${k}`,children:k})},X=({children:t,onClose:a,error:s})=>s?e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:a,className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9000]",children:e.jsx("div",{className:"bg-white rounded-lg p-6 max-w-sm mx-4",children:e.jsxs("div",{className:"text-red-600 text-center",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"⚠️ Error"}),e.jsx("p",{className:"text-sm",children:s}),e.jsx("button",{onClick:a,className:"mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})]})})}):e.jsx(e.Fragment,{children:t}),_e=({prediction:t,isOpen:a,onClose:s})=>{const{user:l}=q(),[i,o]=r.useState(""),[m,y]=r.useState(!1),k=r.useRef(null),u=r.useRef(null),[x]=r.useState(()=>Z.generateId("comment-modal"));r.useEffect(()=>{y(!0)},[]);const f=t&&t.id&&t.id.trim()!=="",v=a&&f&&m,{comments:b,commentCount:c,isLoading:h,error:S,isSubmitting:C,fetchComments:F,addComment:R,toggleCommentLike:p}=Ce(v?t.id:"");r.useEffect(()=>{v&&F()},[v,F]),r.useEffect(()=>{if(a&&k.current)return u.current=new ge(k.current),u.current.activate(),Z.announce("Comments dialog opened"),()=>{u.current&&(u.current.deactivate(),u.current=null)}},[a]),r.useEffect(()=>{if(!a)return;const d=T=>{he.handleEscape(T,s)};return document.addEventListener("keydown",d),()=>document.removeEventListener("keydown",d)},[a,s]),r.useEffect(()=>{a||o("")},[a,f]);const w=async()=>{if(!(!f||!i.trim()||!l))try{await R(i.trim()),o(""),P.success("Comment added successfully!")}catch(d){console.error("Failed to add comment:",d),P.error(d.message||"Failed to add comment")}},L=async d=>{if(f)try{await p(d)}catch(T){console.error("Failed to toggle comment like:",T),P.error("Failed to update like")}},I=d=>{try{const T=new Date,z=new Date(d),E=Math.floor((T.getTime()-z.getTime())/1e3);return E<60?"Just now":E<3600?`${Math.floor(E/60)}m ago`:E<86400?`${Math.floor(E/3600)}h ago`:`${Math.floor(E/86400)}d ago`}catch{return"Recently"}};return m?a&&!f?e.jsx(X,{onClose:s,error:"Unable to load comments. Invalid prediction data."}):!a||!t?null:e.jsx(Y,{children:e.jsx(X,{onClose:s,children:e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:s,className:"fixed inset-0 bg-black bg-opacity-50 flex items-end justify-center sm:items-center sm:p-4 z-[9000]",children:e.jsxs(j.div,{ref:k,initial:{opacity:0,y:"100%"},animate:{opacity:1,y:0},exit:{opacity:0,y:"100%"},onClick:d=>d.stopPropagation(),className:"bg-white w-full max-w-lg rounded-t-3xl sm:rounded-3xl overflow-hidden flex flex-col max-h-[90vh] sm:max-h-[80vh]",style:{zIndex:9001},role:"dialog","aria-modal":"true","aria-labelledby":`${x}-title`,"aria-describedby":`${x}-description`,"aria-live":"polite",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between sticky top-0 bg-white z-10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{size:20,className:"text-blue-500"}),e.jsxs("div",{children:[e.jsx("h2",{id:`${x}-title`,className:"text-lg font-bold text-gray-900",children:"Comments"}),e.jsxs("p",{id:`${x}-description`,className:"text-sm text-gray-600",children:[c," ",c===1?"comment":"comments"]})]})]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200 transition-colors","aria-label":"Close comments dialog",children:e.jsx(te,{size:18})})]}),e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-100",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-1",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.description||"No description available"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:h&&b.length===0?e.jsx("div",{className:"p-4 text-center",children:e.jsx("div",{className:"animate-pulse space-y-3",children:[...Array(3)].map((d,T)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-3/4"})]})]},T))})}):S?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{size:48,className:"text-red-300 mx-auto mb-3"}),e.jsx("p",{className:"text-red-600 font-medium",children:"Failed to load comments"}),e.jsx("p",{className:"text-sm text-red-400 mb-4",children:S}),e.jsx("button",{onClick:()=>F(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"Try Again"})]}):b.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(H,{size:48,className:"text-gray-300 mx-auto mb-3"}),e.jsx("p",{className:"text-gray-500 font-medium",children:"No comments yet"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Be the first to share your thoughts!"})]}):e.jsx("div",{className:"p-4 space-y-4",children:b.map(d=>e.jsx(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"flex gap-3",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-gray-50 rounded-2xl px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(le,{username:d.user?.username||"Anonymous",userId:d.user?.id||"anonymous",className:"font-semibold text-gray-900 text-sm hover:text-blue-600",showAt:!1}),e.jsx("span",{className:"text-xs text-gray-500",children:I(d.created_at)})]}),e.jsx("p",{className:"text-gray-800 text-sm leading-relaxed",children:d.content})]}),e.jsx("div",{className:"flex items-center gap-4 mt-2 ml-4",children:e.jsxs("button",{onClick:()=>L(d.id),className:`flex items-center gap-1 text-xs transition-colors ${d.is_liked?"text-red-500":"text-gray-500 hover:text-red-500"}`,children:[e.jsx(re,{size:14,fill:d.is_liked?"currentColor":"none"}),d.likes_count>0&&e.jsx("span",{children:d.likes_count})]})})]})},d.id))})}),l?e.jsx("div",{className:"p-4 border-t border-gray-100 bg-white sticky bottom-0",children:e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:d=>o(d.target.value),onKeyPress:d=>{d.key==="Enter"&&!d.shiftKey&&(d.preventDefault(),w())},placeholder:"Write a comment...",className:"flex-1 px-4 py-2 bg-gray-100 rounded-full focus:ring-2 focus:ring-green-500 focus:bg-white focus:outline-none transition-all text-sm",disabled:C}),e.jsx("button",{onClick:w,disabled:!i.trim()||C,className:"w-8 h-8 rounded-full bg-teal-500 text-white flex items-center justify-center hover:bg-teal-600 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:e.jsx(Se,{size:14})})]})})}):e.jsx("div",{className:"p-4 border-t border-gray-100 bg-gray-50 text-center",children:e.jsx("p",{className:"text-gray-600 text-sm",children:"Please log in to join the conversation"})})]})})})}):null},Fe=({error:t})=>e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-red-200 p-4 m-2",children:e.jsxs("div",{className:"text-red-600 text-sm",children:["⚠️ Error loading prediction",t&&e.jsx("div",{className:"text-xs mt-1 text-gray-500",children:t})]})}),Re=({prediction:t,entry:a,variant:s="default",onLike:l,onComment:i,onShare:o,onPredict:m,className:y=""})=>{if(!t||!t.id)return console.warn("⚠️ PredictionCard: Invalid prediction data received:",t),e.jsx(Fe,{error:"Invalid prediction data"});const k=ee(),[u,x]=r.useState(!1),[f,v]=r.useState(!1),[b,c]=r.useState(!1);r.useEffect(()=>{x(!0)},[]);const h=()=>{try{const{toggleLike:g,checkIfLiked:N,getLikeCount:M}=ye();return{toggleLike:g,checkIfLiked:N,getLikeCount:M}}catch(g){return console.warn("Error accessing like store:",g),{toggleLike:async()=>{},checkIfLiked:()=>!1,getLikeCount:()=>0}}},S=()=>{try{const{getCommentCount:g}=Pe();return{getCommentCount:g}}catch(g){return console.warn("Error accessing comment store:",g),{getCommentCount:()=>0}}},{toggleLike:C,checkIfLiked:F,getLikeCount:R}=h(),{getCommentCount:p}=S();if(!u)return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/4"})]})]}),e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"})]});const w=F(t.id)||!1,L=R(t.id),I=L??(t.likes_count||t.likes||0),d=p(t.id),T=d??(t.comments_count||t.comments||0),z=t.entry_deadline||t.entryDeadline,E=z?Math.max(0,new Date(z).getTime()-Date.now()):0,U=Math.floor(E/(1e3*60*60)),O=U<24&&U>0,n=t.participant_count||t.entries?.length||0,$=t.options?.reduce((g,N)=>{const M=N.total_staked||N.totalStaked||0;return g+M},0)||t.pool_total||t.poolTotal||0,D=g=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(g),oe=()=>E<=0?"Closed":U<1?`${Math.ceil(E/(1e3*60))}m left`:U<24?`${U}h left`:`${Math.floor(U/24)}d left`,ce=async g=>{if(g.stopPropagation(),!b)try{c(!0),await C(t.id),l&&l()}catch(N){console.error("❌ Error toggling like:",N),P.error("Failed to update like")}finally{c(!1)}},de=g=>{g.stopPropagation(),v(!0),i&&i()},me=async g=>{g.stopPropagation();try{const N={title:t.question||t.title,text:`Check out this prediction: ${t.question||t.title}`,url:`${window.location.origin}/prediction/${t.id}`};if(navigator.share&&navigator.canShare&&navigator.canShare(N))await navigator.share(N);else if(navigator.clipboard)await navigator.clipboard.writeText(N.url),P.success("Link copied to clipboard!");else{const M=document.createElement("textarea");M.value=N.url,document.body.appendChild(M),M.select(),document.execCommand("copy"),document.body.removeChild(M),P.success("Link copied to clipboard!")}o&&o()}catch(N){console.error("Error sharing:",N),P.error("Failed to share")}},xe=g=>{g.stopPropagation(),m&&m()},ue=g=>{const N=g.target;N.closest("button")||N.closest("a")||N.closest(".interactive")||(console.log("🔗 PredictionCard: Navigating to prediction details:",t.id),k(`/prediction/${t.id}`))};return e.jsxs(e.Fragment,{children:[e.jsxs(j.div,{className:`bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden cursor-pointer ${y}`,whileHover:{scale:1.02,boxShadow:"0 8px 25px rgba(0, 0, 0, 0.1)"},whileTap:{scale:.98},onClick:ue,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.creator?.firstName||t.creator?.email?e.jsxs(e.Fragment,{children:[e.jsx($e,{email:t.creator?.email,username:t.creator?.firstName||t.creator?.email?.split("@")[0],avatarUrl:t.creator?.avatar,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx(le,{username:t.creator?.firstName||t.creator?.email?.split("@")[0],className:"font-medium text-gray-900"}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})]})]}):e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})})}),t.category&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:t.category})})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3 line-clamp-2",children:t.question||t.title}),t.options&&t.options.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:t.options.map((g,N)=>{const M=g.total_staked||g.totalStaked||0,W=$>0?Math.round(M/$*100):0;return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-emerald-100 rounded-lg",style:{width:`${W}%`}}),e.jsxs("div",{className:"relative px-3 py-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:g.text||g.option}),e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:[W,"%"]})]})]},N)})})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:D($)}),e.jsx("span",{className:"text-gray-500",children:"pool"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:n})]}),e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(Ee,{className:"w-4 h-4"}),e.jsx("span",{className:O?"text-amber-600 font-medium":"",children:oe()})]})]}),n>5&&e.jsxs("div",{className:"flex items-center gap-1 text-emerald-600",children:[e.jsx(se,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Trending"})]})]})}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(j.button,{onClick:ce,disabled:b,className:`flex items-center gap-2 ${w?"text-red-500":"text-gray-600"} hover:text-red-500 transition-colors interactive`,whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(re,{className:`w-5 h-5 ${w?"fill-current":""}`}),e.jsx("span",{className:"text-sm font-medium",children:I})]}),e.jsxs(j.button,{onClick:de,className:"flex items-center gap-2 text-gray-600 hover:text-blue-500 transition-colors interactive",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:T})]}),e.jsxs(j.button,{onClick:me,className:"flex items-center gap-2 text-gray-600 hover:text-emerald-500 transition-colors interactive",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(pe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Share"})]})]}),e.jsx(j.button,{onClick:xe,className:"bg-gradient-to-r from-purple-600 to-emerald-600 text-white px-6 py-2 rounded-lg font-medium shadow-sm interactive",whileHover:{scale:1.02,boxShadow:"0 8px 25px rgba(123, 47, 247, 0.25)"},whileTap:{scale:.98},children:"Predict Now"})]})})]}),e.jsx(_e,{prediction:t,isOpen:f,onClose:()=>v(!1)})]})},Ie=t=>e.jsx(fe,{children:e.jsx(Re,{...t})}),Ue=()=>e.jsxs("div",{className:"bg-white rounded-2xl p-4 mx-4 mb-3 shadow-sm border border-gray-100 animate-pulse",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]}),e.jsx("div",{className:"ml-3 flex-shrink-0",children:e.jsx("div",{className:"w-16 h-6 bg-gray-200 rounded-full"})})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"p-3 border-2 border-gray-200 rounded-xl",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-8"})]}),e.jsxs("div",{className:"p-3 border-2 border-gray-200 rounded-xl",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12 mb-1"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-8"})]})]})}),e.jsxs("div",{className:"flex items-center justify-between text-sm mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-10"})]}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-12"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-8"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-6"})]}),e.jsx("div",{className:"w-20 h-8 bg-gray-200 rounded-lg"})]})]}),V=r.forwardRef(({className:t,...a},s)=>e.jsx("div",{ref:s,className:A("rounded-xl border bg-card text-card-foreground shadow-sm",t),...a}));V.displayName="Card";const ze=r.forwardRef(({className:t,...a},s)=>e.jsx("div",{ref:s,className:A("flex flex-col space-y-1.5 p-6",t),...a}));ze.displayName="CardHeader";const Ae=r.forwardRef(({className:t,...a},s)=>e.jsx("h3",{ref:s,className:A("font-semibold leading-none tracking-tight",t),...a}));Ae.displayName="CardTitle";const He=r.forwardRef(({className:t,...a},s)=>e.jsx("p",{ref:s,className:A("text-sm text-muted-foreground",t),...a}));He.displayName="CardDescription";const K=r.forwardRef(({className:t,...a},s)=>e.jsx("div",{ref:s,className:A("p-6 pt-0",t),...a}));K.displayName="CardContent";const Ye=r.forwardRef(({className:t,...a},s)=>e.jsx("div",{ref:s,className:A("flex items-center p-6 pt-0",t),...a}));Ye.displayName="CardFooter";const _=t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t),Oe=(t,a)=>t*a,G=(...t)=>t.filter(Boolean).join(" "),Be=t=>{const a=t.entry_deadline||t.entryDeadline;if(!a)return"Time remaining unknown";const s=Math.max(0,new Date(a).getTime()-Date.now()),l=Math.floor(s/(1e3*60*60));return s<=0?"Ended":l>=24?`${Math.floor(l/24)}d left`:`${l}h left`},Ve=({prediction:t,isOpen:a,onClose:s})=>{if(!t||!a)return null;const[l,i]=r.useState(""),[o,m]=r.useState(""),[y,k]=r.useState(!1),{user:u}=q(),{getBalance:x,lockFunds:f}=ve(),{placePrediction:v}=ae(),b=x("USD")||0,c=parseFloat(o)||0,h=t?.options?.find(p=>p.id===l),S=h?.current_odds||(h?.total_staked?t?.pool_total/h.total_staked:2),C=h?Oe(c,S):0,F=[5,10,25,50,100,250],R=async()=>{if(!l){P.error("Please select a prediction option (Yes or No)");return}if(!c){P.error("Please enter an amount to stake");return}if(c<t.stake_min){P.error(`Minimum stake is ${_(t.stake_min)}. Please increase your amount.`);return}if(t.stake_max&&c>t.stake_max){P.error(`Maximum stake is ${_(t.stake_max)}. Please reduce your amount.`);return}if(c>b){P.error(`Insufficient balance. You have ${_(b)} available, but tried to stake ${_(c)}.`);return}if(!u?.id){P.error("You must be logged in to place predictions");return}k(!0);try{await f(c,"USD"),await v(t.id,l,c,u.id),P.success(`Prediction placed successfully! You staked ${_(c)} on ${h?.label}.`),s(),m(""),i("")}catch(p){const w=p?.message||"Unknown error occurred";P.error(`Failed to place prediction: ${w}. Please try again.`)}finally{k(!1)}};return e.jsx(Y,{mode:"wait",initial:!1,children:a&&e.jsxs(e.Fragment,{children:[e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm",onClick:s,style:{zIndex:8e3}},"prediction-modal-backdrop"),e.jsx("div",{className:"fixed inset-0 flex items-end justify-center p-4 pb-20",style:{zIndex:8500,pointerEvents:"none"},children:e.jsxs(j.div,{initial:{y:"100%",opacity:0},animate:{y:0,opacity:1},exit:{y:"100%",opacity:0},transition:{type:"spring",damping:30,stiffness:300},className:"w-full max-w-md bg-white rounded-t-2xl shadow-2xl flex flex-col max-h-[75vh]",style:{pointerEvents:"auto"},onClick:p=>p.stopPropagation(),children:[e.jsx("div",{className:"flex-shrink-0 p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Place Prediction"}),e.jsx("button",{onClick:s,className:"p-2 rounded-lg hover:bg-gray-100 transition-colors","aria-label":"Close modal",children:e.jsx(te,{size:20})})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-base",children:t.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("span",{children:[_(t.pool_total||0)," Pool"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[t.participant_count||0," Players"]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:Be(t)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Select your prediction:"}),e.jsx("div",{className:"space-y-2",children:(t.options||[]).map(p=>{const w=p.total_staked||0,L=t.pool_total||1,I=L>0?Math.min(w/L*100,100):50,d=p.current_odds||(w>0?L/w:2);return e.jsx(V,{className:G("cursor-pointer transition-all border-2",l===p.id?"border-teal-500 bg-teal-50":"border-gray-200 hover:border-gray-300"),onClick:()=>i(p.id),children:e.jsx(K,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:p.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[I.toFixed(1),"%"]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"text-lg font-bold text-teal-600",children:[d.toFixed(2),"x"]})})]})})},p.id||Math.random())})})]}),e.jsx(Y,{mode:"wait",children:l&&e.jsxs(j.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Stake amount"}),e.jsxs("div",{className:"relative",children:[e.jsx(Le,{type:"number",placeholder:"0.00",value:o,onChange:p=>m(p.target.value),className:"pl-8 pr-4 h-12 text-lg font-medium",min:t.stake_min,max:t.stake_max||b}),e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium",children:"$"})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 mt-2",children:[e.jsxs("span",{children:["Balance: ",_(b)]}),e.jsx("button",{onClick:()=>m(b.toString()),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Max"})]})]}),e.jsx("div",{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:F.map(p=>e.jsxs(J,{variant:"outline",size:"sm",onClick:()=>m(p.toString()),disabled:p>b,className:"text-sm h-10",children:["$",p]},p))})}),c>0&&e.jsx(V,{className:"bg-teal-50 border-teal-200",children:e.jsx(K,{className:"p-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Potential return"}),e.jsx("div",{className:"text-lg font-bold text-teal-600",children:_(C)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Profit"}),e.jsx("div",{className:G("font-semibold",C>c?"text-teal-600":"text-red-600"),children:_(C-c)})]})]})})})]},`amount-input-${l}`)})]}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-gray-200 bg-white",children:e.jsx(J,{onClick:R,disabled:!l||!c||y||c>b,className:"w-full h-12 bg-teal-500 hover:bg-teal-600 disabled:bg-gray-400 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg flex items-center justify-center",children:y?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Placing..."})]}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{size:16}),e.jsxs("span",{children:["Place Prediction (",_(c),")"]})]})})})]},"prediction-modal-content")})]})})},Ke=({hasNext:t,loading:a,onLoadMore:s,threshold:l=200,disabled:i=!1,container:o=null})=>{const m=r.useRef(!1),y=r.useCallback(()=>{if(i||a||!t||m.current)return;let u,x,f;o?(u=o.scrollTop,x=o.scrollHeight,f=o.clientHeight):(u=window.pageYOffset||document.documentElement.scrollTop,x=document.documentElement.scrollHeight,f=window.innerHeight||document.documentElement.clientHeight);const v=x-(u+f);v<=l&&(console.log("🔄 Infinite scroll triggered:",{distanceFromBottom:v,threshold:l,hasNext:t,loading:a,container:o?"container":"window"}),m.current=!0,s(),setTimeout(()=>{m.current=!1},1e3))},[i,a,t,l,s,o]);return r.useEffect(()=>{if(i)return;let u;const x=()=>{clearTimeout(u),u=setTimeout(y,100)},f=o||window,v="scroll",b="touchmove";return f.addEventListener(v,x,{passive:!0}),o||window.addEventListener(b,x,{passive:!0}),()=>{f.removeEventListener(v,x),o||window.removeEventListener(b,x),clearTimeout(u)}},[y,i,o]),{triggerLoadMore:r.useCallback(()=>{!i&&!a&&t&&!m.current&&(console.log("🔄 Manual infinite scroll trigger"),m.current=!0,s(),setTimeout(()=>{m.current=!1},1e3))},[i,a,t,s])}},qe=De((t,a)=>({positions:{},saveScrollPosition:(s,l)=>{t(i=>({positions:{...i.positions,[s]:{path:s,scrollY:l,timestamp:Date.now()}}}))},getScrollPosition:s=>{const l=a().positions[s];return l&&Date.now()-l.timestamp<10*60*1e3?l.scrollY:null},clearOldPositions:()=>{const s=Date.now(),l=10*60*1e3;t(i=>({positions:Object.fromEntries(Object.entries(i.positions).filter(([,o])=>s-o.timestamp<l))}))}})),Qe=(t,a={})=>{const[s]=je(),{saveScrollPosition:l,getScrollPosition:i}=qe(),o=r.useRef(""),{saveOnUnmount:m=!0,restoreOnMount:y=!0,preserveFor:k=10,threshold:u=50}=a,x=r.useCallback(()=>t?.current?t.current:document.querySelector("[data-scroll-container]")||document.documentElement,[t]),f=r.useCallback(()=>{const c=x(),h=c===document.documentElement?window.pageYOffset||document.documentElement.scrollTop:c.scrollTop;h>u&&(console.log(`💾 Saving scroll position for ${s}: ${h}px`),l(s,h))},[s,u,l,x]),v=r.useCallback(()=>{const c=x(),h=i(s);return h!==null&&h>0?(console.log(`🔄 Restoring scroll position for ${s}: ${h}px`),setTimeout(()=>{c===document.documentElement?window.scrollTo({top:h,behavior:"smooth"}):c.scrollTo({top:h,behavior:"smooth"})},100),!0):!1},[s,i,x]),b=r.useCallback(c=>{const h=x(),S=h===document.documentElement?window.pageYOffset||document.documentElement.scrollTop:h.scrollTop,C=c||s;S>u&&(console.log(`💾 Manually saving scroll for ${C}: ${S}px`),l(C,S))},[s,u,l,x]);return r.useEffect(()=>{let c;return y&&(c=setTimeout(()=>{v()},50)),()=>{c&&clearTimeout(c),m&&f()}},[y,m,v,f]),r.useEffect(()=>{o.current&&o.current!==s&&console.log(`🔄 Location changed from ${o.current} to ${s}`),o.current=s},[s]),{saveScroll:b,restoreScroll:v,saveCurrentScroll:f}},ne=Q.memo(function({selectedCategory:a,onSelect:s}){const l=[{id:"all",label:"All",icon:"🌟"},{id:"sports",label:"Sports",icon:"⚽"},{id:"pop_culture",label:"Pop Culture",icon:"🎬"},{id:"custom",label:"Custom",icon:"✨"},{id:"politics",label:"Politics",icon:"🗳️"},{id:"crypto",label:"Crypto",icon:"₿"},{id:"tech",label:"Tech",icon:"💻"},{id:"finance",label:"Finance",icon:"📈"}];return e.jsx("div",{className:"category-filters bg-white border-b border-gray-100 px-4 py-3","data-tour-id":"category-filters",children:e.jsx("div",{className:"category-filters-container overflow-x-auto -mx-2 px-2",children:e.jsx("div",{className:"category-filters-flex flex gap-2 pb-1",children:l.map(i=>e.jsx(j.button,{onClick:()=>s(i.id),className:`
                category-pill flex-shrink-0 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm font-medium
                transition-all duration-200 whitespace-nowrap
                ${a===i.id?"active bg-purple-500 text-white shadow-sm":"bg-gray-100 text-gray-700 hover:bg-gray-200"}
              `,whileTap:{scale:.96},children:e.jsx("span",{children:i.label})},i.id))})})})});ne.displayName="CategoryFilters";const ie=Q.memo(function({stats:a,searchQuery:s,onSearchChange:l}){return e.jsxs("div",{className:"px-4 pt-4 pb-4 bg-white",children:[e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-emerald-50 to-teal-50 rounded-2xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-emerald-500 rounded-full animate-pulse"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"LIVE MARKETS"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-lg font-bold text-gray-900",children:["$",a?.totalVolume||"0"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Volume"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a?.activePredictions||"0"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Live"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-gray-900",children:a?.totalUsers||"0"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Players"})]})]})]}),e.jsxs("div",{className:"relative","data-tour-id":"search-bar",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ne,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search predictions...",value:s,onChange:i=>l(i.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-50 border-0 rounded-xl text-gray-900 placeholder-gray-500 focus:bg-white focus:ring-2 focus:ring-emerald-500 focus:outline-none transition-all"})]})]})});ie.displayName="DiscoverHeaderContent";const We=Q.memo(function({onNavigateToProfile:a,onNavigateToPrediction:s}){q();const{predictions:l,loading:i,loadingMore:o,pagination:m,filters:y,refreshPredictions:k,loadMorePredictions:u,setFilters:x}=ae(),[f,v]=r.useState(null),[b,c]=r.useState(!1),h=r.useRef(null),{saveScroll:S}=Qe(h,{saveOnUnmount:!0,restoreOnMount:!0,preserveFor:15,threshold:100}),[C,F]=r.useState({totalVolume:"0",activePredictions:0,totalUsers:"0",rawVolume:0,rawUsers:0}),R=r.useCallback(async()=>{try{const{getApiUrl:n}=await we(()=>import("./index-9e31fc92.js").then(D=>D.Q),["assets/index-9e31fc92.js","assets/ui-7ef4368a.js","assets/vendor-2237fdcd.js","assets/utils-ac284782.js","assets/index-52054a3d.css"]),$=await fetch(`${n()}/api/v2/predictions/stats/platform`);if($.ok){const D=await $.json();D.success&&(F(D.data),console.log("✅ Platform stats fetched:",D.data))}else console.error("Failed to fetch platform stats:",$.status)}catch(n){console.error("Error fetching platform stats:",n)}},[]);Ke({hasNext:m.hasNext,loading:o,onLoadMore:()=>{console.log("🔄 Infinite scroll triggered in DiscoverPage:",{hasNext:m.hasNext,loading:o,currentPage:m.page,total:m.total}),u()},threshold:300,container:h.current}),r.useEffect(()=>{k(),R()},[k,R]);const p=r.useMemo(()=>({totalVolume:C.totalVolume,activePredictions:C.activePredictions,totalUsers:C.totalUsers}),[C]),w=r.useMemo(()=>!l||!Array.isArray(l)?(console.log("🔍 DiscoverPage Debug - No valid predictions array:",l),[]):(console.log(`🔍 DiscoverPage Debug - Displaying ${l.length} predictions`),l.filter(n=>!n||!n.id||!n.title?(console.warn("⚠️ DiscoverPage: Invalid prediction object:",n),!1):!0)),[l]),L=r.useCallback(n=>{v(n),c(!0)},[]),I=r.useCallback(n=>{S("/discover"),s?s(n):window.location.href=`/prediction/${n}`},[s,S]),d=r.useCallback(n=>{B.success("Prediction liked!")},[]),T=r.useCallback(n=>{S("/discover"),I(n)},[I,S]),z=r.useCallback(n=>{const $=`Check out this prediction: ${n.title}`,D=`${window.location.origin}/prediction/${n.id}`;navigator.share?navigator.share({title:n.title,text:$,url:D}).catch(console.error):navigator.clipboard.writeText(`${$}
${D}`).then(()=>B.success("Link copied to clipboard!")).catch(()=>B.error("Failed to copy link"))},[]),E=r.useCallback(n=>{console.log("🔍 Search query changed:",n),x({search:n})},[x]),U=r.useCallback(n=>{console.log("📂 Category changed:",n),x({category:n})},[x]),O=r.useCallback(()=>{c(!1),v(null)},[]);return i&&(!l||l.length===0)?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsxs("div",{className:"bg-white border-b border-gray-100",children:[e.jsx("div",{className:"h-11"}),e.jsxs("div",{className:"px-4 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24 mb-2 loading-skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32 loading-skeleton"})]}),e.jsx("div",{className:"w-10 h-10 bg-gray-200 rounded-full loading-skeleton"})]}),e.jsxs("div",{className:"bg-gray-200 rounded-2xl p-4 mb-4 loading-skeleton",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-20 mb-3 loading-skeleton"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-16 mx-auto loading-skeleton"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-12 mx-auto loading-skeleton"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-6 bg-gray-300 rounded mb-1 loading-skeleton"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-14 mx-auto loading-skeleton"})]})]})]}),e.jsx("div",{className:"h-12 bg-gray-200 rounded-xl loading-skeleton"})]})]}),e.jsx("div",{className:"px-4 py-3 bg-white border-b border-gray-100",children:e.jsx("div",{className:"flex gap-2 overflow-x-auto",children:[1,2,3,4,5,6].map(n=>e.jsx("div",{className:"h-8 bg-gray-200 rounded-full w-20 flex-shrink-0 loading-skeleton"},n))})}),e.jsxs("div",{className:"py-4",children:[e.jsxs("div",{className:"px-4 mb-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mb-2 loading-skeleton"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24 loading-skeleton"})]}),e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(n=>e.jsx(Ue,{},n))})]})]}):e.jsxs("div",{ref:h,className:"discover-page content-with-bottom-nav","data-scroll-container":!0,style:{position:"relative",zIndex:1,overflowY:"auto",height:"100vh"},children:[e.jsx(Me,{title:"Discover"}),e.jsx(ie,{stats:p,searchQuery:y.search,onSearchChange:E}),e.jsx("div",{className:"category-filters-wrapper",style:{position:"relative",zIndex:45},children:e.jsx(ne,{selectedCategory:y.category,onSelect:U})}),e.jsxs("div",{className:"prediction-cards-container",children:[e.jsxs(j.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"px-4 mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-900 mb-1","data-tour-id":"discover-list",children:[y.category==="all"?"All Predictions":`${y.category} Predictions`,y.search&&` - "${y.search}"`]}),m.total>0&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",w.length," of ",m.total," predictions",m.hasNext&&" • Scroll for more"]})]}),e.jsx("div",{className:"space-y-2",children:e.jsx(Y,{mode:"wait",children:w.length>0?e.jsxs(e.Fragment,{children:[w.map((n,$)=>!n||!n.id?(console.warn("⚠️ DiscoverPage: Skipping invalid prediction at index",$),null):e.jsx(Ie,{prediction:n,variant:"compact",onPredict:()=>L(n),onLike:()=>d(n.id),onComment:()=>T(n.id),onShare:()=>z(n)},`${n.id}-${$}`)),o&&e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-center justify-center py-8",children:[e.jsx(ke,{className:"w-6 h-6 animate-spin text-purple-500 mr-3"}),e.jsx("span",{className:"text-gray-600",children:"Loading more predictions..."})]}),m.hasNext&&!o&&e.jsxs(j.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-6",children:[e.jsxs("button",{onClick:()=>{console.log("🔄 Manual load more triggered"),u()},className:"bg-purple-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-purple-600 transition-colors",children:["Load More (",m.total-w.length," remaining)"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Page ",m.page," • ",w.length,"/",m.total]})]}),!m.hasNext&&!o&&w.length>10&&e.jsx(j.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"🎉 You've seen all predictions!"})})]}):e.jsxs(j.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"text-center py-12 px-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(se,{size:24,className:"text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No predictions found"}),e.jsx("p",{className:"text-gray-600",children:y.search?`No predictions match "${y.search}"`:i?"Loading predictions...":"Try adjusting your filters or check back later"}),!i&&!y.search&&e.jsx("button",{onClick:()=>k(!0),className:"mt-4 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition-colors",children:"Refresh Predictions"})]})})})]}),e.jsx(Ve,{prediction:f,isOpen:b,onClose:O})]})});We.displayName="DiscoverPage";export{We as default};
