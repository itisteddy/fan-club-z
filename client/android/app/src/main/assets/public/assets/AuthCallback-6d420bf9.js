import{j as e}from"./ui-c369d1f3.js";import{r as w}from"./vendor-c36eaa8e.js";import{ay as F,j as U,az as p,aA as f}from"./index-78beacc5.js";import"./wagmi-c444efa6.js";import"./utils-617af415.js";function z(){return e.jsx("div",{className:"flex h-screen items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Completing Sign In..."}),e.jsx("p",{className:"text-gray-600",children:"Please wait while we finish setting up your account."})]})})}const H=()=>{const{supabase:r}=F(),o=U(),[d,b]=w.useState(null),m=i=>new Promise(t=>setTimeout(t,i)),j=async(i=2e3)=>{const t=Date.now();let n=await r.auth.getSession();for(;!n.data.session&&Date.now()-t<i;)await m(250),n=await r.auth.getSession();return n};return w.useEffect(()=>{(async()=>{try{const{data:{session:t},error:n}=await r.auth.getSession();if(t&&!n){const h=new URLSearchParams(window.location.search).get("next"),N=p(),P=f(h??N??"/");await new Promise(E=>setTimeout(E,500)),o(P,{replace:!0});return}const c=new URLSearchParams(window.location.search);let a=c.get("next");if(a)try{a=decodeURIComponent(a),a.includes("app.fanclubz.app")}catch{a=null}let l=p();if(l&&l.includes("app.fanclubz.app")&&!1)try{}catch{}const y=(window.location.hash||"").includes("access_token="),S=!!c.get("access_token"),u=!!c.get("code"),x=y||S;if(x&&!u)try{const{data:s,error:h}=await r.auth.getSessionFromUrl({storeSession:!0})}catch{}u&&await m(500);const{data:{session:k},error:g}=await j(2500);if(g)throw g;if(!k)throw u?new Error("Google sign-in failed. Please try signing in again. If the problem persists, try clearing your browser cookies and cache."):x?new Error("This sign-in link is invalid or has already been used. Please request a new email link to sign in."):new Error("Authentication failed. Please try signing in again.");const v=f(a??l??"/");await new Promise(s=>setTimeout(s,500)),o(v,{replace:!0})}catch(t){b(t.message||"Authentication failed")}})()},[r,o]),d?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center max-w-md mx-auto p-6",children:[e.jsxs("div",{className:"bg-red-50 rounded-lg p-4 mb-4",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-4 bg-red-100 rounded-full",children:e.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Authentication Error"}),e.jsx("p",{className:"text-red-600 text-sm mb-4",children:d})]}),e.jsx("button",{onClick:()=>o("/",{replace:!0}),className:"bg-emerald-500 text-white px-6 py-2 rounded-lg hover:bg-emerald-600 transition-colors",children:"Return to Home"})]})}):e.jsx(z,{})};export{H as default};
