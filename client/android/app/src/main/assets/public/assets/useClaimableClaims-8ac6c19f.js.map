{"version":3,"file":"useClaimableClaims-8ac6c19f.js","sources":["../../src/hooks/useClaimableClaims.ts"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\nimport { getApiUrl } from '@/utils/environment';\n// no need for QK here; define a stable key inline\n\nexport type ClaimableItem = {\n  predictionId: string;\n  title: string;\n  amountUnits: string;\n  amountUSD: number;\n  proof: `0x${string}`[];\n  merkleRoot: `0x${string}`;\n};\n\nexport function useClaimableClaims(address?: string, limit = 20) {\n  return useQuery({\n    queryKey: ['wallet', 'claimable', (address || '').toLowerCase(), limit],\n    enabled: Boolean(address),\n    queryFn: async (): Promise<ClaimableItem[]> => {\n      const params = new URLSearchParams({ address: String(address), limit: String(limit) });\n      const r = await fetch(`${getApiUrl()}/api/v2/settlement/claimable?${params.toString()}`, {\n        headers: { Accept: 'application/json' },\n        credentials: 'include',\n      });\n      if (!r.ok) {\n        const j = await r.json().catch(() => ({}));\n        throw new Error(j?.message || 'Failed to load claimable items');\n      }\n      const json = await r.json();\n      const items = ((json?.data?.claims ?? []) as ClaimableItem[]);\n      \n      // CRITICAL: Deduplicate by predictionId (safety net if backend returns duplicates)\n      const seen = new Map<string, ClaimableItem>();\n      for (const item of items) {\n        if (!seen.has(item.predictionId)) {\n          seen.set(item.predictionId, item);\n        }\n      }\n      const deduplicated = Array.from(seen.values());\n      \n      // Also apply a local \"claimed\" mask to avoid flicker if backend lags\n      try {\n        const addrLower = (address || '').toLowerCase();\n        return deduplicated.filter((it) => !localStorage.getItem(`fcz:claimed:${it.predictionId}:${addrLower}`));\n      } catch {\n        return deduplicated;\n      }\n    },\n    staleTime: 15_000,\n    refetchInterval: 30_000,\n  });\n}\n\n\n"],"names":["useClaimableClaims","address","limit","useQuery","params","r","getApiUrl","j","items","seen","item","deduplicated","addrLower","it"],"mappings":"gFAagB,SAAAA,EAAmBC,EAAkBC,EAAQ,GAAI,CAC/D,OAAOC,EAAS,CACd,SAAU,CAAC,SAAU,aAAcF,GAAW,IAAI,cAAeC,CAAK,EACtE,QAAS,EAAQD,EACjB,QAAS,SAAsC,CAC7C,MAAMG,EAAS,IAAI,gBAAgB,CAAE,QAAS,OAAOH,CAAO,EAAG,MAAO,OAAOC,CAAK,CAAG,CAAA,EAC/EG,EAAI,MAAM,MAAM,GAAGC,GAAW,gCAAgCF,EAAO,SAAU,CAAA,GAAI,CACvF,QAAS,CAAE,OAAQ,kBAAmB,EACtC,YAAa,SAAA,CACd,EACG,GAAA,CAACC,EAAE,GAAI,CACH,MAAAE,EAAI,MAAMF,EAAE,OAAO,MAAM,KAAO,CAAG,EAAA,EACzC,MAAM,IAAI,MAAME,GAAG,SAAW,gCAAgC,CAChE,CAEA,MAAMC,GADO,MAAMH,EAAE,SACC,MAAM,QAAU,CAAA,EAGhCI,MAAW,IACjB,UAAWC,KAAQF,EACZC,EAAK,IAAIC,EAAK,YAAY,GACxBD,EAAA,IAAIC,EAAK,aAAcA,CAAI,EAGpC,MAAMC,EAAe,MAAM,KAAKF,EAAK,OAAQ,CAAA,EAGzC,GAAA,CACI,MAAAG,GAAaX,GAAW,IAAI,YAAY,EAC9C,OAAOU,EAAa,OAAQE,GAAO,CAAC,aAAa,QAAQ,eAAeA,EAAG,YAAY,IAAID,CAAS,EAAE,CAAC,CAAA,MACjG,CACC,OAAAD,CACT,CACF,EACA,UAAW,KACX,gBAAiB,GAAA,CAClB,CACH"}