{"version":3,"file":"txFormat-714ffd43.js","sources":["../../src/lib/txFormat.ts"],"sourcesContent":["/**\n * Transaction delta formatting\n * \n * Centralizes the logic for displaying transaction amounts with correct\n * signs and colors (credits = green +, debits = red –)\n */\n\nimport { formatCurrency } from './format';\n\nexport type TxTone = 'credit' | 'debit' | 'neutral';\n\nfunction normKey(v?: string) {\n  return (v || '').toLowerCase().trim();\n}\n\nfunction keyMatchesAny(key: string, needles: string[]) {\n  for (const n of needles) {\n    if (!n) continue;\n    if (key.includes(n)) return true;\n  }\n  return false;\n}\n\n/**\n * Determine transaction tone (credit/debit/neutral) from amount and optional metadata\n */\nexport function getTxDeltaTone(args: {\n  amount: number;\n  direction?: 'credit' | 'debit';\n  type?: string;\n  kind?: string;\n}): TxTone {\n  const { amount, direction, type, kind } = args;\n\n  if (amount === 0) return 'neutral';\n\n  // If direction is explicitly provided, use it\n  if (direction === 'credit') return 'credit';\n  if (direction === 'debit') return 'debit';\n\n  // Many activity feeds store amounts as positive numbers (e.g. amountUSD is abs),\n  // so we infer direction from the event key when available.\n  const k = normKey(kind);\n  const t = normKey(type);\n  const key = `${k} ${t}`.trim();\n\n  // Known debit-ish events (stakes/locks/losses/withdrawals/fees)\n  const debitMarkers = [\n    'withdraw',\n    'wallet.withdraw',\n    'bet_lock',\n    'wallet.bet_lock',\n    'bet_placed',\n    'entry.create',\n    'entry',\n    'stake',\n    'loss',\n    'wallet.loss',\n    'fee',\n  ];\n\n  // Known credit-ish events (deposits/unlocks/refunds/payouts/wins/claims/earnings)\n  const creditMarkers = [\n    'deposit',\n    'wallet.deposit',\n    'unlock',\n    'release',\n    'bet_refund',\n    'refund',\n    'payout',\n    'wallet.payout',\n    'win',\n    'claim',\n    'creator_fee',\n    'wallet.creator_fee',\n    'platform_fee',\n    'wallet.platform_fee',\n  ];\n\n  if (key && keyMatchesAny(key, creditMarkers)) return 'credit';\n  if (key && keyMatchesAny(key, debitMarkers)) return 'debit';\n\n  // Fallback to numeric sign when we truly have signed amounts\n  return amount > 0 ? 'credit' : 'debit';\n}\n\n/**\n * Format transaction amount with sign and tone\n */\nexport function formatTxAmount(args: {\n  amount: number;\n  currencySymbol?: string;\n  currency?: string;\n  direction?: 'credit' | 'debit';\n  type?: string;\n  kind?: string;\n  compact?: boolean;\n}): { tone: TxTone; display: string; absAmount: number } {\n  const { amount, currencySymbol = '$', compact = true, currency = 'USD' } = args;\n  const absAmount = Math.abs(amount);\n  const tone = getTxDeltaTone({ amount, direction: args.direction, type: args.type, kind: args.kind });\n\n  // Format the absolute amount\n  const formatted = formatCurrency(absAmount, { compact, currency });\n\n  // Add sign based on tone\n  let display: string;\n  if (tone === 'credit') {\n    display = `+${formatted}`;\n  } else if (tone === 'debit') {\n    display = `–${formatted}`; // Use en-dash for better typography\n  } else {\n    display = formatted; // Neutral: no sign\n  }\n\n  return { tone, display, absAmount };\n}\n\n/**\n * Get CSS class for transaction tone\n * Maps to existing design language classes\n */\nexport function toneClass(tone: TxTone): string {\n  switch (tone) {\n    case 'credit':\n      return 'text-emerald-600'; // Green for credits\n    case 'debit':\n      return 'text-red-500'; // Red for debits\n    case 'neutral':\n      return 'text-gray-500'; // Muted for neutral\n    default:\n      return 'text-gray-500';\n  }\n}\n"],"names":["normKey","v","keyMatchesAny","key","needles","getTxDeltaTone","args","amount","direction","type","kind","k","t","debitMarkers","formatTxAmount","currencySymbol","compact","currency","absAmount","tone","formatted","formatCurrency","display","toneClass"],"mappings":"yCAWA,SAASA,EAAQC,EAAY,CAC3B,OAAQA,GAAK,IAAI,YAAY,EAAE,KAAK,CACtC,CAEA,SAASC,EAAcC,EAAaC,EAAmB,CACrD,UAAW,KAAKA,EACd,GAAK,GACDD,EAAI,SAAS,CAAC,EAAU,MAAA,GAEvB,MAAA,EACT,CAKO,SAASE,EAAeC,EAKpB,CACT,KAAM,CAAE,OAAAC,EAAQ,UAAAC,EAAW,KAAAC,EAAM,KAAAC,GAASJ,EAE1C,GAAIC,IAAW,EAAU,MAAA,UAGzB,GAAIC,IAAc,SAAiB,MAAA,SACnC,GAAIA,IAAc,QAAgB,MAAA,QAI5B,MAAAG,EAAIX,EAAQU,CAAI,EAChBE,EAAIZ,EAAQS,CAAI,EAChBN,EAAM,GAAGQ,CAAC,IAAIC,CAAC,GAAG,OAGlBC,EAAe,CACnB,WACA,kBACA,WACA,kBACA,aACA,eACA,QACA,QACA,OACA,cACA,KAAA,EAqBE,OAAAV,GAAOD,EAAcC,EAjBH,CACpB,UACA,iBACA,SACA,UACA,aACA,SACA,SACA,gBACA,MACA,QACA,cACA,qBACA,eACA,qBAAA,CAGyC,EAAU,SACjDA,GAAOD,EAAcC,EAAKU,CAAY,EAAU,QAG7CN,EAAS,EAAI,SAAW,OACjC,CAKO,SAASO,EAAeR,EAQ0B,CACjD,KAAA,CAAE,OAAAC,EAAQ,eAAAQ,EAAiB,IAAK,QAAAC,EAAU,GAAM,SAAAC,EAAW,KAAU,EAAAX,EACrEY,EAAY,KAAK,IAAIX,CAAM,EAC3BY,EAAOd,EAAe,CAAE,OAAAE,EAAQ,UAAWD,EAAK,UAAW,KAAMA,EAAK,KAAM,KAAMA,EAAK,IAAM,CAAA,EAG7Fc,EAAYC,EAAeH,EAAW,CAAE,QAAAF,EAAS,SAAAC,EAAU,EAG7D,IAAAK,EACJ,OAAIH,IAAS,SACXG,EAAU,IAAIF,CAAS,GACdD,IAAS,QAClBG,EAAU,IAAIF,CAAS,GAEbE,EAAAF,EAGL,CAAE,KAAAD,EAAM,QAAAG,EAAS,UAAAJ,EAC1B,CAMO,SAASK,EAAUJ,EAAsB,CAC9C,OAAQA,EAAM,CACZ,IAAK,SACI,MAAA,mBACT,IAAK,QACI,MAAA,eACT,IAAK,UACI,MAAA,gBACT,QACS,MAAA,eACX,CACF"}