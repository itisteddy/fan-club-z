import{r as b}from"./vendor-2237fdcd.js";const g=new Map,d=new Map,v=new Set;function S(){v.forEach(t=>t())}const c={get(t){return g.get(t)},set(t,e){g.set(t,e),S()},has(t){return g.has(t)},peekInflight(t){return d.get(t)},setInflight(t,e){d.set(t,e)},clearInflight(t){d.delete(t)},subscribe(t){return v.add(t),()=>v.delete(t)},reset(){g.clear(),d.clear(),S()}},T="KoLAbON534ZA8GNcNdZGTEoDtNBarlgJArGSokyuGkI",M="MNVZGjhI06B65Il9QFX2GVU9D3nHftQzMZhMcWVNICUQtrKYbf4JoSKf",k=12,L=6e3,R=new Set(["the","a","an","and","or","of","in","on","at","to","for","by","with","from","will","is","are","be","being","been","do","does","did","can","could","should","may","might","it","this","that","these","those","about","over","under","into","than","as","if","then","but","so","not","no","yes","you","we","they","i"]),x=["logo","vector","illustration","icon","mockup","render","3d","sticker"],E={technology:[/phone|iphone|smartphone|device|ai|chip|semiconductor|laptop|app|software|hardware|startup|gadget/i],finance:[/stock|market|earnings|revenue|profit|ipo|fed|rates|inflation|bank|economy|gdp|tariff/i],crypto:[/bitcoin|ethereum|solana|blockchain|token|coin|defi|web3|nft/i],sports:[/match|game|season|league|tournament|player|goal|score|nba|nfl|premier|fifa|olympic/i],politics:[/election|vote|president|parliament|policy|government|minister|senate|congress|referendum/i],entertainment:[/movie|film|tv|show|series|celebrity|album|music|song|oscars|emmys|grammys/i],gaming:[/game|esports|steam|nintendo|playstation|xbox|league of legends|valorant|fortnite|minecraft/i],science:[/research|space|nasa|physics|biology|health|vaccine|climate|genome|quantum/i],popCulture:[/trend|viral|meme|influencer|tiktok|instagram|youtube|fashion|brand/i],general:[/./]},y={technology:["https://images.unsplash.com/photo-1518770660439-4636190af475","https://images.unsplash.com/photo-1510552776732-03e61cf4b144","https://images.unsplash.com/photo-1517336714731-489689fd1ca8"],finance:["https://images.unsplash.com/photo-1526304640581-d334cdbbf45e","https://images.unsplash.com/photo-1526304640581-8b363aa866a6"],crypto:["https://images.unsplash.com/photo-1621416894569-0f39d71dbe8f","https://images.unsplash.com/photo-1518544801976-3e4e4474c1ee"],sports:["https://images.unsplash.com/photo-1459865264687-595d652de67e","https://images.unsplash.com/photo-1521417531630-0a222dda9bda"],politics:["https://images.unsplash.com/photo-1530036723598-68bd9f06e1d2","https://images.unsplash.com/photo-1520975916090-3105956dac38"],entertainment:["https://images.unsplash.com/photo-1515165562835-c3b8c0b0b0d6","https://images.unsplash.com/photo-1497032628192-86f99bcd76bc"],gaming:["https://images.unsplash.com/photo-1511512578047-dfb367046420","https://images.unsplash.com/photo-1542751110-97427bbecf20"],science:["https://images.unsplash.com/photo-1451187580459-43490279c0fa","https://images.unsplash.com/photo-1507413245164-6160d8298b31"],popCulture:["https://images.unsplash.com/photo-1514516870926-205989cdcb5a","https://images.unsplash.com/photo-1516826957135-700dedea698c"],general:["https://images.unsplash.com/photo-1500530855697-b586d89ba3ee","https://images.unsplash.com/photo-1500534314209-a25ddb2bd429"]};function _(t){let e=2166136261;for(let r=0;r<t.length;r++)e^=t.charCodeAt(r),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}function I(t){return(t||"").toLowerCase().replace(/[^a-z0-9\s\-\+]/g," ").split(/\s+/).filter(Boolean).filter(e=>!R.has(e)).slice(0,24)}function j(t){const e=[];for(const s of Object.keys(E)){const o=E[s].reduce((n,l)=>n+(t.some(p=>l.test(p))?1:0),0);o>0&&e.push({c:s,score:o})}if(!e.length)return["general"];e.sort((s,a)=>a.score-s.score);const r=e[0].score;return e.filter(s=>s.score>=r).map(s=>s.c)}function N(t,e){const r=t.slice(0,8).join(" "),s={technology:["technology","device","smartphone","product"],finance:["finance","stock market","economy","trading"],crypto:["crypto","blockchain"],sports:["sports","stadium","game"],politics:["politics","government"],entertainment:["entertainment","audience"],gaming:["gaming"],science:["science","research"],popCulture:["trending","pop culture"],general:[]},a=new Set;return a.add(r),e.forEach(o=>{s[o].forEach(n=>a.add(`${r} ${n}`.trim()))}),t.length<2&&e.forEach(o=>s[o].forEach(n=>a.add(n))),x.forEach(o=>{for(const n of Array.from(a))a.add(`${n} -${o}`)}),Array.from(a).slice(0,12)}async function A(t,e=L){return new Promise((r,s)=>{const a=setTimeout(()=>s(new Error("timeout")),e);t.then(o=>{clearTimeout(a),r(o)},o=>{clearTimeout(a),s(o)})})}async function O(t,e,r){const s=[],a=t[r%t.length],o=new URL("https://api.unsplash.com/search/photos");o.searchParams.set("query",a),o.searchParams.set("per_page",String(e)),o.searchParams.set("orientation","landscape"),o.searchParams.set("content_filter","high");const n=await A(fetch(o.toString(),{headers:{Authorization:`Client-ID ${T}`}}));if(!n.ok)return[];const p=(await n.json())?.results||[];for(const i of p)s.push({provider:"unsplash",id:i.id,url:i.urls?.regular||i.urls?.small||i.urls?.raw,alt:i.alt_description||i.description||"",tags:(i.tags||[]).map(u=>u.title).filter(Boolean)});return s}async function U(t,e,r){const s=[],a=t[(r+1)%t.length],o=new URL("https://api.pexels.com/v1/search");o.searchParams.set("query",a),o.searchParams.set("per_page",String(e)),o.searchParams.set("orientation","landscape");const n=await A(fetch(o.toString(),{headers:{Authorization:M}}));if(!n.ok)return[];const p=(await n.json())?.photos||[];for(const i of p)s.push({provider:"pexels",id:String(i.id),url:i.src?.large2x||i.src?.large||i.src?.medium||i.src?.original,alt:i.alt||"",tags:[]});return s}function D(t,e){if(!t.length||!e.length)return 0;const r=new Set(t);let s=0;return e.forEach(a=>{r.has(a)&&s++}),s/Math.max(t.length,e.length)}function G(t,e,r){const s=I(`${t.alt||""} ${new URL(t.url).pathname.replace(/\//g," ")}`);let a=D(e,s)*1.5;const o=r.flatMap(n=>n.split(/(?=[A-Z])/)).map(n=>n.toLowerCase());return s.some(n=>o.includes(n))&&(a+=.2),x.some(n=>s.includes(n))&&(a-=.4),a}function w(t,e){if(t.length)return t[e%t.length]}async function H(t){const e=_(t.id),r=[t.title,t.description||""].join(" "),s=I(r),a=j(s),o=N(s,a);let n=[];try{const[u,m]=await Promise.allSettled([O(o,k,e),U(o,k,e)]);u.status==="fulfilled"&&(n=n.concat(u.value)),m.status==="fulfilled"&&(n=n.concat(m.value))}catch{}if(t.imageHint&&/^https?:\/\//i.test(t.imageHint))return{id:"hint",url:t.imageHint,provider:"hint",alt:t.title};if(n.length){const u=n.map(h=>({r:h,s:G(h,s,a)})).sort((h,P)=>P.s-h.s),m=u[0].s,C=u.filter(h=>h.s>=m-.2).map(h=>h.r),f=w(C,e)||w(n,e);return{id:f.id,url:f.url,alt:f.alt||t.title,provider:f.provider}}const l=a[0]||"general",p=y[l]||y.general;return{id:"fallback",url:w(p,e)||y.general[0],alt:t.title,provider:"fallback"}}const $={id:"placeholder",url:"data:image/svg+xml;utf8,"+encodeURIComponent(`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600">
        <defs><linearGradient id="g" x1="0" x2="1"><stop stop-color="#f3f4f6"/><stop offset="1" stop-color="#e5e7eb"/></linearGradient></defs>
        <rect width="100%" height="100%" fill="url(#g)"/></svg>`),alt:"",provider:"fallback"};function K(t,e){const a=!!b.useMemo(()=>c.get(t)??null,[t,c.get(t)])?"ready":"loading";return b.useEffect(()=>{if(c.get(t))return;const o=c.peekInflight(t);if(o){o.then(l=>c.set(t,l)).catch(()=>c.clearInflight(t));return}const n=H(e).then(l=>c.set(t,l)).catch(()=>{}).finally(()=>c.clearInflight(t));c.setInflight(t,n)},[t,e]),b.useSyncExternalStore(c.subscribe,()=>0),{media:c.get(t)??$,status:a}}export{K as u};
