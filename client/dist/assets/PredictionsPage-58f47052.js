import{j as e,m as N,A as ie}from"./ui-78f6af00.js";import{r,R as ze}from"./vendor-2237fdcd.js";import{e as me,o as He,X as Z,A as W,f as We,g as Ye,z as pe,u as be,n as T,C as de,d as ee,B as ge,h as Ce,b as Ve,i as Ge,T as Ne,j as ve,k as se,P as qe}from"./index-ed10b69d.js";import{u as ye}from"./predictionStore-b57c3d4f.js";import{g as ce}from"./index-0f9ae2a6.js";import{I as Ke,B as oe}from"./input-23b48381.js";import{c as Je}from"./utils-7b53e1b5.js";import{D as fe}from"./dollar-sign-7966139d.js";import{U as ae}from"./users-c41e2c9e.js";import{C as Xe}from"./check-5827933d.js";import{M as Ze,A as we,S as Qe,C as et}from"./share-2-34a93c08.js";import{P as ke}from"./pen-line-abb55cf5.js";import{A as Se}from"./AppHeader-e1af1366.js";import"./utils-718748af.js";/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=me("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=me("Gavel",[["path",{d:"m14.5 12.5-8 8a2.119 2.119 0 1 1-3-3l8-8",key:"15492f"}],["path",{d:"m16 16 6-6",key:"vzrcl6"}],["path",{d:"m8 8 6-6",key:"18bi4p"}],["path",{d:"m9 7 8 8",key:"5jnvq1"}],["path",{d:"m21 11-8-8",key:"z4y7zo"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=me("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=me("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),it=({title:v,body:b,primaryLabel:s="Sign In",onPrimary:w,secondaryLabel:p,onSecondary:S,intent:y,payload:c})=>{const n=async()=>{if(w)w();else if(y)try{const C=await He({intent:y,payload:c});C.status==="success"||C.status==="cancel"||C.status}catch{}else console.warn("SignedOutGateCard: No onPrimary or intent provided")};return e.jsx(N.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"max-w-sm mx-auto mt-8",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 text-center border border-gray-100",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:e.jsx(st,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",role:"heading","aria-level":"2",children:v||"Sign in required"}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed mb-8",role:"text",children:b||"Please sign in to continue with this action."}),e.jsxs(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:n,className:"w-full flex items-center justify-center gap-2 bg-emerald-600 text-white py-4 px-6 rounded-xl font-semibold hover:bg-emerald-700 transition-colors mb-4","data-qa":"authgate-open",style:{minHeight:"44px"},children:[s,e.jsx(tt,{className:"w-4 h-4"})]}),p&&S&&e.jsx(N.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:S,className:"w-full text-gray-600 py-3 px-6 rounded-xl font-medium hover:text-gray-800 hover:bg-gray-50 transition-colors",style:{minHeight:"44px"},children:p})]})})},lt=({isOpen:v,onClose:b,onConfirm:s,title:w,message:p,confirmText:S="Confirm",cancelText:y="Cancel",variant:c="danger",isLoading:n=!1})=>{const o=(()=>{switch(c){case"danger":return{icon:e.jsx(W,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"};case"warning":return{icon:e.jsx(W,{className:"w-6 h-6 text-amber-600"}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white",border:"border-amber-200"};case"info":return{icon:e.jsx(W,{className:"w-6 h-6 text-blue-600"}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",border:"border-blue-200"};default:return{icon:e.jsx(W,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"}}})(),k=()=>{n||s()},_=()=>{n||b()};return e.jsx(ie,{mode:"wait",children:v&&e.jsxs("div",{className:"fixed inset-0 z-[12000] flex items-center justify-center p-4",children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50",onClick:_}),e.jsxs(N.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${o.border}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[o.icon,e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:w})]}),e.jsx("button",{onClick:_,disabled:n,className:"p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-600 leading-relaxed",children:p})}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:_,disabled:n,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50",children:y}),e.jsx("button",{onClick:k,disabled:n,className:`flex-1 px-4 py-3 rounded-xl font-medium transition-colors disabled:opacity-50 ${o.confirmButton}`,children:n?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):S})]})]})]})})},rt=()=>{const[v,b]=r.useState(!1),[s,w]=r.useState(null),p=r.useCallback(async y=>{b(!0),w(null);try{console.log("ğŸ”¨ Starting manual settlement:",y);const c=await fetch(`${ce()}/api/v2/settlement/manual`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(y)});if(console.log("ğŸ“¡ Settlement response status:",c.status),!c.ok){const C=await c.json();return console.error("âŒ Settlement failed:",C),w(C.message||"Settlement failed"),null}const n=await c.json();return console.log("âœ… Settlement successful:",n),n}catch(c){return console.error("âŒ Settlement network error:",c),w("Network error during settlement"),null}finally{b(!1)}},[]),S=r.useCallback(async y=>{try{console.log("ğŸ“Š Fetching settlement info for:",y);const c=await fetch(`${ce()}/api/v2/settlement/prediction/${y}`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!c.ok){if(c.status===404)return null;throw new Error(`Failed to fetch settlement: ${c.status}`)}const n=await c.json();return console.log("ğŸ“Š Settlement info fetched:",n),n.data}catch(c){return console.error("âŒ Error fetching settlement info:",c),null}},[]);return{settleManually:p,getSettlementInfo:S,isSettling:v,settlementError:s,clearError:()=>w(null)}},Pe=r.forwardRef(({className:v,...b},s)=>e.jsx("textarea",{className:Je("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",v),ref:s,...b}));Pe.displayName="Textarea";const nt=({isOpen:v,onClose:b,prediction:s,onSettlementComplete:w})=>{const[p,S]=r.useState(""),[y,c]=r.useState(""),[n,C]=r.useState(""),[o,k]=r.useState(!1),[_,g]=r.useState(s.options||[]),{settleManually:M,isSettling:m,settlementError:O,clearError:d}=rt();We();const u=async()=>{if(!p){pe.error("Please select a winning option");return}if(!n.trim()){pe.error("Please provide a reason for settlement");return}try{await M({predictionId:s.id,winningOptionId:p,proofUrl:y.trim()||void 0,reason:n.trim(),userId:s.creator_id||"325343a7-0a32-4565-8059-7c0d9d3fed1b"})&&(pe.success("Prediction settled successfully!"),console.log("ğŸ”” Settlement completed, participants will be notified individually"),k(!1),b(),w&&w())}catch(f){console.error("Settlement error:",f)}},R=()=>{S(""),c(""),C(""),k(!1),d(),b()},{fetchPredictionById:x}=ye();ze.useEffect(()=>{let f=!0;return(async()=>{try{if(s.options&&s.options.length>0){if(!f)return;g(s.options),console.log("âœ… SettlementModal: Using options from props:",s.options.length);return}const U=await x(String(s.id));f&&U?.options?.length?(g(U.options),console.log("âœ… SettlementModal: Loaded options via fetch:",U.options.length)):f&&console.warn("âš ï¸ SettlementModal: No options available for prediction:",s.id)}catch(U){console.warn("âš ï¸ SettlementModal: Failed to ensure options:",U)}})(),()=>{f=!1}},[s.id]);const K=_.find(f=>f.id===p),z=s.pool_total||0,j=s.participant_count||0,Y=z*2.5/100,J=z*1/100,te=z-Y-J;return v?e.jsx(ie,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[110] p-4",children:e.jsx(N.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Confirm Settlement"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:m,children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg p-4 border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ye,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Settlement Summary"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winning Option:"}),e.jsx("span",{className:"font-medium text-gray-900",children:K?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Pool:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",z.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Platform Fee (2.5%):"}),e.jsxs("span",{className:"text-gray-900",children:["$",Y.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Creator Fee (1.0%):"}),e.jsxs("span",{className:"text-gray-900",children:["$",J.toFixed(2)]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winner Payout:"}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:["$",te.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Participants:"}),e.jsx("span",{className:"text-gray-900",children:j})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-amber-600 flex-shrink-0"}),e.jsxs("p",{className:"text-amber-800 text-sm",children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone. All participants will be notified of the settlement result."]})]})}),O&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:O})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(oe,{variant:"outline",onClick:()=>k(!1),disabled:m,children:"Back"}),e.jsx(oe,{onClick:u,disabled:m,className:"bg-emerald-600 hover:bg-emerald-700",children:m?"Settling...":"Confirm Settlement"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Settle Prediction"}),e.jsx("button",{onClick:R,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6 pb-40",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsxs("span",{children:["$",z.toFixed(2)," pool"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"w-4 h-4"}),e.jsxs("span",{children:[j," participants"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Winning Option *"}),e.jsx("div",{className:"space-y-2",children:_.length===0?e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-yellow-600"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"No Options Available"})]}),e.jsx("p",{className:"text-yellow-700 text-sm mb-3",children:"This prediction doesn't have any options to select from. This might be because:"}),e.jsxs("ul",{className:"text-yellow-700 text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ The prediction data is still loading"}),e.jsx("li",{children:"â€¢ The prediction was created without options"}),e.jsx("li",{children:"â€¢ There was an error fetching the prediction details"})]}),e.jsx("p",{className:"text-yellow-600 text-xs mt-3",children:"Please close this modal and try opening it again. If the problem persists, contact support."})]}):_.map(f=>{const V=p===f.id,U=f.total_staked||0,X=z>0?U/z*100:0;return e.jsx(N.button,{onClick:()=>S(f.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${V?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${V?"text-emerald-700":"text-gray-900"}`,children:f.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[X.toFixed(0),"% â€¢ $",U.toFixed(2)," staked"]})]}),V&&e.jsx(Xe,{className:"w-5 h-5 text-emerald-500"})]})},f.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof URL (optional)"}),e.jsx(Ke,{type:"url",placeholder:"https://example.com/proof",value:y,onChange:f=>c(f.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to evidence supporting this outcome (news article, official result, etc.)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Settlement Reason *"}),e.jsx(Pe,{placeholder:"Explain why this option is the winner...",value:n,onChange:f=>C(f.target.value),className:"w-full h-20 resize-none",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[n.length,"/500 characters"]})]}),O&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:O})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(oe,{variant:"outline",onClick:R,disabled:m,children:"Cancel"}),e.jsx(oe,{onClick:()=>k(!0),disabled:!p||!n.trim()||m,className:"bg-emerald-600 hover:bg-emerald-700",children:"Continue"})]})]})})})}):null},ot=({isOpen:v,onClose:b,predictionId:s,predictionTitle:w,onResolutionComplete:p})=>{const[S,y]=r.useState(null),[c,n]=r.useState(!0),[C,o]=r.useState(!1),[k,_]=r.useState(null),[g,M]=r.useState(""),[m,O]=r.useState(""),{user:d}=be();r.useEffect(()=>{v&&u()},[v,s]);const u=async()=>{try{n(!0);const x=await fetch(`${ce()}/api/v2/settlement/${s}/disputes`);if(!x.ok)throw new Error("Failed to fetch disputes");const K=await x.json();y(K.data)}catch(x){console.error("Error fetching disputes:",x),T.error("Failed to load disputes")}finally{n(!1)}},R=async()=>{if(!k||!g.trim()){T.error("Please select an action and provide a reason");return}try{if(o(!0),!(await fetch(`${ce()}/api/v2/settlement/${s}/resolve-disputes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:k,reason:g,newWinningOption:k==="revise"?m:void 0,creatorId:d?.id})})).ok)throw new Error("Failed to resolve disputes");T.success("Disputes resolved successfully!"),b(),p&&p()}catch(x){console.error("Error resolving disputes:",x),T.error("Failed to resolve disputes")}finally{o(!1)}};return v?e.jsx(ie,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Dispute Resolution"}),e.jsx("p",{className:"text-sm text-gray-600",children:w})]})]}),e.jsx("button",{onClick:b,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-red-500 border-t-transparent rounded-full animate-spin"})}):S?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Dispute Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Total Disputes:"}),e.jsx("span",{className:"font-medium ml-2",children:S.totalDisputes})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Pending:"}),e.jsx("span",{className:"font-medium ml-2",children:S.pendingDisputes})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Individual Disputes"}),S.disputes.map(x=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:x.user.full_name||x.user.username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(x.created_at).toLocaleDateString()})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${x.status==="pending"?"bg-yellow-100 text-yellow-800":x.status==="resolved"?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"}`,children:x.status})]}),e.jsx("div",{className:"bg-gray-50 rounded p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Ze,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700",children:x.reason})]})})]},x.id))]}),S.pendingDisputes>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Resolution Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("button",{onClick:()=>_("reject"),className:`p-4 border-2 rounded-lg text-left transition-all ${k==="reject"?"border-red-500 bg-red-50":"border-gray-200 hover:border-red-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Z,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Reject Disputes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Maintain original settlement"})]})]})}),e.jsx("button",{onClick:()=>_("revise"),className:`p-4 border-2 rounded-lg text-left transition-all ${k==="revise"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Revise Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change the winning option"})]})]})}),e.jsx("button",{onClick:()=>_("accept"),className:`p-4 border-2 rounded-lg text-left transition-all ${k==="accept"?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-emerald-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(de,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Accept Disputes & Refund"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Refund all participants"})]})]})})]}),k==="revise"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Winning Option ID"}),e.jsx("input",{type:"text",value:m,onChange:x=>O(x.target.value),placeholder:"Enter the correct winning option ID",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Reason"}),e.jsx("textarea",{value:g,onChange:x=>M(x.target.value),placeholder:"Explain your resolution decision...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:b,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:R,disabled:C||!k||!g.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:C?"Resolving...":"Resolve Disputes"})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No dispute data available"})})})]})})}):null},dt=({isOpen:v,onClose:b,prediction:s,onUpdate:w})=>{const[p,S]=r.useState(s.title||""),[y,c]=r.useState(s.description||""),[n,C]=r.useState(!1),[o,k]=r.useState({}),_=r.useRef(null),g=r.useRef(null);r.useEffect(()=>{v&&(S(s.title||""),c(s.description||""),k({}),setTimeout(()=>_.current?.focus(),150))},[v,s.title,s.description]),r.useEffect(()=>{const d=g.current;d&&(d.style.height="auto",d.style.height=Math.min(d.scrollHeight,120)+"px")},[y]);const M=()=>{const d={};return p.trim()?p.trim().length<3?d.title="Title must be at least 3 characters":p.trim().length>200&&(d.title="Title must be less than 200 characters"):d.title="Title is required",y.trim().length>1e3&&(d.description="Description must be less than 1000 characters"),k(d),Object.keys(d).length===0},m=async()=>{if(!M())return;const d=p.trim(),u=y.trim();if(d===s.title&&u===(s.description||"")){T.error("No changes detected");return}C(!0);try{const R={};d!==s.title&&(R.title=d),u!==(s.description||"")&&(R.description=u),await w(R),T.success("Prediction updated successfully!"),b()}catch(R){console.error("Failed to update prediction:",R),T.error(R instanceof Error?R.message:"Failed to update prediction")}finally{C(!1)}},O=d=>{d.key==="Escape"&&!n?b():d.key==="Enter"&&(d.metaKey||d.ctrlKey)&&!n&&m()};return v?e.jsx(ie,{children:e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4",children:[e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:n?void 0:b}),e.jsxs(N.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",onKeyDown:O,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(ke,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Prediction"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your prediction details"})]})]}),e.jsx("button",{onClick:b,disabled:n,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prediction Title *"}),e.jsx("input",{ref:_,type:"text",value:p,onChange:d=>S(d.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${o.title?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Enter prediction title...",disabled:n,maxLength:200}),o.title&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(we,{className:"w-4 h-4"}),o.title]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[p.length,"/200 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description (Optional)"}),e.jsx("textarea",{ref:g,value:y,onChange:d=>c(d.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${o.description?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Add more details about your prediction...",disabled:n,rows:3,maxLength:1e3,style:{minHeight:"80px",maxHeight:"120px"}}),o.description&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(we,{className:"w-4 h-4"}),o.description]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[y.length,"/1000 characters"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 border-t border-gray-100",children:[e.jsx("button",{onClick:b,disabled:n,className:"px-6 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx(N.button,{onClick:m,disabled:n||!p.trim()||!!o.title||!!o.description,className:"px-6 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",whileHover:{scale:n?1:1.02},whileTap:{scale:n?1:.98},children:n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):"Update Prediction"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Press ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel or"," ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"âŒ˜ Enter"})," to save"]})})]})]})}):null},ct=({isOpen:v,onClose:b,prediction:s})=>{const[w,p]=r.useState("overview"),[S,y]=r.useState(!0),[c,n]=r.useState(!0),[C,o]=r.useState(!0),[k,_]=r.useState([]),[g,M]=r.useState([]),[m,O]=r.useState(!1),[d,u]=r.useState(!1),[R,x]=r.useState(!1),[K,z]=r.useState(!1),[j,Y]=r.useState(!1),[J,te]=r.useState(!1),[f,V]=r.useState(!1),[U,X]=r.useState(!1),[le,re]=r.useState(!1),[je,t]=r.useState(""),[h,P]=r.useState(s);r.useEffect(()=>{P(s)},[s]);const{updatePrediction:F,deletePrediction:H,closePrediction:a,fetchPredictionActivity:i,fetchPredictionParticipants:L,fetchPredictionById:A,refreshPredictions:D,fetchUserCreatedPredictions:$,fetchUserPredictionEntries:Q}=ye(),{user:G}=be(),xe=l=>{if(l.status==="closed"||l.status==="ended")return!0;const E=l.entry_deadline||l.timeRemaining;if(E){if(typeof E=="string"&&E.includes("Ended"))return!0;if(l.entry_deadline){const I=new Date(l.entry_deadline)<=new Date;return l.status==="open"&&I}}return!1},De=[{id:"overview",label:"Overview",icon:ge},{id:"settings",label:"Settings",icon:Ce},{id:"participants",label:"Participants",icon:ae}];r.useEffect(()=>{v&&s.id&&ue()},[v,s.id]);const ue=r.useCallback(async()=>{O(!0);try{console.log("ğŸ”„ Loading prediction data for modal:",s.id);const l=await A(String(s.id));l?.options?.length?(console.log("ğŸ”„ ManagePredictionModal: Updated prediction with",l.options.length,"options"),Object.assign(s,l),P({...l})):(console.warn("âš ï¸ ManagePredictionModal: No options found for prediction:",s.id),setTimeout(async()=>{const B=await A(String(s.id));B?.options?.length&&(console.log("ğŸ”„ Retry successful: Found",B.options.length,"options"),Object.assign(s,B),P({...B}))},1e3));const[E,I]=await Promise.all([i(String(s.id)).catch(B=>(console.warn("Failed to fetch activity:",B),[])),L(String(s.id)).catch(B=>(console.warn("Failed to fetch participants:",B),[]))]);_(E),M(I),console.log("âœ… Modal data loaded successfully")}catch(l){console.error("Failed to load prediction data:",l),T.error("Failed to load prediction data. Using cached information.")}finally{O(!1)}},[s.id,i,L,A]),q=r.useCallback(async()=>{if(G?.id)try{console.log("ğŸ”„ Refreshing all prediction data..."),await Promise.all([D(!0),$(G.id),Q(G.id),ue()]),console.log("âœ… All prediction data refreshed")}catch(l){console.error("âŒ Error refreshing prediction data:",l)}},[G?.id,D,$,Q,ue]),he=r.useCallback(async()=>{console.log("âŒ Closing modal and triggering data refresh"),await q(),setTimeout(()=>{b()},100)},[b,q]),$e=()=>{t(s.title),V(!0)},Re=async l=>{try{Y(!0),console.log("ğŸ”§ Updating prediction:",s.id,l),await F(String(s.id),l),await q()}catch(E){throw console.error("Failed to update prediction:",E),E}finally{Y(!1)}},Ee=async()=>{x(!0)},Te=()=>{X(!0)},Ae=async()=>{try{Y(!0),console.log("ğŸ”’ Closing prediction:",s.id),await a(String(s.id)),await q(),Object.assign(s,{status:"closed"}),T.success("Prediction closed successfully! You can now settle it."),X(!1)}catch(l){console.error("Failed to close prediction:",l),T.error(l instanceof Error?l.message:"Failed to close prediction")}finally{Y(!1)}},Me=async()=>{try{const l=`${window.location.origin}/predictions/${s.id}`,E=`Check out this prediction: ${s.title}`;if(navigator.share)try{await navigator.share({title:s.title,text:E,url:l});return}catch(I){console.log("Native sharing cancelled or failed:",I)}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(`${E}
${l}`),T.success("Link copied to clipboard!");else{const I=document.createElement("textarea");I.value=`${E}
${l}`,document.body.appendChild(I),I.select();try{document.execCommand("copy"),T.success("Link copied to clipboard!")}catch(B){T.error("Failed to copy link. Please copy manually."),console.error("execCommand failed:",B)}finally{document.body.removeChild(I)}}}catch(l){console.error("Error sharing prediction:",l),T.error("Failed to share prediction")}},Fe=async()=>{try{u(!0),console.log("âš™ï¸ Saving prediction settings:",s.id),await F(String(s.id),{is_private:!c}),await q(),T.success("Settings saved successfully!")}catch(l){console.error("Failed to save settings:",l),T.error("Failed to save settings. Please try again.")}finally{u(!1)}},Le=async()=>{try{z(!0),console.log("ğŸ—‘ï¸ Deleting prediction:",s.id),await H(String(s.id)),await q(),T.success("Prediction deleted successfully!"),x(!1),he()}catch(l){console.error("Failed to delete prediction:",l),T.error(l instanceof Error?l.message:"Failed to delete prediction")}finally{z(!1)}},Ue=()=>{const l=s.pool_total||s.totalPool||0,E=s.participant_count||s.participants||0,I=s.creator_fee_percentage||s.yourCut||0,B=l*I/100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Pool"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",l.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ae,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Participants"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:E})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Cut"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[I,"%"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(fe,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Est. Earnings"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:["$",B.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(N.button,{onClick:$e,disabled:j||m,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:j||m?1:1.02},whileTap:{scale:j||m?1:.98},children:[j?e.jsx(ee,{className:"w-5 h-5 animate-spin"}):e.jsx(ke,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Edit Details"})]}),e.jsxs(N.button,{onClick:Me,disabled:j||m,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:j||m?1:1.02},whileTap:{scale:j||m?1:.98},children:[e.jsx(Qe,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Share"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(N.button,{onClick:Te,disabled:j||m||s.status!=="open",className:`flex-1 flex items-center justify-center gap-3 px-6 py-4 rounded-2xl font-semibold shadow-lg transition-all duration-200 group ${s.status!=="open"?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-xl"} disabled:opacity-50 disabled:cursor-not-allowed`,whileHover:{scale:j||m||s.status!=="open"?1:1.02},whileTap:{scale:j||m||s.status!=="open"?1:.98},children:[j?e.jsx(ee,{className:"w-5 h-5 animate-spin"}):e.jsx(et,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:s.status==="open"?"Close Early":"Already Closed"})]}),e.jsxs(N.button,{onClick:()=>te(!0),disabled:j||m||!xe(s),className:"flex-1 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group border-2 border-emerald-400/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300/30",whileHover:{scale:j||m||!xe(s)?1:1.02},whileTap:{scale:j||m||!xe(s)?1:.98},children:[e.jsx(_e,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Settle"})]})]})]}),s.status==="disputed"&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(W,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-900",children:"âš ï¸ Settlement Disputed"}),e.jsx("p",{className:"text-red-700",children:"Participants have disputed your settlement. Review and resolve."})]})]}),e.jsx(N.button,{onClick:()=>re(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:"ğŸ” Manage Disputes"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Recent Activity"}),m?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ee,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading activity..."})]}):k.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:k.map((ne,Be)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:ne.description}),e.jsx("p",{className:"text-xs text-gray-500",children:ne.timeAgo})]}),ne.amount&&e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:["$",ne.amount.toLocaleString()]})]},`activity-${Be}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No activity yet"})]})]})]})},Oe=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prediction Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Public Visibility"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow anyone to find and join this prediction"})]}),e.jsx("button",{onClick:()=>n(!c),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${c?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${c?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive updates about this prediction via email"})]}),e.jsx("button",{onClick:()=>y(!S),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${S?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${S?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Auto Close"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically close when deadline is reached"})]}),e.jsx("button",{onClick:()=>o(!C),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${C?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${C?"translate-x-6":"translate-x-1"}`})})]})]})]}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end",children:e.jsxs("button",{onClick:Fe,disabled:d,className:"inline-flex items-center justify-center gap-2 px-5 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[d?e.jsx(ee,{className:"w-4 h-4 animate-spin"}):e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Settings"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-4",children:"Danger Zone"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Delete Prediction"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"This action cannot be undone. This will permanently delete the prediction and all associated data."}),e.jsxs("button",{onClick:Ee,disabled:j||m,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(at,{className:"w-4 h-4"}),"Delete Prediction"]})]})]})]}),Ie=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Participants (",g.length,")"]}),m?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ee,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading participants..."})]}):g.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:g.map((l,E)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-purple-600",children:l.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["@",l.username]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Chose: ",l.option," â€¢ ",l.timeAgo]})]})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",l.amount.toLocaleString()]})]},`participant-${E}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No participants yet"})]})]})});return v?e.jsxs(e.Fragment,{children:[e.jsx(ie,{children:e.jsx(N.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4",onClick:l=>{l.target===l.currentTarget&&he()},children:e.jsxs(N.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Manage Prediction"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-1",children:s.title})]}),e.jsx("button",{onClick:he,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"flex border-b border-gray-200",children:De.map(l=>{const E=l.icon;return e.jsxs("button",{onClick:()=>p(l.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${w===l.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(E,{className:"w-4 h-4"}),l.label]},l.id)})}),e.jsxs("div",{className:"p-6 pb-40 max-h-[calc(90vh-200px)] overflow-y-auto",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[w==="overview"&&e.jsx(Ue,{}),w==="settings"&&e.jsx(Oe,{}),w==="participants"&&e.jsx(Ie,{})]})]})})}),R&&e.jsx(lt,{isOpen:R,onClose:()=>x(!1),onConfirm:Le,title:"Delete Prediction",message:"Are you sure you want to delete this prediction? This action cannot be undone and all participant data will be lost.",confirmText:"Delete",variant:"danger",isLoading:K}),f&&e.jsx(dt,{isOpen:f,onClose:()=>V(!1),prediction:{id:String(s.id),title:s.title,description:s.description||""},onUpdate:Re}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(N.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Close Prediction Early"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to close this prediction early? No new participants will be able to join once closed."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>X(!1),className:"flex-1 px-4 py-2 text-gray-700 bg-gray-100 rounded-xl hover:bg-gray-200 transition-colors",disabled:j,children:"Cancel"}),e.jsx("button",{onClick:Ae,disabled:j,className:"flex-1 px-4 py-2 bg-orange-600 text-white rounded-xl hover:bg-orange-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:j?"Closing...":"Close Early"})]})]})}),J&&e.jsx(nt,{isOpen:J,onClose:()=>te(!1),prediction:{...h,id:String(h.id),creator_id:G?.id||"",type:"multi_outcome",stake_min:1,settlement_method:"manual",is_private:!1,platform_fee_percentage:2.5,club_id:void 0,image_url:void 0,tags:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString(),creator:{id:G?.id||"",username:G?.username||"",full_name:G?.full_name||"",avatar_url:G?.avatar_url||null},options:s.options||[],pool_total:s.pool_total||s.totalPool||0,participant_count:s.participant_count||s.participants||0,entry_deadline:s.entry_deadline||new Date().toISOString()},onSettlementComplete:q}),le&&e.jsx(ot,{isOpen:le,onClose:()=>re(!1),predictionId:String(s.id),predictionTitle:s.title,onResolutionComplete:q})]}):null},Ct=({onNavigateToDiscover:v})=>{const[,b]=Ve(),{predictions:s,getUserCreatedPredictions:w,fetchUserCreatedPredictions:p,fetchUserPredictionEntries:S,getUserPredictionEntries:y,loading:c}=ye(),{user:n,isAuthenticated:C}=be(),{user:o,initialized:k}=Ge(),_=o?!0:C,g=o?{id:o.id,firstName:o.user_metadata?.firstName||o.user_metadata?.first_name||o.user_metadata?.full_name?.split(" ")[0]||"User",lastName:o.user_metadata?.lastName||o.user_metadata?.last_name||o.user_metadata?.full_name?.split(" ").slice(1).join(" ")||"",email:o.email||"",phone:o.phone,avatar:o.user_metadata?.avatar_url||o.user_metadata?.picture,provider:o.app_metadata?.provider||"email",createdAt:o.created_at}:n,[M,m]=r.useState("Active"),[O,d]=r.useState(!1),[u,R]=r.useState(null),x=(t,h)=>{if(!t)return"Unknown";const P=new Date().getTime(),F=new Date(t).getTime()-P;if(h==="closed")return"Closed";if(h==="settled")return"Settled";if(h==="awaiting_settlement")return"Awaiting Settlement";if(h==="disputed")return"Disputed";if(h==="refunded")return"Refunded";if(h==="ended"||F<=0)return"Ended";const H=Math.floor(F/(1e3*60*60*24)),a=Math.floor(F%(1e3*60*60*24)/(1e3*60*60));return H>0?`${H}d ${a}h`:`${a}h`},K=t=>{if(!t||!t.options)return 68;const h=t.options.reduce((F,H)=>F+(H.total_staked||0),0);if(h===0)return 68;const P=Math.max(...t.options.map(F=>F.total_staked||0));return Math.round(P/h*100)};r.useEffect(()=>{window.scrollTo({behavior:"instant"})},[]),r.useEffect(()=>{if(!g?.id||!_)return;let t=!0,h=!1;const P=setTimeout(()=>{!t||h||(console.log("ğŸ“Š BetsTab: Fetching data for user:",g.id),p(g.id),S(g.id),h=!0)},100);return()=>{t=!1,clearTimeout(P)}},[g?.id,_]);const j=(()=>{if(!_||!g)return{active:0,created:0,completed:0};const t=w(g.id),h=y(g.id),P=h.filter(a=>{const i=a.prediction||s.find($=>$.id===a.prediction_id);if(!i)return!1;const L=i.status==="open",A=new Date(i.entry_deadline)>new Date,D=a.status==="active";return L&&A&&D}),F=t.filter(a=>a.status==="open"||a.status==="closed"||a.status==="awaiting_settlement"),H=h.filter(a=>{const i=a.prediction||s.find($=>$.id===a.prediction_id);if(!i)return!1;const L=a.status==="won"||a.status==="lost",A=i.status==="closed"||i.status==="settled"||i.status==="ended",D=new Date(i.entry_deadline)<=new Date;return L||A||D});return{active:P.length,created:F.length,completed:H.length}})(),Y=[{id:"Active",label:"Active",icon:Ne,count:j.active},{id:"Created",label:"Created",icon:ve,count:j.created},{id:"Completed",label:"Completed",icon:de,count:j.completed}],J=()=>{if(!_||!g)return{Active:[],Created:[],Completed:[]};const t=y(g.id),h=w(g.id),P=t.filter(a=>{const i=a.prediction||s.find($=>$.id===a.prediction_id);if(!i)return!1;const L=i.status==="open",A=new Date(i.entry_deadline)>new Date,D=a.status==="active";return L&&A&&D}).map(a=>{const i=a.prediction||s.find(D=>D.id===a.prediction_id);if(!i)return console.warn("âš ï¸ No prediction found for entry:",a.id),null;const L=a.option||i.options?.find(D=>D.id===a.option_id),A=x(i.entry_deadline,i.status);return{id:a.id,title:i.title,category:i.category,position:L?.label||"Unknown",stake:a.amount,potentialReturn:a.potential_payout||0,odds:a.potential_payout?`${(a.potential_payout/a.amount).toFixed(2)}x`:"1.00x",timeRemaining:A,status:"active",participants:i.participant_count||0,confidence:K(i)}}).filter(Boolean),F=h.filter(a=>a.status==="open"||a.status==="closed"||a.status==="awaiting_settlement").map(a=>{let i=a.status;const L=new Date,A=new Date(a.entry_deadline);i==="open"&&A<=L&&(i="ended");const D=x(a.entry_deadline,i);return{id:a.id,title:a.title,category:a.category,totalPool:a.pool_total||0,participants:a.participant_count||0,timeRemaining:D,status:i,yourCut:a.creator_fee_percentage||3.5,description:a.description,pool_total:a.pool_total,participant_count:a.participant_count,creator_fee_percentage:a.creator_fee_percentage,entry_deadline:a.entry_deadline}}),H=t.filter(a=>{const i=a.prediction||s.find($=>$.id===a.prediction_id);if(!i)return!1;const L=a.status==="won"||a.status==="lost",A=i.status==="closed"||i.status==="settled"||i.status==="ended",D=new Date(i.entry_deadline)<=new Date;return L||A||D}).map(a=>{const i=a.prediction||s.find(Q=>Q.id===a.prediction_id);if(!i)return console.warn("âš ï¸ No prediction found for completed entry:",a.id),null;const L=a.option||i.options?.find(Q=>Q.id===a.option_id),A=(a.actual_payout||0)-a.amount;let D=a.status,$="";return i.status==="settled"&&(a.status==="won"||a.status==="lost")?$=`Settled on ${new Date(a.updated_at).toLocaleDateString()}`:i.status==="closed"?$="Closed - Awaiting Settlement":i.status==="awaiting_settlement"?$="Awaiting Settlement":i.status==="disputed"?$="Settlement Disputed":i.status==="refunded"?$=`Refunded on ${new Date(i.updated_at||i.created_at).toLocaleDateString()}`:new Date(i.entry_deadline)<=new Date?($=`Ended on ${new Date(i.entry_deadline).toLocaleDateString()}`,a.status==="active"&&(D="active")):$=x(i.entry_deadline,i.status),{id:a.id,title:i.title,category:i.category,position:L?.label||"Unknown",stake:a.amount,actualReturn:a.actual_payout||0,profit:A,status:D,participants:i.participant_count||0,settledAt:$}}).filter(Boolean);return{Active:P,Created:F,Completed:H}},f=r.useMemo(()=>{try{return J()}catch(t){return console.error("Error getting user predictions:",t),{Active:[],Created:[],Completed:[]}}},[g?.id,_,s,M])[M]||[],V=t=>{switch(t){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"winning":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"losing":return"bg-red-50 text-red-700 border-red-200";case"open":return"bg-blue-50 text-blue-700 border-blue-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},U=t=>({custom:"bg-orange-100 text-orange-700",sports:"bg-blue-100 text-blue-700",esports:"bg-purple-100 text-purple-700",pop_culture:"bg-pink-100 text-pink-700",politics:"bg-red-100 text-red-700",celebrity_gossip:"bg-emerald-100 text-emerald-700"})[t]||"bg-gray-100 text-gray-700";if(!_)return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"My Bets"}),e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-6",children:e.jsx(it,{title:"Sign in to view your predictions",body:"See your portfolio, performance, and history.",intent:"view_my_bets",ctaLabel:"Sign In"})})]});const X=({tab:t})=>{const P={Active:{icon:Ne,title:"No active predictions",description:"You haven't placed any bets yet. Start by exploring trending topics and making your first prediction!",buttonText:"Discover Predictions",buttonColor:"from-emerald-500 to-emerald-600",iconBg:"bg-emerald-100",iconColor:"text-emerald-500"},Created:{icon:ve,title:"No predictions created",description:"Share your insights with the community! Create predictions and earn fees when others participate.",buttonText:"Create Prediction",buttonColor:"from-blue-500 to-blue-600",iconBg:"bg-blue-100",iconColor:"text-blue-500"},Completed:{icon:de,title:"No completed predictions",description:"Your prediction history and earnings will appear here as you complete predictions.",buttonText:"Browse Active Predictions",buttonColor:"from-purple-500 to-purple-600",iconBg:"bg-purple-100",iconColor:"text-purple-500"}}[t],F=P.icon;return e.jsxs(N.div,{className:"flex flex-col items-center justify-center py-20 px-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:[e.jsx(N.div,{className:se("w-20 h-20 rounded-full flex items-center justify-center mb-6",P.iconBg),initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20,delay:.2},children:e.jsx(N.div,{initial:{rotateY:-180},animate:{rotateY:0},transition:{delay:.4,duration:.6},children:e.jsx(F,{className:se("w-10 h-10",P.iconColor)})})}),e.jsx(N.h3,{className:"text-xl font-bold text-gray-900 mb-3 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:P.title}),e.jsx(N.p,{className:"text-gray-600 text-center mb-8 max-w-md leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:P.description}),e.jsxs(N.button,{className:se("bg-gradient-to-r text-white px-8 py-3 rounded-xl font-semibold","transition-all duration-200 flex items-center gap-2 shadow-lg","hover:shadow-xl hover:scale-105 active:scale-95",`${P.buttonColor}`),onClick:()=>{t==="Created"?(b("/create"),window.scrollTo({behavior:"instant"})):v&&v()},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(qe,{className:"w-5 h-5"}),P.buttonText]})]})},le=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${U(t.category)}`,children:t.category.replace("_"," ")}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${V(t.status)}`,children:"Active"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-800",children:"Your Position"}),e.jsx("span",{className:"text-lg font-bold text-emerald-700",children:t.position})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Staked"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",t.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Potential"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",t.potentialReturn.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Odds"}),e.jsx("p",{className:"font-semibold text-emerald-900",children:t.odds})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Market Confidence"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[t.confidence,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${t.confidence}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[t.participants," participants"]}),e.jsx("span",{className:`font-medium ${t.timeRemaining.includes("Closed")||t.timeRemaining.includes("Settled")||t.timeRemaining.includes("Disputed")||t.timeRemaining.includes("Ended")?"text-red-600":t.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-amber-600"}`,children:(t.timeRemaining.includes("h")||t.timeRemaining.includes("d"))&&!t.timeRemaining.includes("Closed")&&!t.timeRemaining.includes("Ended")&&!t.timeRemaining.includes("Settled")&&!t.timeRemaining.includes("Disputed")&&!t.timeRemaining.includes("Awaiting")?`${t.timeRemaining} left`:t.timeRemaining})]})]}),re=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${U(t.category)}`,children:t.category.replace("_"," ")}),e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-blue-50 text-blue-700 border-blue-200",children:t.status==="open"?"Open":t.status})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Total Pool"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:["$",t.totalPool.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Participants"}),e.jsx("p",{className:"font-semibold text-blue-900",children:t.participants})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Your Cut"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[t.yourCut,"%"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm ${t.timeRemaining.includes("Closed")||t.timeRemaining.includes("Settled")||t.timeRemaining.includes("Disputed")||t.timeRemaining.includes("Ended")?"text-red-600":t.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-gray-500"}`,children:(t.timeRemaining.includes("h")||t.timeRemaining.includes("d"))&&!t.timeRemaining.includes("Closed")&&!t.timeRemaining.includes("Ended")&&!t.timeRemaining.includes("Settled")&&!t.timeRemaining.includes("Disputed")&&!t.timeRemaining.includes("Awaiting")?`Closes in ${t.timeRemaining}`:t.timeRemaining}),e.jsxs("button",{onClick:()=>{R(t),d(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-1 hover:bg-blue-700 transition-colors",children:["Manage ",e.jsx(Ce,{className:"w-4 h-4"})]})]})]}),je=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${U(t.category)}`,children:t.category.replace("_"," ")}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${t.status==="won"?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-red-50 text-red-700 border-red-200"}`,children:t.status==="won"?"Won":"Lost"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsxs("div",{className:`rounded-xl p-4 mb-4 ${t.status==="won"?"bg-emerald-50":"bg-red-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:`text-sm font-medium ${t.status==="won"?"text-emerald-800":"text-red-800"}`,children:["Your Position: ",t.position]}),e.jsxs("span",{className:`text-lg font-bold ${t.status==="won"?"text-emerald-700":"text-red-700"}`,children:[t.profit>=0?"+":"","$",Math.abs(t.profit).toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${t.status==="won"?"text-emerald-600":"text-red-600"}`,children:"Staked"}),e.jsxs("p",{className:`font-semibold ${t.status==="won"?"text-emerald-900":"text-red-900"}`,children:["$",t.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${t.status==="won"?"text-emerald-600":"text-red-600"}`,children:"Returned"}),e.jsxs("p",{className:`font-semibold ${t.status==="won"?"text-emerald-900":"text-red-900"}`,children:["$",t.actualReturn.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${t.status==="won"?"text-emerald-600":"text-red-600"}`,children:"Profit/Loss"}),e.jsxs("p",{className:`font-semibold ${t.status==="won"?"text-emerald-900":"text-red-900"}`,children:[t.profit>=0?"+":"","$",Math.abs(t.profit).toLocaleString()]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[t.participants," participants"]}),e.jsxs("span",{children:["Settled ",t.settledAt]})]})]});return e.jsxs(e.Fragment,{children:[e.jsx(Se,{title:"My Bets"}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:Y.map((t,h)=>{const P=t.icon;return e.jsxs("button",{onClick:()=>m(t.id),className:se("px-3 py-1 rounded-lg text-sm font-medium transition-colors whitespace-nowrap",M===t.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsx(P,{className:"w-4 h-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:t.label}),e.jsx("span",{className:"sm:hidden",children:t.id==="Active"?"Active":t.id==="Created"?"Created":"Complete"}),t.count>0&&e.jsx("span",{className:se("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold inline-block",M===t.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:t.count>99?"99+":t.count})]},t.id)})})})}),e.jsx("div",{className:"min-h-screen bg-gray-50 pb-[calc(5rem+env(safe-area-inset-bottom))]",children:e.jsx("div",{className:"px-4 py-6",children:c?e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading predictions..."})]}):f.length>0?e.jsxs("div",{className:"space-y-4",children:[M==="Active"&&f.map((t,h)=>!t||typeof t.id>"u"?(console.warn("Invalid prediction object:",t),null):e.jsx(le,{prediction:t},`active-${t.id}-${h}`)),M==="Created"&&f.map((t,h)=>!t||typeof t.id>"u"?(console.warn("Invalid prediction object:",t),null):e.jsx(re,{prediction:t},`created-${t.id}-${h}`)),M==="Completed"&&f.map((t,h)=>!t||typeof t.id>"u"?(console.warn("Invalid prediction object:",t),null):e.jsx(je,{prediction:t},`completed-${t.id}-${h}`))]}):e.jsx(X,{tab:M})})}),u&&e.jsx(ct,{isOpen:O,onClose:()=>{d(!1),R(null)},prediction:{id:u.id,title:u.title,category:u.category,totalPool:u.totalPool||u.pool_total||0,participants:u.participants||u.participant_count||0,timeRemaining:u.timeRemaining||"0h",yourCut:u.yourCut||u.creator_fee_percentage||3.5,status:u.status||"open",description:u.description,pool_total:u.pool_total,participant_count:u.participant_count,creator_fee_percentage:u.creator_fee_percentage,entry_deadline:u.entry_deadline}})]})};export{Ct as default};
