{"version":3,"file":"useActivityFeed-afbe2e9d.js","sources":["../../node_modules/lucide-react/dist/esm/icons/send.js","../../src/hooks/useActivityFeed.ts"],"sourcesContent":["/**\n * @license lucide-react v0.303.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst Send = createLucideIcon(\"Send\", [\n  [\"path\", { d: \"m22 2-7 20-4-9-9-4Z\", key: \"1q3vgg\" }],\n  [\"path\", { d: \"M22 2 11 13\", key: \"nzbqef\" }]\n]);\n\nexport { Send as default };\n//# sourceMappingURL=send.js.map\n","import { useState, useEffect, useCallback, useRef } from 'react';\nimport { getApiUrl } from '@/utils/environment';\n\nexport interface ActivityItem {\n  id: string;\n  timestamp: string;\n  type: string;\n  actor?: {\n    id: string;\n    username?: string;\n    full_name?: string;\n    avatar_url?: string;\n    is_verified?: boolean;\n  } | null;\n  data: Record<string, any>;\n  predictionId?: string;\n  predictionTitle?: string;\n  predictionStatus?: string;\n}\n\nexport interface ActivityFeedResponse {\n  items: ActivityItem[];\n  nextCursor?: string;\n  hasMore: boolean;\n  version: string;\n}\n\nexport interface UseActivityFeedOptions {\n  predictionId?: string;\n  userId?: string;\n  limit?: number;\n  autoLoad?: boolean;\n}\n\nexport interface UseActivityFeedReturn {\n  items: ActivityItem[];\n  loading: boolean;\n  error: string | null;\n  hasMore: boolean;\n  loadMore: () => Promise<void>;\n  refresh: () => Promise<void>;\n  clear: () => void;\n}\n\n/**\n * Hook for fetching and managing activity feed data\n * Supports both prediction-specific and user-specific activity feeds\n */\nexport function useActivityFeed({\n  predictionId,\n  userId,\n  limit = 25,\n  autoLoad = true\n}: UseActivityFeedOptions): UseActivityFeedReturn {\n  const [items, setItems] = useState<ActivityItem[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [cursor, setCursor] = useState<string | undefined>();\n  const [hasMore, setHasMore] = useState(true);\n  const hasLoadedRef = useRef(false);\n\n  // Build API URL based on whether we're fetching prediction or user activity\n  const buildApiEndpoint = useCallback((cursorParam?: string) => {\n    const apiBase = getApiUrl();\n    const baseUrl = `${apiBase}/api/v2/activity`;\n    const params = new URLSearchParams();\n    \n    if (limit) params.set('limit', limit.toString());\n    if (cursorParam) params.set('cursor', cursorParam);\n\n    if (predictionId) {\n      return `${baseUrl}/predictions/${predictionId}?${params.toString()}`;\n    } else if (userId) {\n      return `${baseUrl}/user/${userId}?${params.toString()}`;\n    }\n    \n    throw new Error('Either predictionId or userId must be provided');\n  }, [predictionId, userId, limit]);\n\n  // Fetch activity data\n  const fetchActivity = useCallback(async (cursorParam?: string, append = false) => {\n    if (loading) return;\n    \n    setLoading(true);\n    setError(null);\n\n    try {\n      const url = buildApiEndpoint(cursorParam);\n      console.log('ðŸ” Fetching activity feed:', url);\n      \n      const response = await fetch(url);\n      \n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n      \n      const data: ActivityFeedResponse = await response.json();\n      \n      if (append) {\n        setItems(prev => [...prev, ...data.items]);\n      } else {\n        setItems(data.items);\n      }\n      \n      setCursor(data.nextCursor);\n      setHasMore(data.hasMore);\n      \n      console.log('âœ… Activity feed loaded:', {\n        itemsCount: data.items.length,\n        hasMore: data.hasMore,\n        nextCursor: data.nextCursor\n      });\n      \n    } catch (err) {\n      const errorMessage = err instanceof Error ? err.message : 'Failed to fetch activity feed';\n      console.error('âŒ Activity feed error:', errorMessage);\n      setError(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  }, [loading, buildApiEndpoint]);\n\n  // Load more items (pagination)\n  const loadMore = useCallback(async () => {\n    if (!hasMore || loading || !cursor) return;\n    await fetchActivity(cursor, true);\n  }, [hasMore, loading, cursor, fetchActivity]);\n\n  // Refresh the feed\n  const refresh = useCallback(async () => {\n    setCursor(undefined);\n    setHasMore(true);\n    hasLoadedRef.current = false;\n    await fetchActivity(undefined, false);\n  }, [fetchActivity]);\n\n  // Clear all items\n  const clear = useCallback(() => {\n    setItems([]);\n    setCursor(undefined);\n    setHasMore(true);\n    setError(null);\n    hasLoadedRef.current = false;\n  }, []);\n\n  // Auto-load on mount or when dependencies change\n  useEffect(() => {\n    if (autoLoad && (predictionId || userId) && !hasLoadedRef.current) {\n      hasLoadedRef.current = true;\n      clear();\n      // Call fetchActivity directly without including it in dependencies\n      fetchActivity(undefined, false);\n    }\n  }, [predictionId, userId, autoLoad, clear]);\n\n  return {\n    items,\n    loading,\n    error,\n    hasMore,\n    loadMore,\n    refresh,\n    clear\n  };\n}\n\n/**\n * Hook specifically for prediction activity feed\n */\nexport function usePredictionActivity(predictionId: string, options?: Omit<UseActivityFeedOptions, 'predictionId'>) {\n  return useActivityFeed({\n    predictionId,\n    ...options\n  });\n}\n\n/**\n * Hook specifically for user activity feed\n */\nexport function useUserActivity(userId: string, options?: Omit<UseActivityFeedOptions, 'userId'>) {\n  return useActivityFeed({\n    userId,\n    ...options\n  });\n}\n"],"names":["Send","createLucideIcon","useActivityFeed","predictionId","userId","limit","autoLoad","items","setItems","useState","loading","setLoading","error","setError","cursor","setCursor","hasMore","setHasMore","hasLoadedRef","useRef","buildApiEndpoint","useCallback","cursorParam","baseUrl","getApiUrl","params","fetchActivity","append","url","response","data","prev","err","errorMessage","loadMore","refresh","clear","useEffect","usePredictionActivity","options","useUserActivity"],"mappings":"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","x_google_ignoreList":[0]}