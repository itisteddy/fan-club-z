import{j as e,A as pe,m as O}from"./ui-c369d1f3.js";import{R as De,r}from"./vendor-c36eaa8e.js";import{o as Qe,X as oe,A as Z,e as ve,c as et,l as me,z as H,f as tt,p as Ee,m as Ce,q as st,r as at,s as Re,t as it,v as rt,b as Te,D as Pe,U as xe,w as nt,x as lt,a as Ae,n as U,G as Ue,y as Ne,B as Ie,k as ue,E as _e,F as Be,H as ze,j as ot,I as dt,T as ke,J as Fe,K as ye,M as he,P as ct}from"./index-78beacc5.js";import{E as mt,u as ut}from"./useMerkleClaim-2ef83797.js";import{u as xt}from"./useWalletConnectSession-1627a74c.js";import{m as We,r as pt,t as ht,v as gt,j as je,w as ft,B as bt}from"./wagmi-c444efa6.js";import{I as yt,B as we}from"./input-0cc3cd56.js";import{c as jt,f as $e}from"./utils-ae6b997d.js";import{M as wt,T as vt}from"./trash-2-b77d99dc.js";import{P as He}from"./pen-line-0d53dd19.js";import{S as Nt}from"./share-2-f58723c5.js";import{A as Oe}from"./AppHeader-5f619f9e.js";import{u as St}from"./useClaimableClaims-8ac6c19f.js";import{b as Ct}from"./format-14414da9.js";import"./utils-617af415.js";import"./index-cca8fa81.js";import"./useNotifications-29ac0910.js";const _t=({icon:j,title:n,body:s,primaryLabel:$="Sign In",onPrimary:g,secondaryLabel:f,onSecondary:_,intent:w,payload:x})=>{const R=async()=>{if(g)g();else if(w)try{const u=await Qe({intent:w,payload:x});u.status==="success"||u.status==="cancel"||u.status}catch{}};return e.jsxs("div",{className:"flex flex-col items-center justify-center text-center py-12 px-4",children:[j&&e.jsx("div",{className:"mb-4 text-gray-300",children:De.cloneElement(j,{className:"w-6 h-6 md:w-8 md:h-8"})}),e.jsx("h3",{className:"text-base md:text-lg font-semibold text-gray-900 mb-2",children:n||"Sign in required"}),e.jsx("p",{className:"text-sm md:text-base text-gray-600 mb-6 max-w-sm leading-relaxed",children:s||"Please sign in to continue with this action."}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-3",children:[e.jsx("button",{onClick:R,className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors","data-qa":"authgate-open",children:$}),f&&_&&e.jsx("button",{onClick:_,className:"px-6 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg font-medium transition-colors",children:f})]})]})},kt=_t,Le=({isOpen:j,onClose:n,onConfirm:s,title:$,message:g,confirmText:f="Confirm",cancelText:_="Cancel",variant:w="danger",isLoading:x=!1})=>{const u=(()=>{switch(w){case"danger":return{icon:e.jsx(Z,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"};case"warning":return{icon:e.jsx(Z,{className:"w-6 h-6 text-amber-600"}),confirmButton:"bg-amber-600 hover:bg-amber-700 text-white",border:"border-amber-200"};case"info":return{icon:e.jsx(Z,{className:"w-6 h-6 text-blue-600"}),confirmButton:"bg-blue-600 hover:bg-blue-700 text-white",border:"border-blue-200"};default:return{icon:e.jsx(Z,{className:"w-6 h-6 text-red-600"}),confirmButton:"bg-red-600 hover:bg-red-700 text-white",border:"border-red-200"}}})(),k=()=>{x||s()},v=()=>{x||n()};return e.jsx(pe,{mode:"wait",children:j&&e.jsxs("div",{className:"fixed inset-0 z-[12000] flex items-center justify-center p-4",children:[e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black bg-opacity-50",onClick:v}),e.jsxs(O.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{duration:.2,ease:"easeOut"},className:"relative bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden",children:[e.jsxs("div",{className:`flex items-center justify-between p-6 border-b ${u.border}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[u.icon,e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:$})]}),e.jsx("button",{onClick:v,disabled:x,className:"p-2 rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(oe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6",children:e.jsx("p",{className:"text-gray-600 leading-relaxed",children:g})}),e.jsxs("div",{className:"flex gap-3 p-6 pt-0",children:[e.jsx("button",{onClick:v,disabled:x,className:"flex-1 px-4 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl font-medium transition-colors disabled:opacity-50",children:_}),e.jsx("button",{onClick:k,disabled:x,className:`flex-1 px-4 py-3 rounded-xl font-medium transition-colors disabled:opacity-50 ${u.confirmButton}`,children:x?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Processing..."]}):f})]})]})]})})},Pt=()=>{const[j,n]=r.useState(!1),[s,$]=r.useState(null),g=r.useCallback(async _=>{n(!0),$(null);try{const w=await fetch(`${ve()}/api/v2/settlement/manual`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify(_)});if(!w.ok){const R=await w.json();return $(R.message||"Settlement failed"),null}return await w.json()}catch{return $("Network error during settlement"),null}finally{n(!1)}},[]),f=r.useCallback(async _=>{try{const w=await fetch(`${ve()}/api/v2/settlement/prediction/${_}`,{method:"GET",headers:{Accept:"application/json"},credentials:"include"});if(!w.ok){if(w.status===404)return null;throw new Error(`Failed to fetch settlement: ${w.status}`)}return(await w.json()).data}catch{return null}},[]);return{settleManually:g,getSettlementInfo:f,isSettling:j,settlementError:s,clearError:()=>$(null)}},$t=Pt;function Dt(j){return`0x${j.replace(/-/g,"").toLowerCase().padEnd(64,"0")}`}function Tt(){const{address:j,chainId:n,isConnected:s}=We(),$=pt(),{switchChainAsync:g}=ht(),{writeContractAsync:f}=gt(),{withSessionRecovery:_,recoverFromError:w}=xt(),{sessionHealthy:x}=et(),[R,u]=r.useState(!1),[k,v]=r.useState(null);async function N(o){if(!at(o))return!1;try{return Re(),await w(),H.error("Wallet session expired. Please try again.",{id:"session-error"}),it("Wallet session expired"),!0}catch{return Re(),H.error("Wallet connection lost. Please reconnect.",{id:"session-error"}),!0}}const A=r.useCallback(async o=>{u(!0),v(null);let P=null,p=null;try{const h=await fetch(`${me()}/api/v2/settlement/manual/merkle`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({predictionId:o.predictionId,winningOptionId:o.winningOptionId,userId:o.userId,reason:o.reason||""})});if(!h.ok){const W=await h.json().catch(()=>({}));throw new Error(W?.message||"Failed to prepare merkle settlement")}const m=await h.json();if(!m?.data?.merkleRoot)return H.success("Settlement completed (demo only).",{id:"settle"}),{queuedFinalize:!1};const c=o.escrowAddress||"0x30c60f688A0082D1b761610ec3c70f6dC1374E95";if(!c)throw new Error("Escrow contract address missing (VITE_BASE_ESCROW_ADDRESS)");const I=o.platformTreasury||"0x80f204ea1b41f08227b87334e1384e5687f332d2",M=Dt(o.predictionId),C=m.data.merkleRoot;p=C;const J=BigInt(m.data.creatorFeeUnits||"0"),ne=BigInt(m.data.platformFeeUnits||"0"),z=(m.data.summary?.platformFeeUSD??0)+(m.data.summary?.creatorFeeUSD??0);if(!!!(j&&s&&x)){try{await fetch(`${me()}/api/v2/settlement/${o.predictionId}/request-finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({userId:o.userId})})}catch{}return H.success("Settlement prepared. Finalization queued for relayer.",{id:"settle"}),{root:C,queuedFinalize:!0}}n!==je.id&&await g({chainId:je.id});try{tt({address:j,chainId:je.id,expectedChainId:je.id,isConnected:s,sessionHealthy:x})}catch(W){const G=Ee(W);H.error(G.message,{id:"settle"}),v(G.message);try{await fetch(`${me()}/api/v2/settlement/${o.predictionId}/request-finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({userId:o.userId})})}catch{}return{root:C,queuedFinalize:!0}}if(!j)throw new Error("Connect wallet to submit settlement on-chain");if(H.loading("Submitting settlement root on-chain...",{id:"settle"}),P=await _(async()=>await f({address:c,abi:mt,functionName:"postSettlementRoot",args:[M,C,j,J,I,ne]}),{maxRetries:1,operationTimeoutMs:2e4}),!P)throw new Error("Missing transaction hash after settlement submission");if(await Ce({userId:o.userId,walletAddress:j,txHash:P,type:"settlement",status:"pending",amount:z,predictionId:o.predictionId}).catch(W=>{}),$&&(await ft($,{hash:P,confirmations:1,timeout:18e4})).status==="reverted")throw new Error("Settlement transaction reverted on-chain");await Ce({userId:o.userId,walletAddress:j,txHash:P,type:"settlement",status:"completed",amount:z,predictionId:o.predictionId}).catch(W=>{});try{const W=`fcz:lastTx:settlement:${o.predictionId}`;localStorage.setItem(W,P),window.dispatchEvent(new CustomEvent("fcz:tx",{detail:{kind:"settlement",txHash:P,predictionId:o.predictionId}}))}catch{}try{await fetch(`${me()}/api/v2/settlement/manual/merkle/posted`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({predictionId:o.predictionId,txHash:P,root:C})})}catch{}const ae=`${P.slice(0,8)}â€¦${P.slice(-6)}`;return H.success("Settlement root posted! Tx: "+ae,{id:"settle"}),st(),{txHash:P,root:C}}catch(h){const m=await N(h);if(m&&p){try{await fetch(`${me()}/api/v2/settlement/${o.predictionId}/request-finalize`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"include",body:JSON.stringify({userId:o.userId})})}catch{}return H.success("Wallet session expired. Finalization queued for relayer.",{id:"settle"}),{root:p,queuedFinalize:!0}}if(P&&!m){const I=Ee(h);await Ce({userId:o.userId,walletAddress:j,txHash:P,type:"settlement",status:"failed",predictionId:o.predictionId,error:I.message}).catch(M=>{})}let c=h?.shortMessage||h?.message||"Failed to submit settlement";if(h instanceof bt){const I=(h.shortMessage||"").toLowerCase();I.includes("insufficient funds")&&(c="Insufficient funds to pay gas"),I.includes("user rejected")&&(c="User rejected the transaction"),I.includes("execution reverted")&&(c="Contract reverted â€” check merkle root or fees")}return v(c),H.error(c,{id:"settle"}),null}finally{u(!1)}},[j,n,s,$,x,g,f,_,w]);return{isSubmitting:R,error:k,settleWithMerkle:A}}const qe=r.forwardRef(({className:j,...n},s)=>e.jsx("textarea",{className:jt("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",j),ref:s,...n}));qe.displayName="Textarea";const At=({isOpen:j,onClose:n,prediction:s,onSettlementComplete:$})=>{const[g,f]=r.useState(""),[_,w]=r.useState(""),[x,R]=r.useState(""),[u,k]=r.useState(!1),[v,N]=r.useState(s.options||[]),[A,o]=r.useState(null),[P,p]=r.useState(null),[h,m]=r.useState(null),[c,I]=r.useState(null),{isSettling:M,settlementError:C,clearError:J}=$t(),{settleWithMerkle:ne,isSubmitting:z,error:Q}=Tt();rt();const ae=async()=>{if(!g){H.error("Please select a winning option");return}if(!x.trim()){H.error("Please provide a reason for settlement");return}try{if(J(),await ne({predictionId:s.id,winningOptionId:g,reason:x.trim(),userId:s.creator_id||""})){k(!1),n(),$&&$();return}H.error(Q||"Settlement failed. Please reconnect wallet (if needed) and try again.")}catch(a){const y=a?.message||"Settlement failed. Please try again.";H.error(y)}},W=()=>{f(""),w(""),R(""),k(!1),J(),n()},{fetchPredictionById:G}=Te();De.useEffect(()=>{let a=!0;return(async()=>{try{if(s.options&&s.options.length>0){if(!a)return;N(s.options),o(typeof s.pool_total=="number"?s.pool_total:null),p(typeof s.participant_count=="number"?s.participant_count:null),m(Number.isFinite(s.platform_fee_percentage)?Number(s.platform_fee_percentage):null),I(Number.isFinite(s.creator_fee_percentage)?Number(s.creator_fee_percentage):null);return}const S=await G(String(s.id));a&&S?.options?.length&&(N(S.options),o(typeof S.pool_total=="number"?Number(S.pool_total):null),p(typeof S.participant_count=="number"?Number(S.participant_count):null),m(Number.isFinite(S.platform_fee_percentage)?Number(S.platform_fee_percentage):null),I(Number.isFinite(S.creator_fee_percentage)?Number(S.creator_fee_percentage):null))}catch{}})(),()=>{a=!1}},[s.id]);const ee=v.find(a=>a.id===g),X=a=>Number((a?.total_staked??a?.totalStaked??0)||0),ge=v.reduce((a,y)=>a+X(y),0),le=Number((A??s.pool_total)||0),V=Math.max(le,ge,0),ie=Number((P??s.participant_count)||0),re=Number.isFinite(h??s.platform_fee_percentage)?Number(h??s.platform_fee_percentage):2.5,de=Number.isFinite(c??s.creator_fee_percentage)?Number(c??s.creator_fee_percentage):1,ce=ee?X(ee):0,t=Math.max(0,V-ce),d=Math.round(t*100*re/100),b=Math.round(t*100*de/100),D=d/100,q=b/100,i=Math.max(0,ce+Math.max(0,(t*100-d-b)/100));return j?e.jsx(pe,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[110] p-4",children:e.jsx(O.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:"bg-white rounded-xl shadow-xl w-full max-w-md max-h-[90vh] overflow-y-auto",children:u?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Confirm Settlement"}),e.jsx("button",{onClick:()=>k(!1),className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:M,children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-emerald-50 to-blue-50 rounded-lg p-4 border border-emerald-100",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(lt,{className:"w-5 h-5 text-emerald-600"}),e.jsx("h3",{className:"font-medium text-gray-900",children:"Settlement Summary"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winning Option:"}),e.jsx("span",{className:"font-medium text-gray-900",children:ee?.label})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Pool:"}),e.jsxs("span",{className:"font-medium text-gray-900",children:["$",V.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Platform Fee (",re,"%):"]}),e.jsxs("span",{className:"text-gray-900",children:["$",D.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["Creator Fee (",de,"%):"]}),e.jsxs("span",{className:"text-gray-900",children:["$",q.toFixed(2)]})]}),e.jsx("hr",{className:"border-gray-200"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Winner Payout:"}),e.jsxs("span",{className:"font-semibold text-emerald-600",children:["$",i.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Participants:"}),e.jsx("span",{className:"text-gray-900",children:ie})]})]})]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-amber-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-amber-800 text-sm",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone."]}),e.jsx("p",{className:"mt-1",children:"All participants will be notified of the settlement result."})]})]})}),C&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:C})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(we,{variant:"outline",onClick:()=>k(!1),disabled:M||z,children:"Back"}),e.jsx(we,{onClick:ae,disabled:M||z,className:"bg-emerald-600 hover:bg-emerald-700",children:z?"Submitting...":M?"Settling...":"Confirm Settlement"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Settle Prediction"}),e.jsx("button",{onClick:W,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(oe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"p-6 space-y-6 pb-40",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-2 line-clamp-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsxs("span",{children:["$",V.toFixed(2)," pool"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsxs("span",{children:[ie," participants"]})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Select Winning Option *"}),e.jsx("div",{className:"space-y-2",children:v.length===0?e.jsxs("div",{className:"p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Z,{className:"w-5 h-5 text-yellow-600"}),e.jsx("p",{className:"text-yellow-800 font-medium",children:"No Options Available"})]}),e.jsx("p",{className:"text-yellow-700 text-sm mb-3",children:"This prediction doesn't have any options to select from. This might be because:"}),e.jsxs("ul",{className:"text-yellow-700 text-sm space-y-1 ml-4",children:[e.jsx("li",{children:"â€¢ The prediction data is still loading"}),e.jsx("li",{children:"â€¢ The prediction was created without options"}),e.jsx("li",{children:"â€¢ There was an error fetching the prediction details"})]}),e.jsx("p",{className:"text-yellow-600 text-xs mt-3",children:"Please close this modal and try opening it again. If the problem persists, contact support."})]}):v.map(a=>{const y=g===a.id,S=X(a),L=V>0?S/V*100:0,E=a.current_odds||(V>0&&S>0?V/S:2);return e.jsx(O.button,{onClick:()=>f(a.id),className:`w-full p-4 rounded-lg border-2 transition-all text-left ${y?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-gray-300"}`,whileHover:{scale:1.01},whileTap:{scale:.99},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-medium ${y?"text-emerald-700":"text-gray-900"}`,children:a.label}),e.jsxs("div",{className:"text-sm text-gray-500",children:[L.toFixed(1),"% â€¢ $",S.toFixed(2)," staked â€¢ ",E.toFixed(2),"x odds"]})]}),y&&e.jsx(nt,{className:"w-5 h-5 text-emerald-500"})]})},a.id)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Proof URL (optional)"}),e.jsx(yt,{type:"url",placeholder:"https://example.com/proof",value:_,onChange:a=>w(a.target.value),className:"w-full"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Link to evidence supporting this outcome (news article, official result, etc.)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Settlement Reason *"}),e.jsx(qe,{placeholder:"Explain why this option is the winner...",value:x,onChange:a=>R(a.target.value),className:"w-full h-20 resize-none",maxLength:500}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[x.length,"/500 characters"]})]}),(C||Q)&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-4 h-4 text-red-500 flex-shrink-0"}),e.jsx("p",{className:"text-red-700 text-sm",children:C||Q})]})})]}),e.jsxs("div",{className:"sticky left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end gap-3",style:{bottom:"max(4rem, env(safe-area-inset-bottom))"},children:[e.jsx(we,{variant:"outline",onClick:W,disabled:M,children:"Cancel"}),e.jsx(we,{onClick:()=>k(!0),disabled:!g||!x.trim()||M,className:"bg-emerald-600 hover:bg-emerald-700",children:"Continue"})]})]})})})}):null},Et=At,Rt=({isOpen:j,onClose:n,predictionId:s,predictionTitle:$,onResolutionComplete:g})=>{const[f,_]=r.useState(null),[w,x]=r.useState(!0),[R,u]=r.useState(!1),[k,v]=r.useState(null),[N,A]=r.useState(""),[o,P]=r.useState(""),{user:p}=Ae();r.useEffect(()=>{j&&h()},[j,s]);const h=async()=>{try{x(!0);const c=await fetch(`${ve()}/api/v2/settlement/${s}/disputes`);if(!c.ok)throw new Error("Failed to fetch disputes");const I=await c.json();_(I.data)}catch{U.error("Failed to load disputes")}finally{x(!1)}},m=async()=>{if(!k||!N.trim()){U.error("Please select an action and provide a reason");return}try{if(u(!0),!(await fetch(`${ve()}/api/v2/settlement/${s}/resolve-disputes`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:k,reason:N,newWinningOption:k==="revise"?o:void 0,creatorId:p?.id})})).ok)throw new Error("Failed to resolve disputes");U.success("Disputes resolved successfully!"),n(),g&&g()}catch{U.error("Failed to resolve disputes")}finally{u(!1)}};return j?e.jsx(pe,{children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(O.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-2xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Dispute Resolution"}),e.jsx("p",{className:"text-sm text-gray-600",children:$})]})]}),e.jsx("button",{onClick:n,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(oe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:w?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-2 border-red-500 border-t-transparent rounded-full animate-spin"})}):f?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Dispute Summary"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Total Disputes:"}),e.jsx("span",{className:"font-medium ml-2",children:f.totalDisputes})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-red-700",children:"Pending:"}),e.jsx("span",{className:"font-medium ml-2",children:f.pendingDisputes})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Individual Disputes"}),f.disputes.map(c=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:c.user.full_name||c.user.username}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(c.created_at).toLocaleDateString()})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${c.status==="pending"?"bg-yellow-100 text-yellow-800":c.status==="resolved"?"bg-emerald-100 text-emerald-800":"bg-red-100 text-red-800"}`,children:c.status})]}),e.jsx("div",{className:"bg-gray-50 rounded p-3",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(wt,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-gray-700",children:c.reason})]})})]},c.id))]}),f.pendingDisputes>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Resolution Actions"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx("button",{onClick:()=>v("reject"),className:`p-4 border-2 rounded-lg text-left transition-all ${k==="reject"?"border-red-500 bg-red-50":"border-gray-200 hover:border-red-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(oe,{className:"w-5 h-5 text-red-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Reject Disputes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Maintain original settlement"})]})]})}),e.jsx("button",{onClick:()=>v("revise"),className:`p-4 border-2 rounded-lg text-left transition-all ${k==="revise"?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-blue-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ue,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Revise Settlement"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Change the winning option"})]})]})}),e.jsx("button",{onClick:()=>v("accept"),className:`p-4 border-2 rounded-lg text-left transition-all ${k==="accept"?"border-emerald-500 bg-emerald-50":"border-gray-200 hover:border-emerald-300"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ne,{className:"w-5 h-5 text-emerald-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Accept Disputes & Refund"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Refund all participants"})]})]})})]}),k==="revise"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"New Winning Option ID"}),e.jsx("input",{type:"text",value:o,onChange:c=>P(c.target.value),placeholder:"Enter the correct winning option ID",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Resolution Reason"}),e.jsx("textarea",{value:N,onChange:c=>A(c.target.value),placeholder:"Explain your resolution decision...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",rows:3})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:n,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:m,disabled:R||!k||!N.trim(),className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:R?"Resolving...":"Resolve Disputes"})]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No dispute data available"})})})]})})}):null},It=Rt,Ft=({isOpen:j,onClose:n,prediction:s,onUpdate:$})=>{const[g,f]=r.useState(s.title||""),[_,w]=r.useState(s.description||""),[x,R]=r.useState(!1),[u,k]=r.useState({}),v=r.useRef(null),N=r.useRef(null);r.useEffect(()=>{j&&(f(s.title||""),w(s.description||""),k({}),setTimeout(()=>v.current?.focus(),150))},[j,s.title,s.description]),r.useEffect(()=>{const p=N.current;p&&(p.style.height="auto",p.style.height=Math.min(p.scrollHeight,120)+"px")},[_]);const A=()=>{const p={};return g.trim()?g.trim().length<3?p.title="Title must be at least 3 characters":g.trim().length>200&&(p.title="Title must be less than 200 characters"):p.title="Title is required",_.trim().length>1e3&&(p.description="Description must be less than 1000 characters"),k(p),Object.keys(p).length===0},o=async()=>{if(!A())return;const p=g.trim(),h=_.trim();if(p===s.title&&h===(s.description||"")){U.error("No changes detected");return}R(!0);try{const m={};p!==s.title&&(m.title=p),h!==(s.description||"")&&(m.description=h),await $(m),U.success("Prediction updated successfully!"),n()}catch(m){U.error(m instanceof Error?m.message:"Failed to update prediction")}finally{R(!1)}},P=p=>{p.key==="Escape"&&!x?n():p.key==="Enter"&&(p.metaKey||p.ctrlKey)&&!x&&o()};return j?e.jsx(pe,{children:e.jsxs("div",{className:"fixed inset-0 z-[120] flex items-center justify-center p-4",children:[e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:x?void 0:n}),e.jsxs(O.div,{initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:20},transition:{type:"spring",damping:25,stiffness:300},className:"relative bg-white rounded-3xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-hidden",onKeyDown:P,children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl flex items-center justify-center",children:e.jsx(He,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Edit Prediction"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Update your prediction details"})]})]}),e.jsx("button",{onClick:n,disabled:x,className:"w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 transition-colors disabled:opacity-50",children:e.jsx(oe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Prediction Title *"}),e.jsx("input",{ref:v,type:"text",value:g,onChange:p=>f(p.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none ${u.title?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Enter prediction title...",disabled:x,maxLength:200}),u.title&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4"}),u.title]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[g.length,"/200 characters"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description (Optional)"}),e.jsx("textarea",{ref:N,value:_,onChange:p=>w(p.target.value),className:`w-full px-4 py-3 rounded-xl border-2 transition-all duration-200 focus:outline-none resize-none ${u.description?"border-red-300 focus:border-red-500 focus:ring-2 focus:ring-red-200":"border-gray-200 focus:border-purple-500 focus:ring-2 focus:ring-purple-200"}`,placeholder:"Add more details about your prediction...",disabled:x,rows:3,maxLength:1e3,style:{minHeight:"80px",maxHeight:"120px"}}),u.description&&e.jsxs("div",{className:"flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(Ie,{className:"w-4 h-4"}),u.description]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[_.length,"/1000 characters"]})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 p-6 bg-gray-50 border-t border-gray-100",children:[e.jsx("button",{onClick:n,disabled:x,className:"px-6 py-2.5 text-gray-700 font-medium rounded-xl hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Cancel"}),e.jsx(O.button,{onClick:o,disabled:x||!g.trim()||!!u.title||!!u.description,className:"px-6 py-2.5 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-medium rounded-xl shadow-lg hover:shadow-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",whileHover:{scale:x?1:1.02},whileTap:{scale:x?1:.98},children:x?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):"Update Prediction"})]}),e.jsx("div",{className:"px-6 pb-4",children:e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["Press ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"Esc"})," to cancel or"," ",e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 rounded text-xs",children:"âŒ˜ Enter"})," to save"]})})]})]})}):null},Ot=Ft,Lt=({isOpen:j,onClose:n,prediction:s})=>{const[$,g]=r.useState("overview"),[f,_]=r.useState(!0),[w,x]=r.useState(!0),[R,u]=r.useState(!0),[k,v]=r.useState([]),[N,A]=r.useState([]),[o,P]=r.useState(!1),[p,h]=r.useState(!1),[m,c]=r.useState(!1),[I,M]=r.useState(!1),[C,J]=r.useState(!1),[ne,z]=r.useState(!1),[Q,ae]=r.useState(!1),[W,G]=r.useState(!1),[ee,X]=r.useState(!1),[ge,le]=r.useState(""),[V,ie]=r.useState(s);r.useEffect(()=>{ie(s)},[s]);const{updatePrediction:re,deletePrediction:de,closePrediction:ce,fetchPredictionActivity:t,fetchPredictionParticipants:d,fetchPredictionById:b,refreshPredictions:D,fetchUserCreatedPredictions:q,fetchUserPredictionEntries:i}=Te(),{user:a}=Ae(),y=l=>{if(l.status==="closed"||l.status==="ended")return!0;const B=l.entry_deadline;return!!(B&&new Date(B).getTime()<=Date.now()||typeof l.timeRemaining=="string"&&l.timeRemaining.toLowerCase().includes("ended"))},S=[{id:"overview",label:"Overview",icon:_e},{id:"settings",label:"Settings",icon:Be},{id:"participants",label:"Participants",icon:xe}];r.useEffect(()=>{j&&s.id&&L()},[j,s.id]);const L=r.useCallback(async()=>{P(!0);try{const l=await b(String(s.id));l?.options?.length?(Object.assign(s,l),ie({id:l.id,title:l.title,category:l.category,totalPool:l.pool_total||l.poolTotal||0,participants:l.participant_count||l.participantCount||0,timeRemaining:$e(l.entry_deadline||l.entryDeadline||""),yourCut:l.creator_fee_percentage||3.5,status:l.status||"open",description:l.description,pool_total:l.pool_total||l.poolTotal,participant_count:l.participant_count||l.participantCount,creator_fee_percentage:l.creator_fee_percentage,entry_deadline:l.entry_deadline||l.entryDeadline,options:l.options})):setTimeout(async()=>{const T=await b(String(s.id));T?.options?.length&&(Object.assign(s,T),ie({id:T.id,title:T.title,category:T.category,totalPool:T.pool_total||T.poolTotal||0,participants:T.participant_count||T.participantCount||0,timeRemaining:$e(T.entry_deadline||T.entryDeadline||""),yourCut:T.creator_fee_percentage||3.5,status:T.status||"open",description:T.description,pool_total:T.pool_total||T.poolTotal,participant_count:T.participant_count||T.participantCount,creator_fee_percentage:T.creator_fee_percentage,entry_deadline:T.entry_deadline||T.entryDeadline,options:T.options}))},1e3);const[B,K]=await Promise.all([t(String(s.id)).catch(T=>[]),d(String(s.id)).catch(T=>[])]);v(B),A(K)}catch{U.error("Failed to load prediction data. Using cached information.")}finally{P(!1)}},[s.id,t,d,b]),E=r.useCallback(async()=>{if(a?.id)try{await Promise.all([D(!0),q(a.id),i(a.id),L()])}catch{}},[a?.id,D,q,i,L]),te=r.useCallback(async()=>{await E(),setTimeout(()=>{n()},100)},[n,E]),F=()=>{le(s.title),ae(!0)},Y=async l=>{try{J(!0),await re(String(s.id),l),await E()}catch(B){throw B}finally{J(!1)}},Se=async()=>{c(!0)},se=()=>{if(s.status!=="open"){U.error("Can only close predictions that are currently open");return}G(!0)},fe=async()=>{try{J(!0),await ce(String(s.id)),await E(),Object.assign(s,{status:"closed"}),U.success("Prediction closed successfully! You can now settle it."),G(!1),z(!0)}catch(l){U.error(l instanceof Error?l.message:"Failed to close prediction")}finally{J(!1)}},Ve=async()=>{try{const l=`${window.location.origin}/predictions/${s.id}`,B=`Check out this prediction: ${s.title}`;if(navigator.share)try{await navigator.share({title:s.title,text:B,url:l});return}catch{}if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(`${B}
${l}`),U.success("Link copied to clipboard!");else{const K=document.createElement("textarea");K.value=`${B}
${l}`,document.body.appendChild(K),K.select();try{document.execCommand("copy"),U.success("Link copied to clipboard!")}catch{U.error("Failed to copy link. Please copy manually.")}finally{document.body.removeChild(K)}}}catch{U.error("Failed to share prediction")}},Ye=async()=>{try{h(!0),await re(String(s.id),{is_private:!w}),await E(),U.success("Settings saved successfully!")}catch{U.error("Failed to save settings. Please try again.")}finally{h(!1)}},Je=async()=>{try{M(!0),await de(String(s.id)),await E(),U.success("Prediction deleted successfully!"),c(!1),te()}catch(l){U.error(l instanceof Error?l.message:"Failed to delete prediction")}finally{M(!1)}},Ge=()=>{const l=s.pool_total||s.totalPool||0,B=s.participant_count||s.participants||0,K=s.creator_fee_percentage||s.yourCut||0,T=l*K/100;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Total Pool"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["$",l.toLocaleString()]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(xe,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Participants"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:B})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(_e,{className:"w-4 h-4 text-purple-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Your Cut"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:[K,"%"]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Est. Earnings"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-600",children:["$",T.toLocaleString()]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(O.button,{onClick:F,disabled:C||o,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-purple-600 to-indigo-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:C||o?1:1.02},whileTap:{scale:C||o?1:.98},children:[C?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(He,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Edit Details"})]}),e.jsxs(O.button,{onClick:Ve,disabled:C||o,className:"flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-emerald-600 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group disabled:opacity-50 disabled:cursor-not-allowed",whileHover:{scale:C||o?1:1.02},whileTap:{scale:C||o?1:.98},children:[e.jsx(Nt,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Share"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(O.button,{onClick:se,disabled:C||o||s.status!=="open",className:`flex-1 flex items-center justify-center gap-3 px-6 py-4 rounded-2xl font-semibold shadow-lg transition-all duration-200 group ${s.status!=="open"?"bg-gray-400 text-gray-600 cursor-not-allowed opacity-50":"bg-gradient-to-r from-orange-500 to-red-500 text-white hover:shadow-xl"} disabled:opacity-50 disabled:cursor-not-allowed`,whileHover:{scale:C||o||s.status!=="open"?1:1.02},whileTap:{scale:C||o||s.status!=="open"?1:.98},children:[C?e.jsx(ue,{className:"w-5 h-5 animate-spin"}):e.jsx(ze,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:s.status==="open"?"Close Early":"Already Closed"})]}),e.jsxs(O.button,{onClick:()=>z(!0),disabled:C||o||!y(s),className:"flex-1 flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white rounded-2xl font-semibold shadow-lg hover:shadow-xl transition-all duration-200 group border-2 border-emerald-400/30 disabled:opacity-50 disabled:cursor-not-allowed disabled:border-gray-300/30",whileHover:{scale:C||o||!y(s)?1:1.02},whileTap:{scale:C||o||!y(s)?1:.98},children:[e.jsx(Ue,{className:"w-5 h-5 group-hover:scale-110 transition-transform"}),e.jsx("span",{children:"Settle"})]})]})]}),s.status==="disputed"&&e.jsxs("div",{className:"bg-red-50 border-2 border-red-200 rounded-2xl p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-500 rounded-full flex items-center justify-center",children:e.jsx(Z,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-red-900",children:"âš ï¸ Settlement Disputed"}),e.jsx("p",{className:"text-red-700",children:"Participants have disputed your settlement. Review and resolve."})]})]}),e.jsx(O.button,{onClick:()=>X(!0),className:"w-full py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-xl transition-colors",whileHover:{scale:1.02},whileTap:{scale:.98},children:"ðŸ” Manage Disputes"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Recent Activity"}),o?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ue,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading activity..."})]}):k.length>0?e.jsx("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:k.map((be,Ze)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:be.description}),e.jsx("p",{className:"text-xs text-gray-500",children:be.timeAgo})]}),be.amount&&e.jsxs("span",{className:"text-sm font-semibold text-emerald-600",children:["$",be.amount.toLocaleString()]})]},`activity-${Ze}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No activity yet"})]})]})]})},Ke=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Prediction Settings"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Public Visibility"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Allow anyone to find and join this prediction"})]}),e.jsx("button",{onClick:()=>x(!w),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${w?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${w?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Email Notifications"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Receive updates about this prediction via email"})]}),e.jsx("button",{onClick:()=>_(!f),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${f?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${f?"translate-x-6":"translate-x-1"}`})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Auto Close"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Automatically close when deadline is reached"})]}),e.jsx("button",{onClick:()=>u(!R),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${R?"bg-purple-600":"bg-gray-300"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${R?"translate-x-6":"translate-x-1"}`})})]})]})]}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/75 border-t border-gray-100 p-4 flex items-center justify-end",children:e.jsxs("button",{onClick:Ye,disabled:p,className:"inline-flex items-center justify-center gap-2 px-5 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 disabled:opacity-50",children:[p?e.jsx(ue,{className:"w-4 h-4 animate-spin"}):e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Settings"})]})}),e.jsxs("div",{className:"border-t border-gray-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-600 mb-4",children:"Danger Zone"}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Delete Prediction"}),e.jsx("p",{className:"text-sm text-red-700 mb-4",children:"This action cannot be undone. This will permanently delete the prediction and all associated data."}),e.jsxs("button",{onClick:Se,disabled:C||o,className:"flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:opacity-50",children:[e.jsx(vt,{className:"w-4 h-4"}),"Delete Prediction"]})]})]})]}),Xe=()=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Participants (",N.length,")"]}),o?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(ue,{className:"w-6 h-6 animate-spin text-gray-400"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Loading participants..."})]}):N.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:N.map((l,B)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-semibold text-purple-600",children:l.username.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:["@",l.username]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Chose: ",l.option," â€¢ ",l.timeAgo]})]})]}),e.jsxs("span",{className:"text-sm font-semibold text-gray-900",children:["$",l.amount.toLocaleString()]})]},`participant-${B}`))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xe,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"No participants yet"})]})]})});return j?e.jsxs(e.Fragment,{children:[e.jsx(pe,{children:e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 z-[100] flex items-center justify-center p-4",onClick:l=>{l.target===l.currentTarget&&te()},children:e.jsxs(O.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},className:"bg-white rounded-lg w-full max-w-2xl max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Manage Prediction"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-1",children:s.title})]}),e.jsx("button",{onClick:te,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(oe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"flex border-b border-gray-200",children:S.map(l=>{const B=l.icon;return e.jsxs("button",{onClick:()=>g(l.id),className:`flex items-center gap-2 px-6 py-3 text-sm font-medium border-b-2 transition-colors ${$===l.id?"border-purple-500 text-purple-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:[e.jsx(B,{className:"w-4 h-4"}),l.label]},l.id)})}),e.jsxs("div",{className:"p-6 pb-40 max-h-[calc(90vh-200px)] overflow-y-auto",style:{paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[$==="overview"&&e.jsx(Ge,{}),$==="settings"&&e.jsx(Ke,{}),$==="participants"&&e.jsx(Xe,{})]})]})})}),m&&e.jsx(Le,{isOpen:m,onClose:()=>c(!1),onConfirm:Je,title:"Delete Prediction",message:"Are you sure you want to delete this prediction? This action cannot be undone and all participant data will be lost.",confirmText:"Delete",variant:"danger",isLoading:I}),Q&&e.jsx(Ot,{isOpen:Q,onClose:()=>ae(!1),prediction:{id:String(s.id),title:s.title,description:s.description||""},onUpdate:Y}),e.jsx(Le,{isOpen:W,onClose:()=>G(!1),onConfirm:fe,title:"Close Prediction Early",message:"Are you sure you want to close this prediction early? No new participants will be able to join once closed.",confirmText:"Close Early",cancelText:"Cancel",variant:"warning",isLoading:C}),ne&&e.jsx(Et,{isOpen:ne,onClose:()=>z(!1),prediction:{...V,id:String(V.id),creator_id:a?.id||"",type:"multi_outcome",stake_min:1,settlement_method:"manual",is_private:!1,platform_fee_percentage:2.5,club_id:void 0,image_url:void 0,tags:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString(),creator:{id:a?.id||"",username:a?.username||"",full_name:a?.full_name||"",avatar_url:a?.avatar_url||null},options:s.options||[],pool_total:s.pool_total||s.totalPool||0,participant_count:s.participant_count||s.participants||0,entry_deadline:s.entry_deadline||new Date().toISOString()},onSettlementComplete:E}),ee&&e.jsx(It,{isOpen:ee,onClose:()=>X(!1),predictionId:String(s.id),predictionTitle:s.title,onResolutionComplete:E})]}):null},Mt=Lt;function Me(j){const{prediction:n,myEntry:s,now:$=Date.now()}=j,g=Array.isArray(s)?s:s?[s]:[],f=(n.status||"").toLowerCase(),_=!!(n.settled_at||n.settledAt),w=_||f==="settled"||f==="complete",x=n.entry_deadline,R=x?new Date(x).getTime()<=$:!1,u=!w&&(f==="closed"||f==="awaiting_settlement"||R);let k,v;if(f==="cancelled"||f==="voided"||f==="refunded"){if(k={text:f==="refunded"?"Refunded":f==="cancelled"?"Cancelled":"Voided",tone:"danger"},n.settled_at||n.settledAt){const m=new Date(n.settled_at||n.settledAt||"");v=`${f==="refunded"?"Refunded":"Cancelled"} on ${m.toLocaleDateString()}`}}else if(w)k={text:"Complete",tone:"success"},_&&(v=`Settled on ${new Date(n.settled_at||n.settledAt||"").toLocaleDateString()}`);else if(u)k={text:"Closed",tone:"default"},v="Awaiting settlement";else if(k={text:"Active",tone:"default"},x){const c=(new Date(x).getTime()-$)/(1e3*60*60);c>0&&c<48&&(v=`Closes in ${Math.round(c)}h`)}let N,A,o;typeof n.myStakeTotal=="number"||typeof n.myReturnedTotal=="number"||typeof n.myNet=="number"?(N=typeof n.myStakeTotal=="number"?n.myStakeTotal:0,A=typeof n.myReturnedTotal=="number"?n.myReturnedTotal:0,o=typeof n.myNet=="number"?n.myNet:0):(N=g.reduce((m,c)=>m+(Number(c.amount)||0),0),A=w?g.reduce((m,c)=>m+(Number(c.actual_payout)||0),0):0,o=A-N);let P;if(g.length>0){const m=g[0];if(m){const c=m.option_id;if(n.options&&c){const I=n.options.find(M=>M.id===c);I?.label&&(P=I.label)}!P&&m.option?.label&&(P=m.option.label)}g.length>1&&new Set(g.map(I=>I.option_id).filter(Boolean)).size>1&&(P="Multiple positions")}let p=null;if(g.length>0){const m=g[0]?.provider;m==="demo-wallet"?p="Demo":m&&m.includes("crypto")?p="Crypto":m&&(m.includes("fiat")||m.includes("paystack"))&&(p="Fiat")}const h=w&&_?new Date(n.settled_at||n.settledAt||"").toLocaleDateString():null;return{id:n.id,title:n.title,categoryLabel:n.category?.replace("_"," "),statusBadge:k,statusSubtext:v,participantsCount:n.participant_count||n.participants||0,yourPositionLabel:P,staked:N,returned:A,profitLoss:o,railLabel:p,settledAtText:h}}const as=({onNavigateToDiscover:j})=>{const n=ot(),{predictions:s,getUserCreatedPredictions:$,fetchUserCreatedPredictions:g,fetchUserPredictionEntries:f,getUserPredictionEntries:_,loading:w}=Te(),{user:x,isAuthenticated:R}=Ae(),{user:u,initialized:k}=dt(),v=u?!0:R,N=u?{id:u.id,firstName:u.user_metadata?.firstName||u.user_metadata?.first_name||u.user_metadata?.full_name?.split(" ")[0]||"User",lastName:u.user_metadata?.lastName||u.user_metadata?.last_name||u.user_metadata?.full_name?.split(" ").slice(1).join(" ")||"",email:u.email||"",phone:u.phone,avatar:u.user_metadata?.avatar_url||u.user_metadata?.picture,provider:u.app_metadata?.provider||"email",createdAt:u.created_at}:x,[A,o]=r.useState("Active"),[P,p]=r.useState(!1),[h,m]=r.useState(null),[c,I]=r.useState(!1),M=r.useCallback(t=>{const d=(t||"").toLowerCase();return!(d==="won"||d==="lost"||d==="refunded")},[]),C=(t,d)=>{if(!t)return"Unknown";const b=(d||"").toLowerCase();if(b==="closed")return"Closed";if(b==="settled")return"Settled";if(b==="awaiting_settlement")return"Awaiting settlement";if(b==="disputed")return"Disputed";if(b==="refunded")return"Refunded";if(b==="ended")return"Ended";const D=$e(t);return D||"Unknown"},J=t=>{if(!t||!t.options)return 68;const d=t.options.reduce((D,q)=>D+(q.total_staked||0),0);if(d===0)return 68;const b=Math.max(...t.options.map(D=>D.total_staked||0));return Math.round(b/d*100)};r.useEffect(()=>{window.scrollTo({behavior:"instant"})},[]),r.useEffect(()=>{let t=!1;return(async()=>{if(!(!N?.id||!v))try{I(!1),await Promise.all([g(N.id),f(N.id)])}finally{t||I(!0)}})(),()=>{t=!0}},[N?.id,v,g,f]);const z=(()=>{if(!v||!N)return{active:0,created:0,completed:0};const t=$(N.id),d=_(N.id),b=d.filter(i=>{const a=i.prediction||s.find(te=>te.id===i.prediction_id),y=M(i.status);if(!a)return y;const L=(a.status||"").toLowerCase()==="open",E=new Date(a.entry_deadline)>new Date;return y&&L&&E}),D=t.filter(i=>i.status==="open"||i.status==="closed"||i.status==="awaiting_settlement"),q=d.filter(i=>{const a=i.prediction||s.find(E=>E.id===i.prediction_id);if(!a)return!1;const y=i.status==="won"||i.status==="lost",S=a.status==="closed"||a.status==="settled"||a.status==="ended",L=new Date(a.entry_deadline)<=new Date;return y||S||L});return{active:b.length,created:D.length,completed:q.length}})(),Q=[{id:"Active",label:"Active",icon:ke,count:z.active},{id:"Created",label:"Created",icon:Fe,count:z.created},{id:"Completed",label:"Completed",icon:Ne,count:z.completed}],ae=()=>{if(!v||!N)return{Active:[],Created:[],Completed:[]};const t=_(N.id),d=$(N.id),b=t.filter(i=>{const a=i.prediction||s.find(te=>te.id===i.prediction_id),y=M(i.status);if(!a)return y;const L=(a.status||"").toLowerCase()==="open",E=new Date(a.entry_deadline)>new Date;return y&&L&&E}).map(i=>{const a=i.prediction||s.find(L=>L.id===i.prediction_id);if(!a)return null;const y=i.option||a.options?.find(L=>L.id===i.option_id),S=C(a.entry_deadline,a.status);return{id:i.id,title:a.title,category:a.category,position:y?.label||"Unknown",stake:i.amount,potentialReturn:i.potential_payout||0,odds:i.potential_payout?`${(i.potential_payout/i.amount).toFixed(2)}x`:"1.00x",timeRemaining:S,status:"active",participants:a.participant_count||0,confidence:J(a)}}).filter(Boolean),D=d.filter(i=>i.status==="open"||i.status==="closed"||i.status==="awaiting_settlement").map(i=>{let a=i.status;const y=new Date,S=new Date(i.entry_deadline);a==="open"&&S<=y&&(a="ended");const L=C(i.entry_deadline,a);return{id:i.id,title:i.title,category:i.category,totalPool:i.pool_total||0,participants:i.participant_count||0,timeRemaining:L,status:a,yourCut:i.creator_fee_percentage||3.5,description:i.description,pool_total:i.pool_total,participant_count:i.participant_count,creator_fee_percentage:i.creator_fee_percentage,entry_deadline:i.entry_deadline}}),q=t.filter(i=>{const a=i.prediction||s.find(E=>E.id===i.prediction_id);if(!a)return!1;const y=i.status==="won"||i.status==="lost",S=a.status==="closed"||a.status==="awaiting_settlement"||a.status==="settled"||a.status==="ended",L=new Date(a.entry_deadline)<=new Date;return y||S||L}).map(i=>{const a=i.prediction||s.find(S=>S.id===i.prediction_id);if(!a)return null;const y=Me({prediction:{id:a.id,title:a.title,category:a.category,status:a.status,settled_at:a.settled_at||a.settledAt||null,entry_deadline:a.entry_deadline,participant_count:a.participant_count,participants:a.participant_count,options:a.options,updated_at:a.updated_at,created_at:a.created_at},myEntry:{id:i.id,option_id:i.option_id,amount:i.amount,actual_payout:i.actual_payout||null,status:i.status,provider:i.provider,option:i.option||i.option}});return{id:a.id,predictionId:a.id,entryId:i.id,title:y.title,category:a.category,position:y.yourPositionLabel||"Unknown",stake:y.staked,actualReturn:y.returned,profit:y.profitLoss,status:i.status,participants:y.participantsCount||0,settledAt:y.statusSubtext||y.settledAtText||"",predictionStatus:a.status,entry_deadline:a.entry_deadline,options:a.options,vm:y}}).filter(Boolean);return{Active:b,Created:D,Completed:q}},W=r.useMemo(()=>{try{return ae()}catch{return{Active:[],Created:[],Completed:[]}}},[N?.id,v,s,A]),G=v&&N?_(N.id):[],ee=r.useMemo(()=>!v||!N?[]:G.filter(t=>{const d=t.prediction||s.find(a=>a.id===t.prediction_id),b=M(t.status);if(!d)return b;const q=(d.status||"").toLowerCase()==="open",i=new Date(d.entry_deadline)>new Date;return b&&q&&i}).map(t=>{const d=t.prediction||s.find(D=>D.id===t.prediction_id);if(!d)return{entry:t,prediction:null,card:null};const b=t.option||d.options?.find(D=>D.id===t.option_id);return{entry:t,prediction:d,card:{id:t.id,predictionId:d.id,title:d.title,category:d.category||"custom",position:b?.label||"Unknown",stake:t.amount,potentialReturn:t.potential_payout||0,odds:t.potential_payout?`${(t.potential_payout/t.amount).toFixed(2)}x`:"1.00x",confidence:J(d),participants:d.participant_count||0,status:"active",timeRemaining:C(d.entry_deadline,d.status)}}}),[v,N,G,s,M]),X=W[A]||[],ge=t=>{switch(t){case"active":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"winning":return"bg-emerald-50 text-emerald-700 border-emerald-200";case"losing":return"bg-red-50 text-red-700 border-red-200";case"open":return"bg-blue-50 text-blue-700 border-blue-200";default:return"bg-gray-50 text-gray-700 border-gray-200"}},le=t=>({custom:"bg-orange-100 text-orange-700",sports:"bg-blue-100 text-blue-700",esports:"bg-purple-100 text-purple-700",pop_culture:"bg-pink-100 text-pink-700",politics:"bg-red-100 text-red-700",celebrity_gossip:"bg-emerald-100 text-emerald-700"})[t]||"bg-gray-100 text-gray-700";if(!v)return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{title:ye("myBets")}),e.jsx("div",{className:"min-h-screen bg-gray-50 px-4 py-6",children:e.jsx(kt,{icon:e.jsx(ke,{}),title:"Sign in to view your predictions",body:"See your portfolio, performance, and history.",intent:"view_my_bets",primaryLabel:"Sign In"})})]});const V=({tab:t})=>{const b={Active:{icon:ke,title:"No active predictions",description:`You haven't placed any ${ye("bets")} yet. Start by exploring trending topics and making your first prediction!`,buttonText:"Discover Predictions",buttonColor:"from-emerald-500 to-emerald-600",iconBg:"bg-emerald-100",iconColor:"text-emerald-500"},Created:{icon:Fe,title:"No predictions created",description:"Share your insights with the community! Create predictions and earn fees when others participate.",buttonText:"Create Prediction",buttonColor:"from-blue-500 to-blue-600",iconBg:"bg-blue-100",iconColor:"text-blue-500"},Completed:{icon:Ne,title:"No completed predictions",description:"Your prediction history and earnings will appear here as you complete predictions.",buttonText:"Browse Active Predictions",buttonColor:"from-purple-500 to-purple-600",iconBg:"bg-purple-100",iconColor:"text-purple-500"}}[t],D=b.icon;return e.jsxs(O.div,{className:"flex flex-col items-center justify-center py-20 px-6",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:[e.jsx(O.div,{className:he("w-20 h-20 rounded-full flex items-center justify-center mb-6",b.iconBg),initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:260,damping:20,delay:.2},children:e.jsx(O.div,{initial:{rotateY:-180},animate:{rotateY:0},transition:{delay:.4,duration:.6},children:e.jsx(D,{className:he("w-10 h-10",b.iconColor)})})}),e.jsx(O.h3,{className:"text-xl font-bold text-gray-900 mb-3 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.3},children:b.title}),e.jsx(O.p,{className:"text-gray-600 text-center mb-8 max-w-md leading-relaxed",initial:{opacity:0},animate:{opacity:1},transition:{delay:.4},children:b.description}),e.jsxs(O.button,{className:he("bg-gradient-to-r text-white px-8 py-3 rounded-xl font-semibold","transition-all duration-200 flex items-center gap-2 shadow-lg","hover:shadow-xl hover:scale-105 active:scale-95",`${b.buttonColor}`),onClick:()=>{t==="Created"?(n("/create"),window.scrollTo({top:0,behavior:"instant"})):j&&j()},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.5},whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(ct,{className:"w-5 h-5"}),b.buttonText]})]})},ie=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200 cursor-pointer",onClick:()=>n(`/predictions/${t.predictionId||t.id}`),role:"button","aria-label":`View prediction ${t.title}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${le(t.category)}`,children:(t.category||"custom").replace("_"," ")}),e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${ge(t.status)}`,children:"Active"})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-emerald-800",children:"Your Position"}),e.jsx("span",{className:"text-lg font-bold text-emerald-700",children:t.position})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Staked"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",t.stake.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:"Potential"}),e.jsxs("p",{className:"font-semibold text-emerald-900",children:["$",t.potentialReturn.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-emerald-600 mb-1",children:ye("odds")}),e.jsx("p",{className:"font-semibold text-emerald-900",children:t.odds})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Market Confidence"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:[t.confidence,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${t.confidence}%`}})})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"w-4 h-4"}),e.jsxs("span",{children:[t.participants," participants"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ze,{className:"w-4 h-4"}),e.jsx("span",{className:`font-medium ${t.timeRemaining.includes("Closed")||t.timeRemaining.includes("Settled")||t.timeRemaining.includes("Disputed")||t.timeRemaining.includes("Ended")?"text-red-600":t.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-amber-600"}`,children:(t.timeRemaining.includes("h")||t.timeRemaining.includes("d"))&&!t.timeRemaining.includes("Closed")&&!t.timeRemaining.includes("Ended")&&!t.timeRemaining.includes("Settled")&&!t.timeRemaining.includes("Disputed")&&!t.timeRemaining.includes("Awaiting")?`${t.timeRemaining} left`:t.timeRemaining})]})]})]}),re=()=>e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-5 w-16 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-5 w-12 bg-gray-200 rounded-full"})]}),e.jsx("div",{className:"h-6 w-3/4 bg-gray-200 rounded"}),e.jsxs("div",{className:"bg-emerald-50 rounded-xl p-4 space-y-3",children:[e.jsx("div",{className:"h-4 w-24 bg-emerald-200 rounded"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx("div",{className:"h-10 bg-emerald-100 rounded"}),e.jsx("div",{className:"h-10 bg-emerald-100 rounded"}),e.jsx("div",{className:"h-10 bg-emerald-100 rounded"})]})]}),e.jsx("div",{className:"h-3 w-full bg-gray-200 rounded-full"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"h-4 w-24 bg-gray-200 rounded"}),e.jsx("div",{className:"h-4 w-20 bg-gray-200 rounded"})]})]})}),de=({prediction:t})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 hover:shadow-md transition-all duration-200",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${le(t.category)}`,children:t.category.replace("_"," ")}),e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-blue-50 text-blue-700 border-blue-200",children:t.status==="open"?"Open":t.status})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsx("div",{className:"bg-blue-50 rounded-xl p-4 mb-4",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Total Pool"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:["$",t.totalPool.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Participants"}),e.jsx("p",{className:"font-semibold text-blue-900",children:t.participants})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Your Cut"}),e.jsxs("p",{className:"font-semibold text-blue-900",children:[t.yourCut,"%"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`text-sm ${t.timeRemaining.includes("Closed")||t.timeRemaining.includes("Settled")||t.timeRemaining.includes("Disputed")||t.timeRemaining.includes("Ended")?"text-red-600":t.timeRemaining.includes("Awaiting")?"text-yellow-600":"text-gray-500"}`,children:(t.timeRemaining.includes("h")||t.timeRemaining.includes("d"))&&!t.timeRemaining.includes("Closed")&&!t.timeRemaining.includes("Ended")&&!t.timeRemaining.includes("Settled")&&!t.timeRemaining.includes("Disputed")&&!t.timeRemaining.includes("Awaiting")?`Closes in ${t.timeRemaining}`:t.timeRemaining}),e.jsxs("button",{onClick:d=>{d.preventDefault(),d.stopPropagation(),m(t),p(!0)},className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-medium text-sm flex items-center gap-1 hover:bg-blue-700 transition-colors",children:["Manage ",e.jsx(Be,{className:"w-4 h-4"})]})]})]}),ce=({prediction:t})=>{const{address:d}=We(),{data:b}=St(d||void 0,100),D=new Map((b||[]).map(se=>[se.predictionId,se])),{claim:q,isClaiming:i}=ut(),[a,y]=De.useState(!1),S=t.predictionId||t.id,L=(()=>{try{const se=(d||"").toLowerCase();return!!localStorage.getItem(`fcz:claimed:${S}:${se}`)}catch{return!1}})(),E=D.get(S),te=!!d&&!!E&&!L,F=t.vm||Me({prediction:{id:t.id||t.predictionId,title:t.title,category:t.category,status:t.predictionStatus||t.status||"settled",settled_at:t.settledAt?typeof t.settledAt=="string"?t.settledAt:new Date(t.settledAt).toISOString():null,entry_deadline:t.entry_deadline,participant_count:t.participants,options:t.options},myEntry:{amount:t.stake,actual_payout:t.actualReturn,status:t.status,option_id:t.option_id,option:{label:t.position}}}),Y=F.statusBadge.text==="Complete",Se=async()=>{if(String(t?.status||"").toLowerCase()==="archived"||a){y(!0),H("This prediction has been archived",{icon:"ðŸ—„ï¸"});return}try{if(!(await fetch(`${me()}/api/v2/predictions/${S}`,{method:"HEAD"})).ok){y(!0),H("This prediction has been archived",{icon:"ðŸ—„ï¸"});return}n(`/predictions/${S}`)}catch{n(`/predictions/${S}`)}};return e.jsxs("div",{className:`bg-white rounded-2xl shadow-sm border border-gray-100 p-6 mb-4 transition-all duration-200 ${a?"opacity-60 cursor-not-allowed":"hover:shadow-md cursor-pointer"}`,onClick:()=>{a||Se()},role:"button","aria-label":`View prediction ${t.title}`,children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium ${le(t.category)}`,children:F.categoryLabel||t.category.replace("_"," ")}),a?e.jsx("span",{className:"px-2 py-1 rounded-lg text-xs font-medium border bg-gray-50 text-gray-700 border-gray-200",children:"Archived"}):e.jsx("span",{className:`px-2 py-1 rounded-lg text-xs font-medium border ${F.statusBadge.tone==="success"?"bg-emerald-50 text-emerald-700 border-emerald-200":F.statusBadge.tone==="danger"?"bg-red-50 text-red-700 border-red-200":F.statusBadge.tone==="warning"?"bg-yellow-50 text-yellow-700 border-yellow-200":"bg-gray-50 text-gray-700 border-gray-200"}`,children:F.statusBadge.text}),F.railLabel&&e.jsx("span",{className:"px-1.5 py-0.5 rounded text-xs font-medium bg-slate-100 text-slate-600 border border-slate-200",children:F.railLabel})]}),e.jsx("h3",{className:"font-semibold text-gray-900 text-lg leading-tight",children:t.title})]})}),e.jsxs("div",{className:`rounded-xl p-4 mb-4 ${a?"bg-gray-50":Y?t.status==="won"?"bg-emerald-50":"bg-red-50":"bg-yellow-50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:`text-sm font-medium ${a?"text-gray-700":Y?t.status==="won"?"text-emerald-800":"text-red-800":"text-yellow-800"}`,children:a?"Archived":F.yourPositionLabel?`Your Position: ${F.yourPositionLabel}`:"No position"}),e.jsxs("div",{className:"flex items-center gap-3",children:[Y&&e.jsxs("span",{className:`text-lg font-bold ${t.status==="won"?"text-emerald-700":"text-red-700"}`,children:[F.profitLoss>=0?"+":"âˆ’","$",Math.abs(F.profitLoss).toLocaleString()]}),te&&E&&e.jsx("button",{type:"button",className:"h-8 px-3 rounded-lg bg-emerald-600 text-white text-xs font-semibold hover:bg-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:i,onClick:async se=>{se.stopPropagation();const fe=BigInt(E.amountUnits);await q({predictionId:S,amountUnits:fe,proof:E.proof})},children:i?"Claimingâ€¦":`Claim ${Ct(E.amountUSD,{compact:!0})}`})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mt-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${a?"text-gray-600":Y?t.status==="won"?"text-emerald-600":"text-red-600":"text-yellow-600"}`,children:"Staked"}),e.jsxs("p",{className:`font-semibold ${a?"text-gray-900":Y?t.status==="won"?"text-emerald-900":"text-red-900":"text-yellow-900"}`,children:["$",F.staked.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${a?"text-gray-600":Y?t.status==="won"?"text-emerald-600":"text-red-600":"text-yellow-600"}`,children:"Returned"}),e.jsx("p",{className:`font-semibold ${a?"text-gray-900":Y?t.status==="won"?"text-emerald-900":"text-red-900":"text-yellow-900"}`,children:Y?`$${F.returned.toLocaleString()}`:"â€”"})]}),e.jsxs("div",{children:[e.jsx("p",{className:`text-xs mb-1 ${a?"text-gray-600":Y?t.status==="won"?"text-emerald-600":"text-red-600":"text-yellow-600"}`,children:"Profit/Loss"}),e.jsx("p",{className:`font-semibold ${a?"text-gray-900":Y?t.status==="won"?"text-emerald-900":"text-red-900":"text-yellow-900"}`,children:Y?`${F.profitLoss>=0?"+":"âˆ’"}$${Math.abs(F.profitLoss).toLocaleString()}`:"Pending"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("span",{children:[F.participantsCount||t.participants||0," participants"]}),e.jsx("span",{children:a?"Archived":F.statusSubtext||(F.settledAtText?`Settled ${F.settledAtText}`:"")||""})]})]})};return e.jsxs(e.Fragment,{children:[e.jsx(Oe,{title:ye("myBets")}),e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex space-x-4 py-3",children:Q.map((t,d)=>{const b=t.icon;return e.jsxs("button",{onClick:()=>o(t.id),className:he("px-3 py-1 rounded-lg text-sm font-medium transition-colors whitespace-nowrap",A===t.id?"bg-emerald-100 text-emerald-700":"text-gray-600 hover:text-gray-900"),children:[e.jsx(b,{className:"w-4 h-4 inline mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:t.label}),e.jsx("span",{className:"sm:hidden",children:t.id==="Active"?"Active":t.id==="Created"?"Created":"Complete"}),t.count>0&&e.jsx("span",{className:he("ml-1 px-2 py-0.5 rounded-full text-xs font-semibold inline-block",A===t.id?"bg-emerald-200 text-emerald-900":"bg-gray-200 text-gray-600"),children:t.count>99?"99+":t.count})]},t.id)})})})}),e.jsx("div",{className:"min-h-screen bg-gray-50 pb-[calc(5rem+env(safe-area-inset-bottom))]",children:e.jsx("div",{className:"px-4 py-6",children:w?e.jsxs("div",{className:"flex items-center justify-center py-16",children:[e.jsx("div",{className:"w-8 h-8 border-2 border-emerald-500 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Loading predictions..."})]}):A==="Active"?c?ee.length>0?e.jsx("div",{className:"space-y-4",children:e.jsx(pe,{mode:"popLayout",children:ee.map(({entry:t,prediction:d,card:b},D)=>e.jsx(O.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},exit:{opacity:0,y:-12},transition:{duration:.2,delay:D*.02},children:d&&b?e.jsx(ie,{prediction:b}):e.jsx(re,{})},`active-${d?.id||t.id}-${D}`))})}):e.jsx(V,{tab:A}):e.jsx("div",{className:"space-y-4",children:Array.from({length:Math.max(3,z.active||1)}).map((t,d)=>e.jsx(re,{},`active-loading-${d}`))}):X.length>0?e.jsxs("div",{className:"space-y-4",children:[A==="Created"&&X.map((t,d)=>!t||typeof t.id>"u"?null:e.jsx(de,{prediction:t},`created-${t.id}-${d}`)),A==="Completed"&&X.map((t,d)=>!t||typeof t.id>"u"?null:e.jsx(ce,{prediction:t},`completed-${t.id}-${d}`))]}):e.jsx(V,{tab:A})})}),h&&e.jsx(Mt,{isOpen:P,onClose:()=>{p(!1),m(null)},prediction:{id:h.id,title:h.title,category:h.category,totalPool:h.totalPool||h.pool_total||0,participants:h.participants||h.participant_count||0,timeRemaining:C(h.entry_deadline,h.status)||"Ended",yourCut:h.yourCut||h.creator_fee_percentage||3.5,status:h.status||"open",description:h.description,pool_total:h.pool_total,participant_count:h.participant_count,creator_fee_percentage:h.creator_fee_percentage,entry_deadline:h.entry_deadline}})]})};export{as as default};
