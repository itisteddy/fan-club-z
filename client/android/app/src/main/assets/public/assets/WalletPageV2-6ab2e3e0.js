import{j as e}from"./ui-6244b3df.js";import{r as a}from"./vendor-499a370b.js";import{u as Ie,a as De}from"./utils-17ec81d9.js";import{b as k,c as ie}from"./format-ae98e2f4.js";import{K as me,f as I,h as w,z as b,p as Ue,u as Ee,d as ze,Q as We,W as P,o as $e,J as le,X as Y,q as Le,D as Be}from"./index-6112b649.js";import{A as ce}from"./AppHeader-78d14113.js";import{u as Fe}from"./useClaimableClaims-c78a938a.js";import{u as Me,C as Te}from"./useMerkleClaim-85bb6a08.js";import{D as _e}from"./DepositUSDCModal-2048ba50.js";import{u as qe,W as Re,L as Ke}from"./WithdrawUSDCModal-153e94d2.js";import{u as Qe}from"./useUnifiedBalance-2a41b6ef.js";import{d as xe,u as he,b as ue}from"./useWriteContract-ab9d8160.js";import"./public-3a03d500.js";async function Ve(s,r={}){let i;if(r.connector)i=r.connector;else{const{connections:x,current:m}=s.state;i=x.get(m)?.connector}const u=s.state.connections;i&&(await i.disconnect(),i.emitter.off("change",s._internal.events.change),i.emitter.off("disconnect",s._internal.events.disconnect),i.emitter.on("connect",s._internal.events.connect),u.delete(i.uid)),s.setState(x=>{if(u.size===0)return{...x,connections:new Map,current:null,status:"disconnected"};const m=u.values().next().value;return{...x,connections:new Map(u),current:m.connector.uid}});{const x=s.state.current;if(!x)return;const m=s.state.connections.get(x)?.connector;if(!m)return;await s.storage?.setItem("recentConnectorId",m.id)}}let $=[];function Z(s){const r=[...s.state.connections.values()];return s.state.status==="reconnecting"||xe($,r)?$:($=r,r)}function He(s,r){const{onChange:i}=r;return s.subscribe(()=>Z(s),i,{equalityFn:xe})}function Pe(s){return{mutationFn(r){return Ve(s,r)},mutationKey:["disconnect"]}}function Ye(s={}){const r=me(s);return a.useSyncExternalStore(i=>He(r,{onChange:i}),()=>Z(r),()=>Z(r))}function Ze(s={}){const{mutation:r}=s,i=me(s),u=Pe(i),{mutate:x,mutateAsync:m,...o}=Ie({...r,...u});return{...o,connectors:Ye({config:i}).map(C=>C.connector),disconnect:x,disconnectAsync:m}}/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=I("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=I("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=I("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=I("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=I("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=I("Unlock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]]);function et(){const{chainId:s,isConnected:r,address:i}=he(),{switchChainAsync:u}=ue();a.useEffect(()=>{if(!r||!i||s===w.id)return;const m=setTimeout(async()=>{try{console.log(`[FCZ-PAY] Auto-switching from chain ${s} to Base Sepolia (${w.id})`),await u({chainId:w.id}),b.success("Switched to Base Sepolia")}catch(o){console.error("[FCZ-PAY] Auto network switch failed:",o)}},500);return()=>clearTimeout(m)},[s,r,i,u])}const ut=({onNavigateBack:s})=>{const{user:r}=Ue(),{user:i,isAuthenticated:u}=Ee(),[x,m]=a.useState(!0);et();const o=r||i,C=!!r||u,h=De(),{address:j,isConnected:p,chainId:g,status:pe}=he(),{disconnect:be}=Ze(),{switchChain:O}=ue(),ge=ze(),[J,L]=a.useState(!1),[G,B]=a.useState(!1),[fe,F]=a.useState(!1),[X,U]=a.useState(null),[ee,te]=a.useState(!1),[ye,we]=a.useState(0),[je,se]=a.useState(0),{claim:M,isClaiming:T}=Me(),[f,_]=a.useState(null),[d,q]=a.useState(null),{wallet:E,available:v,locked:S,total:R,isLoading:N,error:ve,refetch:ae}=Qe(),{data:K,isLoading:Ne}=qe(o?.id,20),{data:c}=Fe(j,100),A=a.useCallback(()=>{window.dispatchEvent(new CustomEvent("fcz:wallet:connect"))},[]);a.useEffect(()=>{function t(n){if(!n||!n.detail)return;const{txHash:l,kind:y,predictionId:H}=n.detail||{};l&&_({hash:String(l),kind:String(y||"tx"),predictionId:H})}return window.addEventListener("fcz:tx",t),()=>window.removeEventListener("fcz:tx",t)},[]),a.useEffect(()=>{try{for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t)||"";if(!n.startsWith("fcz:lastTx:"))continue;const l=localStorage.getItem(n)||"";if(!l||sessionStorage.getItem(`fcz:tx:dismissed:${l}`)==="true")continue;const y=n.split(":"),H=y[2]||"tx",Ae=y[3];_({hash:l,kind:H,predictionId:Ae});break}}catch{}},[]);const z=a.useCallback(()=>{try{O({chainId:w.id}),b.success("Check your wallet to confirm the network switch.")}catch(t){console.warn("[FCZ-PAY] switchChain failed; prompting manual switch",t),b.error("Please switch to Base Sepolia in your wallet."),A()}},[A,O]),W=a.useCallback(()=>p?g!==w.id?(z(),!1):!0:(A(),!1),[g,z,p,A]),ne=a.useCallback(()=>{W()&&L(!0)},[W]),ke=a.useCallback(()=>{W()&&B(!0)},[W]),D=a.useCallback(()=>{console.log("[FCZ-PAY] Refreshing balances after transaction"),h.removeQueries({queryKey:["readContract"]}),setTimeout(()=>{ae()},500)},[ae,h]);a.useEffect(()=>(window.addEventListener("fcz:balance:refresh",D),()=>window.removeEventListener("fcz:balance:refresh",D)),[D]);const Q=p&&g===w.id?E:0;a.useEffect(()=>{p&&g===w.id&&console.log("[FCZ-PAY] WalletPage balance state:",{walletUSDC:E,escrowAvailableUSD:v,escrowReservedUSD:S,escrowTotalUSD:R,isLoadingBalance:N})},[E,v,S,R,N,p,g]),a.useEffect(()=>{!p||!j||(h.invalidateQueries({queryKey:["wallet"]}),h.invalidateQueries({queryKey:["escrow-balance"]}),h.invalidateQueries({queryKey:["onchain-activity"]}),h.invalidateQueries({queryKey:["readContract"]}),o?.id&&h.invalidateQueries({queryKey:We.walletActivity(o.id)}))},[p,j,g,pe,h,o?.id]),a.useEffect(()=>{C&&o?.id?m(!1):C||m(!1)},[C,o?.id]);const V=t=>{const n=(t||"").toLowerCase(),l={deposit:"Deposit",withdraw:"Withdrawal",lock:"Funds locked",release:"Funds released",entry:"Bet placed",claim:"Claimed",payout:"Settlement payout"};return l[n]?l[n]:n.replace(/_/g," ").replace(/\b\w/g,y=>y.toUpperCase())},Ce=a.useCallback(t=>{if(_(null),!!t)try{sessionStorage.setItem(`fcz:tx:dismissed:${t}`,"true");for(let n=0;n<localStorage.length;n++){const l=localStorage.key(n)||"";l.startsWith("fcz:lastTx:")&&localStorage.getItem(l)===t&&localStorage.removeItem(l)}}catch{}},[]);if(!C)return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-[calc(5rem+env(safe-area-inset-bottom))]",children:[e.jsx(ce,{title:"Wallet"}),e.jsx("div",{className:"mx-auto w-full max-w-[720px] lg:max-w-[960px] px-4 py-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-white rounded-2xl border border-black/[0.06] p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(P,{className:"w-8 h-8 text-gray-400"})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Sign in to view wallet"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 max-w-sm mx-auto",children:"Track your balance, deposits, and transaction history."}),e.jsx("button",{onClick:async()=>{try{await $e({intent:"view_wallet"})}catch(t){console.error("Auth gate error:",t)}},className:"px-6 py-2 bg-emerald-600 text-white rounded-lg font-medium hover:bg-emerald-700 transition-colors",children:"Sign In"})]})}),e.jsxs("div",{className:"bg-white rounded-2xl border border-black/[0.06] p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsx("div",{className:"text-center py-6 text-gray-500",children:e.jsx("p",{className:"text-sm",children:"Your transaction history will appear here"})})]})]})})]});const re=a.useCallback(async t=>{try{if(U(t.predictionId),await M({predictionId:t.predictionId,amountUnits:BigInt(t.amountUnits),proof:t.proof})){await h.invalidateQueries({queryKey:["wallet","claimable"]});try{window.dispatchEvent(new CustomEvent("fcz:balance:refresh"))}catch{}return!0}return!1}catch(n){if(String(n?.message||"").toLowerCase().includes("already claimed")){await h.invalidateQueries({queryKey:["wallet","claimable"]});try{window.dispatchEvent(new CustomEvent("fcz:balance:refresh"))}catch{}return!0}return console.warn(`Claim failed for ${t.predictionId}:`,n?.message||n),!1}finally{U(null)}},[M,h]),Se=a.useCallback(async()=>{if(!c||c.length===0)return;te(!0),we(c.length),se(0);let t=0;for(const n of c)await re(n)&&(t++,se(t));te(!1),t===c.length?b.success(`Successfully claimed all ${t} winnings!`):t>0?b.success(`Successfully claimed ${t} of ${c.length} winnings`):b.error("No claims were processed")},[c,re]);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-[calc(5rem+env(safe-area-inset-bottom))]",children:[e.jsx(ce,{title:"Wallet"}),e.jsx("div",{className:"mx-auto w-full max-w-[720px] lg:max-w-[960px] px-4 py-4",children:e.jsx("div",{className:"space-y-4",children:x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[...Array(2)].map((t,n)=>e.jsxs("div",{className:"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] animate-pulse",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded mb-2 w-16"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded w-20"})]},n))}),e.jsxs("div",{className:"bg-white rounded-2xl border border-black/[0.06] p-4 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-20 mb-4"}),e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mx-auto mb-2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24 mx-auto mb-4"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex-1 h-12 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"flex-1 h-12 bg-gray-200 rounded-lg"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] flex flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-2",children:[e.jsx(P,{className:"w-4 h-4 text-blue-500"}),e.jsx("div",{className:"text-xs text-gray-600 font-medium tracking-wide",children:"Wallet"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900 font-mono truncate",children:N?"...":k(Q??0,{compact:!0})}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"USDC on Base"})]}),e.jsxs("div",{className:"bg-white rounded-2xl border border-black/[0.06] p-4 min-h-[88px] flex flex-col justify-center",children:[e.jsxs("div",{className:"flex items-center space-x-1 mb-2",children:[e.jsx(le,{className:"w-4 h-4 text-emerald-500"}),e.jsx("div",{className:"text-xs text-gray-600 font-medium tracking-wide",children:"Escrow"})]}),e.jsx("div",{className:"text-lg font-bold text-gray-900 font-mono truncate",children:N?"...":k(R??0,{compact:!0})}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex items-center gap-2",children:[e.jsxs("span",{className:"text-emerald-600 font-medium",children:[k(v??0,{compact:!0})," free"]}),S>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-gray-400",children:"·"}),e.jsxs("span",{className:"text-amber-600 font-medium",children:[k(S,{compact:!0})," locked"]})]})]})]})]}),p&&g!==w.id&&e.jsxs("div",{className:"p-4 bg-amber-50 border-2 border-amber-200 rounded-2xl flex items-start gap-3",children:[e.jsx("span",{className:"text-2xl",children:"⚠️"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-sm font-bold text-amber-900 mb-1",children:"Switch to Base Sepolia"}),e.jsxs("p",{className:"text-xs text-amber-800 mb-3",children:["You are connected to ",e.jsx("strong",{children:g??"Unknown network"}),". Switch to ",e.jsx("strong",{children:"Base Sepolia"})," to continue."]}),e.jsxs("button",{onClick:z,className:"inline-flex items-center gap-2 rounded-lg bg-amber-500 text-white text-xs font-semibold px-3 py-2 hover:bg-amber-600 transition-colors",children:[e.jsx(Oe,{className:"w-4 h-4"})," Switch Network"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl border border-blue-100 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"text-xs font-medium text-blue-600 bg-blue-100 px-2 py-1 rounded-full whitespace-nowrap",children:"Base Sepolia"}),p&&j&&e.jsxs("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2 py-1 text-xs font-mono text-gray-700 truncate max-w-[100px]",children:[j.slice(0,4),"…",j.slice(-3)]})]}),p&&j?e.jsxs("button",{type:"button",onClick:()=>{be(),b.success("Wallet disconnected")},className:"inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-3 py-1 text-xs font-medium text-gray-700 hover:bg-gray-100 transition-colors",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),"Disconnect"]}):e.jsxs("button",{type:"button",onClick:A,className:"inline-flex items-center gap-2 rounded-lg border border-emerald-300 bg-emerald-50 px-3 py-1 text-xs font-medium text-emerald-700 hover:bg-emerald-100 transition-colors",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),"Connect Wallet"]})]}),!!c&&c.length>0&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"rounded-xl border border-emerald-200 bg-emerald-50 p-3",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"text-sm text-emerald-900",children:["You have ",c.length," claim",c.length>1?"s":""," pending"]}),e.jsx("button",{type:"button",className:"text-xs font-semibold text-emerald-700 hover:text-emerald-800 underline",onClick:()=>F(!0),children:"View & claim"})]})})}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 whitespace-nowrap",children:["Wallet USDC ",e.jsx("span",{className:"ml-1 text-[10px] px-1 py-0.5 rounded bg-gray-100",children:"ERC20"})]}),e.jsx("span",{className:"font-mono font-medium tabular-nums whitespace-nowrap",children:Q!==void 0?`${Q.toFixed(2)}`:N?"Loading...":ve?"Error":"$0.00"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx("span",{className:"inline-block h-1.5 w-3 rounded bg-green-500"}),"Available"]}),e.jsx("span",{className:"font-mono font-semibold text-green-600 tabular-nums whitespace-nowrap",children:N?"Loading...":`${(v??0).toFixed(2)}`})]}),S>0&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-700 flex items-center gap-2 whitespace-nowrap",children:[e.jsx("span",{className:"inline-block h-1.5 w-3 rounded bg-amber-500"}),"In active bets"]}),e.jsx("span",{className:"font-mono font-medium text-amber-600 tabular-nums whitespace-nowrap",children:N?"Loading...":`${(S??0).toFixed(2)}`})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-3 mt-6",children:p?g!==w.id?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:z,className:"h-11 rounded-xl bg-amber-500 text-white font-semibold hover:bg-amber-600 transition-colors",children:"Switch Network"}),e.jsx("button",{onClick:ne,className:"h-11 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition-colors",children:"+ Deposit"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ne,className:"h-11 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition-colors",children:"+ Deposit"}),e.jsx("button",{onClick:ke,className:"h-11 rounded-xl border-2 border-gray-300 text-gray-700 font-semibold hover:border-gray-400 transition-colors disabled:opacity-50",disabled:!v||v===0,children:"Withdraw"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:A,className:"h-11 rounded-xl bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition-colors",children:"Connect Wallet"}),e.jsx("button",{disabled:!0,className:"h-11 rounded-xl border-2 border-gray-300 text-gray-400 font-semibold cursor-not-allowed",children:"Withdraw"})]})}),K?.items&&K.items.length>0?e.jsxs("div",{className:"mt-6 pt-4 border-t border-blue-100",children:[e.jsx("h4",{className:"text-xs font-semibold text-gray-700 mb-3",children:"Recent Activity"}),e.jsx("div",{className:"space-y-2",children:K.items.slice(0,8).map(t=>{const l={deposit:le,withdraw:Je,lock:Ke,release:Xe,entry:Le,claim:Ge,payout:Be}[t.kind]||P,y=(()=>t.kind==="entry"&&t.meta?.option_label?`on ${t.meta.option_label}`:t.kind==="payout"&&t.meta?.prediction_title?`for ${t.meta.prediction_title}`:t.kind==="claim"&&t.meta?.prediction_title?`from ${t.meta.prediction_title}`:"")();return e.jsxs("div",{className:"flex items-center justify-between text-sm gap-2 hover:bg-gray-50 rounded-lg p-2 -mx-2 cursor-pointer transition-colors",onClick:()=>q(t),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0 flex-1",children:[l&&e.jsx(l,{className:"w-4 h-4 text-gray-500 flex-shrink-0"}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"text-gray-700 text-xs font-medium truncate",children:V(t.kind)}),y&&e.jsx("span",{className:"text-[11px] text-gray-500 truncate",children:y})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("span",{className:"text-[11px] text-gray-500 whitespace-nowrap",children:t.createdAt?ie(t.createdAt):""}),e.jsx("span",{className:"font-mono text-xs font-medium whitespace-nowrap",children:k(t.amountUSD,{compact:!1})})]})]},t.id)})})]}):Ne?null:e.jsx("div",{className:"mt-6 pt-4 border-t border-blue-100",children:e.jsx("div",{className:"text-center py-3 text-xs text-gray-500",children:"No transactions yet"})})]})]})})}),o?.id&&e.jsxs(e.Fragment,{children:[J&&e.jsx(_e,{open:J,onClose:()=>L(!1),onSuccess:()=>{L(!1),D()},availableUSDC:E,userId:o.id}),G&&e.jsx(Re,{open:G,onClose:()=>B(!1),onSuccess:()=>{B(!1),D()},availableUSDC:v,userId:o.id})]}),d&&e.jsxs("div",{className:"fixed inset-0 z-modal flex items-end md:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>q(null)}),e.jsxs("div",{className:"relative w-full md:max-w-md bg-white rounded-t-3xl md:rounded-2xl shadow-2xl p-6 z-[1] mb-[calc(72px+env(safe-area-inset-bottom,0px))] pb-[calc(16px+env(safe-area-inset-bottom,0px))] max-h-[85vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-gray-500",children:"Activity"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:V(d.kind)})]}),e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100","aria-label":"Close details",onClick:()=>q(null),children:e.jsx(Y,{className:"w-4 h-4 text-gray-600"})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Amount"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900",children:k(d.amountUSD,{currency:"USD"})}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 mt-3",children:[e.jsx(Te,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:d.createdAt?ie(d.createdAt):"Just now"})]})]}),d.meta?.prediction_title&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Prediction"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:d.meta.prediction_title}),d.meta.option_label&&e.jsxs("p",{className:"text-xs text-gray-500 mt-0.5",children:["Position: ",d.meta.option_label]})]}),d.txHash?e.jsxs("div",{className:"border border-gray-200 rounded-2xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide",children:"Transaction hash"}),e.jsxs("span",{className:"font-mono text-xs text-gray-900 truncate max-w-[140px]",children:[d.txHash.slice(0,10),"…",d.txHash.slice(-6)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-xl py-2 hover:bg-gray-50",onClick:async()=>{try{await navigator.clipboard.writeText(d.txHash||""),b.success("Copied transaction hash")}catch{b.error("Unable to copy hash")}},children:[e.jsx(oe,{className:"w-4 h-4"}),"Copy"]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center gap-2 text-sm font-medium text-gray-700 border border-gray-200 rounded-xl py-2 hover:bg-gray-50",onClick:()=>{const t=`https://sepolia.basescan.org/tx/${d.txHash}`;window.open(t,"_blank")},children:[e.jsx(de,{className:"w-4 h-4"}),"View"]})]})]}):e.jsx("div",{className:"border border-dashed border-gray-200 rounded-2xl p-4 text-sm text-gray-600 bg-gray-50",children:"This entry was recorded off-chain, so a transaction hash isn’t available."})]})]}),f&&e.jsx("div",{className:"fixed left-1/2 -translate-x-1/2 bottom-[calc(88px+env(safe-area-inset-bottom,0px))] z-modal",children:e.jsxs("div",{className:"mx-auto flex items-center gap-3 rounded-2xl bg-white shadow-lg border border-black/[0.06] px-4 py-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[11px] text-gray-600",children:f.kind==="claim"?"Claim":f.kind==="settlement"?"Settlement":V(f.kind)}),e.jsxs("span",{className:"font-mono text-[11px] text-gray-500",children:[f.hash.slice(0,10),"…",f.hash.slice(-6)]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{className:"p-1.5 rounded-lg hover:bg-gray-100","aria-label":"View transaction",title:"View transaction",onClick:()=>{const t=`https://sepolia.basescan.org/tx/${f.hash}`;window.open(t,"_blank")},children:e.jsx(de,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{className:"p-1.5 rounded-lg hover:bg-gray-100","aria-label":"Copy hash",title:"Copy hash",onClick:async()=>{try{await navigator.clipboard.writeText(f.hash),b.success("Copied transaction hash")}catch{}},children:e.jsx(oe,{className:"w-4 h-4 text-gray-700"})}),e.jsx("button",{className:"p-1.5 rounded-lg hover:bg-gray-100","aria-label":"Dismiss",title:"Dismiss",onClick:()=>Ce(f.hash),children:e.jsx(Y,{className:"w-4 h-4 text-gray-700"})})]})]})}),fe&&e.jsxs("div",{className:"fixed inset-0 z-modal flex items-end md:items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:()=>F(!1)}),e.jsxs("div",{className:"relative w-full md:max-w-lg bg-white rounded-t-2xl md:rounded-2xl shadow-xl p-4 pb-[calc(16px+env(safe-area-inset-bottom,0px))] mb-[calc(72px+env(safe-area-inset-bottom,0px))] max-h-[80vh] md:max-h-[75vh] overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 bg-white/90 backdrop-blur px-4 pt-2 pb-3 -mx-4 border-b border-gray-100 flex items-center justify-between",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Your claimable winnings"}),e.jsxs("div",{className:"flex items-center gap-2",children:[Array.isArray(c)&&c.length>1&&e.jsx("button",{disabled:ee||T,className:"h-9 px-3 rounded-lg bg-emerald-100 text-emerald-800 text-sm font-semibold hover:bg-emerald-200 disabled:opacity-50",onClick:Se,children:ee?`Claiming ${je}/${ye}…`:`Claim all (${c.length})`}),e.jsx("button",{className:"p-1.5 rounded-lg hover:bg-gray-100","aria-label":"Dismiss",title:"Dismiss",onClick:()=>F(!1),children:e.jsx(Y,{className:"w-4 h-4 text-gray-700"})})]})]}),!c||c.length===0?e.jsx("div",{className:"text-sm text-gray-600 py-6 text-center",children:"No claimable items."}):e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-xl",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 truncate",children:t.title||"Settled prediction"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Claim ",k(t.amountUSD,{compact:!1})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{className:"h-9 px-3 rounded-lg border text-sm text-gray-700 hover:bg-gray-50",onClick:()=>ge(`/predictions/${t.predictionId}`),children:"View"}),e.jsx("button",{className:"h-9 px-3 rounded-lg bg-emerald-600 text-white text-sm font-semibold hover:bg-emerald-700 disabled:opacity-50",disabled:T&&X!==t.predictionId,onClick:async()=>{try{U(t.predictionId),await M({predictionId:t.predictionId,amountUnits:BigInt(t.amountUnits),proof:t.proof})&&(await h.invalidateQueries({queryKey:["wallet","claimable"]}),window.dispatchEvent(new CustomEvent("fcz:balance:refresh")))}finally{U(null)}},children:T&&X===t.predictionId?"Claiming…":"Claim"})]})]},`${t.predictionId}:${t.amountUnits}`))})]})]})]})};export{ut as default};
